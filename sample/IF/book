
[[doctype spellcast/book]]

[module] @@{core}/utils.kfg
#[module] @@{rpg}/system/inventory.kfg

[module] @@interpreter.kfg


[item-model coin]
	class: object
	name: coin
	description: A coin.
	params:
		examine-flavor: A silver coin.



[create-main-entity]
	class: character
	name: the hero
	slots:
		hand: 2



[here-actions]
	[call input/input]



[system input]
	
	[fn input]
		
		[define $state]
			input: ""
		[message] > input:
		[input $state.input]
		[request bot => $reply] $state
		[message] $> reply: ${reply}
		[debug] $reply



[chapter game]
	
	[starting-scene info]
		#[message] > Use with --script-debug
		[goto loop]

	[scene loop]
		[input $input]
		[request command-interpreter => $reply] $input
		[debug] $reply
		[message] $> Command: ${reply.command}, target: ${reply.target}
		[goto loop]




[create-main-sandbox]
	[place garden]
		ways:
			-	to: fountain
				label: to the fountain (south)
				# if present, 'from' indicate continuation from that direction,
				# here if we are going from the hall, we can continue to the fountain.
				from: hall
			-	to: hall
				label: to the hall (north)
				from: fountain
				door:
					name: metallic door
			-	to: chapel
				label: to the chapel (east)
				door:
					name: wood door
	
	[place chapel]
		# no need to define ways, there is only one way out: to the garden,
		# and a bi-directional passage through a wood door was created by the garden itself
	
	[action unlock]
		[check]
			[if $args.target.lock = false]
				[message] $> ${args.target.name} is not locked.
				[return] false
			
			[if $args.target.key != $args.agent]
				[message] $> ${args.agent.name} can't unlock ${args.target.name}.
				[return] false

		[on-success]
			[set $args.target.lock] false
		
		[success-report]
			[message] $> ${args.subject.name} unlock ${args.target.name}.

[chapter wanted-api]

	[scene wanted-api]
		[sandbox]


