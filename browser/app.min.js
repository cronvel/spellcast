(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,i;return function(){function e(t,i,n){function s(a,o){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return s(i||e)},u,u.exports,e,t,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}return e}()({1:[function(e,t,i){"use strict";var n=e("nextgen-events/lib/browser.js");var s=e("dom-kit");var r=e("svg-kit");var a=e("../../commonUtils.js");function o(){}function l(){this.$body=document.querySelector("body");this.$spellcast=document.querySelector("spellcast");this.$theme=document.querySelector("#theme");this.$gfx=document.querySelector("#gfx");this.$sceneImage=document.querySelector(".scene-image");this.$main=document.querySelector("main");this.$mainBuffer=document.querySelector("#main-buffer");this.$altBuffer=document.querySelector("#alt-buffer");this.$closeAltButton=document.querySelector("#button-close-alt");this.$dialogWrapper=document.querySelector("#dialog-wrapper");this.$hint=document.querySelector("#hint");this.$lobby=document.querySelector("#lobby");this.$clientStatus=this.$lobby.querySelector(".client-status");this.$status=document.querySelector("#status");this.$panel=document.querySelector("#panel");this.$music=document.querySelector("#music");this.$sound0=document.querySelector("#sound0");this.$sound1=document.querySelector("#sound1");this.$sound2=document.querySelector("#sound2");this.$sound3=document.querySelector("#sound3");this.choices=[];this.newSegmentNeeded=null;this.onSelect=null;this.onLeave=null;this.onEnter=null;this.toMainBuffer();this.nextSoundChannel=0;this.sprites={};this.uis={};this.markers={};this.cards={};this.cardLocations={};this.animations={};this.hintTimer=null;this.sceneImageOnTimer=null;this.onChatSubmit=null;this.uiLoadingCount=0;this.initEvents()}t.exports=l;l.prototype=Object.create(n.prototype);l.prototype.constructor=l;l.prototype.cleanUrl=function e(t){if(t[0]==="/"){return window.location.pathname+t.slice(1)}return window.location.pathname+"script/"+t};l.prototype.setTheme=function e(t){this.$theme.setAttribute("href",this.cleanUrl(t.url))};l.prototype.preload=function e(){s.preload(["icons/plugged.svg","icons/plugging.svg","icons/unplugged.svg","icons/unreachable-plug.svg"])};l.prototype.initEvents=function e(){this.$main.addEventListener("click",()=>this.emit("continue"),false);this.$gfx.addEventListener("click",()=>this.toggleSceneImage(),false);this.$dialogWrapper.addEventListener("click",()=>this.clearDialog(),false);this.$lobby.addEventListener("click",()=>{this.$lobby.classList.toggle("toggled")});this.$status.addEventListener("click",()=>{this.$status.classList.toggle("toggled")});this.$panel.addEventListener("click",()=>{this.$panel.classList.toggle("toggled")})};l.prototype.toggleSceneImage=function e(){if(this.$gfx.classList.contains("toggled")){this.sceneImageOff()}else{this.sceneImageOn()}};l.prototype.sceneImageOn=function e(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.add("toggled");this.$spellcast.classList.add("gfx-toggled");this.sceneImageOnTimer=setTimeout(this.sceneImageOff.bind(this),8e3)};l.prototype.sceneImageOff=function e(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.remove("toggled");this.$spellcast.classList.remove("gfx-toggled")};l.prototype.toMainBuffer=function e(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHint();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$importantMessages=null;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.$closeAltButton.classList.add("inactive");this.getSwitchedElements();return true};l.prototype.toAltBuffer=function e(){if(this.$activeBuffer===this.$altBuffer){return}this.$activeBuffer=this.$altBuffer;this.$importantMessages=this.$activeSegment;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.$closeAltButton.classList.remove("inactive");this.getSwitchedElements();return true};l.prototype.getSwitchedElements=function e(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};l.prototype.clientStatus=function e(t){this.$clientStatus.setAttribute("data-status",t);this.$clientStatus.setAttribute("title",t)};l.prototype.setMultiplayer=function e(t,i){i=i||o;if(t||t===undefined){this.$spellcast.classList.add("multiplayer")}else{this.$spellcast.classList.remove("multiplayer")}i()};l.prototype.clear=function e(t){t=t||o;s.empty(this.$hint);s.empty(this.$dialogWrapper);s.empty(this.$activeMessages);s.empty(this.$choices);t()};l.prototype.clearMessages=function e(t){t=t||o;s.empty(this.$activeMessages);t()};l.prototype.clearHistory=function e(t){t=t||o;s.empty(this.$history);t()};l.prototype.newSegment=function e(t){var i,n=t==="inter-segment";this.newSegmentNeeded=null;if(n){if(this.$activeSegment&&this.$activeSegment.tagName.toLowerCase()==="inter-segment"){return}i=document.createElement("inter-segment")}else{i=document.createElement("segment")}if(this.$activeSegment&&!this.$activeSegment.children.length){this.$activeSegment.remove()}this.$activeSegment=i;this.$activeMessages.appendChild(i);if(!n){this.moveToHistory()}};l.prototype.moveToHistory=function e(){var t,i;var n=Array.from(this.$activeMessages.children);i=n.length-2;while(i>=0&&n[i].tagName.toLowerCase()==="inter-segment"){i--}if(i<0){return}for(t=0;t<=i;t++){this.$history.appendChild(n[t])}n[i].scrollIntoView(false)};l.prototype.newSegmentOnContent=function e(t){t=t||"segment";this.newSegmentNeeded=t};l.prototype.addSelectedChoice=function e(t){var i=document.createElement("p");i.classList.add("chosen");i.textContent=t;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(i)};l.prototype.addMessage=function e(t,i,n){var r=false;n=n||o;var l=()=>{if(r){return}r=true;if(i.next){c.scrollIntoView(false);this.messageNext(i.next,n);return}n()};var c=document.createElement("p");c.classList.add("text");if(i.next){c.classList.add("continue")}if(i.class){s.class(c,a.toClassObject(i.class),"s-")}if(i.style){s.css(c,i.style)}c.innerHTML=t;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(c);if(i.important&&this.$importantMessages){this.$importantMessages.appendChild(c.cloneNode(true))}l()};l.prototype.messageNext=function e(t,i){var n=false;var s=()=>{if(n){return}n=true;this.$spellcast.classList.remove("continue");i()};this.$spellcast.classList.add("continue");this.once("continue",s);if(typeof t==="number"&&isFinite(t)&&t>0){setTimeout(s,t*1e3)}};l.prototype.addIndicators=function e(t,i,n){n=n||o;if(i){s.empty(this.$status);if(t.length){this.$status.classList.remove("empty")}else{this.$status.classList.add("empty");n();return}}var r=document.createElement("indicator-list");t.forEach(e=>{var t,i,n,s,a,o;t=document.createElement("indicator");i=document.createElement("label");i.classList.add("label");if(e.image){t.classList.add("has-image");n=document.createElement("img");n.classList.add("image");n.setAttribute("src",this.cleanUrl(e.image));if(e.label){n.setAttribute("alt",e.label);n.setAttribute("title",e.label)}i.appendChild(n)}else{i.textContent=e.label}t.appendChild(i);s=document.createElement("widget");s.classList.add("widget");s.classList.add(e.type);s.setAttribute("data-value",e.value);switch(e.type){case"hbar":o=document.createElement("outer-bar");s.appendChild(o);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.width=""+e.value+"%";o.appendChild(a);break;case"vbar":o=document.createElement("outer-bar");s.appendChild(o);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.height=""+e.value+"%";o.appendChild(a);break;case"text":default:s.textContent=e.value}t.appendChild(s);r.appendChild(t)});if(i){this.$status.appendChild(r)}else{if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(r)}n()};l.prototype.createChoiceEventHandlers=function e(t){this.onSelect=(e=>{var i=e.currentTarget;var n=i.getAttribute("data-select-index");if(!n){return}n=parseInt(n,10);t(n)});this.onLeave=(e=>{this.clearHint()});this.onEnter=(e=>{var t=e.currentTarget;var i=t.getAttribute("data-button-hint");if(!i){return}this.setHint(i,{active:true})})};l.prototype.addPanel=function e(t,i,n){n=n||o;if(i){s.empty(this.$panel);if(t.length){this.$panel.classList.remove("empty")}else{this.$panel.classList.add("empty");n();return}}else if(t.length){this.$panel.classList.remove("empty")}t.forEach(e=>{var t,i,n="button-"+e.id;if(document.getElementById(n)){return}t=document.createElement("item");t.classList.add("button");t.classList.add("disabled");t.setAttribute("id",n);if(e.image){t.classList.add("has-image");if(e.image.endsWith(".svg")){i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.classList.add("svg");r.load(this.cleanUrl(e.image),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,colorClass:true,as:i})}else{i=document.createElement("img");i.setAttribute("src",this.cleanUrl(e.image))}i.classList.add("icon");i.classList.add("image");if(e.label){i.setAttribute("alt",e.label);i.setAttribute("title",e.label)}t.appendChild(i)}else{t.textContent=e.label}this.$panel.appendChild(t)});n()};l.prototype.clearChoices=function e(t){var i;t=t||o;this.choices.forEach(e=>{if(!e.button){return}var t="button-"+e.button;i=document.getElementById(t);if(i){i.removeAttribute("data-select-index");i.classList.add("disabled");i.removeEventListener("click",this.onSelect);i.removeEventListener("mouseleave",this.onLeave);i.removeEventListener("mouseenter",this.onEnter)}});s.empty(this.$choices);this.choices.length=0;this.onSelect=null;this.onLeave=null;this.onEnter=null;t()};l.prototype.addChoices=function e(t,i,n){if(this.uiLoadingCount){this.once("uiLoaded",this.addChoices.bind(this,t,i,n));return}var r=false;var l=document.createDocumentFragment();var c=document.createElement("group");n=n||o;this.createChoiceEventHandlers(i);t.forEach(e=>{var t;this.choices.push(e);if(e.button&&(t=document.getElementById("button-"+e.button))&&!t.getAttribute("data-select-index")&&!t.classList.contains("inactive")){if(e.groupBreak){r=true}t.setAttribute("data-select-index",e.index);t.classList.remove("disabled");t.addEventListener("click",this.onSelect);if(e.label){t.setAttribute("data-button-hint",e.label);t.addEventListener("mouseleave",this.onLeave);t.addEventListener("mouseenter",this.onEnter)}return}var i=document.createElement("choice");i.classList.add("choice",e.type);i.setAttribute("data-select-index",e.index);i.classList.remove("disabled");if(e.class){s.class(i,a.toClassObject(e.class),"s-")}if(e.style){s.css(i,e.style)}if(e.image){i.classList.add("has-image");var n=document.createElement("img");n.classList.add("image");n.setAttribute("src",this.cleanUrl(e.image));i.appendChild(n)}var o=document.createElement("span");o.classList.add("label");o.textContent=e.label;i.appendChild(o);if(e.selectedBy&&e.selectedBy.length){var u=document.createElement("span");u.classList.add("italic","brightBlack");u.textContent=" "+e.selectedBy.join(", ");i.appendChild(u)}i.addEventListener("click",this.onSelect);if(e.groupBreak||r){r=false;l.appendChild(c);c=document.createElement("group")}c.appendChild(i)});l.appendChild(c);this.$choices.appendChild(l);n()};l.prototype.getChoiceColumnsCount=function e(t){var i=0,n=0;t.forEach(e=>{if(e.groupBreak){if(i>n){n=i}i=0}i++});if(i>n){n=i}return n};l.prototype.setChoices=function e(t,i,n,s,r){s=s||{};r=r||o;this.clearChoices(()=>{switch(s.nextStyle){case"inline":case"smallInline":case"list":case"smallList":this.$choices.setAttribute("data-choice-style",s.nextStyle);break;case"table":this.$choices.setAttribute("data-choice-style",s.nextStyle);this.$choices.classList.add("columns-"+this.getChoiceColumnsCount(t));break;default:this.$choices.setAttribute("data-choice-style","list")}this.addChoices(t,n,r);if(i&&i.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=i.join(", ");this.$choices.appendChild(e)}if(typeof s.timeout==="number"){this.choiceTimeout(s.timeout)}})};l.prototype.updateChoices=l.prototype.setChoices;l.prototype.choiceTimeout=function e(t){var i=Date.now(),n,s;n=document.createElement("p");n.classList.add("timer");n.textContent=Math.round(t/1e3);this.$choices.appendChild(n);s=setInterval(()=>{if(!n.parentNode){clearInterval(s);return}n.textContent=Math.round((t+i-Date.now())/1e3)},1e3)};l.prototype.textInputDisabled=function e(t){var i=document.createElement("form"),n=document.createElement("label"),s=document.createElement("input");n.textContent=t.label;s.setAttribute("placeholder",t.placeholder);s.setAttribute("disabled",true);s.setAttribute("type","text");s.classList.add("text-input");i.appendChild(n);i.appendChild(s);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(i)};l.prototype.textInput=function e(t,i){var n=document.createElement("form"),s=document.createElement("label"),r=document.createElement("input");s.classList.add("text");s.textContent=t.label;r.setAttribute("type","text");r.classList.add("text-input");n.appendChild(s);n.appendChild(r);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(n);r.focus();var a=function e(t){t.preventDefault();n.removeEventListener("submit",e);r.setAttribute("disabled",true);i(r.value)};n.addEventListener("submit",a)};l.prototype.enableChat=function e(t){if(!this.onChatSubmit){this.onChatSubmit=(e=>{e.preventDefault();t(this.$chatInput.value);this.$chatInput.value=""});this.$chatForm.addEventListener("submit",this.onChatSubmit);this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};l.prototype.disableChat=function e(){this.$chatForm.removeEventListener("submit",this.onChatSubmit);this.onChatSubmit=null;this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};l.prototype.clearHint=function e(){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint)},3e3)};l.prototype.setHint=function e(t,i){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}if(this.$hint.textContent){this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint);this.setHint(t,i)},300);return}this.$hint.textContent=t;this.$hint.classList.remove("empty");s.class(this.$hint,{passive:!!i.passive,active:!!i.active});this.hintTimer=setTimeout(this.clearHint.bind(this),3e3)};l.prototype.setBigHint=function e(t,i){var n=document.createElement("h2");n.textContent=t;if(i){s.class(n,i)}s.empty(this.$hint);this.$hint.appendChild(n)};l.prototype.clearDialog=function e(){this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var t=false;var i=()=>{this.$dialogWrapper.removeEventListener("transitionstart",i);if(t){return}t=true;this.$dialogWrapper.addEventListener("transitionend",n)};var n=()=>{this.$dialogWrapper.removeEventListener("transitionend",n);s.empty(this.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",i);setTimeout(()=>{if(t){return}t=true;s.empty(this.$dialogWrapper)},10)};l.prototype.setDialog=function e(t,i,n){i=i||{};n=n||o;if(i.contentDelay&&!this.newSegmentNeeded){delete i.contentDelay;var r=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var a=Math.min(r*10,5e3);console.warn("contentLength/delay",r,a);setTimeout(this.setDialog.bind(this,t,i,n),a);return}var l=document.createElement("div");l.classList.add("dialog");if(i.title){var c=document.createElement("h2");c.classList.add("title");c.textContent=i.title;l.appendChild(c)}var u=document.createElement("div");u.classList.add("message");u.textContent=t;l.appendChild(u);if(i.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(i.big){l.classList.add("big")}if(i.fun){l.classList.add("fun")}if(i.alert){l.classList.add("alert")}if(i.modal){l.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}s.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(l);this.$dialogWrapper.classList.remove("empty");n()};l.prototype.setSceneImage=function e(t){var i=false;var n=this.$sceneImage;this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(t.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")'}if(t.origin&&typeof t.origin==="string"){this.$sceneImage.style.backgroundPosition=t.origin}var s=()=>{if(i){return}i=true;n.remove()};if(n){n.addEventListener("transitionend",s,false);this.$gfx.insertBefore(this.$sceneImage,n);n.classList.add("hidden");setTimeout(s,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(t.position){case"left":this.$spellcast.setAttribute("data-image-position","left");break;case"right":default:this.$spellcast.setAttribute("data-image-position","right");break}};l.prototype.clearSprite=function e(t){if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}this.clearUiObject(this.sprites[t]);delete this.sprites[t]};l.prototype.clearUi=function e(t){if(!this.uis[t]){console.warn("Unknown UI id: ",t);return}this.clearUiObject(this.uis[t]);delete this.uis[t]};l.prototype.clearMarker=function e(t){if(!this.markers[t]){console.warn("Unknown Marker id: ",t);return}this.clearUiObject(this.markers[t]);delete this.markers[t]};l.prototype.clearCard=function e(t){if(!this.cards[t]){console.warn("Unknown Card id: ",t);return}this.clearCardObject(this.cards[t]);delete this.cards[t]};l.prototype.showSprite=function e(t,i){if(!i.url||typeof i.url!=="string"){return}if(this.sprites[t]){this.clearUiObject(this.sprites[t])}var n=this.sprites[t]=this.createUiObject({actionCallback:i.actionCallback,action:null,type:"sprite",class:i.class,style:{},animation:null});this.updateUiObject(n,i)};l.prototype.showUi=function e(t,i){if(!i.url||typeof i.url!=="string"){return}if(this.uis[t]){this.clearUiObject(this.uis[t])}var n=this.uis[t]=this.createUiObject({actionCallback:i.actionCallback,action:null,type:"ui",class:i.class,style:{},area:{},animation:null});this.updateUiObject(n,i)};l.prototype.showMarker=function e(t,i){if(!i.url||typeof i.url!=="string"){return}if(this.markers[t]){this.clearUiObject(this.markers[t])}var n=this.markers[t]=this.createUiObject({actionCallback:i.actionCallback,action:null,type:"marker",ui:null,location:null,class:i.class,style:{},animation:null});this.updateUiObject(n,i)};var c=0;l.prototype.showCard=function e(t,i){if(!i.url||typeof i.url!=="string"){return}if(this.cards[t]){this.clearCardObject(this.cards[t])}var n=this.cards[t]=this.createUiObject({actionCallback:i.actionCallback,action:null,type:"card",location:"showing",$locationSlot:null,pose:null,order:c++,class:i.class,style:{},imageStyle:{},animation:null,contents:{}});this.updateCardObject(n,i)};l.prototype.updateSprite=function e(t,i){if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}this.updateUiObject(this.sprites[t],i)};l.prototype.updateUi=function e(t,i){if(!this.uis[t]){console.warn("Unknown UI id: ",t);return}this.updateUiObject(this.uis[t],i)};l.prototype.updateMarker=function e(t,i){if(!this.markers[t]){console.warn("Unknown marker id: ",t);return}this.updateUiObject(this.markers[t],i)};l.prototype.updateCard=function e(t,i){if(!this.cards[t]){console.warn("Unknown card id: ",t);return}this.updateCardObject(this.cards[t],i)};l.prototype.animateSprite=function e(t,i){if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}if(!this.animations[i]){console.warn("Unknown animation id: ",i);return}this.animateUiObject(this.sprites[t],this.animations[i])};l.prototype.animateUi=function e(t,i){if(!this.uis[t]){console.warn("Unknown UI id: ",t);return}if(!this.animations[i]){console.warn("Unknown animation id: ",i);return}this.animateUiObject(this.uis[t],this.animations[i])};l.prototype.animateMarker=function e(t,i){if(!this.markers[t]){console.warn("Unknown marker id: ",t);return}if(!this.animations[i]){console.warn("Unknown animation id: ",i);return}this.animateUiObject(this.markers[t],this.animations[i])};l.prototype.animateCard=function e(t,i){if(!this.cards[t]){console.warn("Unknown card id: ",t);return}if(!this.animations[i]){console.warn("Unknown animation id: ",i);return}this.animateUiObject(this.cards[t],this.animations[i])};l.prototype.createUiObject=function e(t){var i=new n;Object.assign(i,t);i.defineStates("loaded","loading");return i};l.prototype.clearUiObject=function e(t){t.$image.remove();if(t.$mask){t.$mask.remove()}};l.prototype.updateUiObject=function e(t,i){var n;if(!i.style||typeof i.style!=="object"){i.style={}}delete i.style.position;if(i.url){if(i.url.endsWith(".svg")){if(t.$image){t.$image.remove()}if(t.type==="marker"){t.$image=document.createElementNS("http://www.w3.org/2000/svg","g")}else{t.$image=document.createElementNS("http://www.w3.org/2000/svg","svg");t.$image.classList.add("svg")}switch(t.type){case"ui":t.onClick=(e=>{e.stopPropagation()});t.$image.addEventListener("click",t.onClick);t.$image.classList.add("ui");this.uiLoadingCount++;break;case"sprite":t.$image.classList.add("sprite");break;case"marker":t.$image.classList.add("marker");break}r.load(this.cleanUrl(i.url),{removeSvgStyle:true,removeComments:true,removeExoticNamespaces:true,as:t.$image},()=>{if(t.type==="ui"){this.setUiButtons(t.$image);this.setUiPassiveHints(t.$image);t.emit("loaded");if(--this.uiLoadingCount<=0){this.emit("uiLoaded")}}else{t.emit("loaded")}});t.emit("loading")}else{if(!t.$image||t.$image.tagName.toLowerCase()!=="img"){if(t.$image){t.$image.remove()}t.$image=document.createElement("img");t.$image.classList.add(t.type)}t.$image.setAttribute("src",this.cleanUrl(i.url))}if(t.type!=="marker"){this.$gfx.append(t.$image)}}if(i.maskUrl&&i.maskUrl.endsWith(".svg")&&t.type==="sprite"){console.warn("has mask!");if(t.$mask){t.$mask.remove()}t.$mask=document.createElementNS("http://www.w3.org/2000/svg","svg");t.$mask.classList.add("sprite-mask");r.load(this.cleanUrl(i.maskUrl),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,as:t.$mask});this.$gfx.append(t.$mask)}if(i.action!==undefined){n=t.$mask||t.$image;if(i.action&&!t.action){t.onClick=(e=>{t.actionCallback(t.action);e.stopPropagation()});n.classList.add("button");n.addEventListener("click",t.onClick)}else if(!i.action&&t.action){n.classList.remove("button");n.removeEventListener("click",t.onClick)}t.action=i.action||null}if(i.style){Object.assign(t.style,i.style);s.css(t.$image,i.style);if(t.$mask){console.warn("update mask!");s.css(t.$mask,i.style)}}if(i.class){i.class=a.toClassObject(i.class);console.log("Data.class",i.class);Object.assign(t.class,i.class);s.class(t.$image,i.class,"s-");if(t.$mask){console.warn("update mask!");s.class(t.$mask,i.class,"s-")}}if(i.area){this.updateUiArea(t,i.area)}if(i.ui||i.location){this.updateMarkerLocation(t,i.ui,i.location)}};l.prototype.updateUiArea=function e(t,i){var n;if(t.type!=="ui"){return}if(!t.hasState("loaded")){t.once("loaded",this.updateUiArea.bind(this,t,i));return}for(n in i){if(!t.area[n]){t.area[n]={}}if(!t.area[n].status){t.area[n].status={}}if(i[n].hint!==undefined){t.area[n].hint=i[n].hint||null}if(i[n].status){Object.assign(t.area[n].status,i[n].status)}Array.from(t.$image.querySelectorAll("[area="+n+"]")).forEach(e=>{var t;if(i[n].hint!==undefined){if(i[n].hint){e.setAttribute("data-passive-hint",i[n].hint);e.classList.add("passive-hint")}else{e.removeAttribute("data-passive-hint");e.classList.remove("passive-hint")}}if(i[n].status){for(t in i[n].status){if(i[n].status[t]){e.classList.add("status-"+t)}else{e.classList.remove("status-"+t)}}}})}};l.prototype.updateMarkerLocation=function e(t,i,n){var s,a,o,l,c,u,h,f,d,p;if(!t.hasState("loaded")){t.once("loaded",this.updateMarkerLocation.bind(this,t,i,n));return}if(!i){i=t.ui}if(!n){n=t.location}if(!this.uis[i]){console.warn("Unknown UI id: ",i);return}s=this.uis[i];if(!s.hasState("loaded")){s.once("loaded",this.updateMarkerLocation.bind(this,t,i,n));return}a=s.$image.querySelector("[area="+n+"]");if(!a){console.warn("UI "+i+": area not found",n);return}t.ui=i;t.location=n;o=a.getBBox();d=o.x+o.width/2;p=o.y+o.height/2;l=r.getViewBox(t.$image);c=parseFloat(t.$image.getAttribute("width"))||l.width;u=parseFloat(t.$image.getAttribute("height"))||l.height;if(!isNaN(h=parseFloat(t.$image.getAttribute("originX")))){d-=(h-l.x)/l.width*c}if(!isNaN(f=parseFloat(t.$image.getAttribute("originY")))){p-=(f-l.y)/l.height*u}t.$image.style.transform="translate("+d+"px , "+p+"px )"+"scale("+c/l.width+" , "+u/l.height+")";if(t.$image.ownerSVGElement!==s.$image){s.$image.append(t.$image)}};l.prototype.clearCardObject=function e(t){if(t.$locationSlot){t.$locationSlot.remove()}t.$wrapper.remove()};l.prototype.updateCardObject=function e(t,i){var n,r,a,o,l;if(!t.$wrapper){this.createCardMarkup(t)}if(i.url){t.$image.style.backgroundImage='url("'+this.cleanUrl(i.url)+'")';delete i.url}if(i.backUrl){t.$backImage.style.backgroundImage='url("'+this.cleanUrl(i.backUrl)+'")';delete i.backUrl}if(i.content){for(n in i.content){r=i.content[n];a=t.contents[n];if(!a){a=t.contents[n]=document.createElement("div");a.classList.add("content-"+n);t.$front.append(a)}a.textContent=r;a.setAttribute("content",r)}delete i.content}if(i.location&&t.location!==i.location){this.moveCardTo(t,i.location,()=>{this.updateCardObject(t,i)});delete i.location;return}if(i.pose!==undefined){if(typeof i.pose==="string"){t.$wrapper.setAttribute("pose",i.pose);t.pose=i.pose}else{t.$wrapper.removeAttribute("pose");t.pose=null}}if(i.status){for(o in i.status){l=i.status[o];if(l){t.$wrapper.classList.add("status-"+o);if(typeof l==="number"||typeof l==="string"){t.$wrapper.setAttribute("status-"+o,l)}}else{t.$wrapper.classList.remove("status-"+o);if(t.$wrapper.hasAttribute("status-"+o)){t.$wrapper.removeAttribute("status-"+o)}}}}if(i.style){Object.assign(t.style,i.style);s.css(t.$wrapper,i.style)}if(i.imageStyle){Object.assign(t.imageStyle,i.imageStyle);s.css(t.$image,i.imageStyle)}};l.prototype.createCardMarkup=function e(t){t.$wrapper=document.createElement("div");t.$wrapper.classList.add("card-wrapper");t.$card=document.createElement("div");t.$card.classList.add("card");t.$wrapper.append(t.$card);t.$front=document.createElement("div");t.$front.classList.add("front");t.$card.append(t.$front);t.$image=document.createElement("div");t.$image.classList.add("card-image");t.$front.append(t.$image);t.$back=document.createElement("div");t.$back.classList.add("back");t.$card.append(t.$back);t.$backImage=document.createElement("div");t.$backImage.classList.add("card-image");t.$back.append(t.$backImage)};l.prototype.createCardLocation=function e(t){var i;if(this.cardLocations[t]){return}i=this.cardLocations[t]=document.createElement("div");i.classList.add("card-location");i.classList.add("card-location-"+t);this.$gfx.append(i)};l.prototype.moveCardTo=function e(t,i,n){var r,a,o,l,c,u,h,f,d,p,m,g,v;var y=10;if(t.location===i){n();return}r=this.cardLocations[i];c=t.$locationSlot;if(t.location){o=t.location;a=this.cardLocations[t.location]}if(!r){r=this.cardLocations[i]=document.createElement("div");r.classList.add("card-location");r.classList.add("card-location-"+i);this.$gfx.append(r)}if(!c){this.$gfx.append(t.$wrapper)}var b=window.getComputedStyle(t.$wrapper);var w=window.getComputedStyle(r);var k=parseFloat(b.width);var x=parseFloat(b.height);t.location=i;l=t.$locationSlot=document.createElement("div");l.classList.add("card-slot");l.style.order=t.order;f=Object.values(this.cards).filter(e=>e!==t&&(e.location===i||e.location===o));d=f.map(e=>e.$locationSlot.getBoundingClientRect());if(r.lastChild&&parseFloat(r.lastChild.style.order)>t.order){r.prepend(l)}else{r.append(l)}if(c){v=c.getBoundingClientRect();c.remove()}p=f.map(e=>e.$locationSlot.getBoundingClientRect());f.forEach((e,t)=>{var i=d[t],n=p[t];var r=e.$wrapper.style.transition;var a=e.$wrapper.style.transform;var o=Object.assign({},e.localTransform);o.translateX+=i.left-n.left;o.translateY+=i.top-i.top;e.$wrapper.style.transition="none";e.$wrapper.style.transform=s.stringifyTransform(o);setTimeout(()=>{e.$wrapper.style.transition=r;e.$wrapper.style.transform=a},y)});var _={translateX:0,translateY:0};switch(w.flexDirection){case"row":case"row-reverse":m=parseFloat(w.height);_.scaleX=_.scaleY=m/x;break;case"column":case"column-reverse":m=parseFloat(w.width);_.scaleX=_.scaleY=m/k;break;default:m=parseFloat(w.height);_.scaleX=_.scaleY=m/x;console.warn("flex-direction",w.flexDirection)}_.translateX-=(k-k*_.scaleX)/2;_.translateY-=(x-x*_.scaleY)/2;var C=t.localTransform;t.localTransform=_;if(!c){t.$wrapper.style.transform=s.stringifyTransform(_);l.append(t.$wrapper);n();return}var S=window.getComputedStyle(a);switch(S.flexDirection){case"column":case"column-reverse":h="column";break;default:h="row"}g=l.getBoundingClientRect();var L={translateX:v.left+C.translateX-g.left,translateY:v.top+C.translateY-g.top,scaleX:C.scaleX,scaleY:C.scaleY};t.$wrapper.style.transform=s.stringifyTransform(L);l.append(t.$wrapper);setTimeout(()=>{t.$wrapper.style.transform=s.stringifyTransform(_);n()},y)};l.prototype.animateUiObject=function e(t,i){var n,s=0;t.animation=i.id;if(!Array.isArray(i.frames)||!i.frames.length){return}var r=()=>{n=i.frames[s];this.updateUiObject(t,n);if(++s<i.frames.length){setTimeout(r,n.duration*1e3)}else{t.animation=null}};r()};l.prototype.defineAnimation=function e(t,i){i.id=t;this.animations[t]=i};l.prototype.setUiButtons=function e(t){Array.from(t.querySelectorAll("[button]")).forEach(e=>{var t=e.getAttribute("button");e.setAttribute("id","button-"+t);if(!e.getAttribute("area")){e.setAttribute("area",t)}e.classList.add("button");e.classList.add("disabled")})};l.prototype.setUiPassiveHints=function e(t){Array.from(t.querySelectorAll("[hint]")).forEach(e=>{var t=e.getAttribute("hint");e.setAttribute("data-passive-hint",t);e.classList.add("passive-hint");e.addEventListener("mouseleave",e=>{this.clearHint()});e.addEventListener("mouseenter",e=>{var t=e.currentTarget;var i=t.getAttribute("data-passive-hint");if(!i){return}this.setHint(i,{passive:true})})})};l.prototype.sound=function e(t){var i=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,t,i);this.nextSoundChannel=(this.nextSoundChannel+1)%4;i.setAttribute("src",this.cleanUrl(t.url));i.play()};l.prototype.music=function e(t){var i=this.$music.getAttribute("src");if(t.url){t.url=this.cleanUrl(t.url);if(i){if(i!==t.url){d(this.$music,()=>{this.$music.setAttribute("src",t.url);this.$music.play();f(this.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",t.url);this.$music.play();f(this.$music)}}else if(i){d(this.$music,()=>{this.$music.removeAttribute("src")})}};var u=10;var h=.01;function f(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+h);e.__fadeTimer=setTimeout(f.bind(undefined,e,t),u)}function d(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-h);e.__fadeTimer=setTimeout(d.bind(undefined,e,t),u)}},{"../../commonUtils.js":5,"dom-kit":7,"nextgen-events/lib/browser.js":11,"svg-kit":22}],2:[function(e,t,i){"use strict";var n=e("nextgen-events/lib/browser.js");var s=e("dom-kit");var r=e("url");function a(e){this.domain=e.domain||"localhost";this.port=e.port||80;this.path=e.path||"/";this.token=e.token||"";this.userName=e.name||"unknown_"+Math.floor(Math.random()*1e4);this.ws=null;this.proxy=null}t.exports=a;a.prototype=Object.create(n.prototype);a.prototype.constructor=a;var o={classic:e("./ui/classic.js")};a.autoCreate=function e(){var t={port:window.location.port,domain:window.location.hostname,path:window.location.pathname};Object.assign(t,r.parse(window.location.href,true).query);window.spellcastClient=new a(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};a.prototype.run=function e(t){var i=false;this.proxy=new n.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(e=>{if(o[e]){new o[e](this.proxy.remoteServices.bus,this)}});var s="ws://"+this.domain+(this.port?":"+this.port:"")+this.path+(this.token||"");console.log("Websocket URL:",s);this.ws=new WebSocket(s);this.emit("connecting");this.ws.onerror=(()=>{if(!i){console.log("Can't open Websocket (error)...");this.emit("error","unreachable");return}});this.ws.onopen=(()=>{i=true;console.log("Websocket opened!");this.emit("open");this.proxy.remoteServices.bus.emit("authenticate",{name:this.userName});if(typeof t==="function"){t()}});this.ws.onclose=(()=>{if(!i){console.log("Can't open Websocket (close)...");this.emit("error","unreachable");return}i=false;this.proxy.destroy();console.log("Websocket closed!");this.emit("close")});this.ws.onmessage=(e=>{var t;try{t=JSON.parse(e.data)}catch(e){return}console.log("Message received: ",t);this.proxy.receive(t)});this.proxy.send=(e=>{this.ws.send(JSON.stringify(e))})};a.autoCreate();s.ready(()=>{window.spellcastClient.run();document.body.onkeypress=(e=>{if(e.keyCode!==120){return}var t,i=document.querySelectorAll("link[rel=stylesheet]");for(var n=0;n<i.length;n++){t=i[n].getAttribute("href").split("?")[0]+"?"+Math.random();i[n].setAttribute("href",t)}})})},{"./ui/classic.js":4,"dom-kit":7,"nextgen-events/lib/browser.js":11,url:24}],3:[function(e,t,i){"use strict";var n={};t.exports=n;var s=e("string-kit/lib/format.js").markupMethod;var r=e("string-kit/lib/escape.js").html;var a={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="bright blue">',c:'<span class="cyan">',C:'<span class="bright cyan">',g:'<span class="green">',G:'<span class="bright green">',k:'<span class="black">',K:'<span class="grey">',m:'<span class="magenta">',M:'<span class="bright magenta">',r:'<span class="red">',R:'<span class="bright red">',w:'<span class="white">',W:'<span class="bright white">',y:'<span class="yellow">',Y:'<span class="bright yellow">'}};n.markup=function(...e){e[0]=r(e[0]).replace(/\n/,"<br />");return s.apply(a,e)}},{"string-kit/lib/escape.js":19,"string-kit/lib/format.js":20}],4:[function(e,t,i){"use strict";var n=e("nextgen-events/lib/browser.js");var s=e("../Dom.js");var r=e("../toolkit.js");function a(e,t){console.log(Array.from(arguments));this.bus=e;this.client=t;this.user=null;this.users=null;this.roles=null;this.roleId=null;this.config=null;this.inGame=false;this.nexts=null;this.afterNext=false;this.afterNextTriggered=false;this.afterLeave=false;this.hasNewContent=false;this.dom=new s;this.ended=false;this.client.once("connecting",a.clientConnecting.bind(this));this.client.once("open",a.clientOpen.bind(this));this.client.once("close",a.clientClose.bind(this));this.client.on("error",a.clientError.bind(this));this.dom.enableChat(e=>{console.log("inGame?",this.inGame);this.bus.emit(this.inGame?"command":"chat",e)});this.dom.preload()}t.exports=a;a.prototype=Object.create(n.prototype);a.prototype.constructor=a;function o(e){return this.find(t=>{return t.id===e})}a.prototype.initBus=function e(){this.bus.on("clientConfig",a.clientConfig.bind(this));this.bus.on("user",a.user.bind(this));this.bus.on("userList",a.userList.bind(this));this.bus.on("roleList",a.roleList.bind(this));this.bus.on("extOutput",a.extOutput.bind(this));this.bus.on("extErrorOutput",a.extErrorOutput.bind(this));this.bus.on("message",a.message.bind(this),{async:true});this.bus.on("indicators",a.indicators.bind(this));this.bus.on("status",a.status.bind(this));this.bus.on("panel",a.panel.bind(this));this.bus.on("theme",a.theme.bind(this));this.bus.on("image",a.image.bind(this));this.bus.on("sound",a.sound.bind(this));this.bus.on("music",a.music.bind(this));this.bus.on("defineAnimation",a.defineAnimation.bind(this));this.bus.on("showSprite",a.showSprite.bind(this));this.bus.on("updateSprite",a.updateSprite.bind(this));this.bus.on("animateSprite",a.animateSprite.bind(this));this.bus.on("clearSprite",a.clearSprite.bind(this));this.bus.on("showUi",a.showUi.bind(this));this.bus.on("updateUi",a.updateUi.bind(this));this.bus.on("animateUi",a.animateUi.bind(this));this.bus.on("clearUi",a.clearUi.bind(this));this.bus.on("showMarker",a.showMarker.bind(this));this.bus.on("updateMarker",a.updateMarker.bind(this));this.bus.on("animateMarker",a.animateMarker.bind(this));this.bus.on("clearMarker",a.clearMarker.bind(this));this.bus.on("showCard",a.showCard.bind(this));this.bus.on("updateCard",a.updateCard.bind(this));this.bus.on("animateCard",a.animateCard.bind(this));this.bus.on("clearCard",a.clearCard.bind(this));this.bus.on("enterScene",a.enterScene.bind(this));this.bus.on("leaveScene",a.leaveScene.bind(this));this.bus.on("nextList",a.nextList.bind(this));this.bus.on("nextTriggered",a.nextTriggered.bind(this));this.bus.on("textInput",a.textInput.bind(this));this.bus.on("rejoin",a.rejoin.bind(this));this.bus.on("pause",a.pause.bind(this));this.bus.on("unpause",a.unpause.bind(this));this.bus.on("wait",a.wait.bind(this));this.bus.on("end",a.end.bind(this),{async:true});this.bus.on("custom",a.custom.bind(this));this.bus.on("exit",a.exit.bind(this),{async:true});this.bus.emit("ready");this.defineStates("end")};a.clientConnecting=function e(){console.log("Connecting!");this.dom.clientStatus("connecting")};a.clientOpen=function e(){console.log("Connected!");this.dom.clientStatus("connected");this.initBus()};a.clientClose=function e(){console.log("Closed!");this.dom.clientStatus("closed")};a.clientError=function e(t){switch(t){case"unreachable":this.dom.clientStatus("unreachable");break}};a.clientConfig=function e(t){console.warn("Client config received: ",t);this.config=t;if(this.config.theme){this.dom.setTheme(this.config.theme)}};a.user=function e(t){console.log("User received: ",t);this.user=t};a.userList=function e(t){console.log("User-list received: ",t);t.get=o;this.users=t};a.roleList=function e(t,i,n){var s=[],r;if(!this.roles&&t.length>1){this.dom.setMultiplayer(true)}t.get=o;this.roles=t;if(this.inGame){return}if(n&&t.length<=1){this.roleId=t[0].id;return}t.forEach((e,t)=>{var i=e.clientId&&this.users.get(e.clientId).name;s.push({index:t,label:e.name,type:"role",selectedBy:i&&[i]})});if(i.length){r=i.map(e=>{return this.users.get(e).name})}var a=e=>{if(t[e].clientId===this.user.id){this.bus.emit("selectRole",null)}else if(t[e].clientId!==null){return}else{this.bus.emit("selectRole",e)}};this.dom.setChoices(s,r,a);if(n){t.find((e,t)=>{if(e.clientId===this.user.id){this.roleId=e.id;return true}return false});this.afterLeave=true;return}};a.message=function e(t,i,n){var s=false;this.hasNewContent=true;t=r.markup(t);if(!i){i={}}this.dom.addMessage(t,i,n)};a.indicators=function e(t){this.dom.addIndicators(t)};a.status=function e(t){this.dom.addIndicators(t,true)};a.panel=function e(t,i){this.dom.addPanel(t,i)};a.enterScene=function e(t,i){var n;this.inGame=true;if(i){n=this.dom.toAltBuffer()}if(!t&&!n){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};a.leaveScene=function e(t,i){if(i){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};a.nextTriggered=function e(t){var i=this.nexts[t];this.dom.newSegmentOnContent("inter-segment");if(i.label&&!i.button){this.dom.addSelectedChoice(i.label)}this.dom.clearChoices();this.afterNextTriggered=true;this.hasNewContent=false};a.nextList=function e(t,i,n,s,r){var a=[],o,l=0;this.nexts=t;this.afterNext=true;if(r&&this.roles.length===1){return}t.forEach((e,t)=>{var i=e.roleIds.map(e=>{return this.roles.get(e).name});if(e.label){l+=e.label.length}a.push({index:t,label:e.label||"Next",style:e.style,class:e.class,image:e.image,button:e.button,groupBreak:!!e.groupBreak,type:"next",selectedBy:i})});if(!s.nextStyle||s.nextStyle==="auto"){if(this.roles.length<=1&&a.length<=3&&l<20){s.nextStyle="inline"}else if(a.length>8){s.nextStyle="smallList"}else{s.nextStyle="list"}}if(n.length&&this.roles.length){o=n.map(e=>{return this.roles.get(e).name})}var c=e=>{if(t[e].roleIds.indexOf(this.roleId)!==-1){this.bus.emit("selectNext",null)}else{this.bus.emit("selectNext",e)}};this.dom.setChoices(a,o,c,{timeout:s.timeout,nextStyle:s.nextStyle})};a.extOutput=function e(t){alert("not coded ATM!")};a.extErrorOutput=function e(t){alert("not coded ATM!")};a.textInput=function e(t,i){var n={label:t};if(i.indexOf(this.roleId)===-1){n.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(n)}else{this.dom.textInput(n,e=>{this.bus.emit("textSubmit",e)})}};a.pause=function e(t){console.log("Received a pause event for",t,"seconds")};a.unpause=function e(){console.log("Received an unpause event")};a.rejoin=function e(){};a.wait=function e(t){switch(t){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoin",()=>this.dom.clearHint());break;default:this.dom.setBigHint("WAITING FOR "+t,{wait:true,"pulse-animation":true})}};a.theme=function e(t){if(!t.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(t)};a.image=function e(t){this.dom.setSceneImage(t)};a.defineAnimation=function e(t,i){this.dom.defineAnimation(t,i)};a.showSprite=function e(t,i){if(!i.url||typeof i.url!=="string"){return}i.actionCallback=a.spriteActionCallback.bind(this);this.dom.showSprite(t,i)};a.spriteActionCallback=function e(t){console.warn("Sprite action triggered: ",t);this.bus.emit("action",t)};a.updateSprite=function e(t,i){this.dom.updateSprite(t,i)};a.animateSprite=function e(t,i){this.dom.animateSprite(t,i)};a.clearSprite=function e(t){this.dom.clearSprite(t)};a.showUi=function e(t,i){if(!i.url||typeof i.url!=="string"){return}i.actionCallback=a.uiActionCallback.bind(this);this.dom.showUi(t,i)};a.uiActionCallback=function e(t){console.warn("UI action triggered: ",t);this.bus.emit("action",t)};a.updateUi=function e(t,i){this.dom.updateUi(t,i)};a.animateUi=function e(t,i){this.dom.animateUi(t,i)};a.clearUi=function e(t){this.dom.clearUi(t)};a.showMarker=function e(t,i){if(!i.url||typeof i.url!=="string"){return}i.actionCallback=a.markerActionCallback.bind(this);this.dom.showMarker(t,i)};a.markerActionCallback=function e(t){console.warn("Marker action triggered: ",t);this.bus.emit("action",t)};a.updateMarker=function e(t,i){this.dom.updateMarker(t,i)};a.animateMarker=function e(t,i){this.dom.animateMarker(t,i)};a.clearMarker=function e(t){this.dom.clearMarker(t)};a.showCard=function e(t,i){if(!i.url||typeof i.url!=="string"){return}i.actionCallback=a.cardActionCallback.bind(this);this.dom.showCard(t,i)};a.cardActionCallback=function e(t){console.warn("Card action triggered: ",t);this.bus.emit("action",t)};a.updateCard=function e(t,i){this.dom.updateCard(t,i)};a.animateCard=function e(t,i){this.dom.animateCard(t,i)};a.clearCard=function e(t){this.dom.clearCard(t)};a.sound=function e(t){this.dom.sound(t)};a.music=function e(t){this.dom.music(t)};a.end=function e(t,i,n){var s={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};var r=()=>{if(this.ended){return}this.ended=true;console.log("finished!");this.emit("end");n()};switch(t){case"end":this.dom.setDialog("The End.",s,r);break;case"win":this.dom.setDialog("You Win!",s,r);break;case"lost":this.dom.setDialog("You Lose...",s,r);break;case"draw":this.dom.setDialog("Draw.",s,r);break}};a.custom=function e(t,i){console.log("Received a custom event",t,i)};a.exit=function e(t,i,n){console.log("exit cb",n);this.once("end",()=>{setTimeout(200,n)})}},{"../Dom.js":1,"../toolkit.js":3,"nextgen-events/lib/browser.js":11}],5:[function(e,t,i){"use strict";i.toClassObject=function e(t){var i={};if(!t){return i}if(typeof t==="string"){i[t]=true;return i}if(typeof t==="object"){if(Array.isArray(t)){t.forEach(e=>i[e]=true);return i}return t}return i}},{}],6:[function(e,t,i){},{}],7:[function(e,t,i){(function(i){"use strict";var n,s;if(i.browser){n=new DOMParser;s=new XMLSerializer}else{var r=e("@cronvel/xmldom");n=new r.DOMParser;s=new r.XMLSerializer}var a={};t.exports=a;a.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};a.fromXml=function e(t){return n.parseFromString(t,"application/xml")};a.toXml=function e(t){return s.serializeToString(t)};a.fromHtml=function e(t){var i,n,s;s=document.createDocumentFragment();n=document.createElement("div");n.insertAdjacentHTML("beforeend",t);for(i=0;i<n.children.length;i++){s.appendChild(n.children[i])}return s};a.batch=function e(t,i,...n){var s;if(i instanceof Element){t(i,...n)}else if(Array.isArray(i)){for(s=0;s<i.length;s++){t(i[s],...n)}}else if(i instanceof NodeList||i instanceof NamedNodeMap){for(s=0;s<i.length;s++){t(i[s],...n)}}};a.css=function e(t,i){var n;for(n in i){t.style[n]=i[n]}};a.attr=function e(t,i,n){var s;n=n||"";for(s in i){if(i[s]===null){t.removeAttribute(n+s)}else{t.setAttribute(n+s,i[s])}}};a.class=function e(t,i,n){var s;n=n||"";for(s in i){if(i[s]){t.classList.add(n+s)}else{t.classList.remove(n+s)}}};a.remove=function e(t){t.parentNode.removeChild(t)};a.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};a.cloneInto=function e(t,i){a.empty(i);i.appendChild(t.cloneNode(true))};a.insertInto=function e(t,i){a.empty(i);i.appendChild(t)};a.moveChildrenInto=function e(t,i){a.empty(i);while(t.firstChild){i.appendChild(t.firstChild)}};a.moveAttributes=function e(t,i){Array.from(t.attributes).forEach(e=>{var n=e.name;var s=e.value;t.removeAttribute(n);if(n!=="xmlns"&&n.indexOf(":")===-1&&s){i.setAttribute(n,s)}})};a.styleToAttribute=function e(t,i,n){if(t.style[i]&&(!n||n.indexOf(t.style[i])===-1)){t.setAttribute(i,t.style[i]);t.style[i]=null}};a.prefixIds=function e(t,i){var n,s={};n=t.querySelectorAll("*");a.batch(a.prefixIds.idAttributePass,n,i,s);a.batch(a.prefixIds.otherAttributesPass,n,s)};a.prefixIds.idAttributePass=function e(t,i,n){n[t.id]=i+"."+t.id;t.id=n[t.id]};a.prefixIds.otherAttributesPass=function e(t,i){a.batch(a.prefixIds.oneAttributeSubPass,t.attributes,i)};a.prefixIds.oneAttributeSubPass=function e(t,i){t.value=t.value.replace(/url\(#([^)]+)\)/g,(e,t)=>{if(!i[t]){return e}return"url(#"+i[t]+")"})};a.removeAllTags=function e(t,i,n){Array.from(t.getElementsByTagName(i)).forEach(e=>{if(!n||!e.firstChild){e.parentNode.removeChild(e)}})};a.removeAllAttributes=function e(t,i){t.removeAttribute(i);Array.from(t.querySelectorAll("["+i+"]")).forEach(e=>{e.removeAttribute(i)})};a.preload=function e(t){if(!Array.isArray(t)){t=[t]}t.forEach(e=>{if(a.preload.preloaded[e]){return}a.preload.preloaded[e]=new Image;a.preload.preloaded[e].src=e})};a.preload.preloaded={};a.filterByNamespace=function e(t,i){var n,s,r,o,l;if(!i||typeof i!=="object"){return}a.filterAttributesByNamespace(t,i);for(n=t.childNodes.length-1;n>=0;n--){s=t.childNodes[n];if(s.nodeType===1){if(s.tagName.indexOf(":")!==-1){l=s.tagName.split(":");r=l[0];o=l[1];if(r===i.primary){s.tagName=o;a.filterByNamespace(s,i)}else if(i.whitelist){if(i.whitelist.indexOf(r)!==-1){a.filterByNamespace(s,i)}else{t.removeChild(s)}}else if(i.blacklist){if(i.blacklist.indexOf(r)!==-1){t.removeChild(s)}else{a.filterByNamespace(s,i)}}else{a.filterByNamespace(s,i)}}else{a.filterByNamespace(s,i)}}}};a.filterAttributesByNamespace=function e(t,i){var n,s,r,a,o,l;if(!i||typeof i!=="object"){return}for(n=t.attributes.length-1;n>=0;n--){s=t.attributes[n];if(s.name.indexOf(":")!==-1){l=s.name.split(":");r=l[0];a=l[1];o=s.value;if(r===i.primary){t.removeAttributeNode(s);t.setAttribute(a,o)}else if(i.whitelist){if(i.whitelist.indexOf(r)===-1){t.removeAttributeNode(s)}}else if(i.blacklist){if(i.blacklist.indexOf(r)!==-1){t.removeAttributeNode(s)}}}}};a.removeComments=function e(t){var i,n;for(i=t.childNodes.length-1;i>=0;i--){n=t.childNodes[i];if(n.nodeType===8){t.removeChild(n)}else if(n.nodeType===1){a.removeComments(n)}}};a.removeWhiteSpaces=function e(t,i){var n,s,r=null;for(n=t.childNodes.length-1;n>=0;n--){s=t.childNodes[n];if(s.nodeType===3){if(i){if(r){r.nodeValue=(s.nodeValue+r.nodeValue).replace(/^\s*(\n[\t ]*)$/,"$1");t.removeChild(s)}else{s.nodeValue=s.nodeValue.replace(/^\s*(\n[\t ]*)$/,"$1");r=s}}else if(!/\S/.test(s.nodeValue)){t.removeChild(s)}}else if(s.nodeType===1){r=null;a.removeWhiteSpaces(s,i)}else{r=null}}};a.parseMatrix=function e(t){var i=t.match(/(matrix|matrix3d)\(([0-9., -]+)\)/);if(!i){return null}return i[2].trim().split(/ ?, ?/).map(e=>{return parseFloat(e)})};a.decomposeMatrix=function e(t){if(t.length===6){return a.decomposeMatrix2d(t)}if(t.length===16){return a.decomposeMatrix3d(t)}return null};a.decomposeMatrix2d=function e(t){var i=Math.atan2(t[1],t[0]),n=t[0]*t[0]+t[1]*t[1],s=Math.sqrt(n),r=(t[0]*t[3]-t[2]*t[1])/s,a=Math.atan2(t[0]*t[2]+t[1]*t[3],n);return{rotate:180*i/Math.PI,scaleX:s,scaleY:r,skewX:180*a/Math.PI,skewY:0,translateX:t[4],translateY:t[5]}};a.decomposeMatrix3d=function e(t){var i=Math.PI/180;var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),s=Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),r=Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);var a=Math.atan2(-t[9]/r,t[10]/r)/i,o=Math.asin(t[8]/r)/i,l=Math.atan2(-t[4]/s,t[0]/n)/i;if(t[4]===1||t[4]===-1){a=0;o=t[4]*-Math.PI/2;l=t[4]*Math.atan2(t[6]/s,t[5]/s)/i}var c=t[12]/n,u=t[13]/n,h=t[14]/n;return{translateX:c,translateY:u,translateZ:h,rotateX:a,rotateY:o,rotateZ:l,scaleX:n,scaleY:s,scaleZ:r}};a.stringifyTransform=function e(t){var i=[];if(t.translateX){i.push("translateX("+t.translateX+"px)")}if(t.translateY){i.push("translateY("+t.translateY+"px)")}if(t.translateZ){i.push("translateZ("+t.translateZ+"px)")}if(t.rotate){i.push("rotate("+t.rotate+"deg)")}if(t.rotateX){i.push("rotateX("+t.rotateX+"deg)")}if(t.rotateY){i.push("rotateY("+t.rotateY+"deg)")}if(t.rotateZ){i.push("rotateZ("+t.rotateZ+"deg)")}if(t.scaleX){i.push("scaleX("+t.scaleX+")")}if(t.scaleY){i.push("scaleY("+t.scaleY+")")}if(t.scaleZ){i.push("scaleZ("+t.scaleZ+")")}if(t.skewX){i.push("skewX("+t.skewX+"deg)")}if(t.skewY){i.push("skewY("+t.skewY+"deg)")}return i.join(" ")};a.id=function e(t,i){t.id=i};a.text=function e(t,i){t.textContent=i};a.html=function e(t,i){t.innerHTML=i}}).call(this,e("_process"))},{"@cronvel/xmldom":6,_process:13}],8:[function(e,t,i){t.exports=function(e){return e!=null&&(n(e)||s(e)||!!e._isBuffer)};function n(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function s(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&n(e.slice(0,0))}},{}],9:[function(e,t,i){(function(i,n){"use strict";const s=i.browser?window.setImmediate:i.nextTick;if(!n.__NEXTGEN_EVENTS__){n.__NEXTGEN_EVENTS__={recursions:0}}var r=n.__NEXTGEN_EVENTS__;function a(){}t.exports=a;a.prototype.__prototypeUID__="nextgen-events/NextGenEvents";a.prototype.__prototypeVersion__=e("../package.json").version;a.SYNC=-Infinity;a.DESYNC=-1;a.defaultMaxListeners=Infinity;a.init=function e(){Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal})};a.Internal=function e(t){this.nice=a.SYNC;this.interruptible=false;this.contexts={};this.desync=setImmediate;this.depth=0;this.states={};this.stateGroups={};this.listeners={error:[],interrupt:[],newListener:[],removeListener:[]};this.maxListeners=a.defaultMaxListeners;if(t){this.nice=t.nice;this.interruptible=t.interruptible;Object.assign(this.states,t.states),Object.assign(this.stateGroups,t.stateGroups),Object.keys(t.listeners).forEach(e=>{this.listeners[e]=t.listeners[e].slice()});Object.keys(t.contexts).forEach(e=>{var i=t.contexts[e];this.contexts[e]={nice:i.nice,ready:true,status:i.status,serial:i.serial,scopes:{}}})}};a.initFrom=function e(t){if(!t.__ngev){a.init.call(t)}Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal(t.__ngev)})};a.mergeListeners=function e(t){if(!this.__ngev){a.init.call(this)}var i=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(i).forEach(e=>{this.__ngev.listeners[e]=[]});t.forEach(e=>{if(!e.__ngev){a.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(e=>{var n,s,r=[];if(i[e]){i[e].forEach(i=>{for(n=0,s=t.length;n<s;n++){if(!t[n].__ngev.listeners[e]||t[n].__ngev.listeners[e].indexOf(i)===-1){r.push(i);break}}})}t.forEach(t=>{t.__ngev.listeners[e].forEach(t=>{if(this.__ngev.listeners[e].indexOf(t)===-1&&r.indexOf(t)===-1){this.__ngev.listeners[e].push(t)}})})})};a.filterOutCallback=function(e,t){return e!==t};a.prototype.addListener=function e(t,n,s){var r={},o;if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){if(s===true&&n&&typeof n==="object"){s=r=n;n=undefined}else{s=n;n=undefined}}if(!s||typeof s!=="object"){s={}}r.fn=n||s.fn;r.id=s.id!==undefined?s.id:r.fn;r.once=!!s.once;r.async=!!s.async;r.eventObject=!!s.eventObject;r.nice=s.nice!==undefined?Math.floor(s.nice):a.SYNC;r.context=typeof s.context==="string"?s.context:null;if(typeof r.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(r.context&&typeof r.context==="string"&&!this.__ngev.contexts[r.context]){this.addListenerContext(r.context)}r.event=t;if(this.__ngev.listeners.newListener.length){o=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[t].push(r);a.emitEvent({emitter:this,name:"newListener",args:[[r]],listeners:o});if(this.__ngev.states[t]){a.emitToOneListener(this.__ngev.states[t],r)}return this}this.__ngev.listeners[t].push(r);if(this.__ngev.listeners[t].length===this.__ngev.maxListeners+1){i.emitWarning("Possible NextGenEvents memory leak detected. "+this.__ngev.listeners[t].length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit",{type:"MaxListenersExceededWarning"})}if(this.__ngev.states[t]){a.emitToOneListener(this.__ngev.states[t],r)}return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function e(t,i,n){if(i&&typeof i==="object"){i.once=true}else if(n&&typeof n==="object"){n.once=true}else{n={once:true}}return this.addListener(t,i,n)};a.prototype.waitFor=function e(t){return new Promise(e=>{this.addListener(t,t=>e(t),{once:true})})};a.prototype.waitForAll=function e(t){return new Promise(e=>{this.addListener(t,(...t)=>e(t),{once:true})})};a.prototype.removeListener=function e(t,i){var n,s,r=[],o=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}s=this.__ngev.listeners[t].length;for(n=0;n<s;n++){if(this.__ngev.listeners[t][n].id===i){o.push(this.__ngev.listeners[t][n])}else{r.push(this.__ngev.listeners[t][n])}}this.__ngev.listeners[t]=r;if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function e(t){var i;if(!this.__ngev){a.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}i=this.__ngev.listeners[t];this.__ngev.listeners[t]=[];if(i.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",i)}}else{this.__ngev.listeners={error:[],interrupt:[],newListener:[],removeListener:[]}}return this};a.listenerWrapper=function e(t,i,n,s){var r,o;if(i.interrupt){return}if(t.async){if(n){n.ready=!s}o=(e=>{i.listenersDone++;if(e&&i.emitter.__ngev.interruptible&&!i.interrupt&&i.name!=="interrupt"){i.interrupt=e;if(i.callback){a.emitCallback(i)}i.emitter.emit("interrupt",i.interrupt)}else if(i.listenersDone>=i.listeners.length&&i.callback){a.emitCallback(i)}if(s){a.processScopeQueue(i.emitter,n,true,true)}});if(t.eventObject){t.fn(i,o)}else{r=t.fn.apply(undefined,i.args.concat(o))}}else{if(t.eventObject){t.fn(i)}else{r=t.fn.apply(undefined,i.args)}i.listenersDone++}if(r&&i.emitter.__ngev.interruptible&&!i.interrupt&&i.name!=="interrupt"){i.interrupt=r;if(i.callback){a.emitCallback(i)}i.emitter.emit("interrupt",i.interrupt)}else if(i.listenersDone>=i.listeners.length&&i.callback){a.emitCallback(i)}};var o=0;a.prototype.emit=function e(...t){var i;i={emitter:this,interrupt:null,sync:true};if(typeof t[0]==="number"){i.nice=Math.floor(t[0]);i.name=t[1];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(2,-1)}else{i.args=t.slice(2)}}else{i.name=t[0];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(1,-1)}else{i.args=t.slice(1)}}return a.emitEvent(i)};a.prototype.waitForEmit=function e(...t){return new Promise(e=>{this.emit(...t,t=>e(t))})};a.emitEvent=function e(t){var i=t.emitter,n,s,l=0,c,u;if(!i.__ngev){a.init.call(i)}c=i.__ngev.states[t.name];if(c!==undefined){if(c&&t.args.length===c.args.length&&t.args.every((e,t)=>e===c.args[t])){return}i.__ngev.stateGroups[t.name].forEach(e=>{i.__ngev.states[e]=null});i.__ngev.states[t.name]=t}if(!i.__ngev.listeners[t.name]){i.__ngev.listeners[t.name]=[]}t.id=o++;t.listenersDone=0;t.once=!!t.once;if(t.nice===undefined||t.nice===null){t.nice=i.__ngev.nice}if(!t.listeners){t.listeners=i.__ngev.listeners[t.name].slice()}r.recursions++;t.depth=i.__ngev.depth++;u=[];for(n=0,s=t.listeners.length;n<s;n++){l++;a.emitToOneListener(t,t.listeners[n],u)}r.recursions--;if(!t.callback){i.__ngev.depth--}if(u.length&&i.__ngev.listeners.removeListener.length){i.emit("removeListener",u)}if(!l){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){a.emitCallback(t)}}t.sync=false;return t};a.emitToOneListener=function e(t,i,n){var s=t.emitter,o,l,c,u,h=false;o=i.context&&s.__ngev.contexts[i.context];if(o&&o.status===a.CONTEXT_DISABLED){return}if(o){u=Math.max(t.nice,i.nice,o.nice);c=o.serial;l=a.getContextScope(o,t.depth)}else{u=Math.max(t.nice,i.nice)}if(i.once){s.__ngev.listeners[t.name]=s.__ngev.listeners[t.name].filter(a.filterOutCallback.bind(undefined,i));if(n){n.push(i)}else{h=true}}if(o&&(o.status===a.CONTEXT_QUEUED||!l.ready)){l.queue.push({event:t,listener:i,nice:u})}else{try{if(u<0){if(r.recursions>=-u){s.__ngev.desync(a.listenerWrapper.bind(s,i,t,l,c))}else{a.listenerWrapper.call(s,i,t,l,c)}}else{setTimeout(a.listenerWrapper.bind(s,i,t,l,c),u)}}catch(e){r.recursions--;throw e}}if(h&&s.__ngev.listeners.removeListener.length){s.emit("removeListener",[i])}};a.emitCallback=function e(t){var i=t.callback;delete t.callback;if(t.sync&&t.emitter.__ngev.nice!==a.SYNC){t.emitter.__ngev.desync(()=>{t.emitter.__ngev.depth--;i(t.interrupt,t)})}else{t.emitter.__ngev.depth--;i(t.interrupt,t)}};a.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}return this.__ngev.listeners[t].slice()};a.listenerCount=function(e,t){if(!e||!(e instanceof a)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};a.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};a.prototype.setNice=function e(t){if(!this.__ngev){a.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};a.prototype.desyncUseNextTick=function e(t){if(!this.__ngev){a.init.call(this)}this.__ngev.desync=t?s:setImmediate};a.prototype.setInterruptible=function e(t){if(!this.__ngev){a.init.call(this)}this.__ngev.interruptible=!!t};a.share=function(e,t){if(!(e instanceof a)||!(t instanceof a)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){a.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};a.reset=function e(t){Object.defineProperty(t,"__ngev",{configurable:true,value:null})};a.prototype.getMaxListeners=function(){if(!this.__ngev){a.init.call(this)}return this.__ngev.maxListeners};a.prototype.setMaxListeners=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.maxListeners=typeof e==="number"&&!Number.isNaN(e)?Math.floor(e):a.defaultMaxListeners;return this};a.noop=function(){};a.prototype.defineStates=function e(...t){if(!this.__ngev){a.init.call(this)}t.forEach(e=>{this.__ngev.states[e]=null;this.__ngev.stateGroups[e]=t})};a.prototype.hasState=function e(t){if(!this.__ngev){a.init.call(this)}return!!this.__ngev.states[t]};a.prototype.getAllStates=function e(){if(!this.__ngev){a.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>this.__ngev.states[e])};a.groupAddListener=function e(t,i,n,s){if(typeof n!=="function"){s=n;n=undefined}if(!s||typeof s!=="object"){s={}}n=n||s.fn;delete s.fn;s.id=s.id||n;t.forEach(e=>{e.addListener(i,n.bind(undefined,e),s)})};a.groupOn=a.groupAddListener;a.groupOnce=function e(t,i,n,s){if(n&&typeof n==="object"){n.once=true}else if(s&&typeof s==="object"){s.once=true}else{s={once:true}}return this.groupAddListener(t,i,n,s)};a.groupGlobalOnce=function e(t,i,n,s){var r,o=false;if(typeof n!=="function"){s=n;n=undefined}if(!s||typeof s!=="object"){s={}}n=n||s.fn;delete s.fn;s.id=s.id||n;r=((...e)=>{if(o){return}o=true;a.groupRemoveListener(t,i,s.id);n(...e)});t.forEach(e=>{e.once(i,r.bind(undefined,e),s)})};a.groupGlobalOnceAll=function e(t,i,n,s){var r,a=false,o=t.length;if(typeof n!=="function"){s=n;n=undefined}if(!s||typeof s!=="object"){s={}}n=n||s.fn;delete s.fn;s.id=s.id||n;r=((...e)=>{if(a){return}if(--o){return}a=true;n(...e)});t.forEach(e=>{e.once(i,r.bind(undefined,e),s)})};a.groupRemoveListener=function e(t,i,n){t.forEach(e=>{e.removeListener(i,n)})};a.groupOff=a.groupRemoveListener;a.groupRemoveAllListeners=function e(t,i){t.forEach(e=>{e.removeAllListeners(i)})};a.groupEmit=function e(t,...i){var n,s,r=1,o,l=t.length,c,u,h=false;if(typeof i[i.length-1]==="function"){o=-1;c=i[i.length-1];u=(e=>{if(h){return}if(e){h=true;c(e)}else if(!--l){h=true;c()}})}if(typeof i[0]==="number"){r=2;s=typeof i[0]}n=i[r-1];i=i.slice(r,o);t.forEach(e=>{a.emitEvent({emitter:e,name:n,args:i,nice:s,callback:u})})};a.groupDefineStates=function e(t,...i){t.forEach(e=>{e.defineStates(...i)})};a.CONTEXT_ENABLED=0;a.CONTEXT_DISABLED=1;a.CONTEXT_QUEUED=2;a.prototype.addListenerContext=function e(t,i){if(!this.__ngev){a.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!i||typeof i!=="object"){i={}}var n=this.__ngev.contexts[t];if(!n){n=this.__ngev.contexts[t]={nice:a.SYNC,ready:true,status:a.CONTEXT_ENABLED,serial:false,scopes:{}}}if(i.nice!==undefined){n.nice=Math.floor(i.nice)}if(i.status!==undefined){n.status=i.status}if(i.serial!==undefined){n.serial=!!i.serial}return this};a.getContextScope=function e(t,i){var n=t.scopes[i];if(!n){n=t.scopes[i]={ready:true,queue:[]}}return n};a.prototype.disableListenerContext=function e(t){if(!this.__ngev){a.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=a.CONTEXT_DISABLED;return this};a.prototype.enableListenerContext=function e(t){if(!this.__ngev){a.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}var i=this.__ngev.contexts[t];i.status=a.CONTEXT_ENABLED;Object.values(i.scopes).forEach(e=>{if(e.queue.length>0){a.processScopeQueue(this,e,i.serial)}});return this};a.prototype.queueListenerContext=function e(t){if(!this.__ngev){a.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=a.CONTEXT_QUEUED;return this};a.prototype.serializeListenerContext=function e(t,i){if(!this.__ngev){a.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=i===undefined?true:!!i;return this};a.prototype.setListenerContextNice=function e(t,i){if(!this.__ngev){a.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(i);return this};a.prototype.destroyListenerContext=function e(t){var i,n,s,r,o=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}for(s in this.__ngev.listeners){r=null;n=this.__ngev.listeners[s].length;for(i=0;i<n;i++){if(this.__ngev.listeners[s][i].context===t){r=[];o.push(this.__ngev.listeners[s][i])}else if(r){r.push(this.__ngev.listeners[s][i])}}if(r){this.__ngev.listeners[s]=r}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};a.processScopeQueue=function e(t,i,n,s){var o;if(s){i.ready=true}r.recursions++;while(i.ready&&i.queue.length){o=i.queue.shift();if(o.event.interrupt){continue}try{if(o.nice<0){if(r.recursions>=-o.nice){t.__ngev.desync(a.listenerWrapper.bind(t,o.listener,o.event,i,n))}else{a.listenerWrapper.call(t,o.listener,o.event,i,n)}}else{setTimeout(a.listenerWrapper.bind(t,o.listener,o.event,i,n),o.nice)}}catch(e){r.recursions--;throw e}}r.recursions--};a.on=a.prototype.on;a.once=a.prototype.once;a.off=a.prototype.off;if(n.AsyncTryCatch){a.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(a);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}a.Proxy=e("./Proxy.js")}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":12,"./Proxy.js":10,_process:13}],10:[function(e,t,i){"use strict";function n(){this.localServices={};this.remoteServices={};this.nextAckId=1}t.exports=n;var s=e("./NextGenEvents.js");var r="NextGenEvents/message";function a(){}n.create=((...e)=>new n(...e));n.prototype.addLocalService=function e(t,i,n){this.localServices[t]=o.create(this,t,i,n);return this.localServices[t]};n.prototype.addRemoteService=function e(t){this.remoteServices[t]=l.create(this,t);return this.remoteServices[t]};n.prototype.destroy=function e(){Object.keys(this.localServices).forEach(e=>{this.localServices[e].destroy();delete this.localServices[e]});Object.keys(this.remoteServices).forEach(e=>{this.remoteServices[e].destroy();delete this.remoteServices[e]});this.receive=this.send=a};n.prototype.push=function e(t){if(t.__type!==r||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};n.prototype.receive=function e(t){this.push(t)};n.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function o(e,t,i,n){return o.create(e,t,i,n)}n.LocalService=o;o.create=function e(t,i,n,r){var a=Object.create(o.prototype,{proxy:{value:t,enumerable:true},id:{value:i,enumerable:true},emitter:{value:n,writable:true,enumerable:true},internalEvents:{value:Object.create(s.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!r.listen,writable:true,enumerable:true},canEmit:{value:!!r.emit,writable:true,enumerable:true},canAck:{value:!!r.ack,writable:true,enumerable:true},canRpc:{value:!!r.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return a};o.prototype.destroy=function e(){Object.keys(this.events).forEach(e=>{this.emitter.off(e,this.events[e]);delete this.events[e]});this.emitter=null;this.destroyed=true};o.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var i={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){i.callback=(e=>{this.proxy.send({__type:r,service:this.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:e})})}s.emitEvent(i)};o.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=o.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=o.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};o.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};o.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t)};o.forward=function e(t){if(this.destroyed){return}this.proxy.send({__type:r,service:this.id,method:"event",event:t.name,args:t.args})};o.forward.ack=false;o.forwardWithAck=function e(t,i){if(this.destroyed){return}if(!t.callback){this.proxy.send({__type:r,service:this.id,method:"event",event:t.name,args:t.args});i();return}var n=false;var s=this.proxy.nextAckId++;var a=e=>{if(n||e.ack!==s){return}n=true;this.internalEvents.off("ack",a);i()};this.internalEvents.on("ack",a);this.proxy.send({__type:r,service:this.id,method:"event",event:t.name,ack:s,args:t.args})};o.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}n.RemoteService=l;var c=1;var u=2;l.create=function e(t,i){var n=Object.create(l.prototype,{proxy:{value:t,enumerable:true},id:{value:i,enumerable:true},emitter:{value:Object.create(s.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(s.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return n};l.prototype.destroy=function e(){this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(e=>{delete this.events[e]});this.destroyed=true};l.prototype.emit=function e(t,...i){if(this.destroyed){return}var n,s,a;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof i[i.length-1]!=="function"){this.proxy.send({__type:r,service:this.id,method:"emit",event:t,args:i});return}n=i.pop();s=this.proxy.nextAckId++;a=false;var o=e=>{if(a||e.ack!==s){return}a=true;this.internalEvents.off("ack",o);n(e.interruption)};this.internalEvents.on("ack",o);this.proxy.send({__type:r,service:this.id,method:"emit",ack:s,event:t,args:i})};l.prototype.addListener=function e(t,i,n){if(this.destroyed){return}if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}n.fn=i||n.fn;this.emitter.addListener(t,n);if(!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length){return}if(n.async&&this.events[t]!==u){this.events[t]=u;this.proxy.send({__type:r,service:this.id,method:"listen",ack:true,event:t})}else if(!n.async&&!this.events[t]){this.events[t]=c;this.proxy.send({__type:r,service:this.id,method:"listen",event:t})}};l.prototype.on=l.prototype.addListener;l.prototype.once=s.prototype.once;l.prototype.removeListener=function e(t,i){if(this.destroyed){return}this.emitter.removeListener(t,i);if((!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({__type:r,service:this.id,method:"ignore",event:t})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function e(t){if(this.destroyed||!this.events[t.event]){return}var i={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){i.callback=(()=>{this.proxy.send({__type:r,service:this.id,method:"ackEvent",ack:t.ack,event:t.event})})}s.emitEvent(i);var n=i.name;if(!this.emitter.__ngev.listeners[n]||!this.emitter.__ngev.listeners[n].length){this.events[n]=0;this.proxy.send({__type:r,service:this.id,method:"ignore",event:n})}};l.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==u){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":9}],11:[function(e,t,i){(function(i){"use strict";if(typeof window.setImmediate!=="function"){window.setImmediate=function e(t){setTimeout(t,0)}}if(!i.emitWarning){i.emitWarning=function(){}}t.exports=e("./NextGenEvents.js");t.exports.isBrowser=true}).call(this,e("_process"))},{"./NextGenEvents.js":9,_process:13}],12:[function(e,t,i){t.exports={_from:"nextgen-events@1.0.1",_id:"nextgen-events@1.0.1",_inBundle:false,_integrity:"sha512-ATR5qGlRJiptrv9awMyxgI+SDZlsB+GrkicjX1zAeit0cqJkMslbbL/2dcjk0K0a1kUWc1AM3SEKGQn4PlHUaA==",_location:"/nextgen-events",_phantomChildren:{},_requested:{type:"version",registry:true,raw:"nextgen-events@1.0.1",name:"nextgen-events",escapedName:"nextgen-events",rawSpec:"1.0.1",saveSpec:null,fetchSpec:"1.0.1"},_requiredBy:["#USER","/","/terminal-kit"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-1.0.1.tgz",_shasum:"cfea77630b360ca2eb257c82fb348679c10ebf66",_spec:"nextgen-events@1.0.1",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cdric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},bundleDependencies:false,config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2018],owner:"Cdric Ronvel"},dependencies:{},deprecated:false,description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^16.2.2","uglify-js-es6":"^2.8.9",ws:"^5.1.1"},directories:{test:"test"},engines:{node:">=6.0.0"},homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",name:"nextgen-events",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"tea-time -R dot"},version:"1.0.1"}},{}],13:[function(e,t,i){var n=t.exports={};var s;var r;function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){s=setTimeout}else{s=a}}catch(e){s=a}try{if(typeof clearTimeout==="function"){r=clearTimeout}else{r=o}}catch(e){r=o}})();function l(e){if(s===setTimeout){return setTimeout(e,0)}if((s===a||!s)&&setTimeout){s=setTimeout;return setTimeout(e,0)}try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}function c(e){if(r===clearTimeout){return clearTimeout(e)}if((r===o||!r)&&clearTimeout){r=clearTimeout;return clearTimeout(e)}try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}var u=[];var h=false;var f;var d=-1;function p(){if(!h||!f){return}h=false;if(f.length){u=f.concat(u)}else{d=-1}if(u.length){m()}}function m(){if(h){return}var e=l(p);h=true;var t=u.length;while(t){f=u;u=[];while(++d<t){if(f){f[d].run()}}d=-1;t=u.length}f=null;h=false;c(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}u.push(new g(e,t));if(u.length===1&&!h){l(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function v(){}n.on=v;n.addListener=v;n.once=v;n.off=v;n.removeListener=v;n.removeAllListeners=v;n.emit=v;n.prependListener=v;n.prependOnceListener=v;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],14:[function(t,i,n){(function(t){(function(s){var r=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof i=="object"&&i&&!i.nodeType&&i;var o=typeof t=="object"&&t;if(o.global===o||o.window===o||o.self===o){s=o}var l,c=2147483647,u=36,h=1,f=26,d=38,p=700,m=72,g=128,v="-",y=/^xn--/,b=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,k={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=u-h,_=Math.floor,C=String.fromCharCode,S;function L(e){throw new RangeError(k[e])}function $(e,t){var i=e.length;var n=[];while(i--){n[i]=t(e[i])}return n}function E(e,t){var i=e.split("@");var n="";if(i.length>1){n=i[0]+"@";e=i[1]}e=e.replace(w,".");var s=e.split(".");var r=$(s,t).join(".");return n+r}function A(e){var t=[],i=0,n=e.length,s,r;while(i<n){s=e.charCodeAt(i++);if(s>=55296&&s<=56319&&i<n){r=e.charCodeAt(i++);if((r&64512)==56320){t.push(((s&1023)<<10)+(r&1023)+65536)}else{t.push(s);i--}}else{t.push(s)}}return t}function j(e){return $(e,function(e){var t="";if(e>65535){e-=65536;t+=C(e>>>10&1023|55296);e=56320|e&1023}t+=C(e);return t}).join("")}function T(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function O(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function M(e,t,i){var n=0;e=i?_(e/p):e>>1;e+=_(e/t);for(;e>x*f>>1;n+=u){e=_(e/x)}return _(n+(x+1)*e/(e+d))}function N(e){var t=[],i=e.length,n,s=0,r=g,a=m,o,l,d,p,y,b,w,k,x;o=e.lastIndexOf(v);if(o<0){o=0}for(l=0;l<o;++l){if(e.charCodeAt(l)>=128){L("not-basic")}t.push(e.charCodeAt(l))}for(d=o>0?o+1:0;d<i;){for(p=s,y=1,b=u;;b+=u){if(d>=i){L("invalid-input")}w=T(e.charCodeAt(d++));if(w>=u||w>_((c-s)/y)){L("overflow")}s+=w*y;k=b<=a?h:b>=a+f?f:b-a;if(w<k){break}x=u-k;if(y>_(c/x)){L("overflow")}y*=x}n=t.length+1;a=M(s-p,n,p==0);if(_(s/n)>c-r){L("overflow")}r+=_(s/n);s%=n;t.splice(s++,0,r)}return j(t)}function I(e){var t,i,n,s,r,a,o,l,d,p,y,b=[],w,k,x,S;e=A(e);w=e.length;t=g;i=0;r=m;for(a=0;a<w;++a){y=e[a];if(y<128){b.push(C(y))}}n=s=b.length;if(s){b.push(v)}while(n<w){for(o=c,a=0;a<w;++a){y=e[a];if(y>=t&&y<o){o=y}}k=n+1;if(o-t>_((c-i)/k)){L("overflow")}i+=(o-t)*k;t=o;for(a=0;a<w;++a){y=e[a];if(y<t&&++i>c){L("overflow")}if(y==t){for(l=i,d=u;;d+=u){p=d<=r?h:d>=r+f?f:d-r;if(l<p){break}S=l-p;x=u-p;b.push(C(O(p+S%x,0)));l=_(S/x)}b.push(C(O(l,0)));r=M(i,k,n==s);i=0;++n}}++i;++t}return b.join("")}function B(e){return E(e,function(e){return y.test(e)?N(e.slice(4).toLowerCase()):e})}function U(e){return E(e,function(e){return b.test(e)?"xn--"+I(e):e})}l={version:"1.4.1",ucs2:{decode:A,encode:j},decode:N,encode:I,toASCII:U,toUnicode:B};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return l})}else if(r&&a){if(i.exports==r){a.exports=l}else{for(S in l){l.hasOwnProperty(S)&&(r[S]=l[S])}}}else{s.punycode=l}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],15:[function(e,t,i){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,i,r){t=t||"&";i=i||"=";var a={};if(typeof e!=="string"||e.length===0){return a}var o=/\+/g;e=e.split(t);var l=1e3;if(r&&typeof r.maxKeys==="number"){l=r.maxKeys}var c=e.length;if(l>0&&c>l){c=l}for(var u=0;u<c;++u){var h=e[u].replace(o,"%20"),f=h.indexOf(i),d,p,m,g;if(f>=0){d=h.substr(0,f);p=h.substr(f+1)}else{d=h;p=""}m=decodeURIComponent(d);g=decodeURIComponent(p);if(!n(a,m)){a[m]=g}else if(s(a[m])){a[m].push(g)}else{a[m]=[a[m],g]}}return a};var s=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],16:[function(e,t,i){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,i,o){t=t||"&";i=i||"=";if(e===null){e=undefined}if(typeof e==="object"){return r(a(e),function(a){var o=encodeURIComponent(n(a))+i;if(s(e[a])){return r(e[a],function(e){return o+encodeURIComponent(n(e))}).join(t)}else{return o+encodeURIComponent(n(e[a]))}}).join(t)}if(!o)return"";return encodeURIComponent(n(o))+i+encodeURIComponent(n(e))};var s=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function r(e,t){if(e.map)return e.map(t);var i=[];for(var n=0;n<e.length;n++){i.push(t(e[n],n))}return i}var a=Object.keys||function(e){var t=[];for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i))t.push(i)}return t}},{}],17:[function(e,t,i){"use strict";i.decode=i.parse=e("./decode");i.encode=i.stringify=e("./encode")},{"./decode":15,"./encode":16}],18:[function(e,t,i){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"}},{}],19:[function(e,t,i){"use strict";i.regExp=i.regExpPattern=function e(t){return t.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1")};i.regExpReplacement=function e(t){return t.replace(/\$/g,"$$$$")};i.format=function e(t){return t.replace(/%/g,"%%")};i.jsSingleQuote=function e(t){return i.control(t).replace(/'/g,"\\'")};i.jsDoubleQuote=function e(t){return i.control(t).replace(/"/g,'\\"')};i.shellArg=function e(t){return"'"+t.replace(/'/g,"'\\''")+"'"};var n={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};i.control=function e(t){return t.replace(/[\x00-\x1f\x7f]/g,e=>{if(n[e]!==undefined){return n[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t})};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};i.html=function e(t){return t.replace(/[&<>]/g,e=>{return s[e]})};i.htmlAttr=function e(t){return t.replace(/[&<>"]/g,e=>{return s[e]})};i.htmlSpecialChars=function e(t){return t.replace(/[&<>"']/g,e=>{return s[e]})}},{}],20:[function(e,t,i){(function(t){"use strict";var n=e("./inspect.js").inspect;var s=e("./inspect.js").inspectError;var r=e("./ansi.js");i.formatMethod=function e(...i){var r=i[0];if(typeof r!=="string"){if(!r){r=""}else if(typeof r.toString==="function"){r=r.toString()}else{r=""}}var a,o,l=1,c=i.length,h=false,f=null,d=[];if(this.markupReset&&this.startingMarkupReset){r=(typeof this.markupReset==="function"?this.markupReset(d):this.markupReset)+r}r=r.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,(e,r,p,m,g,v,y)=>{var b,w,k,x,_,C,S,L,$=[];if(p){return"%"}if(r){if(r==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[r]){f=this.shiftMarkup[r];return""}if(f){if(!this.shiftedMarkup||!this.shiftedMarkup[f]||!this.shiftedMarkup[f][r]){return""}h=true;if(typeof this.shiftedMarkup[f][r]==="function"){b=this.shiftedMarkup[f][r](d)}else{b=this.shiftedMarkup[f][r];d.push(b)}f=null}else{if(!this.markup||!this.markup[r]){return""}h=true;if(typeof this.markup[r]==="function"){b=this.markup[r](d)}else{b=this.markup[r];d.push(b)}}return b}if(g){g=parseInt(g,10);if(m){if(m==="+"){g=l+g}else if(m==="-"){g=l-g}}}else{g=l}l++;if(g>=c||g<1){a=undefined}else{a=i[g]}switch(y){case"s":if(a===null||a===undefined){return"("+a+")"}if(typeof a==="string"){return a}if(typeof a==="number"){return""+a}if(typeof a.toString==="function"){return a.toString()}return"("+a+")";case"f":if(typeof a==="string"){a=parseFloat(a)}if(typeof a!=="number"){return"0"}if(v!==undefined){switch(v[0]){case"p":k=parseInt(v.slice(1),10);if(k>=1){a=a.toPrecision(k)}break;case"f":k=parseInt(v.slice(1),10);a=a.toFixed(k);break}}return""+a;case"d":case"i":if(typeof a==="string"){a=parseFloat(a)}if(typeof a==="number"){return""+Math.floor(a)}return"0";case"k":if(typeof a==="string"){a=parseFloat(a)}if(typeof a!=="number"){return"0"}return u(a);case"u":if(typeof a==="string"){a=parseFloat(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0)}return"0";case"U":if(typeof a==="string"){a=parseFloat(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),1)}return"1";case"x":if(typeof a==="string"){a=parseFloat(a)}if(typeof a!=="number"){return"0"}o=""+Math.max(Math.floor(a),0).toString(16);if(o.length%2){o="0"+o}return o;case"h":if(typeof a==="string"){a=parseFloat(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0).toString(16)}return"0";case"o":if(typeof a==="string"){a=parseFloat(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0).toString(8)}return"0";case"b":if(typeof a==="string"){a=parseFloat(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0).toString(2)}return"0";case"z":if(typeof a==="string"){a=t.from(a)}else if(!t.isBuffer(a)){return""}return a.toString("base64");case"Z":if(typeof a==="string"){a=t.from(a)}else if(!t.isBuffer(a)){return""}return a.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"");case"I":x=3;if(v!==undefined){x=parseInt(v,10)}return n({depth:x,style:this&&this.color?"color":"none"},a);case"Y":x=3;if(v!==undefined){x=parseInt(v,10)}return n({depth:x,style:this&&this.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true},a);case"E":return s({style:this&&this.color?"color":"none"},a);case"J":return JSON.stringify(a);case"D":return"";case"F":l--;if(v===undefined){return""}_=v.split(":");C=_[0];S=_[1];if(!C){return""}if(S&&(L=S.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(w=0;w<L.length;w++){m=L[w][1];g=L[w][2];if(g){g=parseInt(g,10);if(m){if(m==="+"){g=l+g}else if(m==="-"){g=l-g}}}else{g=l}l++;if(g>=c||g<1){$[w]=undefined}else{$[w]=i[g]}}}if(!this||!this.fn||typeof this.fn[C]!=="function"){return""}return this.fn[C].apply(this,$);default:return""}});if(h&&this.markupReset&&this.endingMarkupReset){r+=typeof this.markupReset==="function"?this.markupReset(d):this.markupReset}if(this.extraArguments){for(;l<c;l++){a=i[l];if(a===null||a===undefined){continue}else if(typeof a==="string"){r+=a}else if(typeof a==="number"){r+=a}else if(typeof a.toString==="function"){r+=a.toString()}}}return r};var a={extraArguments:true,endingMarkupReset:true,startingMarkupReset:false,markupReset:r.reset,shiftMarkup:{"#":"background"},markup:{":":r.reset," ":r.reset+" ","-":r.dim,"+":r.bold,_:r.underline,"/":r.italic,"!":r.inverse,b:r.blue,B:r.brightBlue,c:r.cyan,C:r.brightCyan,g:r.green,G:r.brightGreen,k:r.black,K:r.brightBlack,m:r.magenta,M:r.brightMagenta,r:r.red,R:r.brightRed,w:r.white,W:r.brightWhite,y:r.yellow,Y:r.brightYellow},shiftedMarkup:{background:{":":r.reset," ":r.reset+" ",b:r.bgBlue,B:r.bgBrightBlue,c:r.bgCyan,C:r.bgBrightCyan,g:r.bgGreen,G:r.bgBrightGreen,k:r.bgBlack,K:r.bgBrightBlack,m:r.bgMagenta,M:r.bgBrightMagenta,r:r.bgRed,R:r.bgBrightRed,w:r.bgWhite,W:r.bgBrightWhite,y:r.bgYellow,Y:r.bgBrightYellow}}};i.format=i.formatMethod.bind(a);i.format.default=a;i.markupMethod=function e(t){if(typeof t!=="string"){if(!t){t=""}else if(typeof t.toString==="function"){t=t.toString()}else{t=""}}var i=false,n=null,s=[];if(this.markupReset&&this.startingMarkupReset){t=(typeof this.markupReset==="function"?this.markupReset(s):this.markupReset)+t}t=t.replace(/\^(.?)/g,(e,t)=>{var r;if(t==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[t]){n=this.shiftMarkup[t];return""}if(n){if(!this.shiftedMarkup||!this.shiftedMarkup[n]||!this.shiftedMarkup[n][t]){return""}i=true;if(typeof this.shiftedMarkup[n][t]==="function"){r=this.shiftedMarkup[n][t](s)}else{r=this.shiftedMarkup[n][t];s.push(r)}n=null}else{if(!this.markup||!this.markup[t]){return""}i=true;if(typeof this.markup[t]==="function"){r=this.markup[t](s)}else{r=this.markup[t];s.push(r)}}return r});if(i&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(s):this.markupReset}return t};i.markup=i.markupMethod.bind(a);i.format.count=function e(t){var i,n,s,r=1,a=0;if(typeof t!=="string"){return 0}var o=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((i=o.exec(t))!==null){s=i[1];n=i[2];if(n){n=parseInt(n,10);if(s){if(s==="+"){n=r+n}else if(s==="-"){n=r-n}}}else{n=r}r++;if(a<n){a=n}}return a};i.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}return false};var o=["","k","M","G","T","P","E","Z","Y"];var l=["","m","","n","p","f","a","z","y"];var c=[100,10,1];function u(e){var t,i,n,s,r;if(!e||e===1){return""+e}if(e<0){return"-"+u(-e)}if(e>1){t=Math.floor(Math.log10(e));i=Math.floor(t/3);n=t%3;s=h(e/1e3**i,c[n]);r=o[i]}else{t=Math.floor(Math.log10(e));i=Math.floor(t/3);n=t%3;if(n<0){n+=3}s=h(e/1e3**i,c[n]);r=l[-i]}return""+s+r}function h(e,t){return Math.round((e+Number.EPSILON)*t)/t}}).call(this,e("buffer").Buffer)},{"./ansi.js":18,"./inspect.js":21,buffer:6}],21:[function(e,t,i){(function(t,n){"use strict";var s=e("./escape.js");var r=e("./ansi.js");function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var i={depth:0,ancestors:[]};if(!e.style){e.style=f.none}else if(typeof e.style==="string"){e.style=f[e.style]}else{e.style=Object.assign({},f.none,e.style)}if(e.depth===undefined){e.depth=3}if(e.maxLength===undefined){e.maxLength=250}if(e.outputMaxLength===undefined){e.outputMaxLength=5e3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}var n=o(i,e,t);if(n.length>e.outputMaxLength){n=n.slice(0,e.outputMaxLength-1)+""}return n}function o(e,i,n){var r,a,u,h,f,d,p,m,g,v,y,b,w,k="",x="",_="",C,S;m=typeof n;v=i.style.tab.repeat(e.depth);if(m==="function"&&i.noFunc){return""}if(e.key!==undefined){if(e.descriptor){_=[];if(!e.descriptor.configurable){_.push("-conf")}if(!e.descriptor.enumerable){_.push("-enum")}if(!e.descriptor.writable){_.push("-w")}if(_.length){_=_.join(" ")}else{_=""}}if(e.keyIsProperty){if(l(e.key)){x='"'+i.style.key(e.key)+'": '}else{x=i.style.key(e.key)+": "}}else{x=i.style.index(e.key)}if(_){_=" "+i.style.type(_)}}g=e.noPre?"":v+x;if(n===undefined){k+=g+i.style.constant("undefined")+_+i.style.newline}else if(n===null){k+=g+i.style.constant("null")+_+i.style.newline}else if(n===false){k+=g+i.style.constant("false")+_+i.style.newline}else if(n===true){k+=g+i.style.constant("true")+_+i.style.newline}else if(m==="number"){k+=g+i.style.number(n.toString())+(i.noType?"":" "+i.style.type("number"))+_+i.style.newline}else if(m==="string"){if(n.length>i.maxLength){k+=g+'"'+i.style.string(s.control(n.slice(0,i.maxLength-1)))+'"'+(i.noType?"":" "+i.style.type("string")+i.style.length("("+n.length+" - TRUNCATED)"))+_+i.style.newline}else{k+=g+'"'+i.style.string(s.control(n))+'"'+(i.noType?"":" "+i.style.type("string")+i.style.length("("+n.length+")"))+_+i.style.newline}}else if(t.isBuffer(n)){k+=g+i.style.inspect(n.inspect())+(i.noType?"":" "+i.style.type("Buffer")+i.style.length("("+n.length+")"))+_+i.style.newline}else if(m==="object"||m==="function"){a=u="";b=false;if(m==="function"){b=true;a=" "+i.style.funcName(n.name?n.name:"(anonymous)");u=i.style.length("("+n.length+")")}y=false;if(Array.isArray(n)){y=true;u=i.style.length("("+n.length+")")}if(!n.constructor){d="(no constructor)"}else if(!n.constructor.name){d="(anonymous)"}else{d=n.constructor.name}d=i.style.constructorName(d);h=Object.getPrototypeOf(n);k+=g;if(!i.noType){if(e.forceType){k+=i.style.type(e.forceType)}else{k+=d+a+u+" "+i.style.type(m)+_}if(!b||i.funcDetails){k+=" "}}f=Object.getOwnPropertyNames(n);if(i.noArrayProperty&&Array.isArray(n)){f=f.slice(0,n.length)}if(i.sort){f.sort()}w=c(n);if(i.protoBlackList&&i.protoBlackList.has(h)){k+=i.style.limit("[skip]")+i.style.newline}else if(w!==undefined){k+="=> "+o({depth:e.depth,ancestors:e.ancestors,noPre:true},i,w)}else if(b&&!i.funcDetails){k+=i.style.newline}else if(!f.length&&!i.proto){k+="{}"+i.style.newline}else if(e.depth>=i.depth){k+=i.style.limit("[depth limit]")+i.style.newline}else if(e.ancestors.indexOf(n)!==-1){k+=i.style.limit("[circular]")+i.style.newline}else{k+=(y&&i.noType?"[":"{")+i.style.newline;S=e.ancestors.slice();S.push(n);for(r=0;r<f.length&&k.length<i.outputMaxLength;r++){if(!y&&i.propertyBlackList&&i.propertyBlackList.has(f[r])){continue}try{C=Object.getOwnPropertyDescriptor(n,f[r]);if(!C.enumerable&&i.enumOnly){continue}p=!y||!C.enumerable||isNaN(f[r]);if(!i.noDescriptor&&(C.get||C.set)){k+=o({depth:e.depth+1,ancestors:S,key:f[r],keyIsProperty:p,descriptor:C,forceType:"getter/setter"},i,{get:C.get,set:C.set})}else{k+=o({depth:e.depth+1,ancestors:S,key:f[r],keyIsProperty:p,descriptor:i.noDescriptor?undefined:C},i,n[f[r]])}}catch(t){k+=o({depth:e.depth+1,ancestors:S,key:f[r],keyIsProperty:p,descriptor:i.noDescriptor?undefined:C},i,t)}if(r<f.length-1){k+=i.style.comma}}if(i.proto){k+=o({depth:e.depth+1,ancestors:S,key:"__proto__",keyIsProperty:true},i,h)}k+=v+(y&&i.noType?"]":"}");k+=i.style.newline}}if(e.depth===0){if(i.style.trim){k=k.trim()}if(i.style==="html"){k=s.html(k)}}return k}i.inspect=a;function l(e){if(!e.length){return true}return false}function c(e){if(typeof e.constructor!=="function"){return}switch(e.constructor.name){case"String":if(e instanceof String){return e.toString()}break;case"RegExp":if(e instanceof RegExp){return e.toString()}break;case"Date":if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}break;case"Set":if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}break;case"Map":if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}break;case"ObjectID":if(e._bsontype){return e.toString()}break}return}function u(e,t){var i="",n,s,r;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"Not an error -- regular variable inspection: "+a(e,t)}if(!e.style){e.style=f.none}else if(typeof e.style==="string"){e.style=f[e.style]}if(t.stack){n=h(e,t.stack)}s=t.type||t.constructor.name;r=t.code||t.name||t.errno||t.number;i+=e.style.errorType(s)+(r?" ["+e.style.errorType(r)+"]":"")+": ";i+=e.style.errorMessage(t.message)+"\n";if(n){i+=e.style.errorStack(n)+"\n"}return i}i.inspectError=u;function h(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=f.none}else if(typeof e.style==="string"){e.style=f[e.style]}if(!t){return}if((e.browser||n.browser)&&t.indexOf("@")!==-1){t=t.replace(/[</]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,(t,i,n,s,r)=>{return e.style.errorStack("    at ")+(i?e.style.errorStackMethod(i)+" ":"")+e.style.errorStack("(")+(n?e.style.errorStackFile(n):e.style.errorStack("unknown"))+(s?e.style.errorStack(":")+e.style.errorStackLine(s):"")+(r?e.style.errorStack(":")+e.style.errorStackColumn(r):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:((?:new +)?[^\s:()[\]\n]+(?:\([^)]+\))?)\s)?(?:\[as ([^\s:()[\]\n]+)\]\s)?(?:\(?([^:()[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,(t,i,n,s,r,a,o)=>{return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+(s?e.style.errorStack("[as ")+e.style.errorStackMethodAs(s)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(r?e.style.errorStackFile(r):e.style.errorStack("unknown"))+(a?e.style.errorStack(":")+e.style.errorStackLine(a):"")+(o?e.style.errorStack(":")+e.style.errorStackColumn(o):"")+e.style.errorStack(")")})}return t}i.inspectStack=h;var f={};var d=e=>e;f.none={trim:false,tab:"    ",newline:"\n",comma:"",limit:d,type:e=>"<"+e+">",constant:d,funcName:d,constructorName:e=>"<"+e+">",length:d,key:d,index:e=>"["+e+"] ",number:d,inspect:d,string:d,errorType:d,errorMessage:d,errorStack:d,errorStackMethod:d,errorStackMethodAs:d,errorStackFile:d,errorStackLine:d,errorStackColumn:d};f.inline=Object.assign({},f.none,{trim:true,tab:"",newline:" ",comma:", ",length:()=>"",index:()=>""});f.color=Object.assign({},f.none,{limit:e=>r.bold+r.brightRed+e+r.reset,type:e=>r.italic+r.brightBlack+e+r.reset,constant:e=>r.cyan+e+r.reset,funcName:e=>r.italic+r.magenta+e+r.reset,constructorName:e=>r.magenta+e+r.reset,length:e=>r.italic+r.brightBlack+e+r.reset,key:e=>r.green+e+r.reset,index:e=>r.blue+"["+e+"]"+r.reset+" ",number:e=>r.cyan+e+r.reset,inspect:e=>r.cyan+e+r.reset,string:e=>r.blue+e+r.reset,errorType:e=>r.red+r.bold+e+r.reset,errorMessage:e=>r.red+r.italic+e+r.reset,errorStack:e=>r.brightBlack+e+r.reset,errorStackMethod:e=>r.brightYellow+e+r.reset,errorStackMethodAs:e=>r.yellow+e+r.reset,errorStackFile:e=>r.brightCyan+e+r.reset,errorStackLine:e=>r.blue+e+r.reset,errorStackColumn:e=>r.magenta+e+r.reset});f.html=Object.assign({},f.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",newline:"<br />",limit:e=>'<span style="color:red">'+e+"</span>",type:e=>'<i style="color:gray">'+e+"</i>",constant:e=>'<span style="color:cyan">'+e+"</span>",funcName:e=>'<i style="color:magenta">'+e+"</i>",constructorName:e=>'<span style="color:magenta">'+e+"</span>",length:e=>'<i style="color:gray">'+e+"</i>",key:e=>'<span style="color:green">'+e+"</span>",index:e=>'<span style="color:blue">['+e+"]</span> ",number:e=>'<span style="color:cyan">'+e+"</span>",inspect:e=>'<span style="color:cyan">'+e+"</span>",string:e=>'<span style="color:blue">'+e+"</span>",errorType:e=>'<span style="color:red">'+e+"</span>",errorMessage:e=>'<span style="color:red">'+e+"</span>",errorStack:e=>'<span style="color:gray">'+e+"</span>",errorStackMethod:e=>'<span style="color:yellow">'+e+"</span>",errorStackMethodAs:e=>'<span style="color:yellow">'+e+"</span>",errorStackFile:e=>'<span style="color:cyan">'+e+"</span>",errorStackLine:e=>'<span style="color:blue">'+e+"</span>",errorStackColumn:e=>'<span style="color:gray">'+e+"</span>"})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":8,"./ansi.js":18,"./escape.js":19,_process:13}],22:[function(e,t,i){(function(i){"use strict";var n=e("fs");var s=e("dom-kit");var r=e("string-kit/lib/escape.js");function a(){}var o={};t.exports=o;var l=["path","circle","ellipse","line","rect","polyline","polygone","text","textPath"];o.inject=function e(t,i){o.patch(t,i);if(i.into){i.into.appendChild(t)}if(i.as){s.moveAttributes(t,i.as);s.moveChildrenInto(t,i.as)}};o.patch=function e(t,i){var n,r,a;o.lightCleanup(t);if(i.id!==undefined){if(typeof i.id==="string"){t.setAttribute("id",i.id)}else if(!i.id){t.removeAttribute("id")}}if(i.class){if(typeof i.class==="string"){t.classList.add(i.class)}else if(typeof i.class==="object"){s.class(t,i.class)}}if(i.hidden){t.style.visibility="hidden"}if(i.prefixIds){s.prefixIds(t,i.prefixIds)}if(i.removeIds){s.removeAllAttributes(t,"id")}if(i.removeSvgStyle){t.removeAttribute("style")}if(i.removeDefaultStyles){o.removeDefaultStyles(t)}if(i.removeComments){s.removeComments(t)}if(i.removeExoticNamespaces){s.filterByNamespace(t,{primary:"svg",whitelist:[]})}if(i.removeSize){r=t.getAttribute("width")||t.style.width;a=t.getAttribute("height")||t.style.height;t.removeAttribute("height");t.removeAttribute("width");t.style.width=null;t.style.height=null;if(!t.getAttribute("viewBox")&&r&&a){n="0 0 "+r+" "+a;t.setAttribute("viewBox",n)}}if(i.css){s.css(t,i.css)}if(i.colorClass){o.colorClass(t)}if(i.removeWhiteSpaces){s.removeWhiteSpaces(t)}else if(i.removeWhiteLines){s.removeWhiteSpaces(t,true)}};o.patchDocument=function e(t,i){var n=i.removeWhiteSpaces,r=i.removeWhiteLines,a=i.removeComments;delete i.removeWhiteSpaces;delete i.removeWhiteLines;delete i.removeComments;if(a){s.removeComments(t)}o.patch(t.documentElement,i);if(n){s.removeWhiteSpaces(t)}else if(r){s.removeWhiteSpaces(t,true)}};o.lightCleanup=function e(t){s.removeAllTags(t,"metadata");s.removeAllTags(t,"script");s.removeAllTags(t,"defs",true)};o.colorClass=function e(t){l.forEach(function(e){Array.from(t.getElementsByTagName(e)).forEach(function(e){if(!e.getAttribute("class")){e.classList.add("primary")}s.styleToAttribute(e,"fill",["none"]);s.styleToAttribute(e,"stroke",["none"])})})};const c=[["font-style","normal"],["font-weight","normal"],["font-variant","normal"],["font-stretch","normal"],["font-size","medium"],["line-height","normal"],["font-variant-ligatures","normal"],["font-variant-position","normal"],["font-variant-caps","normal"],["font-variant-numeric","normal"],["font-variant-alternates","normal"],["font-variant-east-asian","normal"],["font-feature-settings","normal"],["text-indent","0"],["text-align","start"],["text-decoration","none"],["text-decoration-line","none"],["text-decoration-style","solid"],["text-decoration-color","#000000"],["letter-spacing","normal"],["word-spacing","normal"],["text-transform","none"],["writing-mode","lr-tb"],["direction","ltr"],["text-orientation","mixed"],["dominant-baseline","auto"],["baseline-shift","baseline"],["text-anchor","start"],["white-space","normal"],["shape-padding","0"],["display","inline"],["visibility","visible"],["overflow","visible"],["opacity","1"],["isolation","auto"],["mix-blend-mode","normal"],["color-interpolation","sRGB"],["color-interpolation-filters","linearRGB"],["solid-color","#000000"],["solid-opacity","1"],["vector-effect","none"],["fill-rule","nonzero"],["clip-rule","nonzero"],["color-rendering","auto"],["image-rendering","auto"],["shape-rendering","auto"],["text-rendering","auto"],["enable-background","accumulate"],["stroke-dasharray","none"],["stroke-dashoffset","0"],["paint-order","normal"],["paint-order","fill stroke markers"]];o.removeDefaultStyles=function e(t){l.forEach(function(e){Array.from(t.getElementsByTagName(e)).forEach(function(e){var t=e.getAttribute("style");c.forEach(e=>{var i=e[0];var n=e[1];t=t.replace(new RegExp("(^|;) *"+r.regExp(i)+" *: *"+r.regExp(n)+" *(?:;|$)"),(e,t)=>t)});e.setAttribute("style",t)})})};o.load=function e(t,r,l){if(typeof r==="function"){l=r;r={}}else if(!r||typeof r!=="object"){r={}}if(typeof l!=="function"){l=a}if(!i.browser){if(t.substring(0,7)==="file://"){t=t.slice(7)}n.readFile(t,"utf8",function(e,t){if(e){l(e);return}var i=s.fromXml(t);if(r.removeComments){s.removeComments(i);delete r.removeComments}var n=i.documentElement;try{o.inject(n,r)}catch(e){l(e);return}l(undefined,n)})}else{o.ajax(t,function(e,t){if(e){l(e);return}if(r.removeComments){s.removeComments(t);delete r.removeComments}var i=t.documentElement;try{o.inject(i,r)}catch(e){l(e);return}l(undefined,i)})}};o.ajax=function e(t,i){var n=new XMLHttpRequest;n.responseType="document";n.onreadystatechange=o.ajax.ajaxStatus.bind(n,i);n.open("GET",t);n.send()};o.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[svg-kit] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}};o.getViewBox=function e(t){var i=t.getAttribute("viewBox");if(!i){return null}var n=i.split(/ +/);return{x:parseFloat(n[0],10),y:parseFloat(n[1],10),width:parseFloat(n[2],10),height:parseFloat(n[3],10)}};o.setViewBox=function e(t,i){t.setAttribute("viewBox",i.x+" "+i.y+" "+i.width+" "+i.height)};o.toAreaArray=function e(t){if(t.xmin!==undefined&&t.xmax!==undefined&&t.ymin!==undefined&&t.ymax!==undefined){return[t.xmin,t.ymin,t.xmax-t.xmin,t.ymax-t.ymin]}else if(t.x!==undefined&&t.y!==undefined&&t.width!==undefined&&t.height!==undefined){return[t.x,t.y,t.width,t.height]}else{return[0,0,100,100]}};o.standalone=function e(t,i){var n='<?xml version="1.0" encoding="UTF-8"?>\n';if(!Array.isArray(i)){i=o.toAreaArray(i)}n+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+i.join(" ")+'">\n';n+=t;n+="\n</svg>\n";return n}}).call(this,e("_process"))},{_process:13,"dom-kit":7,fs:6,"string-kit/lib/escape.js":23}],23:[function(e,t,i){arguments[4][19][0].apply(i,arguments)},{dup:19}],24:[function(e,t,i){"use strict";var n=e("punycode");var s=e("./util");i.parse=k;i.resolve=_;i.resolveObject=C;i.format=x;i.Url=r;function r(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var a=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(c),h=["'"].concat(u),f=["%","/","?",";","#"].concat(h),d=["/","?","#"],p=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:true,"javascript:":true},y={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},w=e("querystring");function k(e,t,i){if(e&&s.isObject(e)&&e instanceof r)return e;var n=new r;n.parse(e,t,i);return n}r.prototype.parse=function(e,t,i){if(!s.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var r=e.indexOf("?"),o=r!==-1&&r<e.indexOf("#")?"?":"#",c=e.split(o),u=/\\/g;c[0]=c[0].replace(u,"/");e=c.join(o);var k=e;k=k.trim();if(!i&&e.split("#").length===1){var x=l.exec(k);if(x){this.path=k;this.href=k;this.pathname=x[1];if(x[2]){this.search=x[2];if(t){this.query=w.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var _=a.exec(k);if(_){_=_[0];var C=_.toLowerCase();this.protocol=C;k=k.substr(_.length)}if(i||_||k.match(/^\/\/[^@\/]+@[^@\/]+/)){var S=k.substr(0,2)==="//";if(S&&!(_&&y[_])){k=k.substr(2);this.slashes=true}}if(!y[_]&&(S||_&&!b[_])){var L=-1;for(var $=0;$<d.length;$++){var E=k.indexOf(d[$]);if(E!==-1&&(L===-1||E<L))L=E}var A,j;if(L===-1){j=k.lastIndexOf("@")}else{j=k.lastIndexOf("@",L)}if(j!==-1){A=k.slice(0,j);k=k.slice(j+1);this.auth=decodeURIComponent(A)}L=-1;for(var $=0;$<f.length;$++){var E=k.indexOf(f[$]);if(E!==-1&&(L===-1||E<L))L=E}if(L===-1)L=k.length;this.host=k.slice(0,L);k=k.slice(L);this.parseHost();this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T){var O=this.hostname.split(/\./);for(var $=0,M=O.length;$<M;$++){var N=O[$];if(!N)continue;if(!N.match(m)){var I="";for(var B=0,U=N.length;B<U;B++){if(N.charCodeAt(B)>127){I+="x"}else{I+=N[B]}}if(!I.match(m)){var R=O.slice(0,$);var q=O.slice($+1);var D=N.match(g);if(D){R.push(D[1]);q.unshift(D[2])}if(q.length){k="/"+q.join(".")+k}this.hostname=R.join(".");break}}}}if(this.hostname.length>p){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!T){this.hostname=n.toASCII(this.hostname)}var W=this.port?":"+this.port:"";var F=this.hostname||"";this.host=F+W;this.href+=this.host;if(T){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(k[0]!=="/"){k="/"+k}}}if(!v[C]){for(var $=0,M=h.length;$<M;$++){var P=h[$];if(k.indexOf(P)===-1)continue;var X=encodeURIComponent(P);if(X===P){X=escape(P)}k=k.split(P).join(X)}}var Y=k.indexOf("#");if(Y!==-1){this.hash=k.substr(Y);k=k.slice(0,Y)}var G=k.indexOf("?");if(G!==-1){this.search=k.substr(G);this.query=k.substr(G+1);if(t){this.query=w.parse(this.query)}k=k.slice(0,G)}else if(t){this.search="";this.query={}}if(k)this.pathname=k;if(b[C]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var W=this.pathname||"";var H=this.search||"";this.path=W+H}this.href=this.format();return this};function x(e){if(s.isString(e))e=k(e);if(!(e instanceof r))return r.prototype.format.call(e);return e.format()}r.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=false,a="";if(this.host){r=e+this.host}else if(this.hostname){r=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){r+=":"+this.port}}if(this.query&&s.isObject(this.query)&&Object.keys(this.query).length){a=w.stringify(this.query)}var o=this.search||a&&"?"+a||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&r!==false){r="//"+(r||"");if(i&&i.charAt(0)!=="/")i="/"+i}else if(!r){r=""}if(n&&n.charAt(0)!=="#")n="#"+n;if(o&&o.charAt(0)!=="?")o="?"+o;i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)});o=o.replace("#","%23");return t+r+i+o+n};function _(e,t){return k(e,false,true).resolve(t)}r.prototype.resolve=function(e){return this.resolveObject(k(e,false,true)).format()};function C(e,t){if(!e)return t;return k(e,false,true).resolveObject(t)}r.prototype.resolveObject=function(e){if(s.isString(e)){var t=new r;t.parse(e,false,true);e=t}var i=new r;var n=Object.keys(this);for(var a=0;a<n.length;a++){var o=n[a];i[o]=this[o]}i.hash=e.hash;if(e.href===""){i.href=i.format();return i}if(e.slashes&&!e.protocol){var l=Object.keys(e);for(var c=0;c<l.length;c++){var u=l[c];if(u!=="protocol")i[u]=e[u]}if(b[i.protocol]&&i.hostname&&!i.pathname){i.path=i.pathname="/"}i.href=i.format();return i}if(e.protocol&&e.protocol!==i.protocol){if(!b[e.protocol]){var h=Object.keys(e);for(var f=0;f<h.length;f++){var d=h[f];i[d]=e[d]}i.href=i.format();return i}i.protocol=e.protocol;if(!e.host&&!y[e.protocol]){var p=(e.pathname||"").split("/");while(p.length&&!(e.host=p.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(p[0]!=="")p.unshift("");if(p.length<2)p.unshift("");i.pathname=p.join("/")}else{i.pathname=e.pathname}i.search=e.search;i.query=e.query;i.host=e.host||"";i.auth=e.auth;i.hostname=e.hostname||e.host;i.port=e.port;if(i.pathname||i.search){var m=i.pathname||"";var g=i.search||"";i.path=m+g}i.slashes=i.slashes||e.slashes;i.href=i.format();return i}var v=i.pathname&&i.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",k=w||v||i.host&&e.pathname,x=k,_=i.pathname&&i.pathname.split("/")||[],p=e.pathname&&e.pathname.split("/")||[],C=i.protocol&&!b[i.protocol];if(C){i.hostname="";i.port=null;if(i.host){if(_[0]==="")_[0]=i.host;else _.unshift(i.host)}i.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(p[0]==="")p[0]=e.host;else p.unshift(e.host)}e.host=null}k=k&&(p[0]===""||_[0]==="")}if(w){i.host=e.host||e.host===""?e.host:i.host;i.hostname=e.hostname||e.hostname===""?e.hostname:i.hostname;i.search=e.search;i.query=e.query;_=p}else if(p.length){if(!_)_=[];_.pop();_=_.concat(p);i.search=e.search;i.query=e.query}else if(!s.isNullOrUndefined(e.search)){if(C){i.hostname=i.host=_.shift();var S=i.host&&i.host.indexOf("@")>0?i.host.split("@"):false;if(S){i.auth=S.shift();i.host=i.hostname=S.shift()}}i.search=e.search;i.query=e.query;if(!s.isNull(i.pathname)||!s.isNull(i.search)){i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")}i.href=i.format();return i}if(!_.length){i.pathname=null;if(i.search){i.path="/"+i.search}else{i.path=null}i.href=i.format();return i}var L=_.slice(-1)[0];var $=(i.host||e.host||_.length>1)&&(L==="."||L==="..")||L==="";var E=0;for(var A=_.length;A>=0;A--){L=_[A];if(L==="."){_.splice(A,1)}else if(L===".."){_.splice(A,1);E++}else if(E){_.splice(A,1);E--}}if(!k&&!x){for(;E--;E){_.unshift("..")}}if(k&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")){_.unshift("")}if($&&_.join("/").substr(-1)!=="/"){_.push("")}var j=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(C){i.hostname=i.host=j?"":_.length?_.shift():"";var S=i.host&&i.host.indexOf("@")>0?i.host.split("@"):false;if(S){i.auth=S.shift();i.host=i.hostname=S.shift()}}k=k||i.host&&_.length;if(k&&!j){_.unshift("")}if(!_.length){i.pathname=null;i.path=null}else{i.pathname=_.join("/")}if(!s.isNull(i.pathname)||!s.isNull(i.search)){i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")}i.auth=e.auth||i.auth;i.slashes=i.slashes||e.slashes;i.href=i.format();return i};r.prototype.parseHost=function(){var e=this.host;var t=o.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":25,punycode:14,querystring:17}],25:[function(e,t,i){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}]},{},[2])(2)});