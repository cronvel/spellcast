(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var l=typeof require=="function"&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";var r=e("nextgen-events");var i=e("dom-kit");var s=e("url");function o(e){return o.create(e)}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.create=function e(t){var n=Object.create(o.prototype,{token:{value:t.token||"null",writable:true,enumerable:true},port:{value:t.port||57311,writable:true,enumerable:true},userName:{value:t.name||null,writable:true,enumerable:true},ws:{value:null,writable:true,enumerable:true},proxy:{value:null,writable:true,enumerable:true}});return n};var a={classic:e("./ui/classic.js")};o.autoCreate=function e(){var t=s.parse(window.location.href,true).query;window.spellcastClient=o.create(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};o.prototype.run=function e(t){var n=this,i=false;this.proxy=new r.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(function(e){if(a[e]){a[e](n.proxy.remoteServices.bus,n)}});this.ws=new WebSocket("ws://127.0.0.1:"+this.port+"/"+this.token);this.emit("connecting");this.ws.onerror=function e(){if(!i){console.log("Can't open Websocket (error)...");n.emit("error","unreachable");return}};this.ws.onopen=function e(){i=true;console.log("Websocket opened!");n.emit("open");if(n.userName){n.proxy.remoteServices.bus.emit("authenticate",{name:n.userName})}if(typeof t==="function"){t()}};this.ws.onclose=function e(){if(!i){console.log("Can't open Websocket (close)...");n.emit("error","unreachable");return}i=false;n.proxy.destroy();console.log("Websocket closed!");n.emit("close")};this.ws.onmessage=function e(t){var r;try{r=JSON.parse(t.data)}catch(e){return}console.log("Message received: ",r);n.proxy.receive(r)};n.proxy.send=function e(t){n.ws.send(JSON.stringify(t))}};o.autoCreate();i.ready(function(){window.spellcastClient.run()})},{"./ui/classic.js":3,"dom-kit":13,"nextgen-events":15,url:11}],2:[function(e,t,n){"use strict";var r={};t.exports=r;var i=e("string-kit/lib/format.js").markupMethod;var s={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="brightBlue">',c:'<span class="cyan">',C:'<span class="brightCyan">',g:'<span class="green">',G:'<span class="brightGreen">',k:'<span class="black">',K:'<span class="brightBlack">',m:'<span class="magenta">',M:'<span class="brightMagenta">',r:'<span class="red">',R:'<span class="brightRed">',w:'<span class="white">',W:'<span class="brightWhite">',y:'<span class="yellow">',Y:'<span class="brightYellow">'}};r.markup=i.bind(s)},{"string-kit/lib/format.js":19}],3:[function(e,t,n){"use strict";var r=e("dom-kit");var i=e("../toolkit.js");function s(e,t,n){console.log(Array.from(arguments));if(!n){n=Object.create(s.prototype,{bus:{value:e,enumerable:true},client:{value:t,enumerable:true},user:{value:null,writable:true,enumerable:true},users:{value:null,writable:true,enumerable:true},roles:{value:null,writable:true,enumerable:true},roleId:{value:null,writable:true,enumerable:true},inGame:{value:false,writable:true,enumerable:true},nexts:{value:null,writable:true,enumerable:true},afterNext:{value:false,writable:true,enumerable:true},afterLeave:{value:false,writable:true,enumerable:true}})}n.$sceneImage=document.querySelector("#scene-image");n.$content=document.querySelector("#content");n.$text=document.querySelector("#text");n.$next=document.querySelector("#next");n.$hint=document.querySelector("#hint");n.$connection=document.querySelector("#connection");n.$music=document.querySelector("#music");n.initInteractions();n.client.once("connecting",s.clientConnecting.bind(n));n.client.once("open",s.clientOpen.bind(n));n.client.once("close",s.clientClose.bind(n));n.client.on("error",s.clientError.bind(n));return n}t.exports=s;function o(e){return this.find(function(t){return t.id===e})}s.prototype.initInteractions=function e(){var t=this,n=null;var r=function e(r){if(n!==null){clearTimeout(n);n=null}t.$content.classList.remove("hidden")};var i=function e(i){if(n!==null){clearTimeout(n);n=null}t.$content.classList.toggle("hidden");if(t.$content.classList.contains("hidden")){n=setTimeout(r,5e3)}};this.$content.addEventListener("click",r,false);this.$sceneImage.addEventListener("click",i,false)};s.prototype.initBus=function e(){this.bus.on("user",s.user.bind(this));this.bus.on("userList",s.userList.bind(this));this.bus.on("roleList",s.roleList.bind(this));this.bus.on("extOutput",s.extOutput.bind(this));this.bus.on("extErrorOutput",s.extErrorOutput.bind(this));this.bus.on("message",s.message.bind(this),{async:true});this.bus.on("image",s.image.bind(this));this.bus.on("sound",s.sound.bind(this));this.bus.on("music",s.music.bind(this));this.bus.on("enterScene",s.enterScene.bind(this));this.bus.on("leaveScene",s.leaveScene.bind(this),{async:true});this.bus.on("nextList",s.nextList.bind(this));this.bus.on("nextTriggered",s.nextTriggered.bind(this));this.bus.on("textInput",s.textInput.bind(this));this.bus.on("rejoin",s.rejoin.bind(this));this.bus.on("wait",s.wait.bind(this));this.bus.on("end",s.end.bind(this));this.bus.on("exit",s.exit.bind(this));this.bus.emit("ready")};s.clientConnecting=function e(){console.log("Connecting!");this.$connection.innerHTML='<span class="blue bold">connecting...</span>'};s.clientOpen=function e(){console.log("Connected!");this.$connection.innerHTML='<span class="green bold">connected</span>';this.initBus()};s.clientClose=function e(){console.log("Closed!");this.$connection.innerHTML='<span class="red bold">closed</span>'};s.clientError=function e(t){switch(t){case"unreachable":this.$connection.innerHTML='<span class="red bold">unreachable</span>';break}};s.user=function e(t){console.log("User received: ",t);this.user=t};s.userList=function e(t){console.log("User-list received: ",t);t.get=o;this.users=t};s.roleList=function e(t,n,r){var i=this,s,a,l=97+t.length-1;t.get=o;this.roles=t;if(this.inGame){return}if(r&&t.length<=1){this.roleId=t[0].id;return}this.$next.innerHTML="";t.forEach(function(e,t){a=e.clientId&&i.users.get(e.clientId).name;i.$next.insertAdjacentHTML("beforeend",'<button id="next_'+t+'" class="role classic-ui">'+String.fromCharCode(97+t)+". "+e.label+(a?' <span class="italic brightBlack">'+a+"</span>":"")+"</button>")});if(r){t.find(function(e,t){if(e.clientId===i.user.id){i.roleId=e.id;return true}return false});this.afterLeave=true;this.$next.insertAdjacentHTML("beforeend",'<h2 class="end classic-ui">Start!</h2>');return}if(n.length){this.$next.insertAdjacentHTML("beforeend",'<p class="unassigned-users classic-ui">Idling: <span class="unassigned-users classic-ui">'+n.map(function(e){return i.users.get(e).name}).join(", ")+"</span></p>")}s=document.querySelectorAll(".role");s=Array.prototype.slice.call(s);s.forEach(function(e,n){e.onclick=function(){if(t[n].clientId===i.user.id){i.bus.emit("selectRole",null)}else if(t[n].clientId!==null){return}else{i.bus.emit("selectRole",n)}s.forEach(function(e,t){e.onclick=null})}})};s.message=function e(t,n,r){var s=this,o=false;t=i.markup(t);if(!n){n={}}var a=function e(){if(o){return}o=true;if(n.next){s.messageNext(r);return}r()};this.$text.insertAdjacentHTML("beforeend",'<p class="text classic-ui">'+t+"</p>");a()};s.prototype.messageNext=function e(t){t()};s.enterScene=function e(){this.inGame=true;if(this.afterLeave&&!this.afterNextTriggered){this.$text.innerHTML="";this.$next.innerHTML="";this.$hint.innerHTML=""}this.afterNext=this.afterLeave=this.afterNextTriggered=false};s.leaveScene=function e(t){this.afterLeave=true;if(this.afterNext){t();return}setTimeout(t,500)};s.nextTriggered=function e(){this.afterNextTriggered=true;this.$text.innerHTML="";this.$next.innerHTML=""};s.nextList=function e(t,n,r,i,s){this.nexts=t;this.afterNext=true;if(s&&this.roles.length===1){return}if(t.length===1){this.nextListConfirm(t[0],n,r,i,s)}else{this.nextListMenu(t,n,r,i,s)}};s.prototype.nextListConfirm=function e(t,n,r,i,s){var o=this,a,l,c,u,f;this.$next.innerHTML="";if(t.label){l=t.roleIds.map(function(e){return o.roles.get(e).label}).join(", ");this.$next.insertAdjacentHTML("beforeend",'<button id="next_0" class="next classic-ui">Next: '+t.label+(l?' <span class="italic brightBlack">'+l+"</span>":"")+"</button>")}else{l=t.roleIds.map(function(e){return o.roles.get(e).label}).join(", ");this.$next.insertAdjacentHTML("beforeend",'<button id="next_0" class="next classic-ui">Next.'+(l?' <span class="italic brightBlack">'+l+"</span>":"")+"</button>")}if(r.length&&this.roles.length>1){this.$next.insertAdjacentHTML("beforeend",'<p class="waiting-roles classic-ui">Waiting: <span class="waiting-roles classic-ui">'+r.map(function(e){return o.roles.get(e).label}).join(", ")+"</span></p>")}if(i!==null){c=Date.now();this.$next.insertAdjacentHTML("beforeend",'<p class="timer classic-ui">Time limit: <span class="time">'+Math.round(i/1e3)+"s"+"</span></p>");f=document.querySelector(".timer .time");u=setInterval(function(){if(!f.parentNode){clearInterval(u);return}f.textContent=Math.round((i+c-Date.now())/1e3)+"s"},1e3)}a=document.querySelector("#next_0");a.onclick=function(){o.bus.emit("selectNext",0);a.onclick=null}};s.prototype.nextListMenu=function e(t,n,r,i,s){var o=this,a,l,c,u,f=97+t.length-1;this.$next.innerHTML="";t.forEach(function(e,t){var n=e.roleIds.map(function(e){return o.roles.get(e).label}).join(", ");o.$next.insertAdjacentHTML("beforeend",'<button id="next_'+t+'" class="next classic-ui">'+String.fromCharCode(97+t)+". "+e.label+(n?' <span class="italic brightBlack">'+n+"</span>":"")+"</button>")});if(r.length&&this.roles.length){this.$next.insertAdjacentHTML("beforeend",'<p class="waiting-roles classic-ui">Waiting: <span class="waiting-roles classic-ui">'+r.map(function(e){return o.roles.get(e).label}).join(", ")+"</span></p>")}if(i!==null){l=Date.now();this.$next.insertAdjacentHTML("beforeend",'<p class="timer classic-ui">Time limit: <span class="time">'+Math.round(i/1e3)+"s"+"</span></p>");u=document.querySelector(".timer .time");c=setInterval(function(){if(!u.parentNode){clearInterval(c);return}u.textContent=Math.round((i+l-Date.now())/1e3)+"s"},1e3)}a=document.querySelectorAll(".next");a=Array.prototype.slice.call(a);a.forEach(function(e,n){e.onclick=function(){if(t[n].roleIds.indexOf(o.roleId)!==-1){o.bus.emit("selectNext",null)}else{o.bus.emit("selectNext",n)}a.forEach(function(e,t){e.onclick=null})}})};s.extOutput=function e(t){alert("not coded ATM!")};s.extErrorOutput=function e(t){alert("not coded ATM!")};s.textInput=function e(t,n){var r=this,i,s;if(n.indexOf(this.roleId)===-1){this.$text.insertAdjacentHTML("beforeend",'<p class="text classic-ui">'+t+'<input type="text" id="textInput" class="text-input classic-ui" placeholder="YOU CAN\'T RESPOND - WAIT..." disabled /></p>');return}this.$text.insertAdjacentHTML("beforeend",'<form class="form-text-input classic-ui"><p class="text classic-ui">'+t+'<input type="text" class="text-input classic-ui" /></p></form>');i=document.querySelector(".form-text-input");s=i.querySelector(".text-input");s.focus();var o=function e(t){t.preventDefault();i.onsubmit=null;s.setAttribute("disabled",true);r.bus.emit("textSubmit",s.value)};i.onsubmit=o};s.rejoin=function e(){};s.wait=function e(t){var n=this;switch(t){case"otherBranches":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="wait pulse-animation classic-ui">WAITING FOR OTHER BRANCHES TO FINISH...</h2>');this.bus.once("rejoin",function(){n.$hint.innerHTML=""});break;default:this.$hint.insertAdjacentHTML("beforeend",'<h2 class="wait pulse-animation classic-ui">WAITING FOR '+t+"</h2>")}};s.image=function e(t){var n=this,r=false;var i=document.createElement("div");i.classList.add("scene-image");if(t.url){i.style.backgroundImage='url("'+t.url+'")'}if(t.origin&&typeof t.origin==="string"){i.style.backgroundPosition=t.origin}var s=this.$sceneImage.firstElementChild||null;var o=function e(){if(r){return}r=true;s.remove()};if(s){s.addEventListener("transitionend",o,false);this.$sceneImage.insertBefore(i,s);s.classList.add("hidden");setTimeout(o,2e3)}else{this.$sceneImage.append(i)}switch(t.position){case"left":this.$content.setAttribute("data-position","right");break;case"right":default:this.$content.setAttribute("data-position","left");break}};s.music=function e(t){var n=this;if(t.url){this.$music.setAttribute("src",t.url);this.$music.play()}else{this.$music.setAttribute("src",null)}};s.sound=function e(t){console.warn("[sound] tag not supported ATM",t)};s.end=function e(t,n){switch(t){case"end":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end classic-ui">The End.</h2>');break;case"win":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end win classic-ui">You win!</h2>');break;case"lost":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end lost classic-ui">You lose...</h2>');break;case"draw":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end draw classic-ui">Draw.</h2>');break}};s.exit=function e(){}},{"../toolkit.js":2,"dom-kit":13}],4:[function(e,t,n){},{}],5:[function(e,t,n){t.exports=function(e){return!!(e!=null&&(e._isBuffer||e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)))}},{}],6:[function(e,t,n){var r=t.exports={};var i;var s;(function(){try{i=setTimeout}catch(e){i=function(){throw new Error("setTimeout is not defined")}}try{s=clearTimeout}catch(e){s=function(){throw new Error("clearTimeout is not defined")}}})();var o=[];var a=false;var l;var c=-1;function u(){if(!a||!l){return}a=false;if(l.length){o=l.concat(o)}else{c=-1}if(o.length){f()}}function f(){if(a){return}var e=i.call(null,u);a=true;var t=o.length;while(t){l=o;o=[];while(++c<t){if(l){l[c].run()}}c=-1;t=o.length}l=null;a=false;s.call(null,e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}o.push(new h(e,t));if(o.length===1&&!a){i.call(null,f,0)}};function h(e,t){this.fun=e;this.array=t}h.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function p(){}r.on=p;r.addListener=p;r.once=p;r.off=p;r.removeListener=p;r.removeAllListeners=p;r.emit=p;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],7:[function(t,n,r){(function(t){(function(i){var s=typeof r=="object"&&r&&!r.nodeType&&r;var o=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){i=a}var l,c=2147483647,u=36,f=1,h=26,p=38,d=700,m=72,y=128,v="-",g=/^xn--/,b=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=u-f,w=Math.floor,j=String.fromCharCode,L;function S(e){throw new RangeError(x[e])}function O(e,t){var n=e.length;var r=[];while(n--){r[n]=t(e[n])}return r}function A(e,t){var n=e.split("@");var r="";if(n.length>1){r=n[0]+"@";e=n[1]}e=e.replace(_,".");var i=e.split(".");var s=O(i,t).join(".");return r+s}function E(e){var t=[],n=0,r=e.length,i,s;while(n<r){i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((i&1023)<<10)+(s&1023)+65536)}else{t.push(i);n--}}else{t.push(i)}}return t}function T(e){return O(e,function(e){var t="";if(e>65535){e-=65536;t+=j(e>>>10&1023|55296);e=56320|e&1023}t+=j(e);return t}).join("")}function C(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function M(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function I(e,t,n){var r=0;e=n?w(e/d):e>>1;e+=w(e/t);for(;e>k*h>>1;r+=u){e=w(e/k)}return w(r+(k+1)*e/(e+p))}function N(e){var t=[],n=e.length,r,i=0,s=y,o=m,a,l,p,d,g,b,_,x,k;a=e.lastIndexOf(v);if(a<0){a=0}for(l=0;l<a;++l){if(e.charCodeAt(l)>=128){S("not-basic")}t.push(e.charCodeAt(l))}for(p=a>0?a+1:0;p<n;){for(d=i,g=1,b=u;;b+=u){if(p>=n){S("invalid-input")}_=C(e.charCodeAt(p++));if(_>=u||_>w((c-i)/g)){S("overflow")}i+=_*g;x=b<=o?f:b>=o+h?h:b-o;if(_<x){break}k=u-x;if(g>w(c/k)){S("overflow")}g*=k}r=t.length+1;o=I(i-d,r,d==0);if(w(i/r)>c-s){S("overflow")}s+=w(i/r);i%=r;t.splice(i++,0,s)}return T(t)}function $(e){var t,n,r,i,s,o,a,l,p,d,g,b=[],_,x,k,L;e=E(e);_=e.length;t=y;n=0;s=m;for(o=0;o<_;++o){g=e[o];if(g<128){b.push(j(g))}}r=i=b.length;if(i){b.push(v)}while(r<_){for(a=c,o=0;o<_;++o){g=e[o];if(g>=t&&g<a){a=g}}x=r+1;if(a-t>w((c-n)/x)){S("overflow")}n+=(a-t)*x;t=a;for(o=0;o<_;++o){g=e[o];if(g<t&&++n>c){S("overflow")}if(g==t){for(l=n,p=u;;p+=u){d=p<=s?f:p>=s+h?h:p-s;if(l<d){break}L=l-d;k=u-d;b.push(j(M(d+L%k,0)));l=w(L/k)}b.push(j(M(l,0)));s=I(n,x,r==i);n=0;++r}}++n;++t}return b.join("")}function q(e){return A(e,function(e){return g.test(e)?N(e.slice(4).toLowerCase()):e})}function R(e){return A(e,function(e){return b.test(e)?"xn--"+$(e):e})}l={version:"1.4.1",ucs2:{decode:E,encode:T},decode:N,encode:$,toASCII:R,toUnicode:q};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return l})}else if(s&&o){if(n.exports==s){o.exports=l}else{for(L in l){l.hasOwnProperty(L)&&(s[L]=l[L])}}}else{i.punycode=l}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],8:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var l=1e3;if(s&&typeof s.maxKeys==="number"){l=s.maxKeys}var c=e.length;if(l>0&&c>l){c=l}for(var u=0;u<c;++u){var f=e[u].replace(a,"%20"),h=f.indexOf(n),p,d,m,y;if(h>=0){p=f.substr(0,h);d=f.substr(h+1)}else{p=f;d=""}m=decodeURIComponent(p);y=decodeURIComponent(d);if(!r(o,m)){o[m]=y}else if(i(o[m])){o[m].push(y)}else{o[m]=[o[m],y]}}return o};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],9:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(r(o))+n;if(i(e[o])){return s(e[o],function(e){return a+encodeURIComponent(r(e))}).join(t)}else{return a+encodeURIComponent(r(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(r(a))+n+encodeURIComponent(r(e))};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var r=0;r<e.length;r++){n.push(t(e[r],r))}return n}var o=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],10:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":8,"./encode":9}],11:[function(e,t,n){"use strict";var r=e("punycode");var i=e("./util");n.parse=x;n.resolve=w;n.resolveObject=j;n.format=k;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(c),f=["'"].concat(u),h=["%","/","?",";","#"].concat(f),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,y=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:true,"javascript:":true},g={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},_=e("querystring");function x(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;r.parse(e,t,n);return r}s.prototype.parse=function(e,t,n){if(!i.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",c=e.split(a),u=/\\/g;c[0]=c[0].replace(u,"/");e=c.join(a);var x=e;x=x.trim();if(!n&&e.split("#").length===1){var k=l.exec(x);if(k){this.path=x;this.href=x;this.pathname=k[1];if(k[2]){this.search=k[2];if(t){this.query=_.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var w=o.exec(x);if(w){w=w[0];var j=w.toLowerCase();this.protocol=j;x=x.substr(w.length)}if(n||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var L=x.substr(0,2)==="//";if(L&&!(w&&g[w])){x=x.substr(2);this.slashes=true}}if(!g[w]&&(L||w&&!b[w])){var S=-1;for(var O=0;O<p.length;O++){var A=x.indexOf(p[O]);if(A!==-1&&(S===-1||A<S))S=A}var E,T;if(S===-1){T=x.lastIndexOf("@")}else{T=x.lastIndexOf("@",S)}if(T!==-1){E=x.slice(0,T);x=x.slice(T+1);this.auth=decodeURIComponent(E)}S=-1;for(var O=0;O<h.length;O++){var A=x.indexOf(h[O]);if(A!==-1&&(S===-1||A<S))S=A}if(S===-1)S=x.length;this.host=x.slice(0,S);x=x.slice(S);this.parseHost();this.hostname=this.hostname||"";var C=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!C){var M=this.hostname.split(/\./);for(var O=0,I=M.length;O<I;O++){var N=M[O];if(!N)continue;if(!N.match(m)){var $="";for(var q=0,R=N.length;q<R;q++){if(N.charCodeAt(q)>127){$+="x"}else{$+=N[q]}}if(!$.match(m)){var D=M.slice(0,O);var P=M.slice(O+1);var F=N.match(y);if(F){D.push(F[1]);P.unshift(F[2])}if(P.length){x="/"+P.join(".")+x}this.hostname=D.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!C){this.hostname=r.toASCII(this.hostname)}var H=this.port?":"+this.port:"";var B=this.hostname||"";this.host=B+H;this.href+=this.host;if(C){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(x[0]!=="/"){x="/"+x}}}if(!v[j]){for(var O=0,I=f.length;O<I;O++){var U=f[O];if(x.indexOf(U)===-1)continue;var W=encodeURIComponent(U);if(W===U){W=escape(U)}x=x.split(U).join(W)}}var G=x.indexOf("#");if(G!==-1){this.hash=x.substr(G);x=x.slice(0,G)}var X=x.indexOf("?");if(X!==-1){this.search=x.substr(X);this.query=x.substr(X+1);if(t){this.query=_.parse(this.query)}x=x.slice(0,X)}else if(t){this.search="";this.query={}}if(x)this.pathname=x;if(b[j]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var H=this.pathname||"";var Y=this.search||"";this.path=H+Y}this.href=this.format();return this};function k(e){if(i.isString(e))e=x(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=false,o="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&i.isObject(this.query)&&Object.keys(this.query).length){o=_.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(r&&r.charAt(0)!=="#")r="#"+r;if(a&&a.charAt(0)!=="?")a="?"+a;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+n+a+r};function w(e,t){return x(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(x(e,false,true)).format()};function j(e,t){if(!e)return t;return x(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var r=Object.keys(this);for(var o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var l=Object.keys(e);for(var c=0;c<l.length;c++){var u=l[c];if(u!=="protocol")n[u]=e[u]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var f=Object.keys(e);for(var h=0;h<f.length;h++){var p=f[h];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!g[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");n.pathname=d.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var y=n.search||"";n.path=m+y}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var v=n.pathname&&n.pathname.charAt(0)==="/",_=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=_||v||n.host&&e.pathname,k=x,w=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],j=n.protocol&&!b[n.protocol];if(j){n.hostname="";n.port=null;if(n.host){if(w[0]==="")w[0]=n.host;else w.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}x=x&&(d[0]===""||w[0]==="")}if(_){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;w=d}else if(d.length){if(!w)w=[];w.pop();w=w.concat(d);n.search=e.search;n.query=e.query}else if(!i.isNullOrUndefined(e.search)){if(j){n.hostname=n.host=w.shift();var L=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(L){n.auth=L.shift();n.host=n.hostname=L.shift()}}n.search=e.search;n.query=e.query;if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!w.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var S=w.slice(-1)[0];var O=(n.host||e.host||w.length>1)&&(S==="."||S==="..")||S==="";var A=0;for(var E=w.length;E>=0;E--){S=w[E];if(S==="."){w.splice(E,1)}else if(S===".."){w.splice(E,1);A++}else if(A){w.splice(E,1);A--}}if(!x&&!k){for(;A--;A){w.unshift("..")}}if(x&&w[0]!==""&&(!w[0]||w[0].charAt(0)!=="/")){w.unshift("")}if(O&&w.join("/").substr(-1)!=="/"){w.push("")}var T=w[0]===""||w[0]&&w[0].charAt(0)==="/";if(j){n.hostname=n.host=T?"":w.length?w.shift():"";var L=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(L){n.auth=L.shift();n.host=n.hostname=L.shift()}}x=x||n.host&&w.length;if(x&&!T){w.unshift("")}if(!w.length){n.pathname=null;n.path=null}else{n.pathname=w.join("/")}if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":12,punycode:7,querystring:10}],12:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}],13:[function(e,t,n){var r={};t.exports=r;r.svg=e("./svg.js");r.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};r.fromHtml=function e(t){var n,r,i;i=document.createDocumentFragment();r=document.createElement("div");r.insertAdjacentHTML("beforeend",t);for(n=0;n<r.children.length;n++){i.appendChild(r.children[n])}return i};r.batch=function e(t,n){var r,i=Array.prototype.slice.call(arguments,1);if(n instanceof Element){i[0]=n;t.apply(this,i)}else if(Array.isArray(n)){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}else if(n instanceof NodeList||n instanceof NamedNodeMap){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}};r.css=function e(t,n){var r;for(r in n){t.style[r]=n[r]}};r.attr=function e(t,n){var r;for(r in n){if(n[r]===null){t.removeAttribute(r)}else{t.setAttribute(r,n[r])}}};r.remove=function e(t){t.parentNode.removeChild(t)};r.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};r.cloneInto=function e(t,n){r.empty(t);t.appendChild(n.cloneNode(true))};r.insertInto=function e(t,n){r.empty(t);t.appendChild(n)};r.idNamespace=function e(t,n){var i,s={};i=t.querySelectorAll("*");r.batch(r.idNamespace.idAttributePass,i,n,s);r.batch(r.idNamespace.otherAttributesPass,i,s)};r.idNamespace.idAttributePass=function e(t,n,r){r[t.id]=n+"."+t.id;t.id=r[t.id]};r.idNamespace.otherAttributesPass=function e(t,n){r.batch(r.idNamespace.oneAttributeSubPass,t.attributes,n)};r.idNamespace.oneAttributeSubPass=function e(t,n){t.value=t.value.replace(/url\(#([^)]+)\)/g,function(e,t){if(!n[t]){return e}return"url(#"+n[t]+")"})};r.id=function e(t,e){t.id=e};r.text=function e(t,e){t.textContent=e};r.html=function e(t,e){t.innerHTML=e}},{"./svg.js":14}],14:[function(e,t,n){var r=e("fs");var i=e("./dom.js");var s={};t.exports=s;s.load=function e(t,n,i,o){if(typeof i==="function"){o=i}if(!i||typeof i!=="object"){i={}}if(n.substring(0,7)==="file://"){r.readFile(n.slice(7),function(e,n){if(e){o(e);return}var r=new DOMParser;var a=r.parseFromString(n.toString(),"application/xml").documentElement;try{s.attachXmlTo(t,a,i)}catch(e){o(e);return}o(undefined,a)})}else{s.ajax(n,function(e,n){var r=n.documentElement;if(e){o(e);return}try{s.attachXmlTo(t,r,i)}catch(e){o(e);return}o(undefined,r)})}};s.attachXmlTo=function e(t,n,r){s.lightCleanup(n);if(r.id!==undefined){if(typeof r.id==="string"){n.setAttribute("id",r.id)}else if(!r.id){n.removeAttribute("id")}}if(typeof r.class==="string"){n.setAttribute("class",r.class)}if(r.idNamespace){i.idNamespace(n,r.idNamespace)}if(r.hidden){n.style.visibility="hidden"}t.appendChild(n)};s.lightCleanup=function e(t){o(t,"metadata");o(t,"script")};function o(e,t){var n,r,i;r=e.getElementsByTagName(t);for(n=0;n<r.length;n++){i=r.item(n);i.parentNode.removeChild(i)}}s.ajax=function e(t,n){var r=new XMLHttpRequest;r.responseType="document";r.onreadystatechange=s.ajax.ajaxStatus.bind(r,n);r.open("GET",t);r.send()};s.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[dom-kit.svg] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}}},{"./dom.js":13,fs:4}],15:[function(e,t,n){"use strict";function r(){return Object.create(r.prototype)}t.exports=r;r.SYNC=-Infinity;r.init=function e(){Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:r.SYNC,interruptible:false,recursion:0,contexts:{},states:{},stateGroups:{},listeners:{error:[],interrupt:[],newListener:[],removeListener:[]}}})};r.filterOutCallback=function(e,t){
return e!==t};r.prototype.addListener=function e(t,n,i){var s={},o;if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}s.fn=n||i.fn;s.id=i.id!==undefined?i.id:s.fn;s.once=!!i.once;s.async=!!i.async;s.eventObject=!!i.eventObject;s.nice=i.nice!==undefined?Math.floor(i.nice):r.SYNC;s.context=typeof i.context==="string"?i.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(s.context&&typeof s.context==="string"&&!this.__ngev.contexts[s.context]){this.addListenerContext(s.context)}s.event=t;if(this.__ngev.listeners.newListener.length){o=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[t].push(s);r.emitEvent({emitter:this,name:"newListener",args:[[s]],listeners:o});if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this}this.__ngev.listeners[t].push(s);if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function e(t,n,r){if(n&&typeof n==="object"){n.once=true}else if(r&&typeof r==="object"){r.once=true}else{r={once:true}}return this.addListener(t,n,r)};r.prototype.removeListener=function e(t,n){var i,s,o=[],a=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}s=this.__ngev.listeners[t].length;for(i=0;i<s;i++){if(this.__ngev.listeners[t][i].id===n){a.push(this.__ngev.listeners[t][i])}else{o.push(this.__ngev.listeners[t][i])}}this.__ngev.listeners[t]=o;if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.prototype.off=r.prototype.removeListener;r.prototype.removeAllListeners=function e(t){var n;if(!this.__ngev){r.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}n=this.__ngev.listeners[t];this.__ngev.listeners[t]=[];if(n.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",n)}}else{this.__ngev.listeners={}}return this};r.listenerWrapper=function e(t,n,i){var s,o,a;if(n.interrupt){return}if(t.async){if(i){o=i.serial;i.ready=!o}a=function(e){n.listenersDone++;if(e&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=e;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}if(o){r.processQueue.call(n.emitter,t.context,true)}};if(t.eventObject){t.fn(n,a)}else{s=t.fn.apply(undefined,n.args.concat(a))}}else{if(t.eventObject){t.fn(n)}else{s=t.fn.apply(undefined,n.args)}n.listenersDone++}if(s&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=s;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}};var i=0;r.prototype.emit=function e(){var t;t={emitter:this};if(typeof arguments[0]==="number"){t.nice=Math.floor(arguments[0]);t.name=arguments[1];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,2,-1)}else{t.args=Array.prototype.slice.call(arguments,2)}}else{t.name=arguments[0];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}t.args=Array.prototype.slice.call(arguments,1);if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,1,-1)}else{t.args=Array.prototype.slice.call(arguments,1)}}return r.emitEvent(t)};r.emitEvent=function e(t){var n=t.emitter,s,o,a=0,l,c;if(!n.__ngev){r.init.call(n)}l=n.__ngev.states[t.name];if(l!==undefined){if(l&&t.args.length===l.args.length&&t.args.every(function(e,t){return e===l.args[t]})){return}n.__ngev.stateGroups[t.name].forEach(function(e){n.__ngev.states[e]=null});n.__ngev.states[t.name]=t}if(!n.__ngev.listeners[t.name]){n.__ngev.listeners[t.name]=[]}t.id=i++;t.listenersDone=0;t.once=!!t.once;if(t.nice===undefined||t.nice===null){t.nice=n.__ngev.nice}if(!t.listeners){t.listeners=n.__ngev.listeners[t.name].slice()}n.__ngev.recursion++;c=[];for(s=0,o=t.listeners.length;s<o;s++){a++;r.emitToOneListener(t,t.listeners[s],c)}n.__ngev.recursion--;if(c.length&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",c)}if(!a){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){t.callback(undefined,t);delete t.callback}}return t};r.emitToOneListener=function e(t,n,i){var s=t.emitter,o,a,l=false;o=n.context&&s.__ngev.contexts[n.context];if(o&&o.status===r.CONTEXT_DISABLED){return}if(o){a=Math.max(t.nice,n.nice,o.nice)}else{a=Math.max(t.nice,n.nice)}if(n.once){s.__ngev.listeners[t.name]=s.__ngev.listeners[t.name].filter(r.filterOutCallback.bind(undefined,n));if(i){i.push(n)}else{l=true}}if(o&&(o.status===r.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:t,listener:n,nice:a})}else{try{if(a<0){if(s.__ngev.recursion>=-a){setImmediate(r.listenerWrapper.bind(s,n,t,o))}else{r.listenerWrapper.call(s,n,t,o)}}else{setTimeout(r.listenerWrapper.bind(s,n,t,o),a)}}catch(e){s.__ngev.recursion--;throw e}}if(l&&s.__ngev.listeners.removeListener.length){s.emit("removeListener",[n])}};r.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}return this.__ngev.listeners[t].slice()};r.listenerCount=function(e,t){if(!e||!(e instanceof r)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};r.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};r.prototype.setNice=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};r.prototype.setInterruptible=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.interruptible=!!t};r.share=function(e,t){if(!(e instanceof r)||!(t instanceof r)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){r.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};r.reset=function e(t){Object.defineProperty(t,"__ngev",{configurable:true,value:null})};r.prototype.setMaxListeners=function(){};r.noop=function(){};r.prototype.defineStates=function e(){var t=this,n=Array.prototype.slice.call(arguments);if(!this.__ngev){r.init.call(this)}n.forEach(function(e){t.__ngev.states[e]=null;t.__ngev.stateGroups[e]=n})};r.prototype.hasState=function e(t){if(!this.__ngev){r.init.call(this)}return!!this.__ngev.states[t]};r.prototype.getAllStates=function e(){var t=this;if(!this.__ngev){r.init.call(this)}return Object.keys(this.__ngev.states).filter(function(e){return t.__ngev.states[e]})};r.groupAddListener=function e(t,n,r,i){if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;t.forEach(function(e){e.addListener(n,r.bind(undefined,e),i)})};r.groupOn=r.groupAddListener;r.groupOnce=function e(t,n,r,i){if(r&&typeof r==="object"){r.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.groupAddListener(t,n,r,i)};r.groupGlobalOnce=function e(t,n,i,s){var o,a=false;if(typeof i!=="function"){s=i;i=undefined}if(!s||typeof s!=="object"){s={}}i=i||s.fn;delete s.fn;s.id=s.id||i;o=function(){if(a){return}a=true;r.groupRemoveListener(t,n,s.id);i.apply(undefined,arguments)};t.forEach(function(e){e.once(n,o.bind(undefined,e),s)})};r.groupGlobalOnceAll=function e(t,n,r,i){var s,o=false,a=t.length;if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;s=function(){if(o){return}if(--a){return}o=true;r.apply(undefined,arguments)};t.forEach(function(e){e.once(n,s.bind(undefined,e),i)})};r.groupRemoveListener=function e(t,n,r){t.forEach(function(e){e.removeListener(n,r)})};r.groupOff=r.groupRemoveListener;r.groupRemoveAllListeners=function e(t,n){t.forEach(function(e){e.removeAllListeners(n)})};r.groupEmit=function e(t){var n,i,s=2,o,a,l=t.length,c,u,f=false;if(typeof arguments[arguments.length-1]==="function"){o=-1;c=arguments[arguments.length-1];u=function(e){if(f){return}if(e){f=true;c(e)}else if(!--l){f=true;c()}}}if(typeof arguments[1]==="number"){s=3;i=typeof arguments[1]}n=arguments[s-1];a=Array.prototype.slice.call(arguments,s,o);t.forEach(function(e){r.emitEvent({emitter:e,name:n,args:a,callback:u})})};r.groupDefineStates=function e(t){var n=Array.prototype.slice.call(arguments,1);t.forEach(function(e){e.defineStates.apply(e,n)})};r.CONTEXT_ENABLED=0;r.CONTEXT_DISABLED=1;r.CONTEXT_QUEUED=2;r.prototype.addListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!n||typeof n!=="object"){n={}}if(!this.__ngev.contexts[t]){this.__ngev.contexts[t]=Object.create(r.prototype);this.__ngev.contexts[t].nice=r.SYNC;this.__ngev.contexts[t].ready=true;this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;this.__ngev.contexts[t].serial=false;this.__ngev.contexts[t].queue=[]}if(n.nice!==undefined){this.__ngev.contexts[t].nice=Math.floor(n.nice)}if(n.status!==undefined){this.__ngev.contexts[t].status=n.status}if(n.serial!==undefined){this.__ngev.contexts[t].serial=!!n.serial}return this};r.prototype.disableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_DISABLED;return this};r.prototype.enableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;if(this.__ngev.contexts[t].queue.length>0){r.processQueue.call(this,t)}return this};r.prototype.queueListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_QUEUED;return this};r.prototype.serializeListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=n===undefined?true:!!n;return this};r.prototype.setListenerContextNice=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(n);return this};r.prototype.destroyListenerContext=function e(t){var n,i,s,o,a=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}for(s in this.__ngev.listeners){o=null;i=this.__ngev.listeners[s].length;for(n=0;n<i;n++){if(this.__ngev.listeners[s][n].context===t){o=[];a.push(this.__ngev.listeners[s][n])}else if(o){o.push(this.__ngev.listeners[s][n])}}if(o){this.__ngev.listeners[s]=o}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.processQueue=function e(t,n){var i,s;if(!this.__ngev.contexts[t]){return}i=this.__ngev.contexts[t];if(n){i.ready=true}this.__ngev.recursion++;while(i.ready&&i.queue.length){s=i.queue.shift();if(s.event.interrupt){continue}try{if(s.nice<0){if(this.__ngev.recursion>=-s.nice){setImmediate(r.listenerWrapper.bind(this,s.listener,s.event,i))}else{r.listenerWrapper.call(this,s.listener,s.event,i)}}else{setTimeout(r.listenerWrapper.bind(this,s.listener,s.event,i),s.nice)}}catch(e){this.__ngev.recursion--;throw e}}this.__ngev.recursion--};r.on=r.prototype.on;r.once=r.prototype.once;r.off=r.prototype.off;r.Proxy=e("./Proxy.js")},{"./Proxy.js":16}],16:[function(e,t,n){"use strict";function r(){return r.create()}t.exports=r;var i=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}r.create=function e(){var t=Object.create(r.prototype,{localServices:{value:{},enumerable:true},remoteServices:{value:{},enumerable:true},nextAckId:{value:1,writable:true,enumerable:true}});return t};r.prototype.addLocalService=function e(t,n,r){this.localServices[t]=a.create(this,t,n,r);return this.localServices[t]};r.prototype.addRemoteService=function e(t){this.remoteServices[t]=l.create(this,t);return this.remoteServices[t]};r.prototype.destroy=function e(){var t=this;Object.keys(this.localServices).forEach(function(e){t.localServices[e].destroy();delete t.localServices[e]});Object.keys(this.remoteServices).forEach(function(e){t.remoteServices[e].destroy();delete t.remoteServices[e]});this.receive=this.send=o};r.prototype.push=function e(t){if(t.__type!==s||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};r.prototype.receive=function e(t){this.push(t)};r.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,n,r){return a.create(e,t,n,r)}r.LocalService=a;a.create=function e(t,n,r,s){var o=Object.create(a.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:r,writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!s.listen,writable:true,enumerable:true},canEmit:{value:!!s.emit,writable:true,enumerable:true},canAck:{value:!!s.ack,writable:true,enumerable:true},canRpc:{value:!!s.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return o};a.prototype.destroy=function e(){var t=this;Object.keys(this.events).forEach(function(e){t.emitter.off(e,t.events[e]);delete t.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var n=this;var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(r){n.proxy.send({__type:s,service:n.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:r})}}i.emitEvent(r)};a.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};a.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};a.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t)};a.forward=function e(t){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args})};a.forward.ack=false;a.forwardWithAck=function e(t,n){if(this.destroyed){return}var r=this;if(!t.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args});n();return}var i=false;var o=this.proxy.nextAckId++;var a=function e(t){if(i||t.ack!==o){return}i=true;r.internalEvents.off("ack",e);n()};this.internalEvents.on("ack",a);this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,ack:o,args:t.args})};a.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}r.RemoteService=l;var c=1;var u=2;l.create=function e(t,n){var r=Object.create(l.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:Object.create(i.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return r};l.prototype.destroy=function e(){var t=this;this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(function(e){delete t.events[e]});this.destroyed=true};l.prototype.emit=function e(t){if(this.destroyed){return}var n=this,r,i,o,a;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof arguments[arguments.length-1]!=="function"){r=Array.prototype.slice.call(arguments,1);this.proxy.send({__type:s,service:this.id,method:"emit",event:t,args:r});return}r=Array.prototype.slice.call(arguments,1,-1);i=arguments[arguments.length-1];o=this.proxy.nextAckId++;a=false;var l=function e(t){if(a||t.ack!==o){return}a=true;n.internalEvents.off("ack",e);i(t.interruption)};this.internalEvents.on("ack",l);this.proxy.send({__type:s,service:this.id,method:"emit",ack:o,event:t,args:r})};l.prototype.addListener=function e(t,n,r){if(this.destroyed){return}if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}r.fn=n||r.fn;this.emitter.addListener(t,r);if(!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length){return}if(r.async&&this.events[t]!==u){this.events[t]=u;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:t})}else if(!r.async&&!this.events[t]){this.events[t]=c;this.proxy.send({__type:s,service:this.id,method:"listen",event:t})}};l.prototype.on=l.prototype.addListener;l.prototype.once=i.prototype.once;l.prototype.removeListener=function e(t,n){if(this.destroyed){return}this.emitter.removeListener(t,n);if((!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:t})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function e(t){var n=this;if(this.destroyed||!this.events[t.event]){return}var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(){n.proxy.send({__type:s,service:n.id,method:"ackEvent",ack:t.ack,event:t.event})}}i.emitEvent(r);var o=r.name;if(!this.emitter.__ngev.listeners[o]||!this.emitter.__ngev.listeners[o].length){this.events[o]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:o})}};l.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==u){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":15}],17:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m"}},{}],18:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=function e(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")};n.regExpReplacement=function e(t){return t.replace(/\$/g,"$$$$")};n.format=function e(t){return t.replace(/%/g,"%%")};n.shellArg=function e(t){return"'"+t.replace(/\'/g,"'\\''")+"'"};var r={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=function e(t){return t.replace(/[\x00-\x1f\x7f]/g,function(e){if(r[e]!==undefined){return r[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t})};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=function e(t){return t.replace(/[&<>]/g,function(e){return i[e]})};n.htmlAttr=function e(t){return t.replace(/[&<>"]/g,function(e){return i[e]})};n.htmlSpecialChars=function e(t){return t.replace(/[&<>"']/g,function(e){return i[e]})}},{}],19:[function(e,t,n){"use strict";var r=e("./inspect.js").inspect;var i=e("./inspect.js").inspectError;var s=e("./ansi.js");n.formatMethod=function e(t){if(typeof t!=="string"){if(t===null||t===undefined){return""}else if(typeof t.toString==="function"){t=t.toString()}else{return""}}var n=this,s,o,a=1,l=arguments,c=arguments.length,u=false,f=[];t=t.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,function(e,t,h,p,d,m,y){var v,g,b,_,x,k,w,j=[];if(h){return"%"}if(t){if(t==="^"){return"^"}if(!n.markup||!n.markup[t]){return""}u=true;if(typeof n.markup[t]==="function"){v=n.markup[t](f)}else{v=n.markup[t];f.push(v)}return v}if(d){d=parseInt(d);if(p){if(p==="+"){d=a+d}else if(p==="-"){d=a-d}}}else{d=a}a++;if(d>=c||d<1){s=undefined}else{s=l[d]}switch(y){case"s":if(s===null||s===undefined){return""}if(typeof s==="string"){return s}if(typeof s==="number"){return""+s}if(typeof s.toString==="function"){return s.toString()}return"";case"f":if(typeof s==="string"){s=parseFloat(s)}if(typeof s!=="number"){return"0"}if(m!==undefined){switch(m[0]){case"p":b=parseInt(m.slice(1),10);if(b>=1){s=s.toPrecision(b)}break;case"f":b=parseInt(m.slice(1),10);s=s.toFixed(b);break}}return""+s;case"d":case"i":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.floor(s)}return"0";case"u":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0)}return"0";case"U":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),1)}return"1";case"x":if(typeof s==="string"){s=parseInt(s)}if(typeof s!=="number"){return"0"}o=""+Math.max(Math.floor(s),0).toString(16);if(o.length%2){o="0"+o}return o;case"h":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(16)}return"0";case"o":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(8)}return"0";case"b":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(2)}return"0";case"I":return r({style:n&&n.color?"color":"none"},s);case"E":return i({style:n&&n.color?"color":"none"},s);case"J":return JSON.stringify(s);case"D":return"";case"F":a--;if(m===undefined){return""}_=m.split(":");x=_[0];k=_[1];if(!x){return""}if(k&&(w=k.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(g=0;g<w.length;g++){p=w[g][1];d=w[g][2];if(d){d=parseInt(d,10);if(p){if(p==="+"){d=a+d}else if(p==="-"){d=a-d}}}else{d=a}a++;if(d>=c||d<1){j[g]=undefined}else{j[g]=l[d]}}}if(!n||!n.fn||typeof n.fn[x]!=="function"){return""}return n.fn[x].apply(n,j);default:return""}});if(u&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(f):this.markupReset}if(this.extraArguments){for(;a<c;a++){s=l[a];if(s===null||s===undefined){continue}else if(typeof s==="string"){t+=s}else if(typeof s==="number"){t+=s}else if(typeof s.toString==="function"){t+=s.toString()}}}return t};var o={extraArguments:true,endingMarkupReset:true,markupReset:s.reset,markup:{":":s.reset," ":s.reset+" ","-":s.dim,"+":s.bold,_:s.underline,"/":s.italic,"!":s.inverse,b:s.blue,B:s.brightBlue,c:s.cyan,C:s.brightCyan,g:s.green,G:s.brightGreen,k:s.black,K:s.brightBlack,m:s.magenta,M:s.brightMagenta,r:s.red,R:s.brightRed,w:s.white,W:s.brightWhite,y:s.yellow,Y:s.brightYellow}};n.format=n.formatMethod.bind(o);n.format.default=o;n.markupMethod=function e(t){if(typeof t!=="string"){if(t===null||t===undefined){return""}else if(typeof t.toString==="function"){t=t.toString()}else{return""}}var n=this,r=false,i=[];t=t.replace(/\^(.?)/g,function(e,t){var s;if(t==="^"){return"^"}if(!n.markup||!n.markup[t]){return""}r=true;if(typeof n.markup[t]==="function"){s=n.markup[t](i)}else{s=n.markup[t];i.push(s)}return s});if(r&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(i):this.markupReset}return t};n.markup=n.markupMethod.bind(o);n.format.count=function e(t){var n,r,i,s=1,o=0;if(typeof t!=="string"){return 0}var a=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=a.exec(t))!==null){i=n[1];r=n[2];if(r){r=parseInt(r,10);if(i){if(i==="+"){r=s+r}else if(i==="-"){r=s-r}}}else{r=s}s++;if(o<r){o=r}}return o};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}else{return false}}},{"./ansi.js":17,"./inspect.js":20}],20:[function(e,t,n){(function(t,r){"use strict";var i=e("tree-kit/lib/extend.js");var s=e("./escape.js");var o=e("./ansi.js");function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(e.depth===undefined){e.depth=3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}return l(n,e,t)}function l(e,n,r){var i,o,a,f,h,p,d,m,y,v,g,b,_="",x="",k="",w,j;d=typeof r;y=n.style.tab.repeat(e.depth);if(d==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){k=[];if(!e.descriptor.configurable){k.push("-conf")}if(!e.descriptor.enumerable){k.push("-enum")}if(!e.descriptor.writable){k.push("-w")}if(k.length){k=k.join(" ")}else{k=""}}if(e.keyIsProperty){if(c(e.key)){x='"'+n.style.key(e.key)+'": '}else{x=n.style.key(e.key)+": "}}else{x="["+n.style.index(e.key)+"] "}if(k){k=" "+n.style.type(k)}}m=e.noPre?"":y+x;if(r===undefined){_+=m+n.style.constant("undefined")+k+n.style.nl}else if(r===null){_+=m+n.style.constant("null")+k+n.style.nl}else if(r===false){_+=m+n.style.constant("false")+k+n.style.nl}else if(r===true){_+=m+n.style.constant("true")+k+n.style.nl}else if(d==="number"){_+=m+n.style.number(r.toString())+(n.noType?"":" "+n.style.type("number"))+k+n.style.nl}else if(d==="string"){_+=m+'"'+n.style.string(s.control(r))+'" '+(n.noType?"":n.style.type("string")+n.style.length("("+r.length+")"))+k+n.style.nl}else if(t.isBuffer(r)){_+=m+n.style.inspect(r.inspect())+" "+(n.noType?"":n.style.type("Buffer")+n.style.length("("+r.length+")"))+k+n.style.nl}else if(d==="object"||d==="function"){o=a="";g=false;if(d==="function"){g=true;o=" "+n.style.funcName(r.name?r.name:"(anonymous)");a=n.style.length("("+r.length+")")}v=false;if(Array.isArray(r)){v=true;a=n.style.length("("+r.length+")")}if(!r.constructor){h="(no constructor)"}else if(!r.constructor.name){h="(anonymous)"}else{h=r.constructor.name}h=n.style.constructorName(h);_+=m;if(!n.noType){if(e.forceType){_+=n.style.type(e.forceType)}else{_+=h+o+a+" "+n.style.type(d)+k}if(!g||n.funcDetails){_+=" "}}f=Object.getOwnPropertyNames(r);if(n.sort){f.sort()}b=u(r);if(b!==undefined){_+="=> "+l({depth:e.depth,ancestors:e.ancestors,noPre:true},n,b)}else if(g&&!n.funcDetails){_+=n.style.nl}else if(!f.length&&!n.proto){_+="{}"+n.style.nl}else if(e.depth>=n.depth){_+=n.style.limit("[depth limit]")+n.style.nl}else if(e.ancestors.indexOf(r)!==-1){_+=n.style.limit("[circular]")+n.style.nl}else{_+=(v&&n.noType?"[":"{")+n.style.nl;j=e.ancestors.slice();j.push(r);for(i=0;i<f.length;i++){try{w=Object.getOwnPropertyDescriptor(r,f[i]);if(!w.enumerable&&n.enumOnly){continue}p=!v||!w.enumerable||isNaN(f[i]);if(!n.noDescriptor&&(w.get||w.set)){_+=l({depth:e.depth+1,ancestors:j,key:f[i],keyIsProperty:p,descriptor:w,forceType:"getter/setter"},n,{get:w.get,set:w.set})}else{_+=l({depth:e.depth+1,ancestors:j,key:f[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,r[f[i]])}}catch(t){_+=l({depth:e.depth+1,ancestors:j,key:f[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,t)}}if(n.proto){_+=l({depth:e.depth+1,ancestors:j,key:"__proto__",keyIsProperty:true},n,r.__proto__)}_+=y+(v&&n.noType?"]":"}")+n.style.nl}}if(e.depth===0){if(n.style==="html"){_=s.html(_)}}return _}n.inspect=a;function c(e){if(!e.length){return true}return false}function u(e){switch(e.constructor.name){case"Date":if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}break;case"Set":if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}break;case"Map":if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}break;case"ObjectID":if(e._bsontype){return e.toString()}break}return}function f(e,t){var n="",r,i,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(t.stack){r=h(e,t.stack)}i=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(i)+(s?" ["+e.style.errorType(s)+"]":"")+": ";n+=e.style.errorMessage(t.message)+"\n";if(r){n+=e.style.errorStack(r)+"\n"}return n}n.inspectError=f;function h(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(!t){return}if((e.browser||r.browser)&&t.indexOf("@")!==-1){t=t.replace(/[<\/]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,function(t,n,r,i,s){return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(r?e.style.errorStackFile(r):e.style.errorStack("unknown"))+(i?e.style.errorStack(":")+e.style.errorStackLine(i):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:([^\s:\(\)\[\]\n]+(?:\([^\)]+\))?)\s)?(?:\[as ([^\s:\(\)\[\]\n]+)\]\s)?(?:\(?([^:\(\)\[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,function(t,n,r,i,s,o,a){return e.style.errorStack("    at ")+(r?e.style.errorStackMethod(r)+" ":"")+(i?e.style.errorStack("[as ")+e.style.errorStackMethodAs(i)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(o?e.style.errorStack(":")+e.style.errorStackLine(o):"")+(a?e.style.errorStack(":")+e.style.errorStackColumn(a):"")+e.style.errorStack(")");
})}return t}n.inspectStack=h;var p={};var d=function(e){return e};p.none={tab:"    ",nl:"\n",limit:d,type:function(e){return"<"+e+">"},constant:d,funcName:d,constructorName:function(e){return"<"+e+">"},length:d,key:d,index:d,number:d,inspect:d,string:d,errorType:d,errorMessage:d,errorStack:d,errorStackMethod:d,errorStackMethodAs:d,errorStackFile:d,errorStackLine:d,errorStackColumn:d};p.color=i(null,{},p.none,{limit:function(e){return o.bold+o.brightRed+e+o.reset},type:function(e){return o.italic+o.brightBlack+e+o.reset},constant:function(e){return o.cyan+e+o.reset},funcName:function(e){return o.italic+o.magenta+e+o.reset},constructorName:function(e){return o.magenta+e+o.reset},length:function(e){return o.italic+o.brightBlack+e+o.reset},key:function(e){return o.green+e+o.reset},index:function(e){return o.blue+e+o.reset},number:function(e){return o.cyan+e+o.reset},inspect:function(e){return o.cyan+e+o.reset},string:function(e){return o.blue+e+o.reset},errorType:function(e){return o.red+o.bold+e+o.reset},errorMessage:function(e){return o.red+o.italic+e+o.reset},errorStack:function(e){return o.brightBlack+e+o.reset},errorStackMethod:function(e){return o.brightYellow+e+o.reset},errorStackMethodAs:function(e){return o.yellow+e+o.reset},errorStackFile:function(e){return o.brightCyan+e+o.reset},errorStackLine:function(e){return o.blue+e+o.reset},errorStackColumn:function(e){return o.magenta+e+o.reset}});p.html=i(null,{},p.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",nl:"<br />",limit:function(e){return'<span style="color:red">'+e+"</span>"},type:function(e){return'<i style="color:gray">'+e+"</i>"},constant:function(e){return'<span style="color:cyan">'+e+"</span>"},funcName:function(e){return'<i style="color:magenta">'+e+"</i>"},constructorName:function(e){return'<span style="color:magenta">'+e+"</span>"},length:function(e){return'<i style="color:gray">'+e+"</i>"},key:function(e){return'<span style="color:green">'+e+"</span>"},index:function(e){return'<span style="color:blue">'+e+"</span>"},number:function(e){return'<span style="color:cyan">'+e+"</span>"},inspect:function(e){return'<span style="color:cyan">'+e+"</span>"},string:function(e){return'<span style="color:blue">'+e+"</span>"},errorType:function(e){return'<span style="color:red">'+e+"</span>"},errorMessage:function(e){return'<span style="color:red">'+e+"</span>"},errorStack:function(e){return'<span style="color:gray">'+e+"</span>"},errorStackMethod:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackMethodAs:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackFile:function(e){return'<span style="color:cyan">'+e+"</span>"},errorStackLine:function(e){return'<span style="color:blue">'+e+"</span>"},errorStackColumn:function(e){return'<span style="color:gray">'+e+"</span>"}})}).call(this,{isBuffer:e("../../browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js")},e("_process"))},{"../../browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js":5,"./ansi.js":17,"./escape.js":18,_process:6,"tree-kit/lib/extend.js":21}],21:[function(e,t,n){"use strict";function r(e,t){var n,r,s=false,o=arguments.length;if(o<3){return t}var a=Array.prototype.slice.call(arguments,2);o=a.length;if(!e||typeof e!=="object"){e={}}var l={depth:0,prefix:""};if(!e.maxDepth&&e.deep&&!e.circular){e.maxDepth=100}if(e.deepFunc){e.deep=true}if(e.deepFilter&&typeof e.deepFilter==="object"){if(e.deepFilter.whitelist&&(!Array.isArray(e.deepFilter.whitelist)||!e.deepFilter.whitelist.length)){delete e.deepFilter.whitelist}if(e.deepFilter.blacklist&&(!Array.isArray(e.deepFilter.blacklist)||!e.deepFilter.blacklist.length)){delete e.deepFilter.blacklist}if(!e.deepFilter.whitelist&&!e.deepFilter.blacklist){delete e.deepFilter}}if(e.flat){e.deep=true;e.proto=false;e.inherit=false;e.unflat=false;if(typeof e.flat!=="string"){e.flat="."}}if(e.unflat){e.deep=false;e.proto=false;e.inherit=false;e.flat=false;if(typeof e.unflat!=="string"){e.unflat="."}}if(e.inherit){e.own=true;e.proto=false}else if(e.proto){e.own=true}if(!t||typeof t!=="object"&&typeof t!=="function"){s=true}if(!e.skipRoot&&(e.inherit||e.proto)){for(n=o-1;n>=0;n--){r=a[n];if(r&&(typeof r==="object"||typeof r==="function")){if(e.inherit){if(s){t=Object.create(r)}else{Object.setPrototypeOf(t,r)}}else if(e.proto){if(s){t=Object.create(Object.getPrototypeOf(r))}else{Object.setPrototypeOf(t,Object.getPrototypeOf(r))}}break}}}else if(s){t={}}l.references={sources:[],targets:[]};for(n=0;n<o;n++){r=a[n];if(!r||typeof r!=="object"&&typeof r!=="function"){continue}i(l,e,t,r)}return t}t.exports=r;function i(e,t,n,r){var s,o,a,l,c,u,f,h,p,d,m,y=-1;if(t.maxDepth&&e.depth>t.maxDepth){throw new Error("[tree] extend(): max depth reached("+t.maxDepth+")")}if(t.circular){e.references.sources.push(r);e.references.targets.push(n)}if(t.own){if(t.nonEnum){a=Object.getOwnPropertyNames(r)}else{a=Object.keys(r)}}else{a=r}for(l in a){if(t.own){l=a[l]}if(t.descriptor){h=Object.getOwnPropertyDescriptor(r,l);c=h.value}else{c=r[l]}d=n;p=e.prefix+l;if(t.nofunc&&typeof c==="function"){continue}if(t.unflat&&e.depth===0){m=l.split(t.unflat);o=m.length-1;if(o){for(s=0;s<o;s++){if(!d[m[s]]||typeof d[m[s]]!=="object"&&typeof d[m[s]]!=="function"){d[m[s]]={}}d=d[m[s]]}p=e.prefix+m[o]}}if(t.deep&&c&&(typeof c==="object"||t.deepFunc&&typeof c==="function")&&(!t.descriptor||!h.get)&&((u=Object.getPrototypeOf(c))||true)&&(!t.deepFilter||(!t.deepFilter.whitelist||t.deepFilter.whitelist.indexOf(u)!==-1)&&(!t.deepFilter.blacklist||t.deepFilter.blacklist.indexOf(u)===-1))){if(t.circular){y=e.references.sources.indexOf(c)}if(t.flat){if(y>=0){continue}i({depth:e.depth+1,prefix:e.prefix+l+t.flat,references:e.references},t,d,c)}else{if(y>=0){if(t.descriptor){Object.defineProperty(d,p,{value:e.references.targets[y],enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=e.references.targets[y]}continue}if(!d[p]||!d.hasOwnProperty(p)||typeof d[p]!=="object"&&typeof d[p]!=="function"){if(Array.isArray(c)){f=[]}else if(t.proto){f=Object.create(u)}else if(t.inherit){f=Object.create(c)}else{f={}}if(t.descriptor){Object.defineProperty(d,p,{value:f,enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=f}}else if(t.proto&&Object.getPrototypeOf(d[p])!==u){Object.setPrototypeOf(d[p],u)}else if(t.inherit&&Object.getPrototypeOf(d[p])!==c){Object.setPrototypeOf(d[p],c)}if(t.circular){e.references.sources.push(c);e.references.targets.push(d[p])}i({depth:e.depth+1,prefix:"",references:e.references},t,d[p],c)}}else if(t.preserve&&d[p]!==undefined){continue}else if(!t.inherit){if(t.descriptor){Object.defineProperty(d,p,h)}else{d[p]=c}}if(t.move){delete r[l]}}}},{}]},{},[1])(1)});