(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function e(t,n,i){function r(a,o){if(!n[a]){if(!t[a]){var l=typeof require=="function"&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[a].exports}var s=typeof require=="function"&&require;for(var a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){"use strict";var i=e("dom-kit");var r=e("svg-kit");var s=e("nextgen-events");function a(){}function o(){return o.create()}t.exports=o;o.prototype=Object.create(s.prototype);o.prototype.constructor=o;o.create=function e(){var t=Object.create(o.prototype);t.$body=document.querySelector("body");t.$theme=document.querySelector("#theme");t.$gfx=document.querySelector("#gfx");t.$sceneImage=document.querySelector(".scene-image");t.$main=document.querySelector("main");t.$mainBuffer=document.querySelector("#main-buffer");t.$altBuffer=document.querySelector("#alt-buffer");t.$closeAltButton=document.querySelector("#button-close-alt");t.$dialogWrapper=document.querySelector("#dialog-wrapper");t.$hint=document.querySelector("#hint");t.$lobby=document.querySelector("#lobby");t.$clientStatus=t.$lobby.querySelector(".client-status");t.$status=document.querySelector("#status");t.$panel=document.querySelector("#panel");t.$music=document.querySelector("#music");t.$sound0=document.querySelector("#sound0");t.$sound1=document.querySelector("#sound1");t.$sound2=document.querySelector("#sound2");t.$sound3=document.querySelector("#sound3");t.choices=[];t.newSegmentNeeded=null;t.onSelect=null;t.onLeave=null;t.onEnter=null;t.toMainBuffer();t.nextSoundChannel=0;t.sprites={};t.uis={};t.markers={};t.cards={};t.cardLocations={};t.animations={};t.hintTimer=null;t.sceneImageOnTimer=null;t.onChatSubmit=null;t.uiLoadingCount=0;t.initEvents();return t};o.prototype.cleanUrl=function e(t){if(t[0]==="/"){return t}return"/script/"+t};o.prototype.setTheme=function e(t){this.$theme.setAttribute("href",this.cleanUrl(t.url))};o.prototype.preload=function e(){i.preload(["/icons/plugged.svg","/icons/plugging.svg","/icons/unplugged.svg","/icons/unreachable-plug.svg"])};o.prototype.initEvents=function e(){var t=this;this.$gfx.addEventListener("click",this.toggleSceneImage.bind(this),false);this.$dialogWrapper.addEventListener("click",this.clearDialog.bind(this),false);this.$lobby.addEventListener("click",function(){t.$lobby.classList.toggle("toggled")});this.$status.addEventListener("click",function(){t.$status.classList.toggle("toggled")});this.$panel.addEventListener("click",function(){t.$panel.classList.toggle("toggled")})};o.prototype.toggleSceneImage=function e(){if(this.$gfx.classList.contains("toggled")){this.sceneImageOff()}else{this.sceneImageOn()}};o.prototype.sceneImageOn=function e(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.add("toggled");this.$body.classList.add("gfx-toggled");this.sceneImageOnTimer=setTimeout(this.sceneImageOff.bind(this),8e3)};o.prototype.sceneImageOff=function e(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.remove("toggled");this.$body.classList.remove("gfx-toggled")};o.prototype.toMainBuffer=function e(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHint();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$importantMessages=null;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.$closeAltButton.classList.add("inactive");this.getSwitchedElements();return true};o.prototype.toAltBuffer=function e(){if(this.$activeBuffer===this.$altBuffer){return}this.$activeBuffer=this.$altBuffer;this.$importantMessages=this.$activeSegment;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.$closeAltButton.classList.remove("inactive");this.getSwitchedElements();return true};o.prototype.getSwitchedElements=function e(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};o.prototype.clientStatus=function e(t){this.$clientStatus.setAttribute("data-status",t);this.$clientStatus.setAttribute("title",t)};o.prototype.setMultiplayer=function e(t,n){n=n||a;if(t||t===undefined){this.$body.classList.add("multiplayer")}else{this.$body.classList.remove("multiplayer")}n()};o.prototype.clear=function e(t){t=t||a;i.empty(this.$hint);i.empty(this.$dialogWrapper);i.empty(this.$activeMessages);i.empty(this.$choices);t()};o.prototype.clearMessages=function e(t){t=t||a;i.empty(this.$activeMessages);t()};o.prototype.clearHistory=function e(t){t=t||a;i.empty(this.$history);t()};o.prototype.newSegment=function e(t){var n,i=t==="inter-segment";this.newSegmentNeeded=null;if(i){if(this.$activeSegment&&this.$activeSegment.tagName.toLowerCase()==="inter-segment"){return}n=document.createElement("inter-segment")}else{n=document.createElement("segment")}if(this.$activeSegment&&!this.$activeSegment.children.length){this.$activeSegment.remove()}this.$activeSegment=n;this.$activeMessages.appendChild(n);if(!i){this.moveToHistory()}};o.prototype.moveToHistory=function e(){var t,n;var i=Array.from(this.$activeMessages.children);n=i.length-2;while(n>=0&&i[n].tagName.toLowerCase()==="inter-segment"){n--}if(n<0){return}for(t=0;t<=n;t++){this.$history.appendChild(i[t])}i[n].scrollIntoView(false)};o.prototype.newSegmentOnContent=function e(t){t=t||"segment";this.newSegmentNeeded=t};o.prototype.addSelectedChoice=function e(t){var n=document.createElement("p");n.classList.add("chosen");n.textContent=t;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(n)};o.prototype.addMessage=function e(t,n,i){i=i||a;var r=document.createElement("p");r.classList.add("text");r.innerHTML=t;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(r);if(n.important&&this.$importantMessages){this.$importantMessages.appendChild(r.cloneNode(true))}i()};o.prototype.messageNext=function e(t){t()};o.prototype.addIndicators=function e(t,n,r){var s=this;r=r||a;if(n){i.empty(this.$status);if(t.length){this.$status.classList.remove("empty")}else{this.$status.classList.add("empty");r();return}}var o=document.createElement("indicator-list");t.forEach(function(e){var t,n,i,r,a,l;t=document.createElement("indicator");n=document.createElement("label");n.classList.add("label");if(e.image){t.classList.add("has-image");i=document.createElement("img");i.classList.add("image");i.setAttribute("src",s.cleanUrl(e.image));if(e.label){i.setAttribute("alt",e.label);i.setAttribute("title",e.label)}n.appendChild(i)}else{n.textContent=e.label}t.appendChild(n);r=document.createElement("widget");r.classList.add("widget");r.classList.add(e.type);r.setAttribute("data-value",e.value);switch(e.type){case"hbar":l=document.createElement("outer-bar");r.appendChild(l);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.width=""+e.value+"%";l.appendChild(a);break;case"vbar":l=document.createElement("outer-bar");r.appendChild(l);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.height=""+e.value+"%";l.appendChild(a);break;case"text":default:r.textContent=e.value}t.appendChild(r);o.appendChild(t)});if(n){this.$status.appendChild(o)}else{if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(o)}r()};o.prototype.createChoiceEventHandlers=function e(t){var n=this;this.onSelect=function(e){var n=e.currentTarget;var i=n.getAttribute("data-select-index");if(!i){return}i=parseInt(i,10);t(i)};this.onLeave=function(e){n.clearHint()};this.onEnter=function(e){var t=e.currentTarget;var i=t.getAttribute("data-button-hint");if(!i){return}n.setHint(i,{active:true})}};o.prototype.addPanel=function e(t,n,s){var o=this;s=s||a;if(n){i.empty(this.$panel);if(t.length){this.$panel.classList.remove("empty")}else{this.$panel.classList.add("empty");s();return}}else if(t.length){this.$panel.classList.remove("empty")}t.forEach(function(e){var t,n,i="button-"+e.id;if(document.getElementById(i)){return}t=document.createElement("item");t.classList.add("button");t.classList.add("disabled");t.setAttribute("id",i);if(e.image){t.classList.add("has-image");if(e.image.endsWith(".svg")){n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("svg");r.load(o.cleanUrl(e.image),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,colorClass:true,as:n})}else{n=document.createElement("img");n.setAttribute("src",o.cleanUrl(e.image))}n.classList.add("icon");n.classList.add("image");if(e.label){n.setAttribute("alt",e.label);n.setAttribute("title",e.label)}t.appendChild(n)}else{t.textContent=e.label}o.$panel.appendChild(t)});s()};o.prototype.clearChoices=function e(t){var n=this,r;t=t||a;this.choices.forEach(function(e){if(!e.button){return}var t="button-"+e.button;r=document.getElementById(t);if(r){r.removeAttribute("data-select-index");r.classList.add("disabled");r.removeEventListener("click",n.onSelect);r.removeEventListener("mouseleave",n.onLeave);r.removeEventListener("mouseenter",n.onEnter)}});i.empty(this.$choices);this.choices.length=0;this.onSelect=null;this.onLeave=null;this.onEnter=null;t()};o.prototype.addChoices=function e(t,n,i){if(this.uiLoadingCount){this.once("uiLoaded",this.addChoices.bind(this,t,n,i));return}var r=this,s=false;var o=document.createDocumentFragment();var l=document.createElement("group");i=i||a;this.createChoiceEventHandlers(n);t.forEach(function(e){var t;r.choices.push(e);if(e.button&&(t=document.getElementById("button-"+e.button))&&!t.getAttribute("data-select-index")&&!t.classList.contains("inactive")){if(e.groupBreak){s=true}t.setAttribute("data-select-index",e.index);t.classList.remove("disabled");t.addEventListener("click",r.onSelect);if(e.label){t.setAttribute("data-button-hint",e.label);t.addEventListener("mouseleave",r.onLeave);t.addEventListener("mouseenter",r.onEnter)}return}var n=document.createElement("choice");n.classList.add("choice",e.type);n.setAttribute("data-select-index",e.index);n.classList.remove("disabled");if(e.image){n.classList.add("has-image");var i=document.createElement("img");i.classList.add("image");i.setAttribute("src",r.cleanUrl(e.image));n.appendChild(i)}var a=document.createElement("span");a.classList.add("label");a.textContent=e.label;n.appendChild(a);if(e.selectedBy&&e.selectedBy.length){var c=document.createElement("span");c.classList.add("italic","brightBlack");c.textContent=" "+e.selectedBy.join(", ");n.appendChild(c)}n.addEventListener("click",r.onSelect);if(e.groupBreak||s){s=false;o.appendChild(l);l=document.createElement("group")}l.appendChild(n)});o.appendChild(l);this.$choices.appendChild(o);i()};o.prototype.getChoiceColumnsCount=function e(t){var n=0,i=0;t.forEach(function(e){if(e.groupBreak){if(n>i){i=n}n=0}n++});if(n>i){i=n}return i};o.prototype.setChoices=function e(t,n,i,r,s){var o=this;r=r||{};s=s||a;this.clearChoices(function(){switch(r.style){case"inline":case"smallInline":case"list":case"smallList":o.$choices.setAttribute("data-choice-style",r.style);break;case"table":o.$choices.setAttribute("data-choice-style",r.style);o.$choices.classList.add("columns-"+o.getChoiceColumnsCount(t));break;default:o.$choices.setAttribute("data-choice-style","list")}o.addChoices(t,i,s);if(n&&n.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=n.join(", ");o.$choices.appendChild(e)}if(typeof r.timeout==="number"){o.choiceTimeout(r.timeout)}})};o.prototype.updateChoices=o.prototype.setChoices;o.prototype.choiceTimeout=function e(t){var n=Date.now(),i,r;i=document.createElement("p");i.classList.add("timer");i.textContent=Math.round(t/1e3);this.$choices.appendChild(i);r=setInterval(function(){if(!i.parentNode){clearInterval(r);return}i.textContent=Math.round((t+n-Date.now())/1e3)},1e3)};o.prototype.textInputDisabled=function e(t){var n=document.createElement("form"),i=document.createElement("label"),r=document.createElement("input");i.textContent=t.label;r.setAttribute("placeholder",t.placeholder);r.setAttribute("disabled",true);r.setAttribute("type","text");r.classList.add("text-input");n.appendChild(i);n.appendChild(r);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(n)};o.prototype.textInput=function e(t,n){var i=document.createElement("form"),r=document.createElement("label"),s=document.createElement("input");r.classList.add("text");r.textContent=t.label;s.setAttribute("type","text");s.classList.add("text-input");i.appendChild(r);i.appendChild(s);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(i);s.focus();var a=function e(t){t.preventDefault();i.removeEventListener("submit",e);s.setAttribute("disabled",true);n(s.value)};i.addEventListener("submit",a)};o.prototype.enableChat=function e(t){var n=this;if(!this.onChatSubmit){this.onChatSubmit=function(e){e.preventDefault();t(n.$chatInput.value);n.$chatInput.value=""};this.$chatForm.addEventListener("submit",this.onChatSubmit);this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};o.prototype.disableChat=function e(){this.$chatForm.removeEventListener("submit",this.onChatSubmit);this.onChatSubmit=null;this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};o.prototype.clearHint=function e(){var t=this;if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}this.$hint.classList.add("empty");this.hintTimer=setTimeout(function(){i.empty(t.$hint)},3e3)};o.prototype.setHint=function e(t,n){var r=this;if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}if(this.$hint.textContent){this.$hint.classList.add("empty");this.hintTimer=setTimeout(function(){i.empty(r.$hint);r.setHint(t,n)},300);return}this.$hint.textContent=t;this.$hint.classList.remove("empty");i.class(this.$hint,{passive:!!n.passive,active:!!n.active});this.hintTimer=setTimeout(this.clearHint.bind(this),3e3)};o.prototype.setBigHint=function e(t,n){var r=document.createElement("h2");r.textContent=t;if(n){i.class(r,n)}i.empty(this.$hint);this.$hint.appendChild(r)};o.prototype.clearDialog=function e(){var t=this;this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var n=false;var r=function(){t.$dialogWrapper.removeEventListener("transitionstart",r);if(n){return}n=true;t.$dialogWrapper.addEventListener("transitionend",s)};var s=function(){t.$dialogWrapper.removeEventListener("transitionend",s);i.empty(t.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",r);setTimeout(function(){if(n){return}n=true;i.empty(t.$dialogWrapper)},10)};o.prototype.setDialog=function e(t,n,r){n=n||{};r=r||a;if(n.contentDelay&&!this.newSegmentNeeded){delete n.contentDelay;var s=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var o=Math.min(s*10,5e3);console.warn("contentLength/delay",s,o);setTimeout(this.setDialog.bind(this,t,n,r),o);return}var l=document.createElement("div");l.classList.add("dialog");if(n.title){var c=document.createElement("h2");c.classList.add("title");c.textContent=n.title;l.appendChild(c)}var u=document.createElement("div");u.classList.add("message");u.textContent=t;l.appendChild(u);if(n.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(n.big){l.classList.add("big")}if(n.fun){l.classList.add("fun")}if(n.alert){l.classList.add("alert")}if(n.modal){l.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}i.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(l);this.$dialogWrapper.classList.remove("empty");r()};o.prototype.setSceneImage=function e(t){var n=false;var i=this.$sceneImage;this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(t.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")'}if(t.origin&&typeof t.origin==="string"){this.$sceneImage.style.backgroundPosition=t.origin}var r=function e(){if(n){return}n=true;i.remove()};if(i){i.addEventListener("transitionend",r,false);this.$gfx.insertBefore(this.$sceneImage,i);i.classList.add("hidden");setTimeout(r,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(t.position){case"left":this.$body.setAttribute("data-image-position","left");break;case"right":default:this.$body.setAttribute("data-image-position","right");break}};o.prototype.clearSprite=function e(t){if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}this.clearUiObject(this.sprites[t]);delete this.sprites[t]};o.prototype.clearUi=function e(t){if(!this.uis[t]){console.warn("Unknown UI id: ",t);return}this.clearUiObject(this.uis[t]);delete this.uis[t]};o.prototype.clearMarker=function e(t){if(!this.markers[t]){console.warn("Unknown Marker id: ",t);return}this.clearUiObject(this.markers[t]);delete this.markers[t]};o.prototype.clearCard=function e(t){if(!this.cards[t]){console.warn("Unknown Card id: ",t);return}this.clearUiObject(this.cards[t]);delete this.cards[t]};o.prototype.showSprite=function e(t,n){if(!n.url||typeof n.url!=="string"){return}if(this.sprites[t]){this.clearUiObject(this.sprites[t])}var i=this.sprites[t]=this.createUiObject({actionCallback:n.actionCallback,action:null,type:"sprite",style:{},animation:null});this.updateUiObject(i,n)};o.prototype.showUi=function e(t,n){if(!n.url||typeof n.url!=="string"){return}if(this.uis[t]){this.clearUiObject(this.uis[t])}var i=this.uis[t]=this.createUiObject({actionCallback:n.actionCallback,action:null,type:"ui",style:{},area:{},animation:null});this.updateUiObject(i,n)};o.prototype.showMarker=function e(t,n){if(!n.url||typeof n.url!=="string"){return}if(this.markers[t]){this.clearUiObject(this.markers[t])}var i=this.markers[t]=this.createUiObject({actionCallback:n.actionCallback,action:null,type:"marker",ui:null,location:null,$locationSlot:null,style:{},animation:null});this.updateUiObject(i,n)};o.prototype.showCard=function e(t,n){if(!n.url||typeof n.url!=="string"){return}if(this.cards[t]){this.clearUiObject(this.cards[t])}var i=this.cards[t]=this.createUiObject({actionCallback:n.actionCallback,action:null,type:"card",location:"showing",style:{},imageStyle:{},animation:null,contents:{}});this.updateCardObject(i,n)};o.prototype.updateSprite=function e(t,n){if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}this.updateUiObject(this.sprites[t],n)};o.prototype.updateUi=function e(t,n){if(!this.uis[t]){console.warn("Unknown UI id: ",t);return}this.updateUiObject(this.uis[t],n)};o.prototype.updateMarker=function e(t,n){if(!this.markers[t]){console.warn("Unknown marker id: ",t);return}this.updateUiObject(this.markers[t],n)};o.prototype.updateCard=function e(t,n){if(!this.cards[t]){console.warn("Unknown card id: ",t);return}this.updateCardObject(this.cards[t],n)};o.prototype.animateSprite=function e(t,n){if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}this.animateUiObject(this.sprites[t],this.animations[n])};o.prototype.animateUi=function e(t,n){if(!this.uis[t]){console.warn("Unknown UI id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}this.animateUiObject(this.uis[t],this.animations[n])};o.prototype.animateMarker=function e(t,n){if(!this.markers[t]){console.warn("Unknown marker id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}this.animateUiObject(this.markers[t],this.animations[n])};o.prototype.animateCard=function e(t,n){if(!this.cards[t]){console.warn("Unknown card id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}this.animateUiObject(this.cards[t],this.animations[n])};o.prototype.createUiObject=function e(t){var n=new s;Object.assign(n,t);n.defineStates("loaded","loading");return n};o.prototype.clearUiObject=function e(t){if(t.type==="card"){t.$wrapper.remove()}else{t.$image.remove();if(t.$mask){t.$mask.remove()}}};o.prototype.updateUiObject=function e(t,n){var s=this,a;if(!n.style||typeof n.style!=="object"){n.style={}}delete n.style.position;if(n.url){if(n.url.endsWith(".svg")){if(t.$image){t.$image.remove()}if(t.type==="marker"){t.$image=document.createElementNS("http://www.w3.org/2000/svg","g")}else{t.$image=document.createElementNS("http://www.w3.org/2000/svg","svg");t.$image.classList.add("svg")}switch(t.type){case"ui":t.onClick=function(e){e.stopPropagation()};t.$image.addEventListener("click",t.onClick);t.$image.classList.add("ui");this.uiLoadingCount++;break;case"sprite":t.$image.classList.add("sprite");break;case"marker":t.$image.classList.add("marker");break}r.load(this.cleanUrl(n.url),{removeSvgStyle:true,removeComments:true,removeExoticNamespaces:true,as:t.$image},function(){if(t.type==="ui"){s.setUiButtons(t.$image);s.setUiPassiveHints(t.$image);t.emit("loaded");if(--s.uiLoadingCount<=0){s.emit("uiLoaded")}}else{t.emit("loaded")}});t.emit("loading")}else{if(!t.$image||t.$image.tagName.toLowerCase()!=="img"){if(t.$image){t.$image.remove()}t.$image=document.createElement("img");t.$image.classList.add(t.type)}t.$image.setAttribute("src",this.cleanUrl(n.url))}if(t.type!=="marker"){this.$gfx.append(t.$image)}}if(n.maskUrl&&n.maskUrl.endsWith(".svg")&&t.type==="sprite"){console.warn("has mask!");if(t.$mask){t.$mask.remove()}t.$mask=document.createElementNS("http://www.w3.org/2000/svg","svg");t.$mask.classList.add("sprite-mask");r.load(this.cleanUrl(n.maskUrl),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,as:t.$mask});this.$gfx.append(t.$mask)}if(n.action!==undefined){a=t.$mask||t.$image;if(n.action&&!t.action){t.onClick=function(e){t.actionCallback(t.action);e.stopPropagation()};a.classList.add("button");a.addEventListener("click",t.onClick)}else if(!n.action&&t.action){a.classList.remove("button");a.removeEventListener("click",t.onClick)}t.action=n.action||null}if(n.style){Object.assign(t.style,n.style);i.css(t.$image,n.style);if(t.$mask){console.warn("update mask!");i.css(t.$mask,n.style)}}if(n.area){this.updateUiArea(t,n.area)}if(n.ui||n.location){this.updateMarkerLocation(t,n.ui,n.location)}};o.prototype.updateUiArea=function e(t,n){var i=this,r;if(t.type!=="ui"){return}if(!t.hasState("loaded")){t.once("loaded",this.updateUiArea.bind(this,t,n));return}for(r in n){if(!t.area[r]){t.area[r]={}}if(!t.area[r].status){t.area[r].status={}}if(n[r].hint!==undefined){t.area[r].hint=n[r].hint||null}if(n[r].status){Object.assign(t.area[r].status,n[r].status)}Array.from(t.$image.querySelectorAll("[area="+r+"]")).forEach(function(e){var t;if(n[r].hint!==undefined){if(n[r].hint){e.setAttribute("data-passive-hint",n[r].hint);e.classList.add("passive-hint")}else{e.removeAttribute("data-passive-hint");e.classList.remove("passive-hint")}}if(n[r].status){for(t in n[r].status){if(n[r].status[t]){e.classList.add("status-"+t)}else{e.classList.remove("status-"+t)}}}})}};o.prototype.updateMarkerLocation=function e(t,n,i){var s,a,o,l,c,u,f,h,d,p;if(!t.hasState("loaded")){t.once("loaded",this.updateMarkerLocation.bind(this,t,n,i));return}if(!n){n=t.ui}if(!i){i=t.location}if(!this.uis[n]){console.warn("Unknown UI id: ",n);return}s=this.uis[n];if(!s.hasState("loaded")){s.once("loaded",this.updateMarkerLocation.bind(this,t,n,i));return}a=s.$image.querySelector("[area="+i+"]");if(!a){console.warn("UI "+n+": area not found",i);return}t.ui=n;t.location=i;o=a.getBBox();d=o.x+o.width/2;p=o.y+o.height/2;l=r.getViewBox(t.$image);c=parseFloat(t.$image.getAttribute("width"))||l.width;u=parseFloat(t.$image.getAttribute("height"))||l.height;if(!isNaN(f=parseFloat(t.$image.getAttribute("originX")))){d-=(f-l.x)/l.width*c}if(!isNaN(h=parseFloat(t.$image.getAttribute("originY")))){p-=(h-l.y)/l.height*u}t.$image.style.transform="translate("+d+"px , "+p+"px )"+"scale("+c/l.width+" , "+u/l.height+")";if(t.$image.ownerSVGElement!==s.$image){s.$image.append(t.$image)}};o.prototype.updateCardObject=function e(t,n){var r=this,s,a,o,l,c;if(!t.$wrapper){this.createCardMarkup(t)}if(n.url){t.$image.style.backgroundImage='url("'+this.cleanUrl(n.url)+'")';delete n.url}if(n.backUrl){t.$backImage.style.backgroundImage='url("'+this.cleanUrl(n.backUrl)+'")';delete n.backUrl}if(n.content){for(s in n.content){a=n.content[s];o=t.contents[s];if(!o){o=t.contents[s]=document.createElement("div");o.classList.add("content-"+s);t.$front.append(o)}o.textContent=a;o.setAttribute("content",a)}delete n.content}if(n.location&&t.location!==n.location){this.moveCardTo(t,n.location,function(){r.updateCardObject(t,n)});delete n.location;return}if(n.status){for(l in n.status){c=n.status[l];if(c){t.$wrapper.classList.add("status-"+l);if(typeof c==="number"||typeof c==="string"){t.$wrapper.setAttribute("status-"+l,c)}}else{t.$wrapper.classList.remove("status-"+l);if(t.$wrapper.hasAttribute("status-"+l)){t.$wrapper.removeAttribute("status-"+l)}}}}if(n.style){Object.assign(t.style,n.style);i.css(t.$wrapper,n.style)}if(n.imageStyle){Object.assign(t.imageStyle,n.imageStyle);i.css(t.$image,n.imageStyle)}};o.prototype.createCardMarkup=function e(t){t.$wrapper=document.createElement("div");t.$wrapper.classList.add("card-wrapper");t.$card=document.createElement("div");t.$card.classList.add("card");t.$wrapper.append(t.$card);t.$front=document.createElement("div");t.$front.classList.add("front");t.$card.append(t.$front);t.$image=document.createElement("div");t.$image.classList.add("card-image");t.$front.append(t.$image);t.$back=document.createElement("div");t.$back.classList.add("back");t.$card.append(t.$back);t.$backImage=document.createElement("div");t.$backImage.classList.add("card-image");t.$back.append(t.$backImage)};o.prototype.createCardLocation=function e(t){var n;if(this.cardLocations[t]){return}n=this.cardLocations[t]=document.createElement("div");n.classList.add("card-location");n.classList.add("card-location-"+t);this.$gfx.append(n)};function l(e){var t=e.match(/(matrix|matrix3d)\(([0-9., -]+)\)/);if(!t){return null}return t[2].trim().split(/ ?, ?/).map(function(e){return parseFloat(e)})}function c(e){var t=Math.atan2(e[1],e[0]),n=e[0]*e[0]+e[1]*e[1],i=Math.sqrt(n),r=(e[0]*e[3]-e[2]*e[1])/i,s=Math.atan2(e[0]*e[2]+e[1]*e[3],n);return{rotate:180*t/Math.PI,scaleX:i,scaleY:r,skewX:180*s/Math.PI,skewY:0,translateX:e[4],translateY:e[5]}}function u(e){var t=Math.PI/180;var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);var s=Math.atan2(-e[9]/r,e[10]/r)/t,a=Math.asin(e[8]/r)/t,o=Math.atan2(-e[4]/i,e[0]/n)/t;if(e[4]===1||e[4]===-1){s=0;a=e[4]*-Math.PI/2;o=e[4]*Math.atan2(e[6]/i,e[5]/i)/t}var l=e[12]/n,c=e[13]/n,u=e[14]/n;return{translateX:l,translateY:c,translateZ:u,rotateX:s,rotateY:a,rotateZ:o,scaleX:n,scaleY:i,scaleZ:r}}function f(e){if(e.length===6){return c(e)}if(e.length===16){return u(e)}else{return null}}function h(e){var t=[];if(e.translateX){t.push("translateX("+e.translateX+"px)")}if(e.translateY){t.push("translateY("+e.translateY+"px)")}if(e.translateZ){t.push("translateZ("+e.translateZ+"px)")}if(e.rotate){t.push("rotate("+e.rotate+"deg)")}if(e.rotateX){t.push("rotateX("+e.rotateX+"deg)")}if(e.rotateY){t.push("rotateY("+e.rotateY+"deg)")}if(e.rotateZ){t.push("rotateZ("+e.rotateZ+"deg)")}if(e.scaleX){t.push("scaleX("+e.scaleX+")")}if(e.scaleY){t.push("scaleY("+e.scaleY+")")}if(e.scaleZ){t.push("scaleZ("+e.scaleZ+")")}if(e.skewX){t.push("skewX("+e.skewX+"deg)")}if(e.skewY){t.push("skewY("+e.skewY+"deg)")}return t.join(" ")}o.prototype.moveCardTo=function e(t,n,i){var r,s,a;if(t.location===n){i();return}r=this.cardLocations[n];a=t.$locationSlot;if(!r){r=this.cardLocations[n]=document.createElement("div");r.classList.add("card-location");r.classList.add("card-location-"+n);this.$gfx.append(r)}t.location=n;s=t.$locationSlot=document.createElement("div");s.classList.add("card-slot");r.append(s);var o={translateX:0,translateY:0};var l=parseFloat(window.getComputedStyle(t.$wrapper).width);var c=parseFloat(window.getComputedStyle(t.$wrapper).height);var u=parseFloat(window.getComputedStyle(s).width);var f=parseFloat(window.getComputedStyle(s).height);o.scaleX=u/l;o.scaleY=f/c;o.translateX-=(l-u)/2;o.translateY-=(c-f)/2;var d=t.localTransform;t.localTransform=o;console.warn("targetTransform:",o);if(!a){t.$wrapper.style.transform=h(o);s.append(t.$wrapper);i();return}var p=s.getBoundingClientRect();var m=a.getBoundingClientRect();console.warn("bboxes",p,m);var g={translateX:m.left+d.translateX-p.left,translateY:m.top+d.translateY-p.top,scaleX:d.scaleX,scaleY:d.scaleY};t.$wrapper.style.transform=h(g);s.append(t.$wrapper);a.remove();setTimeout(function(){t.$wrapper.style.transform=h(o);i()},10)};o.prototype.animateUiObject=function e(t,n){var i=this,r,s=0;t.animation=n.id;if(!Array.isArray(n.frames)||!n.frames.length){return}var a=function(){r=n.frames[s];i.updateUiObject(t,r);if(++s<n.frames.length){setTimeout(a,r.duration*1e3)}else{t.animation=null}};a()};o.prototype.defineAnimation=function e(t,n){n.id=t;this.animations[t]=n};o.prototype.setUiButtons=function e(t){Array.from(t.querySelectorAll("[button]")).forEach(function(e){var t=e.getAttribute("button");e.setAttribute("id","button-"+t);if(!e.getAttribute("area")){e.setAttribute("area",t)}e.classList.add("button");e.classList.add("disabled")})};o.prototype.setUiPassiveHints=function e(t){var n=this;Array.from(t.querySelectorAll("[hint]")).forEach(function(e){var t=e.getAttribute("hint");e.setAttribute("data-passive-hint",t);e.classList.add("passive-hint");e.addEventListener("mouseleave",function(e){n.clearHint()});e.addEventListener("mouseenter",function(e){var t=e.currentTarget;var i=t.getAttribute("data-passive-hint");if(!i){return}n.setHint(i,{passive:true})})})};o.prototype.sound=function e(t){var n=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,t,n);this.nextSoundChannel=(this.nextSoundChannel+1)%4;n.setAttribute("src",this.cleanUrl(t.url));n.play()};o.prototype.music=function e(t){var n=this,i=this.$music.getAttribute("src");if(t.url){t.url=this.cleanUrl(t.url);if(i){if(i!==t.url){g(this.$music,function(){n.$music.setAttribute("src",t.url);n.$music.play();m(n.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",t.url);this.$music.play();m(this.$music)}}else{if(i){g(this.$music,function(){n.$music.removeAttribute("src")})}}};var d=10;var p=.01;function m(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+p)
;e.__fadeTimer=setTimeout(m.bind(undefined,e,t),d)}function g(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-p);e.__fadeTimer=setTimeout(g.bind(undefined,e,t),d)}},{"dom-kit":6,"nextgen-events":8,"svg-kit":20}],2:[function(e,t,n){"use strict";var i=e("nextgen-events");var r=e("dom-kit");var s=e("url");function a(e){return a.create(e)}t.exports=a;a.prototype=Object.create(i.prototype);a.prototype.constructor=a;a.create=function e(t){var n=Object.create(a.prototype,{token:{value:t.token||"null",writable:true,enumerable:true},port:{value:t.port||80,writable:true,enumerable:true},userName:{value:t.name||"unknown_"+Math.floor(Math.random()*1e4),writable:true,enumerable:true},ws:{value:null,writable:true,enumerable:true},proxy:{value:null,writable:true,enumerable:true}});return n};var o={classic:e("./ui/classic.js")};a.autoCreate=function e(){var t=s.parse(window.location.href,true).query;window.spellcastClient=a.create(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};a.prototype.run=function e(t){var n=this,r=false;this.proxy=new i.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(function(e){if(o[e]){o[e](n.proxy.remoteServices.bus,n)}});this.ws=new WebSocket("ws://127.0.0.1:"+this.port+"/"+this.token);this.emit("connecting");this.ws.onerror=function e(){if(!r){console.log("Can't open Websocket (error)...");n.emit("error","unreachable");return}};this.ws.onopen=function e(){r=true;console.log("Websocket opened!");n.emit("open");n.proxy.remoteServices.bus.emit("authenticate",{name:n.userName});if(typeof t==="function"){t()}};this.ws.onclose=function e(){if(!r){console.log("Can't open Websocket (close)...");n.emit("error","unreachable");return}r=false;n.proxy.destroy();console.log("Websocket closed!");n.emit("close")};this.ws.onmessage=function e(t){var i;try{i=JSON.parse(t.data)}catch(e){return}console.log("Message received: ",i);n.proxy.receive(i)};n.proxy.send=function e(t){n.ws.send(JSON.stringify(t))}};a.autoCreate();r.ready(function(){window.spellcastClient.run();document.body.onkeypress=function(e){if(e.keyCode!==120){return}var t,n=document.querySelectorAll("link[rel=stylesheet]");for(var i=0;i<n.length;i++){t=n[i].getAttribute("href").split("?")[0]+"?"+Math.random();n[i].setAttribute("href",t)}}})},{"./ui/classic.js":4,"dom-kit":6,"nextgen-events":8,url:21}],3:[function(e,t,n){"use strict";var i={};t.exports=i;var r=e("string-kit/lib/format.js").markupMethod;var s=e("string-kit/lib/escape.js").html;var a={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="brightBlue">',c:'<span class="cyan">',C:'<span class="brightCyan">',g:'<span class="green">',G:'<span class="brightGreen">',k:'<span class="black">',K:'<span class="brightBlack">',m:'<span class="magenta">',M:'<span class="brightMagenta">',r:'<span class="red">',R:'<span class="brightRed">',w:'<span class="white">',W:'<span class="brightWhite">',y:'<span class="yellow">',Y:'<span class="brightYellow">'}};i.markup=function(){var e=Array.from(arguments);e[0]=s(e[0]).replace(/\n/,"<br />");return r.apply(a,e)}},{"string-kit/lib/escape.js":17,"string-kit/lib/format.js":18}],4:[function(e,t,n){"use strict";var i=e("../Dom.js");var r=e("../toolkit.js");function s(e,t,n){console.log(Array.from(arguments));if(!n){n=Object.create(s.prototype,{bus:{value:e,enumerable:true},client:{value:t,enumerable:true},user:{value:null,writable:true,enumerable:true},users:{value:null,writable:true,enumerable:true},roles:{value:null,writable:true,enumerable:true},roleId:{value:null,writable:true,enumerable:true},config:{value:null,writable:true,enumerable:true},inGame:{value:false,writable:true,enumerable:true},nexts:{value:null,writable:true,enumerable:true},afterNext:{value:false,writable:true,enumerable:true},afterNextTriggered:{value:false,writable:true,enumerable:true},afterLeave:{value:false,writable:true,enumerable:true},hasNewContent:{value:false,writable:true,enumerable:true},dom:{value:i.create()}})}n.client.once("connecting",s.clientConnecting.bind(n));n.client.once("open",s.clientOpen.bind(n));n.client.once("close",s.clientClose.bind(n));n.client.on("error",s.clientError.bind(n));n.dom.enableChat(function(e){console.log("inGame?",n.inGame);n.bus.emit(n.inGame?"command":"chat",e)});n.dom.preload();return n}t.exports=s;function a(e){return this.find(function(t){return t.id===e})}s.prototype.initBus=function e(){this.bus.on("clientConfig",s.clientConfig.bind(this));this.bus.on("user",s.user.bind(this));this.bus.on("userList",s.userList.bind(this));this.bus.on("roleList",s.roleList.bind(this));this.bus.on("extOutput",s.extOutput.bind(this));this.bus.on("extErrorOutput",s.extErrorOutput.bind(this));this.bus.on("message",s.message.bind(this),{async:true});this.bus.on("indicators",s.indicators.bind(this));this.bus.on("status",s.status.bind(this));this.bus.on("panel",s.panel.bind(this));this.bus.on("theme",s.theme.bind(this));this.bus.on("image",s.image.bind(this));this.bus.on("sound",s.sound.bind(this));this.bus.on("music",s.music.bind(this));this.bus.on("defineAnimation",s.defineAnimation.bind(this));this.bus.on("showSprite",s.showSprite.bind(this));this.bus.on("updateSprite",s.updateSprite.bind(this));this.bus.on("animateSprite",s.animateSprite.bind(this));this.bus.on("clearSprite",s.clearSprite.bind(this));this.bus.on("showUi",s.showUi.bind(this));this.bus.on("updateUi",s.updateUi.bind(this));this.bus.on("animateUi",s.animateUi.bind(this));this.bus.on("clearUi",s.clearUi.bind(this));this.bus.on("showMarker",s.showMarker.bind(this));this.bus.on("updateMarker",s.updateMarker.bind(this));this.bus.on("animateMarker",s.animateMarker.bind(this));this.bus.on("clearMarker",s.clearMarker.bind(this));this.bus.on("showCard",s.showCard.bind(this));this.bus.on("updateCard",s.updateCard.bind(this));this.bus.on("animateCard",s.animateCard.bind(this));this.bus.on("clearCard",s.clearCard.bind(this));this.bus.on("enterScene",s.enterScene.bind(this));this.bus.on("leaveScene",s.leaveScene.bind(this));this.bus.on("nextList",s.nextList.bind(this));this.bus.on("nextTriggered",s.nextTriggered.bind(this));this.bus.on("textInput",s.textInput.bind(this));this.bus.on("rejoin",s.rejoin.bind(this));this.bus.on("wait",s.wait.bind(this));this.bus.on("end",s.end.bind(this),{async:true});this.bus.on("exit",s.exit.bind(this));this.bus.emit("ready")};s.clientConnecting=function e(){console.log("Connecting!");this.dom.clientStatus("connecting")};s.clientOpen=function e(){console.log("Connected!");this.dom.clientStatus("connected");this.initBus()};s.clientClose=function e(){console.log("Closed!");this.dom.clientStatus("closed")};s.clientError=function e(t){switch(t){case"unreachable":this.dom.clientStatus("unreachable");break}};s.clientConfig=function e(t){console.warn("Client config received: ",t);this.config=t;if(this.config.theme){this.dom.setTheme(this.config.theme)}};s.user=function e(t){console.log("User received: ",t);this.user=t};s.userList=function e(t){console.log("User-list received: ",t);t.get=a;this.users=t};s.roleList=function e(t,n,i){var r=this,s=[],o;if(!this.roles&&t.length>1){this.dom.setMultiplayer(true)}t.get=a;this.roles=t;if(this.inGame){return}if(i&&t.length<=1){this.roleId=t[0].id;return}t.forEach(function(e,t){var n=e.clientId&&r.users.get(e.clientId).name;s.push({index:t,label:e.label,type:"role",selectedBy:n&&[n]})});if(n.length){o=n.map(function(e){return r.users.get(e).name})}var l=function(e){if(t[e].clientId===r.user.id){r.bus.emit("selectRole",null)}else if(t[e].clientId!==null){return}else{r.bus.emit("selectRole",e)}};this.dom.setChoices(s,o,l);if(i){t.find(function(e,t){if(e.clientId===r.user.id){r.roleId=e.id;return true}return false});this.afterLeave=true;return}};s.message=function e(t,n,i){var s=this,a=false;this.hasNewContent=true;t=r.markup(t);if(!n){n={}}var o=function e(){if(a){return}a=true;if(n.next){s.messageNext(i);return}i()};this.dom.addMessage(t,n,o)};s.prototype.messageNext=function e(t){this.dom.messageNext(t)};s.indicators=function e(t){this.dom.addIndicators(t)};s.status=function e(t){this.dom.addIndicators(t,true)};s.panel=function e(t,n){this.dom.addPanel(t,n)};s.enterScene=function e(t,n){var i;this.inGame=true;if(n){i=this.dom.toAltBuffer()}if(!t&&!i){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};s.leaveScene=function e(t,n){if(n){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};s.nextTriggered=function e(t){var n=this.nexts[t];this.dom.newSegmentOnContent("inter-segment");if(n.label&&!n.button){this.dom.addSelectedChoice(n.label)}this.dom.clearChoices();this.afterNextTriggered=true;this.hasNewContent=false};s.nextList=function e(t,n,i,r,s){var a=this,o=[],l,c=0;this.nexts=t;this.afterNext=true;if(s&&this.roles.length===1){return}t.forEach(function(e,t){var n=e.roleIds.map(function(e){return a.roles.get(e).label});if(e.label){c+=e.label.length}o.push({index:t,label:e.label||"Next",image:e.image,button:e.button,groupBreak:!!e.groupBreak,type:"next",selectedBy:n})});if(!r.style||r.style==="auto"){if(this.roles.length<=1&&o.length<=3&&c<20){r.style="inline"}else if(o.length>8){r.style="smallList"}else{r.style="list"}}if(i.length&&this.roles.length){l=i.map(function(e){return a.roles.get(e).label})}var u=function(e){if(t[e].roleIds.indexOf(a.roleId)!==-1){a.bus.emit("selectNext",null)}else{a.bus.emit("selectNext",e)}};this.dom.setChoices(o,l,u,{timeout:r.timeout,style:r.style})};s.extOutput=function e(t){alert("not coded ATM!")};s.extErrorOutput=function e(t){alert("not coded ATM!")};s.textInput=function e(t,n){var i=this,r={label:t};if(n.indexOf(this.roleId)===-1){r.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(r)}else{this.dom.textInput(r,function(e){i.bus.emit("textSubmit",e)})}};s.rejoin=function e(){};s.wait=function e(t){var n=this;switch(t){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoin",function(){n.dom.clearHint()});break;default:this.dom.setBigHint("WAITING FOR "+t,{wait:true,"pulse-animation":true})}};s.theme=function e(t){if(!t.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(t)};s.image=function e(t){this.dom.setSceneImage(t)};s.defineAnimation=function e(t,n){this.dom.defineAnimation(t,n)};s.showSprite=function e(t,n){if(!n.url||typeof n.url!=="string"){return}n.actionCallback=s.spriteActionCallback.bind(this);this.dom.showSprite(t,n)};s.spriteActionCallback=function e(t){console.warn("Sprite action triggered: ",t);this.bus.emit("action",t)};s.updateSprite=function e(t,n){this.dom.updateSprite(t,n)};s.animateSprite=function e(t,n){this.dom.animateSprite(t,n)};s.clearSprite=function e(t){this.dom.clearSprite(t)};s.showUi=function e(t,n){if(!n.url||typeof n.url!=="string"){return}n.actionCallback=s.uiActionCallback.bind(this);this.dom.showUi(t,n)};s.uiActionCallback=function e(t){console.warn("UI action triggered: ",t);this.bus.emit("action",t)};s.updateUi=function e(t,n){this.dom.updateUi(t,n)};s.animateUi=function e(t,n){this.dom.animateUi(t,n)};s.clearUi=function e(t){this.dom.clearUi(t)};s.showMarker=function e(t,n){if(!n.url||typeof n.url!=="string"){return}n.actionCallback=s.markerActionCallback.bind(this);this.dom.showMarker(t,n)};s.markerActionCallback=function e(t){console.warn("Marker action triggered: ",t);this.bus.emit("action",t)};s.updateMarker=function e(t,n){this.dom.updateMarker(t,n)};s.animateMarker=function e(t,n){this.dom.animateMarker(t,n)};s.clearMarker=function e(t){this.dom.clearMarker(t)};s.showCard=function e(t,n){if(!n.url||typeof n.url!=="string"){return}n.actionCallback=s.cardActionCallback.bind(this);this.dom.showCard(t,n)};s.cardActionCallback=function e(t){console.warn("Card action triggered: ",t);this.bus.emit("action",t)};s.updateCard=function e(t,n){this.dom.updateCard(t,n)};s.animateCard=function e(t,n){this.dom.animateCard(t,n)};s.clearCard=function e(t){this.dom.clearCard(t)};s.sound=function e(t){this.dom.sound(t)};s.music=function e(t){this.dom.music(t)};s.end=function e(t,n,i){var r={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};switch(t){case"end":this.dom.setDialog("The End.",r,i);break;case"win":this.dom.setDialog("You Win!",r,i);break;case"lost":this.dom.setDialog("You Lose...",r,i);break;case"draw":this.dom.setDialog("Draw.",r,i);break}};s.exit=function e(){}},{"../Dom.js":1,"../toolkit.js":3}],5:[function(e,t,n){},{}],6:[function(e,t,n){(function(n){"use strict";var i,r;if(n.browser){i=new DOMParser;r=new XMLSerializer}else{var s=e("@cronvel/xmldom");i=new s.DOMParser;r=new s.XMLSerializer}var a={};t.exports=a;a.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};a.fromXml=function e(t){return i.parseFromString(t,"application/xml")};a.toXml=function e(t){return r.serializeToString(t)};a.fromHtml=function e(t){var n,i,r;r=document.createDocumentFragment();i=document.createElement("div");i.insertAdjacentHTML("beforeend",t);for(n=0;n<i.children.length;n++){r.appendChild(i.children[n])}return r};a.batch=function e(t,n){var i,r=Array.prototype.slice.call(arguments,1);if(n instanceof Element){r[0]=n;t.apply(this,r)}else if(Array.isArray(n)){for(i=0;i<n.length;i++){r[0]=n[i];t.apply(this,r)}}else if(n instanceof NodeList||n instanceof NamedNodeMap){for(i=0;i<n.length;i++){r[0]=n[i];t.apply(this,r)}}};a.css=function e(t,n){var i;for(i in n){t.style[i]=n[i]}};a.attr=function e(t,n){var i;for(i in n){if(n[i]===null){t.removeAttribute(i)}else{t.setAttribute(i,n[i])}}};a.class=function e(t,n){var i;for(i in n){if(n[i]){t.classList.add(i)}else{t.classList.remove(i)}}};a.remove=function e(t){t.parentNode.removeChild(t)};a.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};a.cloneInto=function e(t,n){a.empty(n);n.appendChild(t.cloneNode(true))};a.insertInto=function e(t,n){a.empty(n);n.appendChild(t)};a.moveChildrenInto=function e(t,n){a.empty(n);while(t.firstChild){n.appendChild(t.firstChild)}};a.moveAttributes=function e(t,n){Array.from(t.attributes).forEach(function(e){var i=e.name;var r=e.value;t.removeAttribute(i);if(i!=="xmlns"&&i.indexOf(":")===-1&&r){n.setAttribute(i,r)}})};a.styleToAttribute=function e(t,n,i){if(t.style[n]&&(!i||i.indexOf(t.style[n])===-1)){t.setAttribute(n,t.style[n]);t.style[n]=null}};a.prefixIds=function e(t,n){var i,r={};i=t.querySelectorAll("*");a.batch(a.prefixIds.idAttributePass,i,n,r);a.batch(a.prefixIds.otherAttributesPass,i,r)};a.prefixIds.idAttributePass=function e(t,n,i){i[t.id]=n+"."+t.id;t.id=i[t.id]};a.prefixIds.otherAttributesPass=function e(t,n){a.batch(a.prefixIds.oneAttributeSubPass,t.attributes,n)};a.prefixIds.oneAttributeSubPass=function e(t,n){t.value=t.value.replace(/url\(#([^)]+)\)/g,function(e,t){if(!n[t]){return e}return"url(#"+n[t]+")"})};a.removeAllTags=function e(t,n,i){Array.from(t.getElementsByTagName(n)).forEach(function(e){if(!i||!e.firstChild){e.parentNode.removeChild(e)}})};a.removeAllAttributes=function e(t,n){t.removeAttribute(n);Array.from(t.querySelectorAll("["+n+"]")).forEach(function(e){e.removeAttribute(n)})};a.preload=function e(t){if(!Array.isArray(t)){t=[t]}t.forEach(function(e){if(a.preload.preloaded[e]){return}a.preload.preloaded[e]=new Image;a.preload.preloaded[e].src=e})};a.preload.preloaded={};a.filterByNamespace=function e(t,n){var i,r,s,o,l;if(!n||typeof n!=="object"){return}a.filterAttributesByNamespace(t,n);for(i=t.childNodes.length-1;i>=0;i--){r=t.childNodes[i];if(r.nodeType===1){if(r.tagName.indexOf(":")!==-1){l=r.tagName.split(":");s=l[0];o=l[1];if(s===n.primary){r.tagName=o;a.filterByNamespace(r,n)}else if(n.whitelist){if(n.whitelist.indexOf(s)!==-1){a.filterByNamespace(r,n)}else{t.removeChild(r)}}else if(n.blacklist){if(n.blacklist.indexOf(s)!==-1){t.removeChild(r)}else{a.filterByNamespace(r,n)}}else{a.filterByNamespace(r,n)}}else{a.filterByNamespace(r,n)}}}};a.filterAttributesByNamespace=function e(t,n){var i,r,s,a,o,l;if(!n||typeof n!=="object"){return}for(i=t.attributes.length-1;i>=0;i--){r=t.attributes[i];if(r.name.indexOf(":")!==-1){l=r.name.split(":");s=l[0];a=l[1];o=r.value;if(s===n.primary){t.removeAttributeNode(r);t.setAttribute(a,o)}else if(n.whitelist){if(n.whitelist.indexOf(s)===-1){t.removeAttributeNode(r)}}else if(n.blacklist){if(n.blacklist.indexOf(s)!==-1){t.removeAttributeNode(r)}}}}};a.removeComments=function e(t){var n,i;for(n=t.childNodes.length-1;n>=0;n--){i=t.childNodes[n];if(i.nodeType===8){t.removeChild(i)}else if(i.nodeType===1){a.removeComments(i)}}};a.removeWhiteSpaces=function e(t,n){var i,r,s=null;for(i=t.childNodes.length-1;i>=0;i--){r=t.childNodes[i];if(r.nodeType===3){if(n){if(s){s.nodeValue=(r.nodeValue+s.nodeValue).replace(/^\s*(\n[\t ]*)$/,"$1");t.removeChild(r)}else{r.nodeValue=r.nodeValue.replace(/^\s*(\n[\t ]*)$/,"$1");s=r}}else{if(!/\S/.test(r.nodeValue)){t.removeChild(r)}}}else if(r.nodeType===1){s=null;a.removeWhiteSpaces(r,n)}else{s=null}}};a.id=function e(t,e){t.id=e};a.text=function e(t,e){t.textContent=e};a.html=function e(t,e){t.innerHTML=e}}).call(this,e("_process"))},{"@cronvel/xmldom":5,_process:11}],7:[function(e,t,n){t.exports=function(e){return e!=null&&(i(e)||r(e)||!!e._isBuffer)};function i(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function r(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&i(e.slice(0,0))}},{}],8:[function(e,t,n){(function(n){"use strict";function i(){}t.exports=i;i.prototype.__prototypeUID__="nextgen-events/NextGenEvents";i.prototype.__prototypeVersion__=e("../package.json").version;i.SYNC=-Infinity;i.init=function e(){Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:i.SYNC,interruptible:false,recursion:0,contexts:{},states:{},stateGroups:{},listeners:{error:[],interrupt:[],newListener:[],removeListener:[]}}})};i.initFrom=function e(t){if(!t.__ngev){i.init.call(t)}Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:t.__ngev.nice,interruptible:t.__ngev.interruptible,recursion:0,contexts:{},states:Object.assign({},t.__ngev.states),stateGroups:Object.assign({},t.__ngev.stateGroups),listeners:{}}});Object.keys(t.__ngev.listeners).forEach(e=>{this.__ngev.listeners[e]=t.__ngev.listeners[e].slice()});Object.keys(t.__ngev.contexts).forEach(e=>{var n=t.__ngev.contexts[e];this.addListenerContext(e,{nice:n.nice,status:n.status,serial:n.serial})})};i.mergeListeners=function e(t){if(!this.__ngev){i.init.call(this)}var n=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(n).forEach(e=>{this.__ngev.listeners[e]=[]});t.forEach(e=>{if(!e.__ngev){i.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(e=>{var i,r,s=[];if(n[e]){n[e].forEach(n=>{for(i=0,r=t.length;i<r;i++){if(!t[i].__ngev.listeners[e]||t[i].__ngev.listeners[e].indexOf(n)===-1){s.push(n);break}}})}t.forEach(t=>{t.__ngev.listeners[e].forEach(t=>{if(this.__ngev.listeners[e].indexOf(t)===-1&&s.indexOf(t)===-1){this.__ngev.listeners[e].push(t)}})})})};i.filterOutCallback=function(e,t){return e!==t};i.prototype.addListener=function e(t,n,r){var s={},a;if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}s.fn=n||r.fn;s.id=r.id!==undefined?r.id:s.fn;s.once=!!r.once;s.async=!!r.async;s.eventObject=!!r.eventObject;s.nice=r.nice!==undefined?Math.floor(r.nice):i.SYNC;s.context=typeof r.context==="string"?r.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(s.context&&typeof s.context==="string"&&!this.__ngev.contexts[s.context]){this.addListenerContext(s.context)}s.event=t;if(this.__ngev.listeners.newListener.length){a=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[t].push(s);i.emitEvent({emitter:this,name:"newListener",args:[[s]],listeners:a});if(this.__ngev.states[t]){i.emitToOneListener(this.__ngev.states[t],s)}return this}this.__ngev.listeners[t].push(s);if(this.__ngev.states[t]){i.emitToOneListener(this.__ngev.states[t],s)}return this};i.prototype.on=i.prototype.addListener;i.prototype.once=function e(t,n,i){if(n&&typeof n==="object"){n.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.addListener(t,n,i)};i.prototype.removeListener=function e(t,n){var r,s,a=[],o=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}s=this.__ngev.listeners[t].length;for(r=0;r<s;r++){if(this.__ngev.listeners[t][r].id===n){o.push(this.__ngev.listeners[t][r])}else{a.push(this.__ngev.listeners[t][r])}}this.__ngev.listeners[t]=a;if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};i.prototype.off=i.prototype.removeListener;i.prototype.removeAllListeners=function e(t){var n;if(!this.__ngev){i.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}n=this.__ngev.listeners[t];this.__ngev.listeners[t]=[];if(n.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",n)}}else{this.__ngev.listeners={}}return this};i.listenerWrapper=function e(t,n,r){var s,a,o;if(n.interrupt){return}if(t.async){if(r){a=r.serial;r.ready=!a}o=(e=>{n.listenersDone++;if(e&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=e;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}if(a){i.processQueue.call(n.emitter,t.context,true)}});if(t.eventObject){t.fn(n,o)}else{s=t.fn.apply(undefined,n.args.concat(o))}}else{if(t.eventObject){t.fn(n)}else{s=t.fn.apply(undefined,n.args)}n.listenersDone++}if(s&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=s;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}};var r=0;i.prototype.emit=function e(){var t;t={emitter:this};if(typeof arguments[0]==="number"){t.nice=Math.floor(arguments[0]);t.name=arguments[1];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,2,-1)}else{t.args=Array.prototype.slice.call(arguments,2)}}else{t.name=arguments[0];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}t.args=Array.prototype.slice.call(arguments,1);if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,1,-1)}else{t.args=Array.prototype.slice.call(arguments,1)}}return i.emitEvent(t)};i.emitEvent=function e(t){var n=t.emitter,s,a,o=0,l,c;if(!n.__ngev){i.init.call(n)}l=n.__ngev.states[t.name];if(l!==undefined){if(l&&t.args.length===l.args.length&&t.args.every((e,t)=>e===l.args[t])){return}n.__ngev.stateGroups[t.name].forEach(e=>{n.__ngev.states[e]=null});n.__ngev.states[t.name]=t}if(!n.__ngev.listeners[t.name]){n.__ngev.listeners[t.name]=[]}t.id=r++;t.listenersDone=0;t.once=!!t.once;if(t.nice===undefined||t.nice===null){t.nice=n.__ngev.nice}if(!t.listeners){t.listeners=n.__ngev.listeners[t.name].slice()}n.__ngev.recursion++;c=[];for(s=0,a=t.listeners.length;s<a;s++){o++;i.emitToOneListener(t,t.listeners[s],c)}n.__ngev.recursion--;if(c.length&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",c)}if(!o){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){t.callback(undefined,t);delete t.callback}}return t};i.emitToOneListener=function e(t,n,r){var s=t.emitter,a,o,l=false;a=n.context&&s.__ngev.contexts[n.context];if(a&&a.status===i.CONTEXT_DISABLED){return}if(a){o=Math.max(t.nice,n.nice,a.nice)}else{o=Math.max(t.nice,n.nice)}if(n.once){s.__ngev.listeners[t.name]=s.__ngev.listeners[t.name].filter(i.filterOutCallback.bind(undefined,n));if(r){r.push(n)}else{l=true}}if(a&&(a.status===i.CONTEXT_QUEUED||!a.ready)){a.queue.push({event:t,listener:n,nice:o})}else{try{if(o<0){if(s.__ngev.recursion>=-o){setImmediate(i.listenerWrapper.bind(s,n,t,a))}else{i.listenerWrapper.call(s,n,t,a)}}else{setTimeout(i.listenerWrapper.bind(s,n,t,a),o)}}catch(e){s.__ngev.recursion--;throw e}}if(l&&s.__ngev.listeners.removeListener.length){s.emit("removeListener",[n])}};i.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}return this.__ngev.listeners[t].slice()};i.listenerCount=function(e,t){if(!e||!(e instanceof i)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};i.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};i.prototype.setNice=function e(t){if(!this.__ngev){i.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};i.prototype.setInterruptible=function e(t){if(!this.__ngev){i.init.call(this)}this.__ngev.interruptible=!!t};i.share=function(e,t){if(!(e instanceof i)||!(t instanceof i)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){i.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};i.reset=function e(t){Object.defineProperty(t,"__ngev",{configurable:true,value:null})};i.prototype.setMaxListeners=function(){};i.noop=function(){};i.prototype.defineStates=function e(){var t=this,n=Array.prototype.slice.call(arguments);if(!this.__ngev){i.init.call(this)}n.forEach(e=>{t.__ngev.states[e]=null;t.__ngev.stateGroups[e]=n})};i.prototype.hasState=function e(t){if(!this.__ngev){i.init.call(this)}return!!this.__ngev.states[t]};i.prototype.getAllStates=function e(){var t=this;if(!this.__ngev){i.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>t.__ngev.states[e])};i.groupAddListener=function e(t,n,i,r){if(typeof i!=="function"){r=i;i=undefined}if(!r||typeof r!=="object"){r={}}i=i||r.fn;delete r.fn;r.id=r.id||i;t.forEach(e=>{e.addListener(n,i.bind(undefined,e),r)})};i.groupOn=i.groupAddListener;i.groupOnce=function e(t,n,i,r){if(i&&typeof i==="object"){i.once=true}else if(r&&typeof r==="object"){r.once=true}else{r={once:true}}return this.groupAddListener(t,n,i,r)};i.groupGlobalOnce=function e(t,n,r,s){var a,o=false;if(typeof r!=="function"){s=r;r=undefined}if(!s||typeof s!=="object"){s={}}r=r||s.fn;delete s.fn;s.id=s.id||r;a=function(){if(o){return}o=true;i.groupRemoveListener(t,n,s.id);r.apply(undefined,arguments)};t.forEach(e=>{e.once(n,a.bind(undefined,e),s)})};i.groupGlobalOnceAll=function e(t,n,i,r){var s,a=false,o=t.length;if(typeof i!=="function"){r=i;i=undefined}if(!r||typeof r!=="object"){r={}}i=i||r.fn;delete r.fn;r.id=r.id||i;s=function(){if(a){return}if(--o){return}a=true;i.apply(undefined,arguments)};t.forEach(e=>{e.once(n,s.bind(undefined,e),r)})};i.groupRemoveListener=function e(t,n,i){t.forEach(e=>{e.removeListener(n,i)})};i.groupOff=i.groupRemoveListener;i.groupRemoveAllListeners=function e(t,n){t.forEach(e=>{e.removeAllListeners(n)})};i.groupEmit=function e(t){var n,r,s=2,a,o,l=t.length,c,u,f=false;if(typeof arguments[arguments.length-1]==="function"){a=-1;c=arguments[arguments.length-1];u=(e=>{if(f){return}if(e){f=true;c(e)}else if(!--l){f=true;c()}})}if(typeof arguments[1]==="number"){s=3;r=typeof arguments[1]}n=arguments[s-1];o=Array.prototype.slice.call(arguments,s,a);t.forEach(e=>{i.emitEvent({emitter:e,name:n,args:o,nice:r,callback:u})})};i.groupDefineStates=function e(t){var n=Array.prototype.slice.call(arguments,1);t.forEach(e=>{e.defineStates.apply(e,n)})};i.CONTEXT_ENABLED=0;i.CONTEXT_DISABLED=1;i.CONTEXT_QUEUED=2;i.prototype.addListenerContext=function e(t,n){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!n||typeof n!=="object"){n={}}if(!this.__ngev.contexts[t]){this.__ngev.contexts[t]=Object.create(i.prototype);this.__ngev.contexts[t].nice=i.SYNC;this.__ngev.contexts[t].ready=true;this.__ngev.contexts[t].status=i.CONTEXT_ENABLED;this.__ngev.contexts[t].serial=false;this.__ngev.contexts[t].queue=[]}if(n.nice!==undefined){this.__ngev.contexts[t].nice=Math.floor(n.nice)}if(n.status!==undefined){this.__ngev.contexts[t].status=n.status}if(n.serial!==undefined){this.__ngev.contexts[t].serial=!!n.serial}return this};i.prototype.disableListenerContext=function e(t){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=i.CONTEXT_DISABLED;return this};i.prototype.enableListenerContext=function e(t){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=i.CONTEXT_ENABLED;if(this.__ngev.contexts[t].queue.length>0){i.processQueue.call(this,t)}return this};i.prototype.queueListenerContext=function e(t){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=i.CONTEXT_QUEUED;return this};i.prototype.serializeListenerContext=function e(t,n){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=n===undefined?true:!!n;return this};i.prototype.setListenerContextNice=function e(t,n){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(n);return this};i.prototype.destroyListenerContext=function e(t){var n,r,s,a,o=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}for(s in this.__ngev.listeners){a=null
;r=this.__ngev.listeners[s].length;for(n=0;n<r;n++){if(this.__ngev.listeners[s][n].context===t){a=[];o.push(this.__ngev.listeners[s][n])}else if(a){a.push(this.__ngev.listeners[s][n])}}if(a){this.__ngev.listeners[s]=a}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};i.processQueue=function e(t,n){var r,s;if(!this.__ngev.contexts[t]){return}r=this.__ngev.contexts[t];if(n){r.ready=true}this.__ngev.recursion++;while(r.ready&&r.queue.length){s=r.queue.shift();if(s.event.interrupt){continue}try{if(s.nice<0){if(this.__ngev.recursion>=-s.nice){setImmediate(i.listenerWrapper.bind(this,s.listener,s.event,r))}else{i.listenerWrapper.call(this,s.listener,s.event,r)}}else{setTimeout(i.listenerWrapper.bind(this,s.listener,s.event,r),s.nice)}}catch(e){this.__ngev.recursion--;throw e}}this.__ngev.recursion--};i.on=i.prototype.on;i.once=i.prototype.once;i.off=i.prototype.off;if(n.AsyncTryCatch){i.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(i);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}i.Proxy=e("./Proxy.js")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":10,"./Proxy.js":9}],9:[function(e,t,n){"use strict";function i(){return i.create()}t.exports=i;var r=e("./NextGenEvents.js");var s="NextGenEvents/message";function a(){}i.create=function e(){var t=Object.create(i.prototype,{localServices:{value:{},enumerable:true},remoteServices:{value:{},enumerable:true},nextAckId:{value:1,writable:true,enumerable:true}});return t};i.prototype.addLocalService=function e(t,n,i){this.localServices[t]=o.create(this,t,n,i);return this.localServices[t]};i.prototype.addRemoteService=function e(t){this.remoteServices[t]=l.create(this,t);return this.remoteServices[t]};i.prototype.destroy=function e(){var t=this;Object.keys(this.localServices).forEach(function(e){t.localServices[e].destroy();delete t.localServices[e]});Object.keys(this.remoteServices).forEach(function(e){t.remoteServices[e].destroy();delete t.remoteServices[e]});this.receive=this.send=a};i.prototype.push=function e(t){if(t.__type!==s||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};i.prototype.receive=function e(t){this.push(t)};i.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function o(e,t,n,i){return o.create(e,t,n,i)}i.LocalService=o;o.create=function e(t,n,i,s){var a=Object.create(o.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:i,writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!s.listen,writable:true,enumerable:true},canEmit:{value:!!s.emit,writable:true,enumerable:true},canAck:{value:!!s.ack,writable:true,enumerable:true},canRpc:{value:!!s.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return a};o.prototype.destroy=function e(){var t=this;Object.keys(this.events).forEach(function(e){t.emitter.off(e,t.events[e]);delete t.events[e]});this.emitter=null;this.destroyed=true};o.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var n=this;var i={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){i.callback=function e(i){n.proxy.send({__type:s,service:n.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:i})}}r.emitEvent(i)};o.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=o.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=o.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};o.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};o.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t)};o.forward=function e(t){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args})};o.forward.ack=false;o.forwardWithAck=function e(t,n){if(this.destroyed){return}var i=this;if(!t.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args});n();return}var r=false;var a=this.proxy.nextAckId++;var o=function e(t){if(r||t.ack!==a){return}r=true;i.internalEvents.off("ack",e);n()};this.internalEvents.on("ack",o);this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,ack:a,args:t.args})};o.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}i.RemoteService=l;var c=1;var u=2;l.create=function e(t,n){var i=Object.create(l.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:Object.create(r.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return i};l.prototype.destroy=function e(){var t=this;this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(function(e){delete t.events[e]});this.destroyed=true};l.prototype.emit=function e(t){if(this.destroyed){return}var n=this,i,r,a,o;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof arguments[arguments.length-1]!=="function"){i=Array.prototype.slice.call(arguments,1);this.proxy.send({__type:s,service:this.id,method:"emit",event:t,args:i});return}i=Array.prototype.slice.call(arguments,1,-1);r=arguments[arguments.length-1];a=this.proxy.nextAckId++;o=false;var l=function e(t){if(o||t.ack!==a){return}o=true;n.internalEvents.off("ack",e);r(t.interruption)};this.internalEvents.on("ack",l);this.proxy.send({__type:s,service:this.id,method:"emit",ack:a,event:t,args:i})};l.prototype.addListener=function e(t,n,i){if(this.destroyed){return}if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}i.fn=n||i.fn;this.emitter.addListener(t,i);if(!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length){return}if(i.async&&this.events[t]!==u){this.events[t]=u;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:t})}else if(!i.async&&!this.events[t]){this.events[t]=c;this.proxy.send({__type:s,service:this.id,method:"listen",event:t})}};l.prototype.on=l.prototype.addListener;l.prototype.once=r.prototype.once;l.prototype.removeListener=function e(t,n){if(this.destroyed){return}this.emitter.removeListener(t,n);if((!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:t})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function e(t){var n=this;if(this.destroyed||!this.events[t.event]){return}var i={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){i.callback=function e(){n.proxy.send({__type:s,service:n.id,method:"ackEvent",ack:t.ack,event:t.event})}}r.emitEvent(i);var a=i.name;if(!this.emitter.__ngev.listeners[a]||!this.emitter.__ngev.listeners[a].length){this.events[a]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:a})}};l.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==u){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":8}],10:[function(e,t,n){t.exports={_from:"nextgen-events@0.10.2",_id:"nextgen-events@0.10.2",_inBundle:false,_integrity:"sha512-P6efDoVOOJjVLOhwINq+aqhC2B3a9IxojbWMn9fTv2coDiyRaaGLSgWsm84wQHlQeuqVgqiLEE+xiHXf3EVN6w==",_location:"/nextgen-events",_phantomChildren:{},_requested:{type:"version",registry:true,raw:"nextgen-events@0.10.2",name:"nextgen-events",escapedName:"nextgen-events",rawSpec:"0.10.2",saveSpec:null,fetchSpec:"0.10.2"},_requiredBy:["#USER","/","/terminal-kit"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-0.10.2.tgz",_shasum:"d0a3f4e620cae40061874d920afd0cc40c31cebe",_spec:"nextgen-events@0.10.2",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cédric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},bundleDependencies:false,config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2016],owner:"Cédric Ronvel"},dependencies:{},deprecated:false,description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^14.4.0","expect.js":"^0.3.1",jshint:"^2.9.2",mocha:"^2.5.3","uglify-js-es6":"^2.8.9",ws:"^3.2.0"},directories:{test:"test"},engines:{node:">=4.5.0"},homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",name:"nextgen-events",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"mocha -R dot"},version:"0.10.2"}},{}],11:[function(e,t,n){var i=t.exports={};var r;var s;function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=a}}catch(e){r=a}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=o}}catch(e){s=o}})();function l(e){if(r===setTimeout){return setTimeout(e,0)}if((r===a||!r)&&setTimeout){r=setTimeout;return setTimeout(e,0)}try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}function c(e){if(s===clearTimeout){return clearTimeout(e)}if((s===o||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var u=[];var f=false;var h;var d=-1;function p(){if(!f||!h){return}f=false;if(h.length){u=h.concat(u)}else{d=-1}if(u.length){m()}}function m(){if(f){return}var e=l(p);f=true;var t=u.length;while(t){h=u;u=[];while(++d<t){if(h){h[d].run()}}d=-1;t=u.length}h=null;f=false;c(e)}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}u.push(new g(e,t));if(u.length===1&&!f){l(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function v(){}i.on=v;i.addListener=v;i.once=v;i.off=v;i.removeListener=v;i.removeAllListeners=v;i.emit=v;i.prependListener=v;i.prependOnceListener=v;i.listeners=function(e){return[]};i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}],12:[function(t,n,i){(function(t){(function(r){var s=typeof i=="object"&&i&&!i.nodeType&&i;var a=typeof n=="object"&&n&&!n.nodeType&&n;var o=typeof t=="object"&&t;if(o.global===o||o.window===o||o.self===o){r=o}var l,c=2147483647,u=36,f=1,h=26,d=38,p=700,m=72,g=128,v="-",y=/^xn--/,b=/[^\x20-\x7E]/,k=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=u-f,_=Math.floor,C=String.fromCharCode,S;function L(e){throw new RangeError(w[e])}function $(e,t){var n=e.length;var i=[];while(n--){i[n]=t(e[n])}return i}function E(e,t){var n=e.split("@");var i="";if(n.length>1){i=n[0]+"@";e=n[1]}e=e.replace(k,".");var r=e.split(".");var s=$(r,t).join(".");return i+s}function A(e){var t=[],n=0,i=e.length,r,s;while(n<i){r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((r&1023)<<10)+(s&1023)+65536)}else{t.push(r);n--}}else{t.push(r)}}return t}function O(e){return $(e,function(e){var t="";if(e>65535){e-=65536;t+=C(e>>>10&1023|55296);e=56320|e&1023}t+=C(e);return t}).join("")}function j(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function T(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function M(e,t,n){var i=0;e=n?_(e/p):e>>1;e+=_(e/t);for(;e>x*h>>1;i+=u){e=_(e/x)}return _(i+(x+1)*e/(e+d))}function I(e){var t=[],n=e.length,i,r=0,s=g,a=m,o,l,d,p,y,b,k,w,x;o=e.lastIndexOf(v);if(o<0){o=0}for(l=0;l<o;++l){if(e.charCodeAt(l)>=128){L("not-basic")}t.push(e.charCodeAt(l))}for(d=o>0?o+1:0;d<n;){for(p=r,y=1,b=u;;b+=u){if(d>=n){L("invalid-input")}k=j(e.charCodeAt(d++));if(k>=u||k>_((c-r)/y)){L("overflow")}r+=k*y;w=b<=a?f:b>=a+h?h:b-a;if(k<w){break}x=u-w;if(y>_(c/x)){L("overflow")}y*=x}i=t.length+1;a=M(r-p,i,p==0);if(_(r/i)>c-s){L("overflow")}s+=_(r/i);r%=i;t.splice(r++,0,s)}return O(t)}function N(e){var t,n,i,r,s,a,o,l,d,p,y,b=[],k,w,x,S;e=A(e);k=e.length;t=g;n=0;s=m;for(a=0;a<k;++a){y=e[a];if(y<128){b.push(C(y))}}i=r=b.length;if(r){b.push(v)}while(i<k){for(o=c,a=0;a<k;++a){y=e[a];if(y>=t&&y<o){o=y}}w=i+1;if(o-t>_((c-n)/w)){L("overflow")}n+=(o-t)*w;t=o;for(a=0;a<k;++a){y=e[a];if(y<t&&++n>c){L("overflow")}if(y==t){for(l=n,d=u;;d+=u){p=d<=s?f:d>=s+h?h:d-s;if(l<p){break}S=l-p;x=u-p;b.push(C(T(p+S%x,0)));l=_(S/x)}b.push(C(T(l,0)));s=M(n,w,i==r);n=0;++i}}++n;++t}return b.join("")}function B(e){return E(e,function(e){return y.test(e)?I(e.slice(4).toLowerCase()):e})}function U(e){return E(e,function(e){return b.test(e)?"xn--"+N(e):e})}l={version:"1.4.1",ucs2:{decode:A,encode:O},decode:I,encode:N,toASCII:U,toUnicode:B};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return l})}else if(s&&a){if(n.exports==s){a.exports=l}else{for(S in l){l.hasOwnProperty(S)&&(s[S]=l[S])}}}else{r.punycode=l}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var a={};if(typeof e!=="string"||e.length===0){return a}var o=/\+/g;e=e.split(t);var l=1e3;if(s&&typeof s.maxKeys==="number"){l=s.maxKeys}var c=e.length;if(l>0&&c>l){c=l}for(var u=0;u<c;++u){var f=e[u].replace(o,"%20"),h=f.indexOf(n),d,p,m,g;if(h>=0){d=f.substr(0,h);p=f.substr(h+1)}else{d=f;p=""}m=decodeURIComponent(d);g=decodeURIComponent(p);if(!i(a,m)){a[m]=g}else if(r(a[m])){a[m].push(g)}else{a[m]=[a[m],g]}}return a};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],14:[function(e,t,n){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,o){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(a(e),function(a){var o=encodeURIComponent(i(a))+n;if(r(e[a])){return s(e[a],function(e){return o+encodeURIComponent(i(e))}).join(t)}else{return o+encodeURIComponent(i(e[a]))}}).join(t)}if(!o)return"";return encodeURIComponent(i(o))+n+encodeURIComponent(i(e))};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var i=0;i<e.length;i++){n.push(t(e[i],i))}return n}var a=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],15:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":13,"./encode":14}],16:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"}},{}],17:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=function e(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")};n.regExpReplacement=function e(t){return t.replace(/\$/g,"$$$$")};n.format=function e(t){return t.replace(/%/g,"%%")};n.jsSingleQuote=function e(t){return n.control(t).replace(/'/g,"\\'")};n.jsDoubleQuote=function e(t){return n.control(t).replace(/"/g,'\\"')};n.shellArg=function e(t){return"'"+t.replace(/\'/g,"'\\''")+"'"};var i={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=function e(t){return t.replace(/[\x00-\x1f\x7f]/g,function(e){if(i[e]!==undefined){return i[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t})};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=function e(t){return t.replace(/[&<>]/g,function(e){return r[e]})};n.htmlAttr=function e(t){return t.replace(/[&<>"]/g,function(e){return r[e]})};n.htmlSpecialChars=function e(t){return t.replace(/[&<>"']/g,function(e){return r[e]})}},{}],18:[function(e,t,n){(function(t){"use strict";var i=e("./inspect.js").inspect;var r=e("./inspect.js").inspectError;var s=e("./ansi.js");n.formatMethod=function e(n){if(typeof n!=="string"){if(!n){n=""}else if(typeof n.toString==="function"){n=n.toString()}else{n=""}}var s=this,a,o,l=1,c=arguments,u=arguments.length,f=false,h=null,d=[];if(this.markupReset&&this.startingMarkupReset){n=(typeof this.markupReset==="function"?this.markupReset(d):this.markupReset)+n}n=n.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,function(e,n,p,m,g,v,y){var b,k,w,x,_,C,S,L,$=[];if(p){return"%"}if(n){if(n==="^"){return"^"}if(s.shiftMarkup&&s.shiftMarkup[n]){h=s.shiftMarkup[n];return""}if(h){if(!s.shiftedMarkup||!s.shiftedMarkup[h]||!s.shiftedMarkup[h][n]){return""}f=true;if(typeof s.shiftedMarkup[h][n]==="function"){b=s.shiftedMarkup[h][n](d)}else{b=s.shiftedMarkup[h][n];d.push(b)}h=null}else{if(!s.markup||!s.markup[n]){return""}f=true;if(typeof s.markup[n]==="function"){b=s.markup[n](d)}else{b=s.markup[n];d.push(b)}}return b}if(g){g=parseInt(g);if(m){if(m==="+"){g=l+g}else if(m==="-"){g=l-g}}}else{g=l}l++;if(g>=u||g<1){a=undefined}else{a=c[g]}switch(y){case"s":if(a===null||a===undefined){return""}if(typeof a==="string"){return a}if(typeof a==="number"){return""+a}if(typeof a.toString==="function"){return a.toString()}return"";case"f":if(typeof a==="string"){a=parseFloat(a)}if(typeof a!=="number"){return"0"}if(v!==undefined){switch(v[0]){case"p":w=parseInt(v.slice(1),10);if(w>=1){a=a.toPrecision(w)}break;case"f":w=parseInt(v.slice(1),10);a=a.toFixed(w);break}}return""+a;case"d":case"i":if(typeof a==="string"){a=parseInt(a)}if(typeof a==="number"){return""+Math.floor(a)}return"0";case"u":if(typeof a==="string"){a=parseInt(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0)}return"0";case"U":if(typeof a==="string"){a=parseInt(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),1)}return"1";case"x":if(typeof a==="string"){a=parseInt(a)}if(typeof a!=="number"){return"0"}o=""+Math.max(Math.floor(a),0).toString(16);if(o.length%2){o="0"+o}return o;case"h":if(typeof a==="string"){a=parseInt(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0).toString(16)}return"0";case"o":if(typeof a==="string"){a=parseInt(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0).toString(8)}return"0";case"b":if(typeof a==="string"){a=parseInt(a)}if(typeof a==="number"){return""+Math.max(Math.floor(a),0).toString(2)}return"0";case"z":if(typeof a==="string"){a=t.from(a)}else if(!t.isBuffer(a)){return""}return a.toString("base64");case"Z":if(typeof a==="string"){a=t.from(a)}else if(!t.isBuffer(a)){return""}return a.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"");case"I":x=3;if(v!==undefined){x=parseInt(v,10)}return i({depth:x,style:s&&s.color?"color":"none"},a);case"Y":x=3;if(v!==undefined){x=parseInt(v,10)}return i({depth:x,style:s&&s.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true},a);case"E":return r({style:s&&s.color?"color":"none"},a);case"J":return JSON.stringify(a);case"D":return"";case"F":l--;if(v===undefined){return""}_=v.split(":");C=_[0];S=_[1];if(!C){return""}if(S&&(L=S.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(k=0;k<L.length;k++){m=L[k][1];g=L[k][2];if(g){g=parseInt(g,10);if(m){if(m==="+"){g=l+g}else if(m==="-"){g=l-g}}}else{g=l}l++;if(g>=u||g<1){$[k]=undefined}else{$[k]=c[g]}}}if(!s||!s.fn||typeof s.fn[C]!=="function"){return""}return s.fn[C].apply(s,$);default:return""}});if(f&&this.markupReset&&this.endingMarkupReset){n+=typeof this.markupReset==="function"?this.markupReset(d):this.markupReset}if(this.extraArguments){for(;l<u;l++){a=c[l];if(a===null||a===undefined){continue}else if(typeof a==="string"){n+=a}else if(typeof a==="number"){n+=a}else if(typeof a.toString==="function"){n+=a.toString()}}}return n};var a={extraArguments:true,endingMarkupReset:true,startingMarkupReset:false,markupReset:s.reset,shiftMarkup:{"#":"background"},markup:{":":s.reset," ":s.reset+" ","-":s.dim,"+":s.bold,_:s.underline,"/":s.italic,"!":s.inverse,b:s.blue,B:s.brightBlue,c:s.cyan,C:s.brightCyan,g:s.green,G:s.brightGreen,k:s.black,K:s.brightBlack,m:s.magenta,M:s.brightMagenta,r:s.red,R:s.brightRed,w:s.white,W:s.brightWhite,y:s.yellow,Y:s.brightYellow},shiftedMarkup:{background:{":":s.reset," ":s.reset+" ",b:s.bgBlue,B:s.bgBrightBlue,c:s.bgCyan,C:s.bgBrightCyan,g:s.bgGreen,G:s.bgBrightGreen,k:s.bgBlack,K:s.bgBrightBlack,m:s.bgMagenta,M:s.bgBrightMagenta,r:s.bgRed,R:s.bgBrightRed,w:s.bgWhite,W:s.bgBrightWhite,y:s.bgYellow,Y:s.bgBrightYellow}}};n.format=n.formatMethod.bind(a);n.format.default=a;n.markupMethod=function e(t){if(typeof t!=="string"){if(!t){t=""}else if(typeof t.toString==="function"){t=t.toString()}else{t=""}}var n=this,i=false,r=null,s=[];if(this.markupReset&&this.startingMarkupReset){t=(typeof this.markupReset==="function"?this.markupReset(s):this.markupReset)+t}t=t.replace(/\^(.?)/g,function(e,t){var a;if(t==="^"){return"^"}if(n.shiftMarkup&&n.shiftMarkup[t]){r=n.shiftMarkup[t];return""}if(r){if(!n.shiftedMarkup||!n.shiftedMarkup[r]||!n.shiftedMarkup[r][t]){return""}i=true;if(typeof n.shiftedMarkup[r][t]==="function"){a=n.shiftedMarkup[r][t](s)}else{a=n.shiftedMarkup[r][t];s.push(a)}r=null}else{if(!n.markup||!n.markup[t]){return""}i=true;if(typeof n.markup[t]==="function"){a=n.markup[t](s)}else{a=n.markup[t];s.push(a)}}return a});if(i&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(s):this.markupReset}return t};n.markup=n.markupMethod.bind(a);n.format.count=function e(t){var n,i,r,s=1,a=0;if(typeof t!=="string"){return 0}var o=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=o.exec(t))!==null){r=n[1];i=n[2];if(i){i=parseInt(i,10);if(r){if(r==="+"){i=s+i}else if(r==="-"){i=s-i}}}else{i=s}s++;if(a<i){a=i}}return a};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}else{return false}}}).call(this,e("buffer").Buffer)},{"./ansi.js":16,"./inspect.js":19,buffer:5}],19:[function(e,t,n){(function(t,i){"use strict";var r=e("./escape.js");var s=e("./ansi.js");function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=h.none}else if(typeof e.style==="string"){e.style=h[e.style]}if(e.depth===undefined){e.depth=3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}return o(n,e,t)}function o(e,n,i){var s,a,u,f,h,d,p,m,g,v,y,b,k="",w="",x="",_,C;p=typeof i;g=n.style.tab.repeat(e.depth);if(p==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){x=[];if(!e.descriptor.configurable){x.push("-conf")}if(!e.descriptor.enumerable){x.push("-enum")}if(!e.descriptor.writable){x.push("-w")}if(x.length){x=x.join(" ")}else{x=""}}if(e.keyIsProperty){if(l(e.key)){w='"'+n.style.key(e.key)+'": '}else{w=n.style.key(e.key)+": "}}else{w="["+n.style.index(e.key)+"] "}if(x){x=" "+n.style.type(x)}}m=e.noPre?"":g+w;if(i===undefined){k+=m+n.style.constant("undefined")+x+n.style.nl}else if(i===null){k+=m+n.style.constant("null")+x+n.style.nl}else if(i===false){k+=m+n.style.constant("false")+x+n.style.nl}else if(i===true){k+=m+n.style.constant("true")+x+n.style.nl}else if(p==="number"){k+=m+n.style.number(i.toString())+(n.noType?"":" "+n.style.type("number"))+x+n.style.nl}else if(p==="string"){k+=m+'"'+n.style.string(r.control(i))+'" '+(n.noType?"":n.style.type("string")+n.style.length("("+i.length+")"))+x+n.style.nl}else if(t.isBuffer(i)){k+=m+n.style.inspect(i.inspect())+" "+(n.noType?"":n.style.type("Buffer")+n.style.length("("+i.length+")"))+x+n.style.nl}else if(p==="object"||p==="function"){a=u="";y=false;if(p==="function"){y=true;a=" "+n.style.funcName(i.name?i.name:"(anonymous)");u=n.style.length("("+i.length+")")}v=false;if(Array.isArray(i)){v=true;u=n.style.length("("+i.length+")")}if(!i.constructor){h="(no constructor)"}else if(!i.constructor.name){h="(anonymous)"}else{h=i.constructor.name}h=n.style.constructorName(h);k+=m;if(!n.noType){if(e.forceType){k+=n.style.type(e.forceType)}else{k+=h+a+u+" "+n.style.type(p)+x}if(!y||n.funcDetails){k+=" "}}f=Object.getOwnPropertyNames(i);if(n.sort){f.sort()}b=c(i);if(b!==undefined){k+="=> "+o({depth:e.depth,ancestors:e.ancestors,noPre:true},n,b)}else if(y&&!n.funcDetails){k+=n.style.nl}else if(!f.length&&!n.proto){k+="{}"+n.style.nl}else if(e.depth>=n.depth){k+=n.style.limit("[depth limit]")+n.style.nl}else if(e.ancestors.indexOf(i)!==-1){k+=n.style.limit("[circular]")+n.style.nl}else{k+=(v&&n.noType?"[":"{")+n.style.nl;C=e.ancestors.slice();C.push(i);for(s=0;s<f.length;s++){try{_=Object.getOwnPropertyDescriptor(i,f[s]);if(!_.enumerable&&n.enumOnly){continue}d=!v||!_.enumerable||isNaN(f[s]);if(!n.noDescriptor&&(_.get||_.set)){k+=o({depth:e.depth+1,ancestors:C,key:f[s],keyIsProperty:d,descriptor:_,forceType:"getter/setter"},n,{get:_.get,set:_.set})}else{k+=o({depth:e.depth+1,ancestors:C,key:f[s],keyIsProperty:d,descriptor:n.noDescriptor?undefined:_},n,i[f[s]])}}catch(t){k+=o({depth:e.depth+1,ancestors:C,key:f[s],keyIsProperty:d,descriptor:n.noDescriptor?undefined:_},n,t)}}if(n.proto){k+=o({depth:e.depth+1,ancestors:C,key:"__proto__",keyIsProperty:true},n,i.__proto__)}k+=g+(v&&n.noType?"]":"}")+n.style.nl}}if(e.depth===0){if(n.style==="html"){k=r.html(k)}}return k}n.inspect=a;function l(e){if(!e.length){return true}return false}function c(e){switch(e.constructor.name){case"Date":if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}break;case"Set":if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}break;case"Map":if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}break;case"ObjectID":if(e._bsontype){return e.toString()}break}return}function u(e,t){var n="",i,r,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"Not an error -- regular variable inspection: "+a(e,t)}if(!e.style){e.style=h.none}else if(typeof e.style==="string"){e.style=h[e.style]}if(t.stack){i=f(e,t.stack)}r=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(r)+(s?" ["+e.style.errorType(s)+"]":"")+": ";n+=e.style.errorMessage(t.message)+"\n";if(i){n+=e.style.errorStack(i)+"\n"}return n}n.inspectError=u;function f(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=h.none}else if(typeof e.style==="string"){e.style=h[e.style]}if(!t){return}if((e.browser||i.browser)&&t.indexOf("@")!==-1){t=t.replace(/[<\/]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,function(t,n,i,r,s){return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(i?e.style.errorStackFile(i):e.style.errorStack("unknown"))+(r?e.style.errorStack(":")+e.style.errorStackLine(r):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:([^\s:\(\)\[\]\n]+(?:\([^\)]+\))?)\s)?(?:\[as ([^\s:\(\)\[\]\n]+)\]\s)?(?:\(?([^:\(\)\[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,function(t,n,i,r,s,a,o){return e.style.errorStack("    at ")+(i?e.style.errorStackMethod(i)+" ":"")+(r?e.style.errorStack("[as ")+e.style.errorStackMethodAs(r)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(a?e.style.errorStack(":")+e.style.errorStackLine(a):"")+(o?e.style.errorStack(":")+e.style.errorStackColumn(o):"")+e.style.errorStack(")")})}return t}n.inspectStack=f;var h={};var d=function(e){return e};h.none={tab:"    ",nl:"\n",limit:d,type:function(e){return"<"+e+">"},constant:d,funcName:d,constructorName:function(e){return"<"+e+">"},length:d,key:d,index:d,number:d,inspect:d,string:d,errorType:d,errorMessage:d,errorStack:d,errorStackMethod:d,errorStackMethodAs:d,errorStackFile:d,errorStackLine:d,errorStackColumn:d};h.color=Object.assign({},h.none,{limit:function(e){return s.bold+s.brightRed+e+s.reset},type:function(e){return s.italic+s.brightBlack+e+s.reset},constant:function(e){return s.cyan+e+s.reset},funcName:function(e){return s.italic+s.magenta+e+s.reset},constructorName:function(e){return s.magenta+e+s.reset},length:function(e){return s.italic+s.brightBlack+e+s.reset},key:function(e){return s.green+e+s.reset},index:function(e){return s.blue+e+s.reset},number:function(e){return s.cyan+e+s.reset},inspect:function(e){return s.cyan+e+s.reset},string:function(e){return s.blue+e+s.reset},errorType:function(e){return s.red+s.bold+e+s.reset},errorMessage:function(e){return s.red+s.italic+e+s.reset},errorStack:function(e){return s.brightBlack+e+s.reset},errorStackMethod:function(e){return s.brightYellow+e+s.reset},errorStackMethodAs:function(e){return s.yellow+e+s.reset},errorStackFile:function(e){return s.brightCyan+e+s.reset},errorStackLine:function(e){return s.blue+e+s.reset},errorStackColumn:function(e){return s.magenta+e+s.reset}});h.html=Object.assign({},h.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",nl:"<br />",limit:function(e){return'<span style="color:red">'+e+"</span>"},type:function(e){return'<i style="color:gray">'+e+"</i>"},constant:function(e){return'<span style="color:cyan">'+e+"</span>"},funcName:function(e){return'<i style="color:magenta">'+e+"</i>"},constructorName:function(e){return'<span style="color:magenta">'+e+"</span>"},
length:function(e){return'<i style="color:gray">'+e+"</i>"},key:function(e){return'<span style="color:green">'+e+"</span>"},index:function(e){return'<span style="color:blue">'+e+"</span>"},number:function(e){return'<span style="color:cyan">'+e+"</span>"},inspect:function(e){return'<span style="color:cyan">'+e+"</span>"},string:function(e){return'<span style="color:blue">'+e+"</span>"},errorType:function(e){return'<span style="color:red">'+e+"</span>"},errorMessage:function(e){return'<span style="color:red">'+e+"</span>"},errorStack:function(e){return'<span style="color:gray">'+e+"</span>"},errorStackMethod:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackMethodAs:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackFile:function(e){return'<span style="color:cyan">'+e+"</span>"},errorStackLine:function(e){return'<span style="color:blue">'+e+"</span>"},errorStackColumn:function(e){return'<span style="color:gray">'+e+"</span>"}})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":7,"./ansi.js":16,"./escape.js":17,_process:11}],20:[function(e,t,n){(function(n){"use strict";var i=e("fs");var r=e("dom-kit");var s=e("string-kit/lib/escape.js");function a(){}var o={};t.exports=o;var l=["path","circle","ellipse","line","rect","polyline","polygone","text","textPath"];o.inject=function e(t,n){o.patch(t,n);if(n.into){n.into.appendChild(t)}if(n.as){r.moveAttributes(t,n.as);r.moveChildrenInto(t,n.as)}};o.patch=function e(t,n){var i,s,a;o.lightCleanup(t);if(n.id!==undefined){if(typeof n.id==="string"){t.setAttribute("id",n.id)}else if(!n.id){t.removeAttribute("id")}}if(n.class){if(typeof n.class==="string"){t.classList.add(n.class)}else if(typeof n.class==="object"){r.class(t,n.class)}}if(n.hidden){t.style.visibility="hidden"}if(n.prefixIds){r.prefixIds(t,n.prefixIds)}if(n.removeIds){r.removeAllAttributes(t,"id")}if(n.removeSvgStyle){t.removeAttribute("style")}if(n.removeDefaultStyles){o.removeDefaultStyles(t)}if(n.removeComments){r.removeComments(t)}if(n.removeExoticNamespaces){r.filterByNamespace(t,{primary:"svg",whitelist:[]})}if(n.removeSize){s=t.getAttribute("width")||t.style.width;a=t.getAttribute("height")||t.style.height;t.removeAttribute("height");t.removeAttribute("width");t.style.width=null;t.style.height=null;if(!t.getAttribute("viewBox")&&s&&a){i="0 0 "+s+" "+a;t.setAttribute("viewBox",i)}}if(n.css){r.css(t,n.css)}if(n.colorClass){o.colorClass(t)}if(n.removeWhiteSpaces){r.removeWhiteSpaces(t)}else if(n.removeWhiteLines){r.removeWhiteSpaces(t,true)}};o.patchDocument=function e(t,n){var i=n.removeWhiteSpaces,s=n.removeWhiteLines,a=n.removeComments;delete n.removeWhiteSpaces;delete n.removeWhiteLines;delete n.removeComments;if(a){r.removeComments(t)}o.patch(t.documentElement,n);if(i){r.removeWhiteSpaces(t)}else if(s){r.removeWhiteSpaces(t,true)}};o.lightCleanup=function e(t){r.removeAllTags(t,"metadata");r.removeAllTags(t,"script");r.removeAllTags(t,"defs",true)};o.colorClass=function e(t){l.forEach(function(e){Array.from(t.getElementsByTagName(e)).forEach(function(e){if(!e.getAttribute("class")){e.classList.add("primary")}r.styleToAttribute(e,"fill",["none"]);r.styleToAttribute(e,"stroke",["none"])})})};const c=[["font-style","normal"],["font-weight","normal"],["font-variant","normal"],["font-stretch","normal"],["font-size","medium"],["line-height","normal"],["font-variant-ligatures","normal"],["font-variant-position","normal"],["font-variant-caps","normal"],["font-variant-numeric","normal"],["font-variant-alternates","normal"],["font-variant-east-asian","normal"],["font-feature-settings","normal"],["text-indent","0"],["text-align","start"],["text-decoration","none"],["text-decoration-line","none"],["text-decoration-style","solid"],["text-decoration-color","#000000"],["letter-spacing","normal"],["word-spacing","normal"],["text-transform","none"],["writing-mode","lr-tb"],["direction","ltr"],["text-orientation","mixed"],["dominant-baseline","auto"],["baseline-shift","baseline"],["text-anchor","start"],["white-space","normal"],["shape-padding","0"],["display","inline"],["visibility","visible"],["overflow","visible"],["opacity","1"],["isolation","auto"],["mix-blend-mode","normal"],["color-interpolation","sRGB"],["color-interpolation-filters","linearRGB"],["solid-color","#000000"],["solid-opacity","1"],["vector-effect","none"],["fill-rule","nonzero"],["clip-rule","nonzero"],["color-rendering","auto"],["image-rendering","auto"],["shape-rendering","auto"],["text-rendering","auto"],["enable-background","accumulate"],["stroke-dasharray","none"],["stroke-dashoffset","0"],["paint-order","normal"],["paint-order","fill stroke markers"]];o.removeDefaultStyles=function e(t){l.forEach(function(e){Array.from(t.getElementsByTagName(e)).forEach(function(e){var t=e.getAttribute("style");c.forEach(e=>{var n=e[0];var i=e[1];t=t.replace(new RegExp("(^|;) *"+s.regExp(n)+" *: *"+s.regExp(i)+" *(?:;|$)"),(e,t)=>t)});e.setAttribute("style",t)})})};o.load=function e(t,s,l){if(typeof s==="function"){l=s;s={}}else if(!s||typeof s!=="object"){s={}}if(typeof l!=="function"){l=a}if(!n.browser){if(t.substring(0,7)==="file://"){t=t.slice(7)}i.readFile(t,"utf8",function(e,t){if(e){l(e);return}var n=r.fromXml(t);if(s.removeComments){r.removeComments(n);delete s.removeComments}var i=n.documentElement;try{o.inject(i,s)}catch(e){l(e);return}l(undefined,i)})}else{o.ajax(t,function(e,t){if(e){l(e);return}if(s.removeComments){r.removeComments(t);delete s.removeComments}var n=t.documentElement;try{o.inject(n,s)}catch(e){l(e);return}l(undefined,n)})}};o.ajax=function e(t,n){var i=new XMLHttpRequest;i.responseType="document";i.onreadystatechange=o.ajax.ajaxStatus.bind(i,n);i.open("GET",t);i.send()};o.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[svg-kit] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}};o.getViewBox=function e(t){var n=t.getAttribute("viewBox");if(!n){return null}var i=n.split(/ +/);return{x:parseFloat(i[0],10),y:parseFloat(i[1],10),width:parseFloat(i[2],10),height:parseFloat(i[3],10)}};o.setViewBox=function e(t,n){t.setAttribute("viewBox",n.x+" "+n.y+" "+n.width+" "+n.height)};o.toAreaArray=function e(t){if(t.xmin!==undefined&&t.xmax!==undefined&&t.ymin!==undefined&&t.ymax!==undefined){return[t.xmin,t.ymin,t.xmax-t.xmin,t.ymax-t.ymin]}else if(t.x!==undefined&&t.y!==undefined&&t.width!==undefined&&t.height!==undefined){return[t.x,t.y,t.width,t.height]}else{return[0,0,100,100]}};o.standalone=function e(t,n){var i='<?xml version="1.0" encoding="UTF-8"?>\n';if(!Array.isArray(n)){n=o.toAreaArray(n)}i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+n.join(" ")+'">\n';i+=t;i+="\n</svg>\n";return i}}).call(this,e("_process"))},{_process:11,"dom-kit":6,fs:5,"string-kit/lib/escape.js":17}],21:[function(e,t,n){"use strict";var i=e("punycode");var r=e("./util");n.parse=w;n.resolve=_;n.resolveObject=C;n.format=x;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var a=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(c),f=["'"].concat(u),h=["%","/","?",";","#"].concat(f),d=["/","?","#"],p=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:true,"javascript:":true},y={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},k=e("querystring");function w(e,t,n){if(e&&r.isObject(e)&&e instanceof s)return e;var i=new s;i.parse(e,t,n);return i}s.prototype.parse=function(e,t,n){if(!r.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),o=s!==-1&&s<e.indexOf("#")?"?":"#",c=e.split(o),u=/\\/g;c[0]=c[0].replace(u,"/");e=c.join(o);var w=e;w=w.trim();if(!n&&e.split("#").length===1){var x=l.exec(w);if(x){this.path=w;this.href=w;this.pathname=x[1];if(x[2]){this.search=x[2];if(t){this.query=k.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var _=a.exec(w);if(_){_=_[0];var C=_.toLowerCase();this.protocol=C;w=w.substr(_.length)}if(n||_||w.match(/^\/\/[^@\/]+@[^@\/]+/)){var S=w.substr(0,2)==="//";if(S&&!(_&&y[_])){w=w.substr(2);this.slashes=true}}if(!y[_]&&(S||_&&!b[_])){var L=-1;for(var $=0;$<d.length;$++){var E=w.indexOf(d[$]);if(E!==-1&&(L===-1||E<L))L=E}var A,O;if(L===-1){O=w.lastIndexOf("@")}else{O=w.lastIndexOf("@",L)}if(O!==-1){A=w.slice(0,O);w=w.slice(O+1);this.auth=decodeURIComponent(A)}L=-1;for(var $=0;$<h.length;$++){var E=w.indexOf(h[$]);if(E!==-1&&(L===-1||E<L))L=E}if(L===-1)L=w.length;this.host=w.slice(0,L);w=w.slice(L);this.parseHost();this.hostname=this.hostname||"";var j=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!j){var T=this.hostname.split(/\./);for(var $=0,M=T.length;$<M;$++){var I=T[$];if(!I)continue;if(!I.match(m)){var N="";for(var B=0,U=I.length;B<U;B++){if(I.charCodeAt(B)>127){N+="x"}else{N+=I[B]}}if(!N.match(m)){var q=T.slice(0,$);var R=T.slice($+1);var D=I.match(g);if(D){q.push(D[1]);R.unshift(D[2])}if(R.length){w="/"+R.join(".")+w}this.hostname=q.join(".");break}}}}if(this.hostname.length>p){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!j){this.hostname=i.toASCII(this.hostname)}var W=this.port?":"+this.port:"";var F=this.hostname||"";this.host=F+W;this.href+=this.host;if(j){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(w[0]!=="/"){w="/"+w}}}if(!v[C]){for(var $=0,M=f.length;$<M;$++){var P=f[$];if(w.indexOf(P)===-1)continue;var X=encodeURIComponent(P);if(X===P){X=escape(P)}w=w.split(P).join(X)}}var Y=w.indexOf("#");if(Y!==-1){this.hash=w.substr(Y);w=w.slice(0,Y)}var G=w.indexOf("?");if(G!==-1){this.search=w.substr(G);this.query=w.substr(G+1);if(t){this.query=k.parse(this.query)}w=w.slice(0,G)}else if(t){this.search="";this.query={}}if(w)this.pathname=w;if(b[C]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var W=this.pathname||"";var H=this.search||"";this.path=W+H}this.href=this.format();return this};function x(e){if(r.isString(e))e=w(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",s=false,a="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&r.isObject(this.query)&&Object.keys(this.query).length){a=k.stringify(this.query)}var o=this.search||a&&"?"+a||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(i&&i.charAt(0)!=="#")i="#"+i;if(o&&o.charAt(0)!=="?")o="?"+o;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});o=o.replace("#","%23");return t+s+n+o+i};function _(e,t){return w(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(w(e,false,true)).format()};function C(e,t){if(!e)return t;return w(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(r.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var i=Object.keys(this);for(var a=0;a<i.length;a++){var o=i[a];n[o]=this[o]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var l=Object.keys(e);for(var c=0;c<l.length;c++){var u=l[c];if(u!=="protocol")n[u]=e[u]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var f=Object.keys(e);for(var h=0;h<f.length;h++){var d=f[h];n[d]=e[d]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!y[e.protocol]){var p=(e.pathname||"").split("/");while(p.length&&!(e.host=p.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(p[0]!=="")p.unshift("");if(p.length<2)p.unshift("");n.pathname=p.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var g=n.search||"";n.path=m+g}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var v=n.pathname&&n.pathname.charAt(0)==="/",k=e.host||e.pathname&&e.pathname.charAt(0)==="/",w=k||v||n.host&&e.pathname,x=w,_=n.pathname&&n.pathname.split("/")||[],p=e.pathname&&e.pathname.split("/")||[],C=n.protocol&&!b[n.protocol];if(C){n.hostname="";n.port=null;if(n.host){if(_[0]==="")_[0]=n.host;else _.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(p[0]==="")p[0]=e.host;else p.unshift(e.host)}e.host=null}w=w&&(p[0]===""||_[0]==="")}if(k){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;_=p}else if(p.length){if(!_)_=[];_.pop();_=_.concat(p);n.search=e.search;n.query=e.query}else if(!r.isNullOrUndefined(e.search)){if(C){n.hostname=n.host=_.shift();var S=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(S){n.auth=S.shift();n.host=n.hostname=S.shift()}}n.search=e.search;n.query=e.query;if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!_.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var L=_.slice(-1)[0];var $=(n.host||e.host||_.length>1)&&(L==="."||L==="..")||L==="";var E=0;for(var A=_.length;A>=0;A--){L=_[A];if(L==="."){_.splice(A,1)}else if(L===".."){_.splice(A,1);E++}else if(E){_.splice(A,1);E--}}if(!w&&!x){for(;E--;E){_.unshift("..")}}if(w&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")){_.unshift("")}if($&&_.join("/").substr(-1)!=="/"){_.push("")}var O=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(C){n.hostname=n.host=O?"":_.length?_.shift():"";var S=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(S){n.auth=S.shift();n.host=n.hostname=S.shift()}}w=w||n.host&&_.length;if(w&&!O){_.unshift("")}if(!_.length){n.pathname=null;n.path=null}else{n.pathname=_.join("/")}if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=o.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":22,punycode:12,querystring:15}],22:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}]},{},[2])(2)});