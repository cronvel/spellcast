(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,i;return function(){function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return r(i||e)},u,u.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}return e}()({1:[function(e,t,i){"use strict";const n=e("nextgen-events/lib/browser.js");const r=e("seventh");const s=e("dom-kit");const o=e("svg-kit");const a=e("../../commonUtils.js");function l(){}function c(){this.$body=document.querySelector("body");this.$spellcast=document.querySelector("spellcast");this.$theme=document.querySelector("#theme");this.$gfx=document.querySelector("#gfx");this.$sceneImage=document.querySelector(".scene-image");this.$main=document.querySelector("main");this.$mainBuffer=document.querySelector("#main-buffer");this.$altBuffer=document.querySelector("#alt-buffer");this.$closeAltButton=document.querySelector("#button-close-alt");this.$dialogWrapper=document.querySelector("#dialog-wrapper");this.$hint=document.querySelector("#hint");this.$lobby=document.querySelector("#lobby");this.$clientStatus=this.$lobby.querySelector(".client-status");this.$status=document.querySelector("#status");this.$panel=document.querySelector("#panel");this.$music=document.querySelector("#music");this.$sound0=document.querySelector("#sound0");this.$sound1=document.querySelector("#sound1");this.$sound2=document.querySelector("#sound2");this.$sound3=document.querySelector("#sound3");this.choices=[];this.newSegmentNeeded=null;this.onSelect=null;this.onLeave=null;this.onEnter=null;this.toMainBuffer();this.nextSoundChannel=0;this.sprites={};this.vgs={};this.markers={};this.cards={};this.gItemLocations={};this.animations={};this.hintTimer=null;this.sceneImageOnTimer=null;this.onCommandSubmit=null;this.uiLoadingCount=0;this.initEvents()}t.exports=c;c.prototype=Object.create(n.prototype);c.prototype.constructor=c;c.prototype.cleanUrl=function(e){if(e[0]==="/"){return window.location.pathname+e.slice(1)}return window.location.pathname+"script/"+e};c.prototype.setTheme=function(e){this.$theme.setAttribute("href",this.cleanUrl(e.url))};c.prototype.preload=function(){s.preload(["icons/plugged.svg","icons/plugging.svg","icons/unplugged.svg","icons/unreachable-plug.svg"])};c.prototype.initEvents=function(){this.$main.addEventListener("click",()=>this.emit("continue"),false);this.$gfx.addEventListener("click",e=>{if(e.target.classList.contains("scene-image")){this.toggleSceneImage()}},false);this.$dialogWrapper.addEventListener("click",()=>this.clearDialog(),false);this.$lobby.addEventListener("click",()=>{this.$lobby.classList.toggle("toggled")});this.$status.addEventListener("click",()=>{this.$status.classList.toggle("toggled")});this.$panel.addEventListener("click",()=>{this.$panel.classList.toggle("toggled")})};c.prototype.toggleSceneImage=function(){if(this.$gfx.classList.contains("toggled")){this.sceneImageOff()}else{this.sceneImageOn()}};c.prototype.sceneImageOn=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.add("toggled");this.$spellcast.classList.add("gfx-toggled");this.sceneImageOnTimer=setTimeout(this.sceneImageOff.bind(this),8e3)};c.prototype.sceneImageOff=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.remove("toggled");this.$spellcast.classList.remove("gfx-toggled")};c.prototype.toMainBuffer=function(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHint();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$importantMessages=null;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.$closeAltButton.classList.add("inactive");this.getSwitchedElements();return true};c.prototype.toAltBuffer=function(){if(this.$activeBuffer===this.$altBuffer){return}this.$activeBuffer=this.$altBuffer;this.$importantMessages=this.$activeSegment;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.$closeAltButton.classList.remove("inactive");this.getSwitchedElements();return true};c.prototype.getSwitchedElements=function(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};c.prototype.clientStatus=function(e){this.$clientStatus.setAttribute("data-status",e);this.$clientStatus.setAttribute("title",e)};c.prototype.setMultiplayer=function(e,t){t=t||l;if(e||e===undefined){this.$spellcast.classList.add("multiplayer")}else{this.$spellcast.classList.remove("multiplayer")}t()};c.prototype.clear=function(e){e=e||l;s.empty(this.$hint);s.empty(this.$dialogWrapper);s.empty(this.$activeMessages);s.empty(this.$choices);e()};c.prototype.clearMessages=function(e){e=e||l;s.empty(this.$activeMessages);e()};c.prototype.clearHistory=function(e){e=e||l;s.empty(this.$history);e()};c.prototype.newSegment=function(e){var t,i=e==="inter-segment";this.newSegmentNeeded=null;if(i){if(this.$activeSegment&&this.$activeSegment.tagName.toLowerCase()==="inter-segment"){return}t=document.createElement("inter-segment")}else{t=document.createElement("segment")}if(this.$activeSegment&&!this.$activeSegment.children.length){this.$activeSegment.remove()}this.$activeSegment=t;this.$activeMessages.appendChild(t);if(!i){this.moveToHistory()}};c.prototype.moveToHistory=function(){var e,t;var i=Array.from(this.$activeMessages.children);t=i.length-2;while(t>=0&&i[t].tagName.toLowerCase()==="inter-segment"){t--}if(t<0){return}for(e=0;e<=t;e++){this.$history.appendChild(i[e])}i[t].scrollIntoView(false)};c.prototype.newSegmentOnContent=function(e){e=e||"segment";this.newSegmentNeeded=e};c.prototype.addSelectedChoice=function(e){var t=document.createElement("p");t.classList.add("chosen");t.textContent=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};c.prototype.addMessage=function(e,t,i){var n=false;i=i||l;var r=()=>{if(n){return}n=true;if(t.next){o.scrollIntoView(false);this.messageNext(t.next,i);return}i()};var o=document.createElement("p");o.classList.add("text");if(t.next){o.classList.add("continue")}if(t.class){s.class(o,a.toClassObject(t.class),"s-")}if(t.style){s.css(o,t.style)}o.innerHTML=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(o);if(t.important&&this.$importantMessages){this.$importantMessages.appendChild(o.cloneNode(true))}r()};c.prototype.messageNext=function(e,t){var i=false;var n=()=>{if(i){return}i=true;this.$spellcast.classList.remove("continue");t()};this.$spellcast.classList.add("continue");this.once("continue",n);if(typeof e==="number"&&isFinite(e)&&e>0){setTimeout(n,e*1e3)}};c.prototype.speech=function(e,t,i){if(t.useService){return this.restServiceSpeech(e,t,i)}else{return this.nativeBrowserSpeech(e,t,i)}};c.prototype.restServiceSpeech=function(e,t,i){var n=/speech/;n+="?text="+encodeURIComponent(e);n+="&lang="+encodeURIComponent(t.speechLang||"en");n+="&volume="+encodeURIComponent(t.speechVolume!==undefined?t.speechVolume:1);n+="&rate="+encodeURIComponent(t.speechRate!==undefined?t.speechRate:1);n+="&pitch="+encodeURIComponent(t.speechPitch!==undefined?t.speechPitch:1);n+="&gender="+encodeURIComponent(t.speechGender||"female");console.log("REST service URL:",n);this.sound({url:n},i)};c.prototype.nativeBrowserSpeech=function(e,t,i){var n=window.speechSynthesis,r,s;if(!n){i();return}r=new SpeechSynthesisUtterance(e);r.lang=t.speechLang||"en-US";r.volume=t.speechVolume!==undefined?t.speechVolume:1;r.rate=t.speechRate!==undefined?t.speechRate:1;r.pitch=t.speechPitch!==undefined?t.speechPitch:1;if(t.speechVoice){r.voiceURI=t.speechVoice}r.onend=(e=>{console.log("Speech: finished in "+e.elapsedTime+" seconds.");i()});n.speak(r)};c.prototype.addIndicators=function(e,t,i){i=i||l;if(t){s.empty(this.$status);if(e.length){this.$status.classList.remove("empty")}else{this.$status.classList.add("empty");i();return}}var n=document.createElement("indicator-list");e.forEach(e=>{var t,i,r,s,o,a;t=document.createElement("indicator");i=document.createElement("label");i.classList.add("label");if(e.image){t.classList.add("has-image");r=document.createElement("img");r.classList.add("image");r.setAttribute("src",this.cleanUrl(e.image));if(e.label){r.setAttribute("alt",e.label);r.setAttribute("title",e.label)}i.appendChild(r)}else{i.textContent=e.label}t.appendChild(i);s=document.createElement("widget");s.classList.add("widget");s.classList.add(e.type);s.setAttribute("data-value",e.value);switch(e.type){case"hbar":a=document.createElement("outer-bar");s.appendChild(a);o=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){o.style.backgroundColor=e.color}o.style.width=""+e.value+"%";a.appendChild(o);break;case"vbar":a=document.createElement("outer-bar");s.appendChild(a);o=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){o.style.backgroundColor=e.color}o.style.height=""+e.value+"%";a.appendChild(o);break;case"text":default:s.textContent=e.value}t.appendChild(s);n.appendChild(t)});if(t){this.$status.appendChild(n)}else{if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(n)}i()};c.prototype.createChoiceEventHandlers=function(e){this.onSelect=(t=>{var i=t.currentTarget;var n=i.getAttribute("data-select-index");if(!n){return}n=parseInt(n,10);e(n)});this.onLeave=(e=>{this.clearHint()});this.onEnter=(e=>{var t=e.currentTarget;var i=t.getAttribute("data-button-hint");if(!i){return}this.setHint(i,{active:true})})};c.prototype.addPanel=function(e,t,i){i=i||l;if(t){s.empty(this.$panel);if(e.length){this.$panel.classList.remove("empty")}else{this.$panel.classList.add("empty");i();return}}else if(e.length){this.$panel.classList.remove("empty")}e.forEach(e=>{var t,i,n="button-"+e.id;if(document.getElementById(n)){return}t=document.createElement("item");t.classList.add("button");t.classList.add("disabled");t.setAttribute("id",n);if(e.image){t.classList.add("has-image");if(e.image.endsWith(".svg")){i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.classList.add("svg");o.load(this.cleanUrl(e.image),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,colorClass:true,as:i})}else{i=document.createElement("img");i.setAttribute("src",this.cleanUrl(e.image))}i.classList.add("icon");i.classList.add("image");if(e.label){i.setAttribute("alt",e.label);i.setAttribute("title",e.label)}t.appendChild(i)}else{t.textContent=e.label}this.$panel.appendChild(t)});i()};c.prototype.clearChoices=function(e){var t;e=e||l;this.choices.forEach(e=>{if(!e.button){return}var i="button-"+e.button;t=document.getElementById(i);if(t){t.removeAttribute("data-select-index");t.classList.add("disabled");t.removeEventListener("click",this.onSelect);t.removeEventListener("mouseleave",this.onLeave);t.removeEventListener("mouseenter",this.onEnter)}});s.empty(this.$choices);this.choices.length=0;this.onSelect=null;this.onLeave=null;this.onEnter=null;e()};c.prototype.addChoices=function(e,t,i){if(this.uiLoadingCount){this.once("uiLoaded",this.addChoices.bind(this,e,t,i));return}var n=false;var r=document.createDocumentFragment();var o=document.createElement("group");i=i||l;this.createChoiceEventHandlers(t);e.forEach(e=>{var t;this.choices.push(e);if(e.button&&(t=document.getElementById("button-"+e.button))&&!t.getAttribute("data-select-index")&&!t.classList.contains("inactive")){if(e.groupBreak){n=true}t.setAttribute("data-select-index",e.index);t.classList.remove("disabled");t.addEventListener("click",this.onSelect);if(e.label){t.setAttribute("data-button-hint",e.label);t.addEventListener("mouseleave",this.onLeave);t.addEventListener("mouseenter",this.onEnter)}return}var i=document.createElement("choice");i.classList.add("choice",e.type);i.setAttribute("data-select-index",e.index);i.classList.remove("disabled");if(e.class){s.class(i,a.toClassObject(e.class),"s-")}if(e.style){s.css(i,e.style)}if(e.image){i.classList.add("has-image");var l=document.createElement("img");l.classList.add("image");l.setAttribute("src",this.cleanUrl(e.image));i.appendChild(l)}var c=document.createElement("span");c.classList.add("label");c.textContent=e.label;i.appendChild(c);if(e.selectedBy&&e.selectedBy.length){var u=document.createElement("span");u.classList.add("italic","brightBlack");u.textContent=" "+e.selectedBy.join(", ");i.appendChild(u)}i.addEventListener("click",this.onSelect);if(e.groupBreak||n){n=false;r.appendChild(o);o=document.createElement("group")}o.appendChild(i)});r.appendChild(o);this.$choices.appendChild(r);i()};c.prototype.getChoiceColumnsCount=function(e){var t=0,i=0;e.forEach(e=>{if(e.groupBreak){if(t>i){i=t}t=0}t++});if(t>i){i=t}return i};c.prototype.setChoices=function(e,t,i,n,r){n=n||{};r=r||l;this.clearChoices(()=>{switch(n.nextStyle){case"inline":case"smallInline":case"list":case"smallList":this.$choices.setAttribute("data-choice-style",n.nextStyle);break;case"table":this.$choices.setAttribute("data-choice-style",n.nextStyle);this.$choices.classList.add("columns-"+this.getChoiceColumnsCount(e));break;default:this.$choices.setAttribute("data-choice-style","list")}this.addChoices(e,i,r);if(t&&t.length){var s=document.createElement("p");s.classList.add("unassigned-users");s.textContent=t.join(", ");this.$choices.appendChild(s)}if(typeof n.timeout==="number"){this.choiceTimeout(n.timeout)}})};c.prototype.updateChoices=c.prototype.setChoices;c.prototype.choiceTimeout=function(e){var t=Date.now(),i,n;i=document.createElement("p");i.classList.add("timer");i.textContent=Math.round(e/1e3);this.$choices.appendChild(i);n=setInterval(()=>{if(!i.parentNode){clearInterval(n);return}i.textContent=Math.round((e+t-Date.now())/1e3)},1e3)};c.prototype.textInputDisabled=function(e){var t=document.createElement("form"),i=document.createElement("label"),n=document.createElement("input");i.textContent=e.label;n.setAttribute("placeholder",e.placeholder);n.setAttribute("disabled",true);n.setAttribute("type","text");n.classList.add("text-input");t.appendChild(i);t.appendChild(n);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};c.prototype.textInput=function(e,t){var i=document.createElement("form"),n=document.createElement("label"),r=document.createElement("input");n.classList.add("text");n.textContent=e.label;r.setAttribute("type","text");r.classList.add("text-input");i.appendChild(n);i.appendChild(r);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(i);r.focus();var s=function(e){e.preventDefault();i.removeEventListener("submit",s);r.setAttribute("disabled",true);t(r.value)};i.addEventListener("submit",s)};c.prototype.enableCommand=function(e){if(!this.onCommandSubmit){this.onCommandSubmit=(t=>{t.preventDefault();e(this.$chatInput.value);this.$chatInput.value=""});this.$chatForm.addEventListener("submit",this.onCommandSubmit);this.$mainBuffer.classList.remove("chat-hidden");this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};c.prototype.disableCommand=function(){this.$chatForm.removeEventListener("submit",this.onCommandSubmit);this.onCommandSubmit=null;this.$mainBuffer.classList.add("chat-hidden");this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};c.prototype.clearHint=function(){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint)},3e3)};c.prototype.setHint=function(e,t){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}if(this.$hint.textContent){this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint);this.setHint(e,t)},300);return}this.$hint.textContent=e;this.$hint.classList.remove("empty");s.class(this.$hint,{passive:!!t.passive,active:!!t.active});this.hintTimer=setTimeout(this.clearHint.bind(this),3e3)};c.prototype.setBigHint=function(e,t){var i=document.createElement("h2");i.textContent=e;if(t){s.class(i,t)}s.empty(this.$hint);this.$hint.appendChild(i)};c.prototype.clearDialog=function(){this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var e=false;var t=()=>{this.$dialogWrapper.removeEventListener("transitionstart",t);if(e){return}e=true;this.$dialogWrapper.addEventListener("transitionend",i)};var i=()=>{this.$dialogWrapper.removeEventListener("transitionend",i);s.empty(this.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",t);setTimeout(()=>{if(e){return}e=true;s.empty(this.$dialogWrapper)},10)};c.prototype.setDialog=function(e,t,i){t=t||{};i=i||l;if(t.contentDelay&&!this.newSegmentNeeded){delete t.contentDelay;var n=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var r=Math.min(n*10,5e3);console.warn("contentLength/delay",n,r);setTimeout(this.setDialog.bind(this,e,t,i),r);return}var o=document.createElement("div");o.classList.add("dialog");if(t.title){var a=document.createElement("h2");a.classList.add("title");a.textContent=t.title;o.appendChild(a)}var c=document.createElement("div");c.classList.add("message");c.textContent=e;o.appendChild(c);if(t.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(t.big){o.classList.add("big")}if(t.fun){o.classList.add("fun")}if(t.alert){o.classList.add("alert")}if(t.modal){o.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}s.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(o);this.$dialogWrapper.classList.remove("empty");i()};c.prototype.setSceneImage=function(e){var t=false;var i=this.$sceneImage;this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(e.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(e.url)+'")'}if(e.origin&&typeof e.origin==="string"){this.$sceneImage.style.backgroundPosition=e.origin}var n=()=>{if(t){return}t=true;i.remove()};if(i){i.addEventListener("transitionend",n,false);this.$gfx.insertBefore(this.$sceneImage,i);i.classList.add("hidden");setTimeout(n,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(e.position){case"left":this.$spellcast.setAttribute("data-image-position","left");break;case"right":default:this.$spellcast.setAttribute("data-image-position","right");break}};c.prototype.clearSprite=function(e){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return}this.clearGItem(this.sprites[e]);delete this.sprites[e]};c.prototype.clearVg=function(e){if(!this.vgs[e]){console.warn("Unknown VG id: ",e);return}this.clearGItem(this.vgs[e]);delete this.vgs[e]};c.prototype.clearMarker=function(e){if(!this.markers[e]){console.warn("Unknown Marker id: ",e);return}this.clearGItem(this.markers[e]);delete this.markers[e]};c.prototype.clearCard=function(e){if(!this.cards[e]){console.warn("Unknown Card id: ",e);return}this.clearGItem(this.cards[e]);delete this.cards[e]};c.prototype.showSprite=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.sprites[e]){this.clearGItem(this.sprites[e])}var i=this.sprites[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"sprite",location:null,class:t.class,style:{},animation:null});return this.updateGItem(i,t,true)};c.prototype.showVg=function(e,t){if((!t.url||typeof t.url!=="string")&&(!t.vgObject||typeof t.vgObject!=="object")){return r.resolved}if(this.vgs[e]){this.clearGItem(this.vgs[e])}var i=this.vgs[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"vg",vgObject:null,class:t.class,style:{},area:{},animation:null});return this.updateGItem(i,t,true)};c.prototype.showMarker=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.markers[e]){this.clearGItem(this.markers[e])}var i=this.markers[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"marker",vg:null,location:null,class:t.class,style:{},animation:null});return this.updateGItem(i,t,true)};var u=0;c.prototype.showCard=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.cards[e]){this.clearGItem(this.cards[e])}var i=this.cards[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"card",location:"showing",$locationSlot:null,pose:null,order:u++,class:t.class,style:{},imageStyle:{},animation:null,contents:{}});this.createCardMarkup(i);return this.updateGItem(i,t,true)};c.prototype.updateSprite=function(e,t){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return r.resolved}return this.updateGItem(this.sprites[e],t)};c.prototype.updateVg=function(e,t){if(!this.vgs[e]){console.warn("Unknown VG id: ",e);return r.resolved}return this.updateGItem(this.vgs[e],t)};c.prototype.updateMarker=function(e,t){if(!this.markers[e]){console.warn("Unknown marker id: ",e);return r.resolved}return this.updateGItem(this.markers[e],t)};c.prototype.updateCard=function(e,t){if(!this.cards[e]){console.warn("Unknown card id: ",e);return r.resolved}return this.updateGItem(this.cards[e],t)};c.prototype.animateSprite=function(e,t){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.sprites[e],this.animations[t])};c.prototype.animateVg=function(e,t){if(!this.vgs[e]){console.warn("Unknown VG id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.vgs[e],this.animations[t])};c.prototype.animateMarker=function(e,t){if(!this.markers[e]){console.warn("Unknown marker id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.markers[e],this.animations[t])};c.prototype.animateCard=function(e,t){if(!this.cards[e]){console.warn("Unknown card id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.cards[e],this.animations[t])};c.prototype.createGItem=function(e){var t=new n;if(e.type!=="marker"){t.$wrapper=document.createElement("div");t.$wrapper.style.visibility="hidden";t.$wrapper.style.transition="none";t.$wrapper.classList.add("g-item-wrapper",e.type+"-wrapper");this.$gfx.append(t.$wrapper)}t.size={mode:"relative",xy:1};t.position={mode:"relative",x:0,y:0};t.transform={};Object.assign(t,e);t.defineStates("loaded","loading");return t};c.prototype.clearGItem=function(e){if(e.$locationSlot){e.$locationSlot.remove()}e.$wrapper.remove()};c.prototype.updateGItem=async function(e,t,i=false){if(t.vgObject){this.updateGItemVgObject(e,t)}else if(t.vgMorph){this.updateGItemVgMorph(e,t)}if(t.url){await this.updateGItemImage(e,t)}if(t.backUrl){await this.updateGItemBackImage(e,t)}if(t.maskUrl){await this.updateGItemMask(e,t)}if(t.content){this.updateGItemContent(e,t)}if(t.button!==undefined){this.updateGItemButton(e,t)}if(t.area){this.updateVgArea(e,t.area)}if(e.type==="marker"&&(t.vg||t.location)){this.updateMarkerLocation(e,t.vg,t.location)}return this.updateGItemCosmetics(e,t,i)};c.prototype.updateGItemCosmetics=async function(e,t,i=false){if(!i&&e.type!=="marker"&&t.transition!==undefined){if(t.transition===null){e.$wrapper.style.transition=""}else if(!t.transition){e.$wrapper.style.transition="none"}else{e.$wrapper.style.transition="all "+t.transition+"s"}}if(t.location!==undefined&&e.type!=="marker"){await this.moveGItemToLocation(e,t)}if(t.pose!==undefined){this.updateGItemPose(e,t)}if(t.status){this.updateGItemStatus(e,t)}if(t.style&&e.$wrapper){delete t.style.position;Object.assign(e.style,t.style);s.css(e.$wrapper,t.style)}if(t.imageStyle&&e.$image){delete t.imageStyle.position;Object.assign(e.imageStyle,t.imageStyle);s.css(e.$image,t.imageStyle)}if(t.backImageStyle&&e.$backImage){delete t.backImageStyle.position;Object.assign(e.backImageStyle,t.backImageStyle);s.css(e.$backImage,t.backImageStyle)}if(t.maskStyle&&e.$mask){delete t.maskStyle.position;Object.assign(e.maskStyle,t.maskStyle);s.css(e.$mask,t.maskStyle)}if(t.size||t.position){this.updateGItemTransform(e,t)}if(t.class){t.class=a.toClassObject(t.class);Object.assign(e.class,t.class);s.class(e.$wrapper||e.$image,t.class,"s-")}if(i&&e.type!=="marker"){e.$wrapper.style.visibility="visible";await r.resolveAtAnimationFrame();if(t.transition===undefined||t.transition===null){e.$wrapper.style.transition=""}else if(!t.transition){e.$wrapper.style.transition="none"}else{e.$wrapper.style.transition="all "+t.transition+"s"}}};c.prototype.updateGItemImage=function(e,t){var i=new r;e.vgObject=null;if(e.type==="card"){e.$image.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")';i.resolve();return i}if(t.url.endsWith(".svg")){if(e.$image){e.$image.remove()}if(e.type==="marker"){e.$image=document.createElementNS("http://www.w3.org/2000/svg","g")}else{e.$image=document.createElementNS("http://www.w3.org/2000/svg","svg");e.$image.classList.add("svg")}switch(e.type){case"vg":e.onClick=(e=>{e.stopPropagation()});e.$image.addEventListener("click",e.onClick);e.$image.classList.add("vg");this.uiLoadingCount++;break;case"sprite":e.$image.classList.add("sprite");break;case"marker":e.$image.classList.add("marker");break}o.load(this.cleanUrl(t.url),{removeSvgStyle:true,removeComments:true,removeExoticNamespaces:true,as:e.$image}).then(()=>{console.warn("loaded!");if(e.type==="vg"){this.setVgButtons(e.$image);this.setVgPassiveHints(e.$image);e.emit("loaded");if(--this.uiLoadingCount<=0){this.emit("uiLoaded")}}else{e.emit("loaded")}i.resolve()});console.warn("Aft load");e.emit("loading")}else{if(!e.$image||e.$image.tagName.toLowerCase()!=="img"){if(e.$image){e.$image.remove()}e.$image=document.createElement("img");e.$image.classList.add(e.type)}e.$image.setAttribute("src",this.cleanUrl(t.url));e.$image.onload=(()=>i.resolve())}if(e.type!=="marker"){e.$wrapper.append(e.$image)}return i};c.prototype.updateGItemVgObject=function(e,t){var i=t.vgObject;if(!(i instanceof o.VG)){i=o.objectToVG(i);if(!(i instanceof o.VG)){return}}e.vgObject=i;if(e.$image){e.$image.remove()}if(e.type==="marker"){e.$image=i.renderDom({overrideTag:"g"})}else{e.$image=i.renderDom();e.$image.classList.add("svg");e.$image.classList.add("vg-object")}switch(e.type){case"vg":e.onClick=(e=>{e.stopPropagation()});e.$image.addEventListener("click",e.onClick);e.$image.classList.add("vg");this.setVgButtons(e.$image);this.setVgPassiveHints(e.$image);break;case"sprite":e.$image.classList.add("sprite");break;case"marker":e.$image.classList.add("marker");break}if(e.type!=="marker"){e.$wrapper.append(e.$image)}return};c.prototype.updateGItemVgMorph=function(e,t){var i=e.vgObject;if(!i){console.warn("Has no VG object, abort...");return}i.importMorphLog(t.vgMorph);i.morphDom();return};c.prototype.updateGItemBackImage=function(e,t){if(e.type==="card"){e.$backImage.style.backgroundImage='url("'+this.cleanUrl(t.backUrl)+'")'}return r.resolved};c.prototype.updateGItemMask=function(e,t){var i=new r;if(t.maskUrl.endsWith(".svg")&&e.type==="sprite"){console.warn("has mask!");if(e.$mask){e.$mask.remove()}e.$mask=document.createElementNS("http://www.w3.org/2000/svg","svg");e.$mask.classList.add("sprite-mask");o.load(this.cleanUrl(t.maskUrl),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,as:e.$mask}).then(()=>i.resolve());e.$wrapper.append(e.$mask);e.$wrapper.classList.add("has-mask")}else if(e.$mask){e.$mask.remove();e.$wrapper.classList.remove("has-mask");i.resolve()}return i};c.prototype.updateGItemTransform=function(e,t){var i,n,r,o,a,l,c,u,h;if(!e.$wrapper||!e.$image){return}if(t.size){e.size=t.size}if(t.position){e.position=t.position}if(e.$image.tagName.toLowerCase()==="svg"){i=e.$wrapper.offsetWidth/e.$wrapper.offsetHeight;n=e.$image.width.baseVal.value/e.$image.height.baseVal.value;if(n>i){r=e.$wrapper.offsetWidth;o=r/n}else{o=e.$wrapper.offsetHeight;r=o*n}console.log("dbg svg:",{wrapperAspect:i,imageAspect:n,imageWidth:r,imageHeight:o})}else{r=e.$image.offsetWidth;o=e.$image.offsetHeight}switch(e.size.mode){case"area":case"areaMin":default:a=e.transform.scaleX=e.transform.scaleY=e.size.xy;console.log("transform after .updateGItemSize()",e.transform);break}switch(e.position.mode){case"areaInSpriteOut":l=c=0;u=this.$gfx.offsetWidth-r;h=this.$gfx.offsetHeight-o;if(a!==undefined){l=-.5*r*(1-a);c=-.5*o*(1-a);u+=r*(1-a);h+=o*(1-a)}console.log("dbg:",{xMinOffset:l,xFactor:u,yFactor:h});if(e.position.x<-1){e.transform.translateX=l+(e.position.x+1)*r*a}else if(e.position.x>1){e.transform.translateX=l+u+(e.position.x-1)*r*a}else{e.transform.translateX=l+(.5+e.position.x/2)*u}if(e.position.y<-1){e.transform.translateY=c+h-(e.position.y+1)*o*a}else if(e.position.y>1){e.transform.translateY=c-(e.position.y-1)*o*a}else{e.transform.translateY=c+(.5-e.position.y/2)*h}console.log("transform after .updateGItemPosition()",e.transform);break;case"area":default:l=c=0;u=this.$gfx.offsetWidth-r;h=this.$gfx.offsetHeight-o;if(a!==undefined){l=-.5*r*(1-a);c=-.5*o*(1-a);u+=r*(1-a);h+=o*(1-a)}console.log("dbg:",{xMinOffset:l,xFactor:u,yFactor:h});e.transform.translateX=l+(.5+e.position.x/2)*u;e.transform.translateY=c+(.5-e.position.y/2)*h;console.log("transform after .updateGItemPosition()",e.transform);break}s.transform(e.$wrapper,e.transform)};c.prototype.updateGItemContent=function(e,t){var i,n;if(e.type!=="card"){return}for(let r in t.content){i=t.content[r];n=e.contents[r];if(!n){n=e.contents[r]=document.createElement("div");n.classList.add("content-"+r);e.$front.append(n)}n.textContent=i;n.setAttribute("content",i)}};c.prototype.updateGItemPose=function(e,t){if(typeof t.pose==="string"){e.$wrapper.setAttribute("pose",t.pose);e.pose=t.pose}else{e.$wrapper.removeAttribute("pose");e.pose=null}};c.prototype.updateGItemStatus=function(e,t){var i,n;for(n in t.status){i=t.status[n];if(i){e.$wrapper.classList.add("status-"+n);if(typeof i==="number"||typeof i==="string"){e.$wrapper.setAttribute("status-"+n,i)}}else{e.$wrapper.classList.remove("status-"+n);if(e.$wrapper.hasAttribute("status-"+n)){e.$wrapper.removeAttribute("status-"+n)}}}};c.prototype.updateGItemButton=function(e,t){var i=e.$mask||e.$wrapper;var n=t.button;i.setAttribute("id","button-"+n);i.classList.add("button");i.classList.add("disabled")};c.prototype.updateGItemAction=function(e,t){var i=e.$mask||e.$image;if(t.action&&!e.action){e.onClick=(t=>{e.actionCallback(e.action);t.stopPropagation()});i.classList.add("button");i.addEventListener("click",e.onClick)}else if(!t.action&&e.action){i.classList.remove("button");i.removeEventListener("click",e.onClick)}e.action=t.action||null};c.prototype.moveGItemToLocation=function(e,t){var i=new r,n=t.location;if(e.location===n){i.resolve();return i}var o,a,l,c,u,h,f,p,d,m,g,y,v;var b=10;l=e.location;a=l?this.gItemLocations[l]:this.$gfx;u=e.$locationSlot||this.$gfx;e.location=n;o=n?this.gItemLocations[n]:this.$gfx;if(!o){o=this.gItemLocations[n]=document.createElement("div");o.classList.add("g-item-location");o.classList.add("g-item-location-"+n);this.$gfx.append(o)}var x=window.getComputedStyle(e.$wrapper);var w=window.getComputedStyle(o);var k=parseFloat(x.width);var _=parseFloat(x.height);if(o===this.$gfx){c=this.$gfx}else{c=e.$locationSlot=document.createElement("div");c.classList.add("g-item-slot");c.style.order=e.order}p=[...Object.values(this.cards),...Object.values(this.sprites),...Object.values(this.vgs)].filter(t=>t!==e&&t.location&&(t.location===n||t.location===l));d=p.map(e=>e.$locationSlot.getBoundingClientRect());if(c!==this.$gfx){if(o.lastChild&&parseFloat(o.lastChild.style.order)>e.order){o.prepend(c)}else{o.append(c)}}v=u.getBoundingClientRect();if(u!==this.$gfx){u.remove()}m=p.map(e=>e.$locationSlot.getBoundingClientRect());p.forEach((e,t)=>{var i=d[t],n=m[t];var r=e.$wrapper.style.transition;var o=e.$wrapper.style.transform;var a=Object.assign({},e.localTransform);a.translateX+=i.left-n.left;a.translateY+=i.top-i.top;e.$wrapper.style.transition="none";e.$wrapper.style.transform=s.stringifyTransform(a);setTimeout(()=>{e.$wrapper.style.transition=r;e.$wrapper.style.transform=o},b)});var S={translateX:0,translateY:0};switch(w.flexDirection){case"row":case"row-reverse":g=parseFloat(w.height);S.scaleX=S.scaleY=g/_;break;case"column":case"column-reverse":g=parseFloat(w.width);S.scaleX=S.scaleY=g/k;break;default:g=parseFloat(w.height);S.scaleX=S.scaleY=g/_;console.warn("flex-direction",w.flexDirection)}S.translateX-=(k-k*S.scaleX)/2;S.translateY-=(_-_*S.scaleY)/2;var C=e.localTransform;e.localTransform=S;if(u===this.$gfx){e.$wrapper.style.transform=s.stringifyTransform(S);c.append(e.$wrapper);i.resolve();return i}var L=window.getComputedStyle(a);switch(L.flexDirection){case"column":case"column-reverse":f="column";break;default:f="row"}y=c.getBoundingClientRect();var A={translateX:v.left+C.translateX-y.left,translateY:v.top+C.translateY-y.top,scaleX:C.scaleX,scaleY:C.scaleY};e.$wrapper.style.transform=s.stringifyTransform(A);c.append(e.$wrapper);setTimeout(()=>{e.$wrapper.style.transform=s.stringifyTransform(S);i.resolve()},b);return i};c.prototype.updateVgArea=function(e,t){var i;if(e.type!=="vg"){return}if(!e.hasState("loaded")){e.once("loaded",this.updateVgArea.bind(this,e,t));return}for(i in t){if(!e.area[i]){e.area[i]={}}if(!e.area[i].status){e.area[i].status={}}if(t[i].hint!==undefined){e.area[i].hint=t[i].hint||null}if(t[i].status){Object.assign(e.area[i].status,t[i].status)}Array.from(e.$image.querySelectorAll("[area="+i+"]")).forEach(e=>{var n;if(t[i].hint!==undefined){if(t[i].hint){e.setAttribute("data-passive-hint",t[i].hint);e.classList.add("passive-hint")}else{e.removeAttribute("data-passive-hint");e.classList.remove("passive-hint")}}if(t[i].status){for(n in t[i].status){if(t[i].status[n]){e.classList.add("status-"+n)}else{e.classList.remove("status-"+n)}}}})}};c.prototype.updateMarkerLocation=function(e,t,i){var n,r,s,a,l,c,u,h,f,p;if(!e.hasState("loaded")){e.once("loaded",this.updateMarkerLocation.bind(this,e,t,i));return}if(!t){t=e.vg}if(!i){i=e.location}if(!this.vgs[t]){console.warn("Unknown VG id: ",t);return}n=this.vgs[t];if(!n.hasState("loaded")){n.once("loaded",this.updateMarkerLocation.bind(this,e,t,i));return}r=n.$image.querySelector("[area="+i+"]");if(!r){console.warn("VG "+t+": area not found",i);return}e.vg=t;e.location=i;s=r.getBBox();f=s.x+s.width/2;p=s.y+s.height/2;a=o.getViewBox(e.$image);l=parseFloat(e.$image.getAttribute("width"))||a.width;c=parseFloat(e.$image.getAttribute("height"))||a.height;if(!isNaN(u=parseFloat(e.$image.getAttribute("originX")))){f-=(u-a.x)/a.width*l}if(!isNaN(h=parseFloat(e.$image.getAttribute("originY")))){p-=(h-a.y)/a.height*c}e.$image.style.transform="translate("+f+"px , "+p+"px )"+"scale("+l/a.width+" , "+c/a.height+")";if(e.$image.ownerSVGElement!==n.$image){n.$image.append(e.$image)}};c.prototype.createGItemLocation=function(e){var t;if(this.gItemLocations[e]){return}t=this.gItemLocations[e]=document.createElement("div");t.classList.add("g-item-location");t.classList.add("g-item-location-"+e);this.$gfx.append(t)};c.prototype.createCardMarkup=function(e){e.$card=document.createElement("div");e.$card.classList.add("card");e.$wrapper.append(e.$card);e.$front=document.createElement("div");e.$front.classList.add("front");e.$card.append(e.$front);e.$image=document.createElement("div");e.$image.classList.add("card-image");e.$front.append(e.$image);e.$back=document.createElement("div");e.$back.classList.add("back");e.$card.append(e.$back);e.$backImage=document.createElement("div");e.$backImage.classList.add("card-image");e.$back.append(e.$backImage)};c.prototype.animateGItem=async function(e,t){var i,n=0;e.animation=t.id;if(!Array.isArray(t.frames)||!t.frames.length){return}for(i of t.frames){await this.updateGItem(e,i);await r.resolveTimeout(i.duration*1e3)}e.animation=null};c.prototype.defineAnimation=function(e,t){t.id=e;this.animations[e]=t};c.prototype.setVgButtons=function(e){Array.from(e.querySelectorAll("[button]")).forEach(e=>{var t=e.getAttribute("button");e.setAttribute("id","button-"+t);if(!e.getAttribute("area")){e.setAttribute("area",t)}e.classList.add("button");e.classList.add("disabled")})};c.prototype.setVgPassiveHints=function(e){Array.from(e.querySelectorAll("[hint]")).forEach(e=>{var t=e.getAttribute("hint");e.setAttribute("data-passive-hint",t);e.classList.add("passive-hint");e.addEventListener("mouseleave",e=>{this.clearHint()});e.addEventListener("mouseenter",e=>{var t=e.currentTarget;var i=t.getAttribute("data-passive-hint");if(!i){return}this.setHint(i,{passive:true})})})};c.prototype.sound=function(e,t){var i,n=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,e,n);this.nextSoundChannel=(this.nextSoundChannel+1)%4;n.setAttribute("src",this.cleanUrl(e.url));n.play();if(t){i=(()=>{n.removeEventListener("ended",i);t()});n.addEventListener("ended",i)}};c.prototype.music=function(e){var t=this.$music.getAttribute("src");if(e.url){e.url=this.cleanUrl(e.url);if(t){if(t!==e.url){d(this.$music,()=>{this.$music.setAttribute("src",e.url);this.$music.play();p(this.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",e.url);this.$music.play();p(this.$music)}}else if(t){d(this.$music,()=>{this.$music.removeAttribute("src")})}};var h=10;var f=.01;function p(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+f);e.__fadeTimer=setTimeout(p.bind(undefined,e,t),h)}function d(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-f);e.__fadeTimer=setTimeout(d.bind(undefined,e,t),h)}},{"../../commonUtils.js":5,"dom-kit":7,"nextgen-events/lib/browser.js":11,seventh:25,"svg-kit":42}],2:[function(e,t,i){"use strict";const n=e("nextgen-events/lib/browser.js");const r=e("dom-kit");const s=e("url");function o(e){this.domain=e.domain||"localhost";this.port=e.port||80;this.path=e.path||"/";this.token=e.token||"";this.userName=e.name||"unknown_"+Math.floor(Math.random()*1e4);this.ws=null;this.proxy=null}t.exports=o;o.prototype=Object.create(n.prototype);o.prototype.constructor=o;const a={classic:e("./ui/classic.js")};o.autoCreate=function(){var e={port:window.location.port,domain:window.location.hostname,path:window.location.pathname};Object.assign(e,s.parse(window.location.href,true).query);window.spellcastClient=new o(e);if(!e.ui){e.ui=["classic"]}else if(!Array.isArray(e.ui)){e.ui=[e.ui]}window.spellcastClient.ui=e.ui;return window.spellcastClient};o.prototype.run=function(e){var t=false;this.proxy=new n.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(e=>{if(a[e]){new a[e](this.proxy.remoteServices.bus,this)}});var i="ws://"+this.domain+(this.port?":"+this.port:"")+this.path+(this.token||"");console.log("Websocket URL:",i);this.ws=new WebSocket(i);this.emit("connecting");this.ws.onerror=(()=>{if(!t){console.log("Can't open Websocket (error)...");this.emit("error","unreachable");return}});this.ws.onopen=(()=>{t=true;console.log("Websocket opened!");this.emit("open");this.proxy.remoteServices.bus.emit("authenticate",{name:this.userName});if(typeof e==="function"){e()}});this.ws.onclose=(()=>{if(!t){console.log("Can't open Websocket (close)...");this.emit("error","unreachable");return}t=false;this.proxy.destroy();console.log("Websocket closed!");this.emit("close")});this.ws.onmessage=(e=>{var t;try{t=JSON.parse(e.data)}catch(e){return}console.log("Message received: ",t);this.proxy.receive(t)});this.proxy.send=(e=>{this.ws.send(JSON.stringify(e))})};o.autoCreate();r.ready(()=>{window.spellcastClient.run();document.body.onkeypress=(e=>{if(e.keyCode!==120){return}var t,i=document.querySelectorAll("link[rel=stylesheet]");for(var n=0;n<i.length;n++){t=i[n].getAttribute("href").split("?")[0]+"?"+Math.random();i[n].setAttribute("href",t)}})})},{"./ui/classic.js":4,"dom-kit":7,"nextgen-events/lib/browser.js":11,url:47}],3:[function(e,t,i){"use strict";const n={};t.exports=n;const r=e("string-kit/lib/format.js").markupMethod;const s=e("string-kit/lib/escape.js").html;const o={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="bright blue">',c:'<span class="cyan">',C:'<span class="bright cyan">',g:'<span class="green">',G:'<span class="bright green">',k:'<span class="black">',K:'<span class="grey">',m:'<span class="magenta">',M:'<span class="bright magenta">',r:'<span class="red">',R:'<span class="bright red">',w:'<span class="white">',W:'<span class="bright white">',y:'<span class="yellow">',Y:'<span class="bright yellow">'}};n.markup=((...e)=>{e[0]=s(e[0]).replace(/\n/,"<br />");return r.apply(o,e)});const a=/\^\[([^\]]*)]|\^(.)|([^^]+)/g;n.stripMarkup=(e=>e.replace(a,(e,t,i,n)=>n?n:i==="^"?"^":""))},{"string-kit/lib/escape.js":28,"string-kit/lib/format.js":29}],4:[function(e,t,i){"use strict";const n=e("nextgen-events/lib/browser.js");const r=e("../Dom.js");const s=e("../toolkit.js");function o(e,t){console.log(Array.from(arguments));this.bus=e;this.client=t;this.user=null;this.users=null;this.roles=null;this.roleId=null;this.config=null;this.inGame=false;this.nexts=null;this.afterNext=false;this.afterNextTriggered=false;this.afterLeave=false;this.hasNewContent=false;this.dom=new r;this.ended=false;this.client.once("connecting",o.clientConnecting.bind(this));this.client.once("open",o.clientOpen.bind(this));this.client.once("close",o.clientClose.bind(this));this.client.on("error",o.clientError.bind(this));this.commandConfig({enabled:true});this.dom.preload()}t.exports=o;o.prototype=Object.create(n.prototype);o.prototype.constructor=o;function a(e){return this.find(t=>{return t.id===e})}o.prototype.initBus=function(){this.bus.on("clientConfig",o.clientConfig.bind(this));this.bus.on("user",o.user.bind(this));this.bus.on("userList",o.userList.bind(this));this.bus.on("roleList",o.roleList.bind(this));this.bus.on("extOutput",o.extOutput.bind(this));this.bus.on("extErrorOutput",o.extErrorOutput.bind(this));this.bus.on("message",o.message.bind(this),{async:true});this.bus.on("indicators",o.indicators.bind(this));this.bus.on("status",o.status.bind(this));this.bus.on("panel",o.panel.bind(this));this.bus.on("theme",o.theme.bind(this));this.bus.on("image",o.image.bind(this));this.bus.on("sound",o.sound.bind(this));this.bus.on("music",o.music.bind(this));this.bus.on("defineAnimation",o.defineAnimation.bind(this));this.bus.on("showSprite",o.showSprite.bind(this),{async:true});this.bus.on("updateSprite",o.updateSprite.bind(this),{async:true});this.bus.on("animateSprite",o.animateSprite.bind(this),{async:true});this.bus.on("clearSprite",o.clearSprite.bind(this));this.bus.on("showVg",o.showVg.bind(this));this.bus.on("updateVg",o.updateVg.bind(this));this.bus.on("animateVg",o.animateVg.bind(this));this.bus.on("clearVg",o.clearVg.bind(this));this.bus.on("showMarker",o.showMarker.bind(this));this.bus.on("updateMarker",o.updateMarker.bind(this));this.bus.on("animateMarker",o.animateMarker.bind(this));this.bus.on("clearMarker",o.clearMarker.bind(this));this.bus.on("showCard",o.showCard.bind(this));this.bus.on("updateCard",o.updateCard.bind(this));this.bus.on("animateCard",o.animateCard.bind(this));this.bus.on("clearCard",o.clearCard.bind(this));this.bus.on("enterScene",o.enterScene.bind(this));this.bus.on("leaveScene",o.leaveScene.bind(this));this.bus.on("nextList",o.nextList.bind(this));this.bus.on("nextTriggered",o.nextTriggered.bind(this));this.bus.on("textInput",o.textInput.bind(this));this.bus.on("commandConfig",o.prototype.commandConfig.bind(this));this.bus.on("rejoinRoles",o.rejoinRoles.bind(this));this.bus.on("pause",o.pause.bind(this));this.bus.on("unpause",o.unpause.bind(this));this.bus.on("wait",o.wait.bind(this));this.bus.on("end",o.end.bind(this),{async:true});this.bus.on("custom",o.custom.bind(this));this.bus.on("exit",o.exit.bind(this),{async:true});this.bus.emit("ready");this.defineStates("end")};o.clientConnecting=function(){console.log("Connecting!");this.dom.clientStatus("connecting")};o.clientOpen=function(){console.log("Connected!");this.dom.clientStatus("connected");this.initBus()};o.clientClose=function(){console.log("Closed!");this.dom.clientStatus("closed")};o.clientError=function(e){switch(e){case"unreachable":this.dom.clientStatus("unreachable");break}};o.clientConfig=function(e){console.warn("Client config received: ",e);this.config=e;if(this.config.theme){this.dom.setTheme(this.config.theme)}};o.user=function(e){console.log("User received: ",e);this.user=e};o.userList=function(e){console.log("User-list received: ",e);e.get=a;this.users=e};o.roleList=function(e,t,i){var n=[],r;if(!this.roles&&e.length>1){this.dom.setMultiplayer(true)}e.get=a;this.roles=e;if(this.inGame){return}if(i&&e.length<=1){this.roleId=e[0].id;return}e.forEach((e,t)=>{var i=e.clientId&&this.users.get(e.clientId).name;n.push({index:t,label:e.name,type:"role",selectedBy:i&&[i]})});if(t.length){r=t.map(e=>{return this.users.get(e).name})}var s=t=>{if(e[t].clientId===this.user.id){this.bus.emit("selectRole",null)}else if(e[t].clientId!==null){return}else{this.bus.emit("selectRole",e[t].id)}};this.dom.setChoices(n,r,s);if(i){e.find((e,t)=>{if(e.clientId===this.user.id){this.roleId=e.id;return true}return false});this.afterLeave=true;return}};o.message=function(e,t,i){this.hasNewContent=true;if(!t){t={}}if(t.speech){if(!t.speechLang){t.speechLang=this.config.defaultLocale}t.useService=this.config.hasSpeechService;if(t.speechOnly){this.dom.speech(s.stripMarkup(e),t,i)}else{let n=false,r=false;this.dom.addMessage(s.markup(e),t,()=>{n=true;if(r){i()}});this.dom.speech(s.stripMarkup(e),t,()=>{r=true;if(n){i()}})}}else{this.dom.addMessage(s.markup(e),t,i)}};o.indicators=function(e){this.dom.addIndicators(e)};o.status=function(e){this.dom.addIndicators(e,true)};o.panel=function(e,t){this.dom.addPanel(e,t)};o.enterScene=function(e,t){var i;this.inGame=true;if(t){i=this.dom.toAltBuffer()}if(!e&&!i){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};o.leaveScene=function(e,t){if(t){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};o.nextTriggered=function(e){var t=this.nexts.find(t=>t.id===e);this.dom.newSegmentOnContent("inter-segment");if(t&&t.label&&!t.button){this.dom.addSelectedChoice(t.label)}this.dom.clearChoices();this.afterNextTriggered=true;this.hasNewContent=false};o.nextList=function(e,t,i,n){var r=[],s,o=0;this.nexts=e;this.afterNext=true;if(n&&this.roles.length===1){return}e.forEach((e,t)=>{var i=e.roleIds.map(e=>{return this.roles.get(e).name});if(e.label){o+=e.label.length}r.push({index:t,label:e.label||"Next",style:e.style,class:e.class,image:e.image,button:e.button,groupBreak:!!e.groupBreak,type:"next",selectedBy:i})});if(!i.nextStyle||i.nextStyle==="auto"){if(this.roles.length<=1&&r.length<=3&&o<20){i.nextStyle="inline"}else if(r.length>8){i.nextStyle="smallList"}else{i.nextStyle="list"}}if(t.length&&this.roles.length){s=t.map(e=>{return this.roles.get(e).name})}var a=t=>{if(e[t].roleIds.indexOf(this.roleId)!==-1){this.bus.emit("selectNext",null)}else{this.bus.emit("selectNext",e[t].id)}};this.dom.setChoices(r,s,a,{timeout:i.timeout,nextStyle:i.nextStyle})};o.extOutput=function(e){alert("not coded ATM!")};o.extErrorOutput=function(e){alert("not coded ATM!")};o.textInput=function(e,t){var i={label:e};if(t.indexOf(this.roleId)===-1){i.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(i)}else{this.dom.textInput(i,e=>{this.bus.emit("textSubmit",e)})}};o.prototype.commandConfig=function(e){console.warn("Received command config:",e);if(e.enabled===true){this.dom.enableCommand(e=>{this.bus.emit(this.inGame?"command":"chat",e)})}else if(e.enabled===false){this.dom.disableCommand()}};o.pause=function(e){console.log("Received a pause event for",e,"seconds")};o.unpause=function(){console.log("Received an unpause event")};o.rejoinRoles=function(){};o.wait=function(e){switch(e){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoinRoles",()=>this.dom.clearHint());break;default:this.dom.setBigHint("WAITING FOR "+e,{wait:true,"pulse-animation":true})}};o.theme=function(e){if(!e.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(e)};o.image=function(e){this.dom.setSceneImage(e)};o.defineAnimation=function(e,t){this.dom.defineAnimation(e,t)};o.showSprite=function(e,t,i){if(!t.url||typeof t.url!=="string"){i();return}t.actionCallback=o.spriteActionCallback.bind(this);this.dom.showSprite(e,t).then(i)};o.spriteActionCallback=function(e){console.warn("Sprite action triggered: ",e);this.bus.emit("action",e)};o.updateSprite=function(e,t,i){this.dom.updateSprite(e,t).then(i)};o.animateSprite=function(e,t,i){this.dom.animateSprite(e,t).then(i)};o.clearSprite=function(e){this.dom.clearSprite(e)};o.showVg=function(e,t){if((!t.url||typeof t.url!=="string")&&(!t.vgObject||typeof t.vgObject!=="object")){return}t.actionCallback=o.vgActionCallback.bind(this);this.dom.showVg(e,t)};o.vgActionCallback=function(e){console.warn("VG action triggered: ",e);this.bus.emit("action",e)};o.updateVg=function(e,t){this.dom.updateVg(e,t)};o.animateVg=function(e,t){this.dom.animateVg(e,t)};o.clearVg=function(e){this.dom.clearVg(e)};o.showMarker=function(e,t){if(!t.url||typeof t.url!=="string"){return}t.actionCallback=o.markerActionCallback.bind(this);this.dom.showMarker(e,t)};o.markerActionCallback=function(e){console.warn("Marker action triggered: ",e);this.bus.emit("action",e)};o.updateMarker=function(e,t){this.dom.updateMarker(e,t)};o.animateMarker=function(e,t){this.dom.animateMarker(e,t)};o.clearMarker=function(e){this.dom.clearMarker(e)};o.showCard=function(e,t){if(!t.url||typeof t.url!=="string"){return}t.actionCallback=o.cardActionCallback.bind(this);this.dom.showCard(e,t)};o.cardActionCallback=function(e){console.warn("Card action triggered: ",e);this.bus.emit("action",e)};o.updateCard=function(e,t){this.dom.updateCard(e,t)};o.animateCard=function(e,t){this.dom.animateCard(e,t)};o.clearCard=function(e){this.dom.clearCard(e)};o.sound=function(e){this.dom.sound(e)};o.music=function(e){this.dom.music(e)};o.end=function(e,t,i){var n={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};var r=()=>{if(this.ended){return}this.ended=true;console.log("finished!");this.emit("end");i()};switch(e){case"end":this.dom.setDialog("The End.",n,r);break;case"win":this.dom.setDialog("You Win!",n,r);break;case"lost":this.dom.setDialog("You Lose...",n,r);break;case"draw":this.dom.setDialog("Draw.",n,r);break}};o.custom=function(e,t){console.log("Received a custom event",e,t)};o.exit=function(e,t,i){console.log("exit cb",i);this.once("end",()=>{setTimeout(200,i)})}},{"../Dom.js":1,"../toolkit.js":3,"nextgen-events/lib/browser.js":11}],5:[function(e,t,i){"use strict";i.toClassObject=function e(t){var i={};if(!t){return i}if(typeof t==="string"){i[t]=true;return i}if(typeof t==="object"){if(Array.isArray(t)){t.forEach(e=>i[e]=true);return i}return t}return i}},{}],6:[function(e,t,i){},{}],7:[function(e,t,i){(function(i){"use strict";var n,r;if(i.browser){n=new DOMParser;r=new XMLSerializer}else{var s=e("@cronvel/xmldom");n=new s.DOMParser;r=new s.XMLSerializer}var o={};t.exports=o;o.ready=function(e){document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t,false);e()},false)};o.fromXml=function(e){return n.parseFromString(e,"application/xml")};o.toXml=function(e){return r.serializeToString(e)};o.fromHtml=function(e){var t,i,n;n=document.createDocumentFragment();i=document.createElement("div");i.insertAdjacentHTML("beforeend",e);for(t=0;t<i.children.length;t++){n.appendChild(i.children[t])}return n};o.appendJs=function(e){var t=document.createElement("script");t.setAttribute("src",e);document.body.appendChild(t)};o.batch=function(e,t,...i){var n;if(t instanceof Element){e(t,...i)}else if(Array.isArray(t)){for(n=0;n<t.length;n++){e(t[n],...i)}}else if(t instanceof NodeList||t instanceof NamedNodeMap){for(n=0;n<t.length;n++){e(t[n],...i)}}};o.css=function(e,t){var i;for(i in t){e.style[i]=t[i]}};o.attr=function(e,t,i){var n;i=i||"";for(n in t){if(t[n]===null){e.removeAttribute(i+n)}else{e.setAttribute(i+n,t[n])}}};o.class=function(e,t,i){var n;i=i||"";for(n in t){if(t[n]){e.classList.add(i+n)}else{e.classList.remove(i+n)}}};o.remove=function(e){e.parentNode.removeChild(e)};o.empty=function(e){while(e.firstChild){e.removeChild(e.firstChild)}};o.cloneInto=function(e,t){o.empty(t);t.appendChild(e.cloneNode(true))};o.insertInto=function(e,t){o.empty(t);t.appendChild(e)};o.moveChildrenInto=function(e,t){o.empty(t);while(e.firstChild){t.appendChild(e.firstChild)}};o.moveAttributes=function(e,t){Array.from(e.attributes).forEach(i=>{var n=i.name;var r=i.value;e.removeAttribute(n);if(n!=="xmlns"&&n.indexOf(":")===-1&&r){t.setAttribute(n,r)}})};o.styleToAttribute=function(e,t,i){if(e.style[t]&&(!i||i.indexOf(e.style[t])===-1)){e.setAttribute(t,e.style[t]);e.style[t]=null}};o.prefixIds=function(e,t){var i,n={};i=e.querySelectorAll("*");o.batch(o.prefixIds.idAttributePass,i,t,n);o.batch(o.prefixIds.otherAttributesPass,i,n)};o.prefixIds.idAttributePass=function(e,t,i){i[e.id]=t+"."+e.id;e.id=i[e.id]};o.prefixIds.otherAttributesPass=function(e,t){o.batch(o.prefixIds.oneAttributeSubPass,e.attributes,t)};o.prefixIds.oneAttributeSubPass=function(e,t){e.value=e.value.replace(/url\(#([^)]+)\)/g,(e,i)=>{if(!t[i]){return e}return"url(#"+t[i]+")"})};o.removeAllTags=function(e,t,i){Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!i||!e.firstChild){e.parentNode.removeChild(e)}})};o.removeAllAttributes=function(e,t){e.removeAttribute(t);Array.from(e.querySelectorAll("["+t+"]")).forEach(e=>{e.removeAttribute(t)})};o.preload=function(e){if(!Array.isArray(e)){e=[e]}e.forEach(e=>{if(o.preload.preloaded[e]){return}o.preload.preloaded[e]=new Image;o.preload.preloaded[e].src=e})};o.preload.preloaded={};o.filterByNamespace=function(e,t){var i,n,r,s,a;if(!t||typeof t!=="object"){return}o.filterAttributesByNamespace(e,t);for(i=e.childNodes.length-1;i>=0;i--){n=e.childNodes[i];if(n.nodeType===1){if(n.tagName.indexOf(":")!==-1){a=n.tagName.split(":");r=a[0];s=a[1];if(r===t.primary){n.tagName=s;o.filterByNamespace(n,t)}else if(t.whitelist){if(t.whitelist.indexOf(r)!==-1){o.filterByNamespace(n,t)}else{e.removeChild(n)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeChild(n)}else{o.filterByNamespace(n,t)}}else{o.filterByNamespace(n,t)}}else{o.filterByNamespace(n,t)}}}};o.filterAttributesByNamespace=function(e,t){var i,n,r,s,o,a;if(!t||typeof t!=="object"){return}for(i=e.attributes.length-1;i>=0;i--){n=e.attributes[i];if(n.name.indexOf(":")!==-1){a=n.name.split(":");r=a[0];s=a[1];o=n.value;if(r===t.primary){e.removeAttributeNode(n);e.setAttribute(s,o)}else if(t.whitelist){if(t.whitelist.indexOf(r)===-1){e.removeAttributeNode(n)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeAttributeNode(n)}}}}};o.removeComments=function(e){var t,i;for(t=e.childNodes.length-1;t>=0;t--){i=e.childNodes[t];if(i.nodeType===8){e.removeChild(i)}else if(i.nodeType===1){o.removeComments(i)}}};o.removeWhiteSpaces=function(e,t){var i,n,r=null;for(i=e.childNodes.length-1;i>=0;i--){n=e.childNodes[i];if(n.nodeType===3){if(t){if(r){r.nodeValue=(n.nodeValue+r.nodeValue).replace(/^\s*(\n[\t ]*)$/,"$1");e.removeChild(n)}else{n.nodeValue=n.nodeValue.replace(/^\s*(\n[\t ]*)$/,"$1");r=n}}else if(!/\S/.test(n.nodeValue)){e.removeChild(n)}}else if(n.nodeType===1){r=null;o.removeWhiteSpaces(n,t)}else{r=null}}};o.parseMatrix=function(e){var t=e.match(/(matrix|matrix3d)\(([0-9., -]+)\)/);if(!t){return null}return t[2].trim().split(/ ?, ?/).map(e=>{return parseFloat(e)})};o.decomposeMatrix=function(e){if(e.length===6){return o.decomposeMatrix2d(e)}if(e.length===16){return o.decomposeMatrix3d(e)}return null};o.decomposeMatrix2d=function(e){var t=Math.atan2(e[1],e[0]),i=e[0]*e[0]+e[1]*e[1],n=Math.sqrt(i),r=(e[0]*e[3]-e[2]*e[1])/n,s=Math.atan2(e[0]*e[2]+e[1]*e[3],i);return{rotate:180*t/Math.PI,scaleX:n,scaleY:r,skewX:180*s/Math.PI,skewY:0,translateX:e[4],translateY:e[5]}};o.decomposeMatrix3d=function(e){var t=Math.PI/180;var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);var s=Math.atan2(-e[9]/r,e[10]/r)/t,o=Math.asin(e[8]/r)/t,a=Math.atan2(-e[4]/n,e[0]/i)/t;if(e[4]===1||e[4]===-1){s=0;o=e[4]*-Math.PI/2;a=e[4]*Math.atan2(e[6]/n,e[5]/n)/t}var l=e[12]/i,c=e[13]/i,u=e[14]/i;return{translateX:l,translateY:c,translateZ:u,rotateX:s,rotateY:o,rotateZ:a,scaleX:i,scaleY:n,scaleZ:r}};o.stringifyTransform=function(e){var t=[];if(e.translateX){t.push("translateX("+e.translateX+"px)")}if(e.translateY){t.push("translateY("+e.translateY+"px)")}if(e.translateZ){t.push("translateZ("+e.translateZ+"px)")}if(e.rotate){t.push("rotate("+e.rotate+"deg)")}else{if(e.rotateX){t.push("rotateX("+e.rotateX+"deg)")}if(e.rotateY){t.push("rotateY("+e.rotateY+"deg)")}if(e.rotateZ){t.push("rotateZ("+e.rotateZ+"deg)")}}if(e.scale){t.push("scale("+e.scale+")")}else{if(e.scaleX){t.push("scaleX("+e.scaleX+")")}if(e.scaleY){t.push("scaleY("+e.scaleY+")")}if(e.scaleZ){t.push("scaleZ("+e.scaleZ+")")}}if(e.skewX){t.push("skewX("+e.skewX+"deg)")}if(e.skewY){t.push("skewY("+e.skewY+"deg)")}return t.join(" ")};o.transform=function(e,t){e.style.transform=o.stringifyTransform(t)};o.id=function(e,t){e.id=t};o.text=function(e,t){e.textContent=t};o.html=function(e,t){e.innerHTML=t}}).call(this,e("_process"))},{"@cronvel/xmldom":6,_process:13}],8:[function(e,t,i){t.exports=function(e){return e!=null&&(n(e)||r(e)||!!e._isBuffer)};function n(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function r(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&n(e.slice(0,0))}},{}],9:[function(e,t,i){(function(i,n,r){"use strict";const s=i.browser?window.setImmediate:i.nextTick;if(!n.__NEXTGEN_EVENTS__){n.__NEXTGEN_EVENTS__={recursions:0}}var o=n.__NEXTGEN_EVENTS__;function a(){}t.exports=a;a.prototype.__prototypeUID__="nextgen-events/NextGenEvents";a.prototype.__prototypeVersion__=e("../package.json").version;a.SYNC=-Infinity;a.DESYNC=-1;a.defaultMaxListeners=Infinity;a.init=function(){Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal})};a.Internal=function(e){this.nice=a.SYNC;this.interruptible=false;this.contexts={};this.desync=r;this.depth=0;this.states={};this.stateGroups={};this.listeners={error:[],interrupt:[],newListener:[],removeListener:[]};this.hasListenerPriority=false;this.maxListeners=a.defaultMaxListeners;if(e){this.nice=e.nice;this.interruptible=e.interruptible;Object.assign(this.states,e.states),Object.assign(this.stateGroups,e.stateGroups),Object.keys(e.listeners).forEach(t=>{this.listeners[t]=e.listeners[t].slice()});Object.keys(e.contexts).forEach(t=>{var i=e.contexts[t];this.contexts[t]={nice:i.nice,ready:true,status:i.status,serial:i.serial,scopes:{}}})}};a.initFrom=function(e){if(!e.__ngev){a.init.call(e)}Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal(e.__ngev)})};a.mergeListeners=function(e){if(!this.__ngev){a.init.call(this)}var t=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(t).forEach(e=>{this.__ngev.listeners[e]=[]});e.forEach(e=>{if(!e.__ngev){a.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(i=>{var n,r,s=[];if(t[i]){t[i].forEach(t=>{for(n=0,r=e.length;n<r;n++){if(!e[n].__ngev.listeners[i]||e[n].__ngev.listeners[i].indexOf(t)===-1){s.push(t);break}}})}e.forEach(e=>{e.__ngev.listeners[i].forEach(e=>{if(this.__ngev.listeners[i].indexOf(e)===-1&&s.indexOf(e)===-1){this.__ngev.listeners[i].push(e)}})})})};a.filterOutCallback=function(e,t){return e!==t};a.prototype.addListener=function(e,t,n){var r,s;if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}if(!e||typeof e!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof t==="function"){r={};if(!n||typeof n!=="object"){n={}}}else if(n===true&&t&&typeof t==="object"){n=r=t;t=undefined}else{n=t;if(!n||typeof n!=="object"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}t=undefined;r={}}r.fn=t||n.fn;r.id=n.id!==undefined?n.id:r.fn;r.once=!!n.once;r.async=!!n.async;r.eventObject=!!n.eventObject;r.nice=n.nice!==undefined?Math.floor(n.nice):a.SYNC;r.priority=+n.priority||0;r.context=n.context&&(typeof n.context==="string"||typeof n.context==="object")?n.context:null;if(typeof r.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(typeof r.context==="string"){r.context=this.__ngev.contexts[r.context]||this.addListenerContext(r.context)}r.event=e;if(this.__ngev.listeners.newListener.length){s=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[e].push(r);a.emitEvent({emitter:this,name:"newListener",args:[[r]],listeners:s});if(this.__ngev.states[e]){a.emitToOneListener(this.__ngev.states[e],r)}return this}this.__ngev.listeners[e].push(r);if(this.__ngev.hasListenerPriority){this.__ngev.listeners[e].sort((e,t)=>t.priority-e.priority)}if(this.__ngev.listeners[e].length===this.__ngev.maxListeners+1){i.emitWarning("Possible NextGenEvents memory leak detected. "+this.__ngev.listeners[e].length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit",{type:"MaxListenersExceededWarning"})}if(this.__ngev.states[e]){a.emitToOneListener(this.__ngev.states[e],r)}return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function(e,t,i){if(t&&typeof t==="object"){t.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.addListener(e,t,i)};a.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),{once:true})})};a.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),{once:true})})};a.prototype.removeListener=function(e,t){var i,n,r=[],s=[];if(!e||typeof e!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}n=this.__ngev.listeners[e].length;for(i=0;i<n;i++){if(this.__ngev.listeners[e][i].id===t){s.push(this.__ngev.listeners[e][i])}else{r.push(this.__ngev.listeners[e][i])}}this.__ngev.listeners[e]=r;if(s.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",s)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(e){var t;if(!this.__ngev){a.init.call(this)}if(e){if(!e||typeof e!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}t=this.__ngev.listeners[e];this.__ngev.listeners[e]=[];if(t.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",t)}}else{this.__ngev.listeners={error:[],interrupt:[],newListener:[],removeListener:[]}}return this};a.listenerWrapper=function(e,t,i,n,r){var s,l,c=t.master||t,u=!!t.master||t.emitter.__ngev.interruptible;if(c.interrupt){return}if(e.async){if(i){i.ready=!n}if(r<0){if(o.recursions>=-r){t.emitter.__ngev.desync(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC));return}}else{setTimeout(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC),r);return}l=(e=>{c.listenersDone++;if(e&&u&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=e;if(c.callback){a.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){a.emitCallback(t)}if(n){a.processScopeQueue(i,true,true)}});if(e.eventObject){e.fn(t,l)}else{s=e.fn(...t.args,l)}}else{if(r<0){if(o.recursions>=-r){t.emitter.__ngev.desync(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC));return}}else{setTimeout(a.listenerWrapper.bind(undefined,e,t,i,n,a.SYNC),r);return}if(e.eventObject){e.fn(t)}else{s=e.fn(...t.args)}c.listenersDone++}if(s&&u&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=s;if(c.callback){a.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){a.emitCallback(t)}};var l=0;a.prototype.emit=function(...e){var t=a.createEvent(this,...e);return a.emitEvent(t)};a.prototype.waitForEmit=function(...e){return new Promise(t=>{this.emit(...e,e=>t(e))})};a.createEvent=function(e,...t){var i={emitter:e,interrupt:null,master:null,sync:true};if(typeof t[0]==="number"){i.nice=Math.floor(t[0]);i.name=t[1];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(2,-1)}else{i.args=t.slice(2)}}else{i.name=t[0];if(!i.name||typeof i.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}if(typeof t[t.length-1]==="function"){i.callback=t[t.length-1];i.args=t.slice(1,-1)}else{i.args=t.slice(1)}}return i};a.emitEvent=function(e){var t=e.emitter,i,n,r=0,s,c;if(!t.__ngev){a.init.call(t)}s=t.__ngev.states[e.name];if(s!==undefined){if(s&&e.args.length===s.args.length&&e.args.every((e,t)=>e===s.args[t])){return}t.__ngev.stateGroups[e.name].forEach(e=>{t.__ngev.states[e]=null});t.__ngev.states[e.name]=e}if(!t.__ngev.listeners[e.name]){t.__ngev.listeners[e.name]=[]}e.id=l++;e.listenersDone=0;if(e.nice===undefined||e.nice===null){e.nice=t.__ngev.nice}if(!e.listeners){e.listeners=t.__ngev.listeners[e.name].slice()}o.recursions++;e.depth=t.__ngev.depth++;c=[];try{for(i=0,n=e.listeners.length;i<n;i++){r++;a.emitToOneListener(e,e.listeners[i],c)}}catch(e){o.recursions--;t.__ngev.depth--;throw e}o.recursions--;if(!e.callback){t.__ngev.depth--}if(c.length&&t.__ngev.listeners.removeListener.length){t.emit("removeListener",c)}if(!r){if(e.name==="error"){if(e.args[0]){throw e.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(e.callback){a.emitCallback(e)}}e.sync=false;return e};a.emitIntricatedEvents=function(e,t){var i,n,r=0,s;if(!Array.isArray(e)){throw new TypeError(".emitCorrelatedEvents() argument should be an array")}var c=[],u={nice:a.DESYNC,ready:true,status:a.CONTEXT_ENABLED,serial:true,scopes:{}},h={sync:false,nice:a.DESYNC,context:u,interrupt:null,listeners:c,listenersDone:0,depth:0,callback:t};e.forEach(e=>{var t=a.createEvent(...e);t.master=h;if(!t.emitter.__ngev){a.init.call(t.emitter)}if(!t.emitter.__ngev.listeners[t.name]){t.emitter.__ngev.listeners[t.name]=[]}t.listeners=t.emitter.__ngev.listeners[t.name].slice();t.id=l++;t.listeners.forEach(e=>c.push({event:t,listener:e}))});c.sort((e,t)=>t.listener.priority-e.listener.priority);o.recursions++;s=[];try{for(i=0,n=c.length;i<n;i++){r++;a.emitToOneListener(c[i].event,c[i].listener,s)}}catch(e){o.recursions--;throw e}o.recursions--;if(!r&&h.callback){a.emitCallback(event)}h.sync=false};a.emitToOneListener=function(e,t,i){var n=e.emitter,r=e.master||e,s=e.master?e.master.context:t.context,o,l,c,u=false;if(s){if(s.status===a.CONTEXT_DISABLED){return}c=Math.max(r.nice,t.nice,s.nice);l=s.serial;o=a.getContextScope(s,r.depth)}else{c=Math.max(r.nice,t.nice)}if(t.once){n.__ngev.listeners[e.name]=n.__ngev.listeners[e.name].filter(a.filterOutCallback.bind(undefined,t));if(i){i.push(t)}else{u=true}}if(s&&(s.status===a.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:e,listener:t,nice:c})}else{a.listenerWrapper(t,e,o,l,c)}if(u&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",[t])}};a.emitCallback=function(e){var t;if(e.master){t=e.master.callback;delete e.master.callback;if(e.master.sync){s(()=>t(e.master.interrupt,e))}else{t(e.master.interrupt,e)}return}t=e.callback;delete e.callback;if(e.sync&&e.emitter.__ngev.nice!==a.SYNC){e.emitter.__ngev.desync(()=>{e.emitter.__ngev.depth--;t(e.interrupt,e)})}else{e.emitter.__ngev.depth--;t(e.interrupt,e)}};a.prototype.listeners=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].slice()};a.listenerCount=function(e,t){if(!e||!(e instanceof a)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};a.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};a.prototype.setNice=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.nice=Math.floor(+e||0)};a.prototype.desyncUseNextTick=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.desync=e?s:r};a.prototype.setInterruptible=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.interruptible=!!e};a.prototype.setListenerPriority=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.hasListenerPriority=!!e};a.share=function(e,t){if(!(e instanceof a)||!(t instanceof a)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){a.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};a.reset=function(e){Object.defineProperty(e,"__ngev",{configurable:true,value:null})};a.prototype.getMaxListeners=function(){if(!this.__ngev){a.init.call(this)}return this.__ngev.maxListeners};a.prototype.setMaxListeners=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.maxListeners=typeof e==="number"&&!Number.isNaN(e)?Math.floor(e):a.defaultMaxListeners;return this};a.noop=(()=>undefined);a.prototype.defineStates=function(...e){if(!this.__ngev){a.init.call(this)}e.forEach(t=>{this.__ngev.states[t]=null;this.__ngev.stateGroups[t]=e})};a.prototype.hasState=function(e){if(!this.__ngev){a.init.call(this)}return!!this.__ngev.states[e]};a.prototype.getAllStates=function(){if(!this.__ngev){a.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>this.__ngev.states[e])};a.groupAddListener=function(e,t,i,n){if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;e.forEach(e=>{e.addListener(t,i.bind(undefined,e),n)})};a.groupOn=a.groupAddListener;a.groupOnce=function(e,t,i,n){if(i&&typeof i==="object"){i.once=true}else if(n&&typeof n==="object"){n.once=true}else{n={once:true}}return this.groupAddListener(e,t,i,n)};a.groupWaitFor=function(e,t){return Promise.all(e.map(e=>e.waitFor(t)))};a.groupWaitForAll=function(e,t){return Promise.all(e.map(e=>e.waitForAll(t)))};a.groupOnceFirst=function(e,t,i,n){var r,s=false;if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;r=((...r)=>{if(s){return}s=true;a.groupRemoveListener(e,t,n.id);i(...r)});e.forEach(e=>{e.once(t,r.bind(undefined,e),n)})};a.groupWaitForFirst=function(e,t){return new Promise(i=>{a.groupOnceFirst(e,t,e=>i(e))})};a.groupWaitForFirstAll=function(e,t){return new Promise(i=>{a.groupOnceFirst(e,t,(...e)=>i(e))})};a.groupOnceLast=function(e,t,i,n){var r,s=false,o=e.length;if(typeof i!=="function"){n=i;i=undefined}if(!n||typeof n!=="object"){n={}}i=i||n.fn;delete n.fn;n.id=n.id||i;r=((...e)=>{if(s){return}if(--o){return}s=true;i(...e)});e.forEach(e=>{e.once(t,r.bind(undefined,e),n)})};a.groupWaitForLast=function(e,t){return new Promise(i=>{a.groupOnceLast(e,t,e=>i(e))})};a.groupWaitForLastAll=function(e,t){return new Promise(i=>{a.groupOnceLast(e,t,(...e)=>i(e))})};a.groupRemoveListener=function(e,t,i){e.forEach(e=>{e.removeListener(t,i)})};a.groupOff=a.groupRemoveListener;a.groupRemoveAllListeners=function(e,t){e.forEach(e=>{e.removeAllListeners(t)})};a.groupEmit=function(e,...t){var i,n,r=1,s,o=e.length,l,c,u=false;if(typeof t[t.length-1]==="function"){s=-1;l=t[t.length-1];c=(e=>{if(u){return}if(e){u=true;l(e)}else if(!--o){u=true;l()}})}if(typeof t[0]==="number"){r=2;n=typeof t[0]}i=t[r-1];t=t.slice(r,s);e.forEach(e=>{a.emitEvent({emitter:e,name:i,args:t,nice:n,callback:c})})};a.groupWaitForEmit=function(e,...t){return new Promise(i=>{a.groupEmit(e,...t,e=>i(e))})};a.groupDefineStates=function(e,...t){e.forEach(e=>{e.defineStates(...t)})};a.groupGlobalOnce=a.groupOnceFirst;a.groupGlobalOnceAll=a.groupOnceLast;a.CONTEXT_ENABLED=0;a.CONTEXT_DISABLED=1;a.CONTEXT_QUEUED=2;a.prototype.addListenerContext=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!t||typeof t!=="object"){t={}}var i=this.__ngev.contexts[e];if(!i){i=this.__ngev.contexts[e]={nice:a.SYNC,ready:true,status:a.CONTEXT_ENABLED,serial:false,scopes:{}}}if(t.nice!==undefined){i.nice=Math.floor(t.nice)}if(t.status!==undefined){i.status=t.status}if(t.serial!==undefined){i.serial=!!t.serial}return i};a.prototype.getListenerContext=function(e){return this.__ngev.contexts[e]};a.getContextScope=function(e,t){var i=e.scopes[t];if(!i){i=e.scopes[t]={ready:true,queue:[]}}return i};a.prototype.disableListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=a.CONTEXT_DISABLED;return this};a.prototype.enableListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}var t=this.__ngev.contexts[e];t.status=a.CONTEXT_ENABLED;Object.values(t.scopes).forEach(e=>{if(e.queue.length>0){a.processScopeQueue(e,t.serial)}});return this};a.prototype.queueListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=a.CONTEXT_QUEUED;return this};a.prototype.serializeListenerContext=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].serial=t===undefined?true:!!t;return this};a.prototype.setListenerContextNice=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].nice=Math.floor(t);return this};a.prototype.destroyListenerContext=function(e){var t,i,n,r,s,o=[];if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}n=this.__ngev.contexts[e];if(!n){return}for(r in this.__ngev.listeners){s=null;i=this.__ngev.listeners[r].length;for(t=0;t<i;t++){if(this.__ngev.listeners[r][t].context===n){s=[];o.push(this.__ngev.listeners[r][t])}else if(s){s.push(this.__ngev.listeners[r][t])}}if(s){this.__ngev.listeners[r]=s}}delete this.__ngev.contexts[e];if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};a.processScopeQueue=function(e,t,i){var n,r,s,l;if(i){e.ready=true}o.recursions++;while(e.ready&&e.queue.length){n=e.queue.shift();r=n.event;s=r.master||r;l=r.emitter;if(s.interrupt){continue}a.listenerWrapper(n.listener,r,e,t,n.nice)}o.recursions--};a.on=a.prototype.on;a.once=a.prototype.once;a.off=a.prototype.off;if(n.AsyncTryCatch){a.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(a);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}a.Proxy=e("./Proxy.js")}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{"../package.json":12,"./Proxy.js":10,_process:13,timers:46}],10:[function(e,t,i){"use strict";function n(){this.localServices={};this.remoteServices={};this.nextAckId=1}t.exports=n;var r=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}n.create=((...e)=>new n(...e));n.prototype.addLocalService=function(e,t,i){this.localServices[e]=a.create(this,e,t,i);return this.localServices[e]};n.prototype.addRemoteService=function(e){this.remoteServices[e]=l.create(this,e);return this.remoteServices[e]};n.prototype.destroy=function(){Object.keys(this.localServices).forEach(e=>{this.localServices[e].destroy();delete this.localServices[e]});Object.keys(this.remoteServices).forEach(e=>{this.remoteServices[e].destroy();delete this.remoteServices[e]});this.receive=this.send=o};n.prototype.push=function(e){if(e.__type!==s||!e.service||typeof e.service!=="string"||!e.event||typeof e.event!=="string"||!e.method){return}switch(e.method){case"event":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveEvent(e);case"ackEmit":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveAckEmit(e);case"emit":return this.localServices[e.service]&&this.localServices[e.service].receiveEmit(e);case"listen":return this.localServices[e.service]&&this.localServices[e.service].receiveListen(e);case"ignore":return this.localServices[e.service]&&this.localServices[e.service].receiveIgnore(e);case"ackEvent":return this.localServices[e.service]&&this.localServices[e.service].receiveAckEvent(e);default:return}};n.prototype.receive=function(e){this.push(e)};n.prototype.send=function(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,i,n){return a.create(e,t,i,n)}n.LocalService=a;a.create=function(e,t,i,n){var s=Object.create(a.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:i,writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!n.listen,writable:true,enumerable:true},canEmit:{value:!!n.emit,writable:true,enumerable:true},canAck:{value:!!n.ack,writable:true,enumerable:true},canRpc:{value:!!n.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return s};a.prototype.destroy=function(){Object.keys(this.events).forEach(e=>{this.emitter.off(e,this.events[e]);delete this.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function(e){if(this.destroyed||!this.canEmit||e.ack&&!this.canAck){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(t=>{this.proxy.send({__type:s,service:this.id,method:"ackEmit",ack:e.ack,event:e.event,interruption:t})})}r.emitEvent(t)};a.prototype.receiveListen=function(e){if(this.destroyed||!this.canListen||e.ack&&!this.canAck){return}if(e.ack){if(this.events[e.event]){if(this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forwardWithAck.bind(this);this.events[e.event].ack=true;this.emitter.on(e.event,this.events[e.event],{eventObject:true,async:true})}else{if(this.events[e.event]){if(!this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forward.bind(this);this.events[e.event].ack=false;this.emitter.on(e.event,this.events[e.event],{eventObject:true})}};a.prototype.receiveIgnore=function(e){if(this.destroyed||!this.canListen){return}if(!this.events[e.event]){return}this.emitter.off(e.event,this.events[e.event]);this.events[e.event]=null};a.prototype.receiveAckEvent=function(e){if(this.destroyed||!this.canListen||!this.canAck||!e.ack||!this.events[e.event]||!this.events[e.event].ack){return}this.internalEvents.emit("ack",e)};a.forward=function(e){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,args:e.args})};a.forward.ack=false;a.forwardWithAck=function(e,t){if(this.destroyed){return}if(!e.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,args:e.args});t();return}var i=false;var n=this.proxy.nextAckId++;var r=e=>{if(i||e.ack!==n){return}i=true;this.internalEvents.off("ack",r);t()};this.internalEvents.on("ack",r);this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,ack:n,args:e.args})};a.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}n.RemoteService=l;var c=1;var u=2;l.create=function(e,t){var i=Object.create(l.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:Object.create(r.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return i};l.prototype.destroy=function(){this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(e=>{delete this.events[e]});this.destroyed=true};l.prototype.emit=function(e,...t){if(this.destroyed){return}var i,n,r;if(typeof e==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof t[t.length-1]!=="function"){this.proxy.send({__type:s,service:this.id,method:"emit",event:e,args:t});return}i=t.pop();n=this.proxy.nextAckId++;r=false;var o=e=>{if(r||e.ack!==n){return}r=true;this.internalEvents.off("ack",o);i(e.interruption)};this.internalEvents.on("ack",o);this.proxy.send({__type:s,service:this.id,method:"emit",ack:n,event:e,args:t})};l.prototype.addListener=function(e,t,i){if(this.destroyed){return}if(typeof t!=="function"){i=t;t=undefined}if(!i||typeof i!=="object"){i={}}i.fn=t||i.fn;this.emitter.addListener(e,i);if(!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length){return}if(i.async&&this.events[e]!==u){this.events[e]=u;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:e})}else if(!i.async&&!this.events[e]){this.events[e]=c;this.proxy.send({__type:s,service:this.id,method:"listen",event:e})}};l.prototype.on=l.prototype.addListener;l.prototype.once=r.prototype.once;l.prototype.removeListener=function(e,t){if(this.destroyed){return}this.emitter.removeListener(e,t);if((!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length)&&this.events[e]){this.events[e]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:e})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function(e){if(this.destroyed||!this.events[e.event]){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(()=>{this.proxy.send({__type:s,service:this.id,method:"ackEvent",ack:e.ack,event:e.event})})}r.emitEvent(t);var i=t.name;if(!this.emitter.__ngev.listeners[i]||!this.emitter.__ngev.listeners[i].length){this.events[i]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:i})}};l.prototype.receiveAckEmit=function(e){if(this.destroyed||!e.ack||this.events[e.event]!==u){return}this.internalEvents.emit("ack",e)}},{"./NextGenEvents.js":9}],11:[function(e,t,i){(function(i){"use strict";if(typeof window.setImmediate!=="function"){window.setImmediate=(e=>setTimeout(e,0))}if(!i.emitWarning){i.emitWarning=(()=>undefined)}t.exports=e("./NextGenEvents.js");t.exports.isBrowser=true}).call(this,e("_process"))},{"./NextGenEvents.js":9,_process:13}],12:[function(e,t,i){t.exports={_from:"nextgen-events@^1.2.1",_id:"nextgen-events@1.3.0",_inBundle:false,_integrity:"sha512-eBz5mrO4Hw2eenPVm0AVPHuAzg/RZetAWMI547RH8O9+a0UYhCysiZ3KoNWslnWNlHetb9kzowEshsKsmFo2YQ==",_location:"/nextgen-events",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"nextgen-events@^1.2.1",name:"nextgen-events",escapedName:"nextgen-events",rawSpec:"^1.2.1",saveSpec:null,fetchSpec:"^1.2.1"},_requiredBy:["#USER","/","/server-kit","/terminal-kit"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-1.3.0.tgz",_shasum:"a32665d1ab6f026448b19d75c4603ec20292fa22",_spec:"nextgen-events@^1.2.1",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cédric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},bundleDependencies:false,config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2019],owner:"Cédric Ronvel"},dependencies:{},deprecated:false,description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^16.2.2","uglify-js-es6":"^2.8.9",ws:"^5.1.1"},directories:{test:"test"},engines:{node:">=6.0.0"},homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",name:"nextgen-events",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"tea-time -R dot"},version:"1.3.0"}},{}],13:[function(e,t,i){var n=t.exports={};var r;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=o}}catch(e){r=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(e){s=a}})();function l(e){if(r===setTimeout){return setTimeout(e,0)}if((r===o||!r)&&setTimeout){r=setTimeout;return setTimeout(e,0)}try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}function c(e){if(s===clearTimeout){return clearTimeout(e)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var u=[];var h=false;var f;var p=-1;function d(){if(!h||!f){return}h=false;if(f.length){u=f.concat(u)}else{p=-1}if(u.length){m()}}function m(){if(h){return}var e=l(d);h=true;var t=u.length;while(t){f=u;u=[];while(++p<t){if(f){f[p].run()}}p=-1;t=u.length}f=null;h=false;c(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){t[i-1]=arguments[i]}}u.push(new g(e,t));if(u.length===1&&!h){l(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function y(){}n.on=y;n.addListener=y;n.once=y;n.off=y;n.removeListener=y;n.removeAllListeners=y;n.emit=y;n.prependListener=y;n.prependOnceListener=y;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],14:[function(t,i,n){(function(t){(function(r){var s=typeof n=="object"&&n&&!n.nodeType&&n;var o=typeof i=="object"&&i&&!i.nodeType&&i;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){r=a}var l,c=2147483647,u=36,h=1,f=26,p=38,d=700,m=72,g=128,y="-",v=/^xn--/,b=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=u-h,_=Math.floor,S=String.fromCharCode,C;function L(e){throw new RangeError(w[e])}function A(e,t){var i=e.length;var n=[];while(i--){n[i]=t(e[i])}return n}function j(e,t){var i=e.split("@");var n="";if(i.length>1){n=i[0]+"@";e=i[1]}e=e.replace(x,".");var r=e.split(".");var s=A(r,t).join(".");return n+s}function $(e){var t=[],i=0,n=e.length,r,s;while(i<n){r=e.charCodeAt(i++);if(r>=55296&&r<=56319&&i<n){s=e.charCodeAt(i++);if((s&64512)==56320){t.push(((r&1023)<<10)+(s&1023)+65536)}else{t.push(r);i--}}else{t.push(r)}}return t}function E(e){return A(e,function(e){var t="";if(e>65535){e-=65536;t+=S(e>>>10&1023|55296);e=56320|e&1023}t+=S(e);return t}).join("")}function T(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function I(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function M(e,t,i){var n=0;e=i?_(e/d):e>>1;e+=_(e/t);for(;e>k*f>>1;n+=u){e=_(e/k)}return _(n+(k+1)*e/(e+p))}function O(e){var t=[],i=e.length,n,r=0,s=g,o=m,a,l,p,d,v,b,x,w,k;a=e.lastIndexOf(y);if(a<0){a=0}for(l=0;l<a;++l){if(e.charCodeAt(l)>=128){L("not-basic")}t.push(e.charCodeAt(l))}for(p=a>0?a+1:0;p<i;){for(d=r,v=1,b=u;;b+=u){if(p>=i){L("invalid-input")}x=T(e.charCodeAt(p++));if(x>=u||x>_((c-r)/v)){L("overflow")}r+=x*v;w=b<=o?h:b>=o+f?f:b-o;if(x<w){break}k=u-w;if(v>_(c/k)){L("overflow")}v*=k}n=t.length+1;o=M(r-d,n,d==0);if(_(r/n)>c-s){L("overflow")}s+=_(r/n);r%=n;t.splice(r++,0,s)}return E(t)}function N(e){var t,i,n,r,s,o,a,l,p,d,v,b=[],x,w,k,C;e=$(e);x=e.length;t=g;i=0;s=m;for(o=0;o<x;++o){v=e[o];if(v<128){b.push(S(v))}}n=r=b.length;if(r){b.push(y)}while(n<x){for(a=c,o=0;o<x;++o){v=e[o];if(v>=t&&v<a){a=v}}w=n+1;if(a-t>_((c-i)/w)){L("overflow")}i+=(a-t)*w;t=a;for(o=0;o<x;++o){v=e[o];if(v<t&&++i>c){L("overflow")}if(v==t){for(l=i,p=u;;p+=u){d=p<=s?h:p>=s+f?f:p-s;if(l<d){break}C=l-d;k=u-d;b.push(S(I(d+C%k,0)));l=_(C/k)}b.push(S(I(l,0)));s=M(i,w,n==r);i=0;++n}}++i;++t}return b.join("")}function B(e){return j(e,function(e){return v.test(e)?O(e.slice(4).toLowerCase()):e})}function G(e){return j(e,function(e){return b.test(e)?"xn--"+N(e):e})}l={version:"1.4.1",ucs2:{decode:$,encode:E},decode:O,encode:N,toASCII:G,toUnicode:B};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return l})}else if(s&&o){if(i.exports==s){o.exports=l}else{for(C in l){l.hasOwnProperty(C)&&(s[C]=l[C])}}}else{r.punycode=l}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],15:[function(e,t,i){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,i,s){t=t||"&";i=i||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var l=1e3;if(s&&typeof s.maxKeys==="number"){l=s.maxKeys}var c=e.length;if(l>0&&c>l){c=l}for(var u=0;u<c;++u){var h=e[u].replace(a,"%20"),f=h.indexOf(i),p,d,m,g;if(f>=0){p=h.substr(0,f);d=h.substr(f+1)}else{p=h;d=""}m=decodeURIComponent(p);g=decodeURIComponent(d);if(!n(o,m)){o[m]=g}else if(r(o[m])){o[m].push(g)}else{o[m]=[o[m],g]}}return o};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],16:[function(e,t,i){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,i,a){t=t||"&";i=i||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(n(o))+i;if(r(e[o])){return s(e[o],function(e){return a+encodeURIComponent(n(e))}).join(t)}else{return a+encodeURIComponent(n(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(n(a))+i+encodeURIComponent(n(e))};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var i=[];for(var n=0;n<e.length;n++){i.push(t(e[n],n))}return i}var o=Object.keys||function(e){var t=[];for(var i in e){if(Object.prototype.hasOwnProperty.call(e,i))t.push(i)}return t}},{}],17:[function(e,t,i){"use strict";i.decode=i.parse=e("./decode");i.encode=i.stringify=e("./encode")},{"./decode":15,"./encode":16}],18:[function(e,t,i){(function(e,t){(function(t,i){"use strict";if(t.setImmediate){return}var n=1;var r={};var s=false;var o=t.document;var a;function l(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var i=0;i<t.length;i++){t[i]=arguments[i+1]}var s={callback:e,args:t};r[n]=s;a(n);return n++}function c(e){delete r[e]}function u(e){var t=e.callback;var n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(i,n);break}}function h(e){if(s){setTimeout(h,0,e)}else{var t=r[e];if(t){s=true;try{u(t)}finally{c(e);s=false}}}}function f(){a=function(t){e.nextTick(function(){h(t)})}}function p(){if(t.postMessage&&!t.importScripts){var e=true;var i=t.onmessage;t.onmessage=function(){e=false};t.postMessage("","*");t.onmessage=i;return e}}function d(){var e="setImmediate$"+Math.random()+"$";var i=function(i){if(i.source===t&&typeof i.data==="string"&&i.data.indexOf(e)===0){h(+i.data.slice(e.length))}};if(t.addEventListener){t.addEventListener("message",i,false)}else{t.attachEvent("onmessage",i)}a=function(i){t.postMessage(e+i,"*")}}function m(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;h(t)};a=function(t){e.port2.postMessage(t)}}function g(){var e=o.documentElement;a=function(t){var i=o.createElement("script");i.onreadystatechange=function(){h(t);i.onreadystatechange=null;e.removeChild(i);i=null};e.appendChild(i)}}function y(){a=function(e){setTimeout(h,0,e)}}var v=Object.getPrototypeOf&&Object.getPrototypeOf(t);v=v&&v.setTimeout?v:t;if({}.toString.call(t.process)==="[object process]"){f()}else if(p()){d()}else if(t.MessageChannel){m()}else if(o&&"onreadystatechange"in o.createElement("script")){g()}else{y()}v.setImmediate=l;v.clearImmediate=c})(typeof self==="undefined"?typeof t==="undefined"?this:t:self)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:13}],19:[function(e,t,i){"use strict";var n=e("./seventh.js");n.promisifyNodeApi=((e,t,i,r,s)=>{var o;t=t||"Async";i=i||"AsyncAll";r=r||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(s){o=[];for(let t in e){if(typeof e[t]==="function"){o.push(t)}}}else{o=Object.keys(e)}o.filter(t=>{if(typeof e[t]!=="function"){return false}for(let i in e[t].prototype){return false}return r(t,e)}).forEach(r=>{const s=r+t;const o=r+i;if(!e[s]){e[s]=n.promisify(e[r],e)}if(!e[o]){e[o]=n.promisifyAll(e[r],e)}})});n.promisifyAnyNodeApi=((e,t,i,r)=>{n.promisifyNodeApi(e,t,i,r,true)})},{"./seventh.js":25}],20:[function(e,t,i){"use strict";var n=e("./seventh.js");const r={};function s(){}n.all=(e=>{var t=-1,i=false,r=0,s=Infinity,o,a=[],l=new n;for(o of e){if(i){break}t++;(()=>{const e=t;n.resolve(o).then(t=>{if(i){return}a[e]=t;r++;if(r>=s){i=true;l._resolveValue(a)}},e=>{if(i){return}i=true;l.reject(e)})})()}s=t+1;if(!s){l._resolveValue(a)}return l});n._allArray=(e=>{var t=e.length;if(!t){n._resolveValue([])}var i,r={settled:false,count:0,length:t,values:[],allPromise:new n};for(i=0;!r.settled&&i<t;i++){n._allArrayOne(e[i],i,r)}return r.allPromise});n._allArrayOne=((e,t,i)=>{n._bareThen(e,e=>{if(i.settled){return}i.values[t]=e;i.count++;if(i.count>=i.length){i.settled=true;i.allPromise._resolveValue(i.values)}},e=>{if(i.settled){return}i.settled=true;i.allPromise.reject(e)})});n.every=n.map=((e,t)=>{var i=-1,r=false,s=0,o=Infinity,a,l=[],c=new n;for(a of e){if(r){break}i++;(()=>{const e=i;n.resolve(a).then(i=>{if(r){return}return t(i,e)}).then(t=>{if(r){return}l[e]=t;s++;if(s>=o){r=true;c._resolveValue(l)}},e=>{if(r){return}r=true;c.reject(e)})})()}o=i+1;if(!o){c._resolveValue(l)}return c});n.any=(e=>{var t=-1,i=false,r=0,s=Infinity,o,a=[],l=new n;for(o of e){if(i){break}t++;(()=>{const e=t;n.resolve(o).then(e=>{if(i){return}i=true;l._resolveValue(e)},t=>{if(i){return}a[e]=t;r++;if(r>=s){i=true;l.reject(a)}})})()}s=t+1;if(!s){l.reject(new RangeError("Promise.any(): empty array"))}return l});n.some=((e,t)=>{var i=-1,r=false,s=0,o=Infinity,a,l=[],c=new n;for(a of e){if(r){break}i++;(()=>{const e=i;n.resolve(a).then(i=>{if(r){return}return t(i,e)}).then(e=>{if(r){return}r=true;c._resolveValue(e)},t=>{if(r){return}l[e]=t;s++;if(s>=o){r=true;c.reject(l)}})})()}o=i+1;if(!o){c.reject(new RangeError("Promise.any(): empty array"))}return c});n.filter=((e,t)=>{var i=-1,s=false,o=0,a=Infinity,l,c=[],u=new n;for(l of e){if(s){break}i++;(()=>{const e=i;n.resolve(l).then(i=>{if(s){return}c[e]=i;return t(i,e)}).then(t=>{if(s){return}o++;if(!t){c[e]=r}if(o>=a){s=true;c=c.filter(e=>e!==r);u._resolveValue(c)}},e=>{if(s){return}s=true;u.reject(e)})})()}a=i+1;if(!a){u._resolveValue(c)}else if(o>=a){s=true;c=c.filter(e=>e!==r);u._resolveValue(c)}return u});n.foreach=n.forEach=function(e,t,i){var r=-1,o=arguments.length>=3,a=e[Symbol.iterator](),l=new n,c=n.resolve(i);if(n.warnUnhandledRejection){n._handleAll(e)}var u=()=>{c.then(e=>{let{value:i,done:s}=a.next();r++;if(s){l.resolve(e)}else{c=n.resolve(i).then(o?i=>t(e,i,r):e=>t(e,r));u()}},e=>{l.reject(e);for(;;){let{value:e,done:t}=a.next();if(t){break}if(n.isThenable(e)){e.then(s,s)}}})};u();return l};n.reduce=((e,t,i)=>{return n.forEach(e,t,i)});n.mapObject=((e,t)=>{var i=false,r=0,s,o,a=Object.keys(e),l=a.length,c,u={},h=new n;for(s=0;!i&&s<l;s++){o=a[s];c=e[o];(()=>{const e=o;n.resolve(c).then(n=>{if(i){return}return t(n,e)}).then(t=>{if(i){return}u[e]=t;r++;if(r>=l){i=true;h._resolveValue(u)}},e=>{if(i){return}i=true;h.reject(e)})})()}if(!l){h._resolveValue(u)}return h});n.concurrent=((e,t,i)=>{var r=-1,s=false,o=0,a=0,l=Infinity,c,u=false,h=[],f=t[Symbol.iterator](),p=new n;if(n.warnUnhandledRejection){n._handleAll(t)}e=e||1;const d=()=>{while(!u&&o<e){({value:c,done:u}=f.next());if(u){l=r+1;if(a>=l){s=true;p._resolveValue(h);return}break}if(s){break}r++;(()=>{const t=r;o++;n.resolve(c).then(e=>{if(s){return}return i(e,t)}).then(i=>{if(s){return}h[t]=i;a++;o--;if(a>=l){s=true;p._resolveValue(h);return}if(o<e){d();return}},e=>{if(s){return}s=true;p.reject(e)})})()}};d();if(r<0){p._resolveValue(h)}return p});n.race=(e=>{var t=false,i,r=new n;for(i of e){if(t){break}n.resolve(i).then(e=>{if(t){return}t=true;r._resolveValue(e)},e=>{if(t){return}t=true;r.reject(e)})}return r})},{"./seventh.js":25}],21:[function(e,t,i){(function(i,n,r){"use strict";const s=n.Promise;var o;if(!i.browser){o=i.nextTick}else{e("setimmediate");o=r}function a(e){this.fn=e;this._then=a._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}t.exports=a;a.Native=s;a.warnUnhandledRejection=true;a.prototype._exec=function(){this._then=a._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};a.prototype.resolve=a.prototype.fulfill=function(e){if(this._then.settled){return this}if(a.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};a.prototype._resolveValue=function(e){this._then=a._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};a.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};a.prototype.reject=function(e){if(this._then.settled){return this}this._then=a._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(a.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};a.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};a.prototype._execOneFulfillHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};a.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};a.prototype._execOneRejectHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};a.prototype.resolveTimeout=a.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};a.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};a._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var i=new a;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};a._dormantThen.settled=false;a._pendingThen=function(e,t){var i=new a;if(!this.thenHandlers){this.thenHandlers=[i,e,t]}else{this.thenHandlers[this.thenHandlers.length]=i;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return i};a._pendingThen.settled=false;a._fulfilledThen=function(e){if(!e){return this}var t=new a;o(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};a._fulfilledThen.settled=true;a._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var i=new a;o(()=>{try{i.resolve(t(this.value))}catch(e){i.reject(e)}});return i};a._rejectedThen.settled=true;a.prototype.then=function(e,t){return this._then(e,t)};a.prototype.catch=function(e=(()=>undefined)){return this._then(undefined,e)};a.prototype.finally=function(e){return this._then(e,e)};a.prototype.tap=a.prototype.tapThen=function(e){this._then(e,undefined);return this};a.prototype.tapCatch=function(e){this._then(undefined,e);return this};a.prototype.tapFinally=function(e){this._then(e,e);return this};a.prototype.fatal=function(){this._then(undefined,e=>{o(()=>{throw e})})};a.prototype.done=function(e,t){this._then(e,t).fatal();return this};a.prototype.callback=function(e){this._then(t=>{e(undefined,t)},t=>{e(t)}).fatal();return this};a.prototype.callbackAll=function(e){this._then(t=>{if(Array.isArray(t)){e(undefined,...t)}else{e(undefined,t)}},t=>{e(t)}).fatal();return this};a.callback=function(e){return new a((t,i)=>{e((e,n)=>{if(e){i(e)}else{t(n)}})})};a.callbackAll=function(e){return new a((t,i)=>{e((e,...n)=>{if(e){i(e)}else{t(n)}})})};a.prototype.toPromise=a.prototype.propagate=function(e){this._then(t=>{e.resolve(t)},t=>{e.reject(t)});return this};a.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};a.finally=function(e,t){return e.then(t,t)};a.resolve=a.fulfill=function(e){if(a.isThenable(e)){return a.fromThenable(e)}return a._resolveValue(e)};a._resolveValue=function(e){var t=new a;t._then=a._fulfilledThen;t.value=e;return t};a.reject=function(e){var t=new a;t._then=a._rejectedThen;t.value=e;return t};a.resolveTimeout=a.fulfillTimeout=function(e,t){return new a(i=>setTimeout(()=>i(t),e))};a.rejectTimeout=function(e,t){return new a((i,n)=>setTimeout(()=>n(t),e))};a.resolveNextTick=a.fulfillNextTick=function(e){return new a(t=>o(()=>t(e)))};a.rejectNextTick=function(e){return new a((t,i)=>o(()=>i(e)))};a.dormant=function(e){var t=new a;t.fn=e;return t};a.try=function(e){try{return a.resolve(e())}catch(e){return a.reject(e)}};a.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};a.fromThenable=function(e){if(e instanceof a){return e}return new a((t,i)=>{e.then(e=>{t(e)},e=>{i(e)})})};a._bareThen=function(e,t,i){if(e&&typeof e==="object"){if(e instanceof a){if(e._then===a._fulfilledThen){t(e.value)}else if(e._then===a._rejectedThen){i(e.value)}else{e._then(t,i)}}else if(typeof e.then==="function"){e.then(t,i)}else{t(e)}}else{t(e)}};a._handleAll=function(e){var t;for(t of e){if(a.isThenable(t)){t.handledRejection=true}}};a.prototype._unhandledRejection=function(){this.handledRejection=false;const e=e=>setTimeout(e,0);if(this.value instanceof Error){e(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let t=new Error("Unhandled promise rejection");e(()=>{if(this.handledRejection===false){console.error(t);console.error("Rejection reason:",this.value)}})}};a.prototype.getStatus=function(){switch(this._then){case a._dormantThen:return"dormant";case a._pendingThen:return"pending";case a._fulfilledThen:return"fulfilled";case a._rejectedThen:return"rejected"}};a.prototype.inspect=function(){switch(this._then){case a._dormantThen:return"Promise { <DORMANT> }";case a._pendingThen:return"Promise { <PENDING> }";case a._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case a._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};a.resolved=a.dummy=a.resolve();if(i.browser){a.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};a.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};a.resolveAtAnimationFrame=function(e){return new a(t=>window.requestAnimationFrame(()=>t(e)))};a.rejectAtAnimationFrame=function(e){return new a((t,i)=>window.requestAnimationFrame(()=>i(e)))}}}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{_process:13,setimmediate:18,timers:46}],22:[function(e,t,i){"use strict";var n=e("./seventh.js");n.promisifyAll=((e,t)=>{if(t){return(...i)=>{return new n((n,r)=>{e.call(t,...i,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}r(e)}else{n(t)}})})}}return function(...t){return new n((i,n)=>{e.call(this,...t,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}n(e)}else{i(t)}})})}});n.promisify=((e,t)=>{if(t){return(...i)=>{return new n((n,r)=>{e.call(t,...i,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}r(e)}else{n(t)}})})}}return function(...t){return new n((i,n)=>{e.call(this,...t,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}n(e)}else{i(t)}})})}});n.returnValueInterceptor=((e,t,i)=>{return function(...n){var r=t.call(i||this,...n);e(r);return r}});n.once=((e,t)=>{var i=false;var n;return function(...r){if(!i){i=true;n=e.call(t||this,...r)}return n}});n.serialize=((e,t)=>{var i=new n.resolve;return function(...r){var s=new n;i.finally(()=>{n.propagate(e.call(t||this,...r),s)});i=s;return s}});n.debounce=((e,t)=>{var i=null;const r=()=>{i=null};return function(...s){if(i){return i}i=e.call(t||this,...s);n.finally(i,r);return i}});n.debounceDelay=((e,t,i)=>{var r=null;const s=()=>{setTimeout(()=>r=null,e)};return function(...e){if(r){return r}r=t.call(i||this,...e);n.finally(r,s);return r}});n.debounceUpdate=((e,t)=>{var i=null;var r=null;var s=null;const o=()=>{var t,a;i=null;if(r){t=r;r=null;a=s;s=null;i=e.call(...t);n.propagate(i,a);n.finally(i,o);return i}};return function(...a){var l=t||this;if(i){if(!s){s=new n}r=[l,...a];return s}i=e.call(l,...a);n.finally(i,o);return i}});n.NO_DELAY={};n.BATCH_NO_DELAY={};n.debounceSync=((e,t)=>{var i=new Map;const r=e=>{var t=i.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null,noDelayBatches:new Set};i.set(e,t)}return t};const s=(e,i)=>{var r,o,a,l=new Date;e.inProgress=null;if(i>=2){e.lastFullSyncTime=e.lastTime=l}else if(i>=1){e.lastTime=l}if(e.nextFullSyncWith){if(t.delay&&e.lastFullSyncTime&&(r=l-e.lastFullSyncTime-t.delay)<0){e.inProgress=n.resolveTimeout(-r+1);e.inProgress.finally(()=>s(e,0));return e.nextFullSyncPromise}o=e.nextFullSyncWith;e.nextFullSyncWith=null;a=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=t.fn.call(...o);n.propagate(e.inProgress,a);n.finally(e.inProgress,()=>s(e,2));return e.inProgress}};const o=function(t,...i){var o=false,a=e.thisBinding||this,l=r(t);if(i[0]===n.NO_DELAY){o=true;i.shift()}else if(i[0]===n.BATCH_NO_DELAY){i.shift();let e=i.shift();if(!l.noDelayBatches.has(e)){l.noDelayBatches.add(e);o=true}}if(l.inProgress){return l.inProgress}if(!o&&e.delay&&l.lastTime&&new Date-l.lastTime<e.delay){if(typeof e.onDebounce==="function"){e.onDebounce(t,...i)}return l.last}l.last=l.inProgress=e.fn.call(a,t,...i);l.inProgressIsFull=false;n.finally(l.inProgress,()=>s(l,1));return l.inProgress};const a=function(e,...i){var o,a=false,l=t.thisBinding||this,c=r(e);if(i[0]===n.NO_DELAY){a=true;i.shift()}else if(i[0]===n.BATCH_NO_DELAY){i.shift();let e=i.shift();if(!c.noDelayBatches.has(e)){c.noDelayBatches.add(e);a=true}}if(!c.inProgress&&!a&&t.delay&&c.lastFullSyncTime&&(o=new Date-c.lastFullSyncTime-t.delay)<0){c.inProgress=n.resolveTimeout(-o+1);n.finally(c.inProgress,()=>s(c,0))}if(c.inProgress){if(!c.nextFullSyncPromise){c.nextFullSyncPromise=new n}c.nextFullSyncWith=[l,e,...i];return c.nextFullSyncPromise}c.lastFullSync=c.last=c.inProgress=t.fn.call(l,e,...i);n.finally(c.inProgress,()=>s(c,2));return c.inProgress};return[o,a]});n.timeout=((e,t,i)=>{return function(...n){var r=t.call(i||this,...n);setTimeout(()=>r.reject(new Error("Timeout")),e);return r}});n.variableTimeout=((e,t)=>{return function(i,...n){var r=e.call(t||this,...n);setTimeout(()=>r.reject(new Error("Timeout")),i);return r}})},{"./seventh.js":25}],23:[function(e,t,i){(function(t){"use strict";var i=e("./seventh.js");var n=false;i.asyncExit=function(e,r){if(n){return}n=true;var s=t.listeners("asyncExit");if(!s.length){t.exit(e);return}if(r===undefined){r=1e3}const o=t=>{if(t.length<3){t(e,r);return i.dummy}return new i(i=>{t(e,r,()=>{i()})})};i.map(s,o).finally(()=>t.exit(e));setTimeout(()=>t.exit(e),r)};i.resolveSafeTimeout=function(e,t){return new i(i=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>i(t),0)},e/2)},e/2)},0)})}}).call(this,e("_process"))},{"./seventh.js":25,_process:13}],24:[function(e,t,i){"use strict";var n=e("./seventh.js");n.parasite=(()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>n.Native.prototype[e]=n.prototype[e]);n.Native.prototype._then=n.Native.prototype.then})},{"./seventh.js":25}],25:[function(e,t,i){"use strict";const n=e("./core.js");t.exports=n;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./api.js":19,"./batch.js":20,"./core.js":21,"./decorators.js":22,"./misc.js":23,"./parasite.js":24,"./wrapper.js":26}],26:[function(e,t,i){"use strict";var n=e("./seventh.js");n.timeLimit=((e,t)=>{return new n((i,r)=>{if(typeof t==="function"){t=t()}n.resolve(t).then(i,r);setTimeout(()=>r(new Error("Timeout")),e)})});n.retry=((e,t)=>{var i=e.retries||1,r=e.coolDown||0,s=e.raiseFactor||1,o=e.maxCoolDown||Infinity,a=e.timeout||0,l=e.catch||null;const c=()=>{return(a?n.timeLimit(a,t):t()).catch(e=>{if(!i--){throw e}var t=r;r=Math.min(r*s,o);if(l){return n.resolve(l(e)).then(()=>n.resolveTimeout(t).then(c))}return n.resolveTimeout(t).then(c)})};return c()});n.onceEvent=((e,t)=>{return new n(i=>e.once(t,i))});n.onceEventAll=((e,t)=>{return new n(i=>e.once(t,(...e)=>i(e)))});n.onceEventOrError=((e,t,i,r=false)=>{return new n((n,s)=>{var o;var a=(...t)=>{e.removeListener("error",l);if(o){for(let t in o){e.removeListener(t,o[t])}}n(r?t:t[0])};var l=i=>{e.removeListener(t,a);if(o){for(let t in o){e.removeListener(t,o[t])}}s(i)};e.once(t,a);e.once("error",l);if(i){if(!Array.isArray(i)){i=[i]}o={};i.forEach(i=>{var n=(...n)=>{e.removeListener("error",l);e.removeListener(t,a);var r=new Error("Received an excluded event: "+i);r.event=i;r.eventArgs=n;s(r)};e.once(i,n);o[i]=n})}})});n.onceEventAllOrError=((e,t,i)=>{return n.onceEventOrError(e,t,i,true)})},{"./seventh.js":25}],27:[function(e,t,i){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",grey:"[90m",gray:"[90m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgGrey:"[100m",bgGray:"[100m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"}},{}],28:[function(e,t,i){"use strict";i.regExp=i.regExpPattern=(e=>e.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1"));i.regExpReplacement=(e=>e.replace(/\$/g,"$$$$"));i.format=(e=>e.replace(/%/g,"%%"));i.jsSingleQuote=(e=>i.control(e).replace(/'/g,"\\'"));i.jsDoubleQuote=(e=>i.control(e).replace(/"/g,'\\"'));i.shellArg=(e=>"'"+e.replace(/'/g,"'\\''")+"'");var n={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};i.control=((e,t=false)=>e.replace(/[\x00-\x1f\x7f]/g,e=>{if(t&&(e==="\n"||e==="\t")){return e}if(n[e]!==undefined){return n[e]}var i=e.charCodeAt(0).toString(16);if(i.length%2){i="0"+i}return"\\x"+i}));var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};i.html=(e=>e.replace(/[&<>]/g,e=>r[e]));i.htmlAttr=(e=>e.replace(/[&<>"]/g,e=>r[e]));i.htmlSpecialChars=(e=>e.replace(/[&<>"']/g,e=>r[e]));i.unicodePercentEncode=(e=>e.replace(/[\x00-\x1f\u0100-\uffff\x7f%]/g,e=>{try{return encodeURI(e)}catch(e){return""}}));i.httpHeaderValue=(e=>i.unicodePercentEncode(e))},{}],29:[function(e,t,i){(function(t){"use strict";const n=e("./inspect.js").inspect;const r=e("./inspect.js").inspectError;const s=e("./escape.js");const o=e("./ansi.js");const a=e("./unicode.js");const l=e("./naturalSort.js");i.formatMethod=function(...e){var t=e[0];if(typeof t!=="string"){if(!t){t=""}else if(typeof t.toString==="function"){t=t.toString()}else{t=""}}var i,n=1,r=e.length,s=false,o=null,a=[];if(this.markupReset&&this.startingMarkupReset){t=(typeof this.markupReset==="function"?this.markupReset(a):this.markupReset)+t}t=t.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,(t,l,u,h,f,p,d)=>{var m,g,v,b,x,w,k=[];if(u){return"%"}if(l){if(this.noMarkup){return"^"+l}if(l==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[l]){o=this.shiftMarkup[l];return""}if(o){if(!this.shiftedMarkup||!this.shiftedMarkup[o]||!this.shiftedMarkup[o][l]){return""}s=true;if(typeof this.shiftedMarkup[o][l]==="function"){m=this.shiftedMarkup[o][l](a)}else{m=this.shiftedMarkup[o][l];a.push(m)}o=null}else{if(!this.markup||!this.markup[l]){return""}s=true;if(typeof this.markup[l]==="function"){m=this.markup[l](a)}else{m=this.markup[l];a.push(m)}}return m}if(f){f=parseInt(f,10);if(h){if(h==="+"){f=n+f}else if(h==="-"){f=n-f}}}else{f=n}n++;if(f>=r||f<1){i=undefined}else{i=e[f]}if(c[d]){m=c[d](i,p,this);if(this.argumentSanitizer&&!c[d].noSanitize){m=this.argumentSanitizer(m)}if(p&&!c[d].noCommonModeArg){m=y(m,p)}return m}if(d==="F"){n--;if(p===undefined){return""}v=p.split(":");b=v[0];x=v[1];if(!b){return""}if(x&&(w=x.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(g=0;g<w.length;g++){h=w[g][1];f=w[g][2];if(f){f=parseInt(f,10);if(h){if(h==="+"){f=n+f}else if(h==="-"){f=n-f}}}else{f=n}n++;if(f>=r||f<1){k[g]=undefined}else{k[g]=e[f]}}}if(!this||!this.fn||typeof this.fn[b]!=="function"){return""}return this.fn[b].apply(this,k)}return""});if(s&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(a):this.markupReset}if(this.extraArguments){for(;n<r;n++){i=e[n];if(i===null||i===undefined){continue}else if(typeof i==="string"){t+=i}else if(typeof i==="number"){t+=i}else if(typeof i.toString==="function"){t+=i.toString()}}}return t};const c={};c.s=(e=>{if(typeof e==="string"){return e}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return e.toString()}return"("+e+")"});c.r=(e=>c.s(e));c.r.noSanitize=true;c.S=((e,t,n)=>{var r=e=>i.markupMethod.call(n,n.argumentSanitizer?n.argumentSanitizer(e):e);if(typeof e==="string"){return r(e)}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return r(e.toString())}return r("("+e+")")});c.S.noSanitize=true;c.S.noCommonModeArg=true;c.N=((e,i)=>{if(typeof e==="string"){return e}if(e===null||e===undefined||e===true||e===false||typeof e==="number"){return""+e}if(Array.isArray(e)){e=e.map(e=>c.N(e,true));if(i){return"["+e.join(",")+"]"}return e.join(", ")}if(t.isBuffer(e)){e=[...e].map(e=>{e=e.toString(16);if(e.length===1){e="0"+e}return e});return"<"+e.join(" ")+">"}var n=Object.getPrototypeOf(e);if(n===null||n===Object.prototype){e=Object.entries(e).sort(l).map(e=>e[0]+": "+c.N(e[1],true));if(i){return"{"+e.join(", ")+"}"}return e.join(", ")}if(typeof e.inspect==="function"){return e.inspect()}if(typeof e.toString==="function"){return e.toString()}return"("+e+")"});c.n=(e=>c.N(e,true));c.f=((e,t)=>{var i,n,r,s,o,a=0,l,c,u;if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}if(t){g.lastIndex=0;while(i=g.exec(t)){[,n,r]=i;if(n==="z"){u=+r}else if(!n){if(r[0]==="."){s=r[r.length-1];if(s==="!"){o=parseInt(r.slice(1,-1),10);a=10**-o;l=o}else if(s==="?"){o=parseInt(r.slice(1,-1),10);a=10**-o;l=o;c=true}else{o=parseInt(r.slice(1),10);a=10**-o}}else if(r[r.length-1]==="."){o=parseInt(r.slice(0,-1),10);a=10**o}else{o=parseInt(r,10);a=10**(Math.ceil(Math.log10(e+Number.EPSILON)+Number.EPSILON)-o)}}}}if(a){e=_(e,a)}if(l!==undefined&&(!c||e!==Math.trunc(e))){e=e.toFixed(l)}else{e=""+e}if(u){o=e.indexOf(".");if(o===-1){o=e.length}if(e[0]==="-"){if(o-1<u){e="-"+"0".repeat(1+u-o)+e.slice(1)}}else if(o<u){e="0".repeat(u-o)+e}}return e});c.f.noSanitize=true;c.e=((e,t)=>{var i,n,r;if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}if(t){g.lastIndex=0;if(i=g.exec(t)){[,n,r]=i;if(!n){return""+e.toExponential(parseInt(r,10)-1)}}}return""+e.toExponential()});c.e.noSanitize=true;c.d=c.i=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.floor(e)}return"0"});c.i.noSanitize=true;c.u=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0)}return"0"});c.u.noSanitize=true;c.U=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),1)}return"1"});c.U.noSanitize=true;c.k=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"0"}return A(e)});c.k.noSanitize=true;c.m=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"(NaN)"}var t="";if(e<0){t="-";e=-e}var i=k(e),n=e-i;if(!n){return t+i+"°"}var r=k(n*60),s=k(n*3600-r*60);if(s){return t+i+"°"+(""+r).padStart(2,"0")+"′"+(""+s).padStart(2,"0")+"″"}return t+i+"°"+(""+r).padStart(2,"0")+"′"});c.m.noSanitize=true;c.t=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"(NaN)"}var t=Math.floor(e/1e3);if(t<60){return t+"s"}var i=Math.floor(t/60);t=t%60;if(i<60){return i+"min"+(""+t).padStart(2,"0")+"s"}var n=Math.floor(i/60);i=i%60;return n+"h"+(""+i).padStart(2,"0")+"min"+(""+t).padStart(2,"0")+"s"});c.t.noSanitize=true;c.h=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(16)}return"0"});c.h.noSanitize=true;c.x=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"00"}var t=""+Math.max(Math.floor(e),0).toString(16);if(t.length%2){t="0"+t}return t});c.x.noSanitize=true;c.o=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(8)}return"0"});c.o.noSanitize=true;c.b=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(2)}return"0"});c.b.noSanitize=true;c.z=(e=>{if(typeof e==="string"){e=t.from(e)}else if(!t.isBuffer(e)){return""}return e.toString("base64")});c.Z=(e=>{if(typeof e==="string"){e=t.from(e)}else if(!t.isBuffer(e)){return""}return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"")});const u={};c.I=((e,t,i)=>v(e,t,i,u));c.I.noSanitize=true;const h={noFunc:true,enumOnly:true,noDescriptor:true,useInspect:true,useInspectPropertyBlackList:true};c.Y=((e,t,i)=>v(e,t,i,h));c.Y.noSanitize=true;const f={minimal:true,noIndex:true};c.O=((e,t,i)=>v(e,t,i,f));c.O.noSanitize=true;const p={};c.E=((e,t,i)=>v(e,t,i,p,true));c.E.noSanitize=true;c.J=(e=>e===undefined?"null":JSON.stringify(e));c.D=(()=>"");c.D.noSanitize=true;var d={argumentSanitizer:e=>s.control(e,true),extraArguments:true,color:false,noMarkup:false,endingMarkupReset:true,startingMarkupReset:false,markupReset:o.reset,shiftMarkup:{"#":"background"},markup:{":":o.reset," ":o.reset+" ","-":o.dim,"+":o.bold,_:o.underline,"/":o.italic,"!":o.inverse,b:o.blue,B:o.brightBlue,c:o.cyan,C:o.brightCyan,g:o.green,G:o.brightGreen,k:o.black,K:o.brightBlack,m:o.magenta,M:o.brightMagenta,r:o.red,R:o.brightRed,w:o.white,W:o.brightWhite,y:o.yellow,Y:o.brightYellow},shiftedMarkup:{background:{":":o.reset," ":o.reset+" ",b:o.bgBlue,B:o.bgBrightBlue,c:o.bgCyan,C:o.bgBrightCyan,g:o.bgGreen,G:o.bgBrightGreen,k:o.bgBlack,K:o.bgBrightBlack,m:o.bgMagenta,M:o.bgBrightMagenta,r:o.bgRed,R:o.bgBrightRed,w:o.bgWhite,W:o.bgBrightWhite,y:o.bgYellow,Y:o.bgBrightYellow}}};i.createFormatter=(e=>i.formatMethod.bind(Object.assign({},d,e)));i.format=i.formatMethod.bind(d);i.format.default=d;i.markupMethod=function(e){if(typeof e!=="string"){if(!e){e=""}else if(typeof e.toString==="function"){e=e.toString()}else{e=""}}var t=false,i=null,n=[];if(this.markupReset&&this.startingMarkupReset){e=(typeof this.markupReset==="function"?this.markupReset(n):this.markupReset)+e}e=e.replace(/\^(.?)/g,(e,r)=>{var s;if(r==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[r]){i=this.shiftMarkup[r];return""}if(i){if(!this.shiftedMarkup||!this.shiftedMarkup[i]||!this.shiftedMarkup[i][r]){return""}t=true;if(typeof this.shiftedMarkup[i][r]==="function"){s=this.shiftedMarkup[i][r](n)}else{s=this.shiftedMarkup[i][r];n.push(s)}i=null}else{if(!this.markup||!this.markup[r]){return""}t=true;if(typeof this.markup[r]==="function"){s=this.markup[r](n)}else{s=this.markup[r];n.push(s)}}return s});if(t&&this.markupReset&&this.endingMarkupReset){e+=typeof this.markupReset==="function"?this.markupReset(n):this.markupReset}return e};i.createMarkup=(e=>i.markupMethod.bind(Object.assign({},d,e)));i.markup=i.markupMethod.bind(d);i.format.count=function(e){var t,i,n,r=1,s=0;if(typeof e!=="string"){return 0}var o=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((t=o.exec(e))!==null){n=t[1];i=t[2];if(i){i=parseInt(i,10);if(n){if(n==="+"){i=r+i}else if(n==="-"){i=r-i}}}else{i=r}r++;if(s<i){s=i}}return s};i.format.hasFormatting=function(e){if(e.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}return false};const m=/([a-zA-Z])(.[^a-zA-Z]*)/g;const g=/([a-zA-Z]|^)(.[^a-zA-Z]*)/g;function y(e,t){var i,n,r;m.lastIndex=0;while(i=m.exec(t)){[,n,r]=i;if(n==="L"){let t=a.width(e);r=+r||1;if(t>r){e=a.truncateWidth(e,r-1).trim()+"…";t=a.width(e)}if(t<r){e=" ".repeat(r-t)+e}}else if(n==="R"){let t=a.width(e);r=+r||1;if(t>r){e=a.truncateWidth(e,r-1).trim()+"…";t=a.width(e)}if(t<r){e=e+" ".repeat(r-t)}}}return e}function v(e,t,i,s,o=false){var a,l,c,u,h,f=3,p=i&&i.color?"color":"none";if(t){g.lastIndex=0;while(a=g.exec(t)){[,l,c]=a;if(l==="c"){if(c==="+"){p="color"}else if(c==="-"){p="none"}}else if(l==="l"){u=parseInt(c,10)||undefined}else if(l==="s"){h=parseInt(c,10)||undefined}else if(!l){f=parseInt(c,10)||1}}}if(o){return r(Object.assign({depth:f,style:p,outputMaxLength:u,maxLength:h},s),e)}return n(Object.assign({depth:f,style:p,outputMaxLength:u,maxLength:h},s),e)}const b=1e-10;const x=Math.round(1/b);function w(e){return Math.round(e*x)/x}function k(e){return Math.floor(e+b)}function _(e,t){return w(t*Math.round(e*(1/t)))}const S=["","k","M","G","T","P","E","Z","Y"];const C=["","m","µ","n","p","f","a","z","y"];const L=[100,10,1];function A(e){var t,i,n,r,s;if(!e||e===1){return""+e}if(e<0){return"-"+A(-e)}if(e>1){t=Math.floor(Math.log10(e));i=Math.floor(t/3);n=t%3;r=j(e/Math.pow(1e3,i),L[n]);s=S[i]}else{t=Math.floor(Math.log10(e));i=Math.floor(t/3);n=t%3;if(n<0){n+=3}r=j(e/Math.pow(1e3,i),L[n]);s=C[-i]}return""+r+s}function j(e,t){return Math.round((e+Number.EPSILON)*t)/t}}).call(this,e("buffer").Buffer)},{"./ansi.js":27,"./escape.js":28,"./inspect.js":30,"./naturalSort.js":31,"./unicode.js":32,buffer:6}],30:[function(e,t,i){(function(t,n){"use strict";const r=e("./escape.js");const s=e("./ansi.js");const o={};function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var i={depth:0,ancestors:[]};if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(e.depth===undefined){e.depth=3}if(e.maxLength===undefined){e.maxLength=250}if(e.outputMaxLength===undefined){e.outputMaxLength=5e3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.noArrayProperty=true;e.enumOnly=true;e.proto=false;e.funcDetails=false}var n=l(i,e,t);if(n.length>e.outputMaxLength){n=e.style.truncate(n,e.outputMaxLength)}return n}function l(e,i,n){var s,a,u,f,p,d,m,g,y,v,b,x,w,k="",_="",S="",C,L;g=typeof n;v=i.style.tab.repeat(e.depth);if(g==="function"&&i.noFunc){return""}if(e.key!==undefined){if(e.descriptor){S=[];if(!e.descriptor.configurable){S.push("-conf")}if(!e.descriptor.enumerable){S.push("-enum")}if(!e.descriptor.writable){S.push("-w")}if(S.length){S=S.join(" ")}else{S=""}}if(e.keyIsProperty){if(c(e.key)){_='"'+i.style.key(e.key)+'": '}else{_=i.style.key(e.key)+": "}}else if(!i.noIndex){_=i.style.index(e.key)}if(S){S=" "+i.style.type(S)}}y=e.noPre?"":v+_;if(n===undefined){k+=y+i.style.constant("undefined")+S+i.style.newline}else if(n===o){k+=y+i.style.constant("[empty]")+S+i.style.newline}else if(n===null){k+=y+i.style.constant("null")+S+i.style.newline}else if(n===false){k+=y+i.style.constant("false")+S+i.style.newline}else if(n===true){k+=y+i.style.constant("true")+S+i.style.newline}else if(g==="number"){k+=y+i.style.number(n.toString())+(i.noType?"":" "+i.style.type("number"))+S+i.style.newline}else if(g==="string"){if(n.length>i.maxLength){k+=y+'"'+i.style.string(r.control(n.slice(0,i.maxLength-1)))+'…"'+(i.noType?"":" "+i.style.type("string")+i.style.length("("+n.length+" - TRUNCATED)"))+S+i.style.newline}else{k+=y+'"'+i.style.string(r.control(n))+'"'+(i.noType?"":" "+i.style.type("string")+i.style.length("("+n.length+")"))+S+i.style.newline}}else if(t.isBuffer(n)){k+=y+i.style.inspect(n.inspect())+(i.noType?"":" "+i.style.type("Buffer")+i.style.length("("+n.length+")"))+S+i.style.newline}else if(g==="object"||g==="function"){a=u="";x=false;if(g==="function"){x=true;a=" "+i.style.funcName(n.name?n.name:"(anonymous)");u=i.style.length("("+n.length+")")}b=false;if(Array.isArray(n)){b=true;u=i.style.length("("+n.length+")")}if(!n.constructor){d="(no constructor)"}else if(!n.constructor.name){d="(anonymous)"}else{d=n.constructor.name}d=i.style.constructorName(d);f=Object.getPrototypeOf(n);k+=y;if(!i.noType){if(e.forceType){k+=i.style.type(e.forceType)}else{k+=d+a+u+" "+i.style.type(g)+S}if(!x||i.funcDetails){k+=" "}}if(b&&i.noArrayProperty){p=[...Array(n.length).keys()]}else{p=Object.getOwnPropertyNames(n)}if(i.sort){p.sort()}w=h(n,e,i);if(i.protoBlackList&&i.protoBlackList.has(f)){k+=i.style.limit("[skip]")+i.style.newline}else if(w!==undefined){if(typeof w==="string"){k+="=> "+w+i.style.newline}else{k+="=> "+l({depth:e.depth,ancestors:e.ancestors,noPre:true},i,w)}}else if(x&&!i.funcDetails){k+=i.style.newline}else if(!p.length&&!i.proto){k+=(b?"[]":"{}")+i.style.newline}else if(e.depth>=i.depth){k+=i.style.limit("[depth limit]")+i.style.newline}else if(e.ancestors.indexOf(n)!==-1){k+=i.style.limit("[circular]")+i.style.newline}else{k+=(b&&i.noType&&i.noArrayProperty?"[":"{")+i.style.newline;L=e.ancestors.slice();L.push(n);for(s=0;s<p.length&&k.length<i.outputMaxLength;s++){if(!b&&(i.propertyBlackList&&i.propertyBlackList.has(p[s])||i.useInspectPropertyBlackList&&n.inspectPropertyBlackList instanceof Set&&n.inspectPropertyBlackList.has(p[s]))){continue}if(b&&i.noArrayProperty&&!(p[s]in n)){k+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:false},i,o)}else{try{C=Object.getOwnPropertyDescriptor(n,p[s]);if(!C.enumerable&&i.enumOnly){continue}m=!b||!C.enumerable||isNaN(p[s]);if(!i.noDescriptor&&C&&(C.get||C.set)){k+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:m,descriptor:C,forceType:"getter/setter"},i,{get:C.get,set:C.set})}else{k+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:m,descriptor:i.noDescriptor?undefined:C},i,n[p[s]])}}catch(t){k+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:m,descriptor:i.noDescriptor?undefined:C},i,t)}}if(s<p.length-1){k+=i.style.comma}}if(i.proto){k+=l({depth:e.depth+1,ancestors:L,key:"__proto__",keyIsProperty:true},i,f)}k+=v+(b&&i.noType&&i.noArrayProperty?"]":"}");k+=i.style.newline}}if(e.depth===0){if(i.style.trim){k=k.trim()}if(i.style==="html"){k=r.html(k)}}return k}i.inspect=a;function c(e){if(!e.length){return true}return false}var u=["pending","fulfilled","rejected"];function h(e,t,i){if(typeof e.constructor!=="function"){return}if(e instanceof String){return e.toString()}if(e instanceof RegExp){return e.toString()}if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}if(e instanceof Promise){if(n&&n.binding&&n.binding("util")&&n.binding("util").getPromiseDetails){let r=n.binding("util").getPromiseDetails(e);let s=u[r[0]];let o="Promise <"+s+">";if(s==="fulfilled"){o+=" "+l({depth:t.depth,ancestors:t.ancestors,noPre:true},i,r[1])}else if(s==="rejected"){if(r[1]instanceof Error){o+=" "+f({style:i.style,noErrorStack:true},r[1])}else{o+=" "+l({depth:t.depth,ancestors:t.ancestors,noPre:true},i,r[1])}}return o}}if(e._bsontype){return e.toString()}if(i.useInspect&&typeof e.inspect==="function"){return e.inspect()}return}function f(e,t){var i="",n,r,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"inspectError(): it's not an error, using regular variable inspection: "+a(e,t)}if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(t.stack&&!e.noErrorStack){n=p(e,t.stack)}r=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;i+=e.style.errorType(r)+(s?" ["+e.style.errorType(s)+"]":"")+": ";i+=e.style.errorMessage(t.message)+"\n";if(n){i+=e.style.errorStack(n)+"\n"}if(t.from){i+=e.style.newline+e.style.errorFromMessage("From error:")+e.style.newline+f(e,t.from)}return i}i.inspectError=f;function p(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(!t){return}if((e.browser||n.browser)&&t.indexOf("@")!==-1){t=t.replace(/[</]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,(t,i,n,r,s)=>{return e.style.errorStack("    at ")+(i?e.style.errorStackMethod(i)+" ":"")+e.style.errorStack("(")+(n?e.style.errorStackFile(n):e.style.errorStack("unknown"))+(r?e.style.errorStack(":")+e.style.errorStackLine(r):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:(?:(async|new)\s+)?([^\s:()[\]\n]+(?:\([^)]+\))?)\s)?(?:\[as ([^\s:()[\]\n]+)\]\s)?(?:\(?([^:()[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,(t,i,n,r,s,o,a,l)=>{return e.style.errorStack("    at ")+(n?e.style.errorStackKeyword(n)+" ":"")+(r?e.style.errorStackMethod(r)+" ":"")+(s?e.style.errorStack("[as ")+e.style.errorStackMethodAs(s)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(o?e.style.errorStackFile(o):e.style.errorStack("unknown"))+(a?e.style.errorStack(":")+e.style.errorStackLine(a):"")+(l?e.style.errorStack(":")+e.style.errorStackColumn(l):"")+e.style.errorStack(")")})}return t}i.inspectStack=p;var d={};var m=e=>e;d.none={trim:false,tab:"    ",newline:"\n",comma:"",limit:m,type:e=>"<"+e+">",constant:m,funcName:m,constructorName:e=>"<"+e+">",length:m,key:m,index:e=>"["+e+"] ",number:m,inspect:m,string:m,errorType:m,errorMessage:m,errorStack:m,errorStackKeyword:m,errorStackMethod:m,errorStackMethodAs:m,errorStackFile:m,errorStackLine:m,errorStackColumn:m,errorFromMessage:m,truncate:(e,t)=>e.slice(0,t-1)+"…"};d.inline=Object.assign({},d.none,{trim:true,tab:"",newline:" ",comma:", ",length:()=>"",index:()=>""});d.color=Object.assign({},d.none,{limit:e=>s.bold+s.brightRed+e+s.reset,type:e=>s.italic+s.brightBlack+e+s.reset,constant:e=>s.cyan+e+s.reset,funcName:e=>s.italic+s.magenta+e+s.reset,constructorName:e=>s.magenta+e+s.reset,length:e=>s.italic+s.brightBlack+e+s.reset,key:e=>s.green+e+s.reset,index:e=>s.blue+"["+e+"]"+s.reset+" ",number:e=>s.cyan+e+s.reset,inspect:e=>s.cyan+e+s.reset,string:e=>s.blue+e+s.reset,errorType:e=>s.red+s.bold+e+s.reset,errorMessage:e=>s.red+s.italic+e+s.reset,errorStack:e=>s.brightBlack+e+s.reset,errorStackKeyword:e=>s.italic+s.bold+e+s.reset,errorStackMethod:e=>s.brightYellow+e+s.reset,errorStackMethodAs:e=>s.yellow+e+s.reset,errorStackFile:e=>s.brightCyan+e+s.reset,errorStackLine:e=>s.blue+e+s.reset,errorStackColumn:e=>s.magenta+e+s.reset,errorFromMessage:e=>s.yellow+s.underline+e+s.reset,truncate:(e,t)=>{var i=s.gray+"…"+s.reset;e=e.slice(0,t-i.length);var n=e.lastIndexOf("");if(n>=e.length-6){e=e.slice(0,n)}return e+i}});d.html=Object.assign({},d.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",newline:"<br />",limit:e=>'<span style="color:red">'+e+"</span>",type:e=>'<i style="color:gray">'+e+"</i>",constant:e=>'<span style="color:cyan">'+e+"</span>",funcName:e=>'<i style="color:magenta">'+e+"</i>",constructorName:e=>'<span style="color:magenta">'+e+"</span>",length:e=>'<i style="color:gray">'+e+"</i>",key:e=>'<span style="color:green">'+e+"</span>",index:e=>'<span style="color:blue">['+e+"]</span> ",number:e=>'<span style="color:cyan">'+e+"</span>",inspect:e=>'<span style="color:cyan">'+e+"</span>",string:e=>'<span style="color:blue">'+e+"</span>",errorType:e=>'<span style="color:red">'+e+"</span>",errorMessage:e=>'<span style="color:red">'+e+"</span>",errorStack:e=>'<span style="color:gray">'+e+"</span>",errorStackKeyword:e=>"<i>"+e+"</i>",errorStackMethod:e=>'<span style="color:yellow">'+e+"</span>",errorStackMethodAs:e=>'<span style="color:yellow">'+e+"</span>",errorStackFile:e=>'<span style="color:cyan">'+e+"</span>",errorStackLine:e=>'<span style="color:blue">'+e+"</span>",errorStackColumn:e=>'<span style="color:gray">'+e+"</span>",errorFromMessage:e=>'<span style="color:yellow">'+e+"</span>"})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":8,"./ansi.js":27,"./escape.js":28,_process:13}],31:[function(e,t,i){"use strict";t.exports=function(e,t){var i=/(^([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)?$|^0x[\da-fA-F]+$|\d+)/g,n=/^\s+|\s+$/g,r=/\s+/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[/-]\d{1,4}[/-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,o=/^0x[0-9a-f]+$/i,a=/^0/,l=function(e){return(""+e).toLowerCase().replace(n,"")},c=l(e)||"",u=l(t)||"",h=c.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=u.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=parseInt(c.match(o),16)||h.length!==1&&Date.parse(c),d=parseInt(u.match(o),16)||p&&u.match(s)&&Date.parse(u)||null,m=function(e,t){return(!e.match(a)||t===1)&&parseFloat(e)||e.replace(r," ").replace(n,"")||0},g,y;if(d){if(p<d){return-1}else if(p>d){return 1}}for(var v=0,b=h.length,x=f.length,w=Math.max(b,x);v<w;v++){g=m(h[v],b);y=m(f[v],x);if(isNaN(g)!==isNaN(y)){return isNaN(g)?1:-1}else if(typeof g!==typeof y){g+="";y+=""}if(g<y){return-1}if(g>y){return 1}}return 0}},{}],32:[function(e,t,i){"use strict";const n={};t.exports=n;n.encode=(e=>String.fromCodePoint(...e));n.decode=(e=>{var t,i,n=0,r=[],s=e.length;while(n<s){t=e.charCodeAt(n++);if(t>=55296&&t<=56319&&n<s){i=e.charCodeAt(n++);if((i&64512)===56320){r.push(((t&1023)<<10)+(i&1023)+65536)}else{r.push(t);n--}}else{r.push(t)}}return r});n.firstCodePoint=(e=>{var t,i=e.charCodeAt(0);if(i>=55296&&i<=56319&&e.length>=2){t=e.charCodeAt(1);if((t&64512)===56320){return((i&1023)<<10)+(t&1023)+65536}}return i});n.firstChar=(e=>{var t,i=e.charCodeAt(0);if(i>=55296&&i<=56319&&e.length>=2){t=e.charCodeAt(1);if((t&64512)===56320){return e.slice(0,2)}}return e[0]});n.toArray=(e=>{var t,i,n=0,r=[],s=e.length;while(n<s){t=e.charCodeAt(n++);if(t>=55296&&t<=56319&&n<s){i=e.charCodeAt(n++);if((i&64512)===56320){r.push(e.slice(n-2,n))}else{r.push(e[n-2]);n--}}else{r.push(e[n-1])}}return r});n.toCells=((e,t,i=4,r=0,...s)=>{var o,a,l=0,c=[],u,h=t.length;while(l<h){o=t.charCodeAt(l++);if(o===10){r=0}else if(o===9){u=i-r%i-1;c.push(new e("\t",...s));r+=1+u;while(u--){c.push(new e(null,...s))}}else if(o>=55296&&o<=56319&&l<h){a=t.charCodeAt(l++);if((a&64512)===56320){o=((o&1023)<<10)+(a&1023)+65536;c.push(new e(t.slice(l-2,l),...s));r++;if(n.codePointWidth(o)===2){r++;c.push(new e(null,...s))}}else{l--}}else{c.push(new e(t[l-1],...s));r++;if(n.codePointWidth(o)===2){c.push(new e(null,...s));r++}}}return c});n.fromCells=(e=>{return e.map(e=>e.filler?"":e.char).join("")});n.length=(e=>{var t,i,n=0,r=0,s=e.length;while(n<s){t=e.charCodeAt(n++);if(t>=55296&&t<=56319&&n<s){i=e.charCodeAt(n++);if((i&64512)!==56320){n--}}r++}return r});n.width=(e=>{var t=0;n.decode(e).forEach(e=>t+=n.codePointWidth(e));return t});n.arrayWidth=((e,t)=>{var i,r=0;if(t===undefined){t=e.length}for(i=0;i<t;i++){r+=n.isFullWidth(e[i])?2:1}return r});n.widthLimit=n.truncateWidth=((e,t)=>{var i,r,s=0,o=0,a=0,l=e.length;while(s<l){i=e.charCodeAt(s++);if(i>=55296&&i<=56319&&s<l){r=e.charCodeAt(s++);if((r&64512)===56320){i=((i&1023)<<10)+(r&1023)+65536}else{s--}}a+=n.codePointWidth(i);if(a>t){return e.slice(0,o)}o=s}return e});n.surrogatePair=(e=>{var t=e.charCodeAt(0);if(t<55296||t>=57344){return 0}else if(t<56320){return 1}return-1});n.isFullWidth=(e=>{if(e.length<=1){return n.isFullWidthCodePoint(e.codePointAt(0))}return n.isFullWidthCodePoint(n.firstCodePoint(e))});n.charWidth=(e=>{if(e.length<=1){return n.codePointWidth(e.codePointAt(0))}return n.codePointWidth(n.firstCodePoint(e))});n.codePointWidth=(e=>{if(e>=4352&&(e<=4447||9001===e||9002===e||11904<=e&&e<=12871&&e!==12351||12880<=e&&e<=19903||19968<=e&&e<=42182||43360<=e&&e<=43388||44032<=e&&e<=55203||63744<=e&&e<=64255||65040<=e&&e<=65049||65072<=e&&e<=65131||65281<=e&&e<=65376||65504<=e&&e<=65510||110592<=e&&e<=110593||127488<=e&&e<=127569||131072<=e&&e<=262141)){return 2}return 1});n.isFullWidthCodePoint=(e=>n.codePointWidth(e)===2);n.toFullWidth=(e=>{return String.fromCodePoint(...n.decode(e).map(e=>e>=33&&e<=126?65280+e-32:e))})},{}],33:[function(e,t,i){"use strict";const n=e("./svg-kit.js");const r=e("./VGContainer.js");var s=0;function o(e){r.call(this,e);this.id=e&&e.id||"vg_"+s++;this.viewBox={x:0,y:0,width:100,height:100};this.css=[];this.invertY=false;if(e){this.set(e)}}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.prototype.__prototypeUID__="svg-kit/VG";o.prototype.__prototypeVersion__=e("../package.json").version;o.prototype.svgTag="svg";o.prototype.svgAttributes=function(e=this){var t={xmlns:"http://www.w3.org/2000/svg",viewBox:this.viewBox.x+" "+(e.invertY?-this.viewBox.y-this.viewBox.height:this.viewBox.y)+" "+this.viewBox.width+" "+this.viewBox.height};return t};o.prototype.set=function(e){r.prototype.set.call(this,e);if(e.viewBox&&typeof e.viewBox==="object"){if(e.viewBox.x!==undefined){this.viewBox.x=e.viewBox.x}if(e.viewBox.y!==undefined){this.viewBox.y=e.viewBox.y}if(e.viewBox.width!==undefined){this.viewBox.width=e.viewBox.width}if(e.viewBox.height!==undefined){this.viewBox.height=e.viewBox.height}}if(e.css&&Array.isArray(e.css)){this.css.length=0;for(let t of e.css){this.addCssRule(t)}}if(e.invertY!==undefined){this.invertY=!!e.invertY}};o.prototype.addCssRule=function(e){if(!e||typeof e!=="object"||!e.select||!e.style||typeof e.style!=="object"){return}this.css.push(e)}},{"../package.json":45,"./VGContainer.js":34,"./svg-kit.js":42}],34:[function(e,t,i){"use strict";const n=e("./svg-kit.js");const r=e("./VGItem.js");function s(e){r.call(this,e);this.items=[]}t.exports=s;s.prototype=Object.create(r.prototype);s.prototype.constructor=s;s.prototype.__prototypeUID__="svg-kit/VGContainer";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.isContainer=true;s.prototype.set=function(e){r.prototype.set.call(this,e);if(e.items&&Array.isArray(e.items)){for(let t of e.items){this.items.push(n.objectToVG(t))}}};s.prototype.exportMorphLog=function(){var e=false,t={};this.items.forEach((i,n)=>{var r=i.exportMorphLog();if(r){t[n]=r;e=true}});if(!e&&!this.morphLog.length){return null}var i={};if(this.morphLog.length){i.l=[...this.morphLog]}if(e){i.i=t}this.morphLog.length=0;return i};s.prototype.importMorphLog=function(e){var t,i;if(!e){this.morphLog.length=0;return}if(!e.l||!e.l.length){this.morphLog.length=0}else{this.morphLog=e.l}if(e.i){for(t in e.i){i=+t;if(this.items[i]){this.items[i].importMorphLog(e.i[t])}}}};s.prototype.morphDom=function(e=this){this.items.forEach(t=>t.morphDom(e));this.morphLog.forEach(t=>this.morphOneEntryDom(t,e));this.morphLog.length=0;return this.$element}},{"../package.json":45,"./VGItem.js":37,"./svg-kit.js":42}],35:[function(e,t,i){"use strict";const n=e("./VGItem.js");function r(e){n.call(this,e);this.x=0;this.y=0;this.rx=0;this.ry=0;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGEllipse";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="ellipse";r.prototype.svgAttributes=function(e=this){var t={cx:this.x,cy:e.invertY?-this.y:this.y,rx:this.rx,ry:this.ry};return t};r.prototype.set=function(e){n.prototype.set.call(this,e);if(e.cx!==undefined){this.x=e.cx}if(e.cy!==undefined){this.y=e.cy}if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.r!==undefined){this.rx=this.ry=e.r}if(e.rx!==undefined){this.rx=e.rx}if(e.ry!==undefined){this.ry=e.ry}}},{"../package.json":45,"./VGItem.js":37}],36:[function(e,t,i){"use strict";const n=e("./svg-kit.js");const r=e("./VGContainer.js");function s(e){r.call(this,e);if(e){this.set(e)}}t.exports=s;s.prototype=Object.create(r.prototype);s.prototype.constructor=s;s.prototype.__prototypeUID__="svg-kit/VGGroup";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.svgTag="g";s.prototype.set=function(e){r.prototype.set.call(this,e)}},{"../package.json":45,"./VGContainer.js":34,"./svg-kit.js":42}],37:[function(e,t,i){"use strict";const n=e("string-kit/lib/camel");const r=e("string-kit/lib/escape");function s(e){this.id=null;this.class=new Set;this.style={};this.data=null;this.button=null;this.hint=null;this.area=null;this.morphLog=[];this.$element=null;this.$style=null}t.exports=s;s.prototype.__prototypeUID__="svg-kit/VGItem";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.isContainer=false;s.prototype.svgTag="none";s.prototype.svgAttributes=(()=>({}));s.prototype.toJSON=function(){var e=Object.assign({},this);e._type=this.__prototypeUID__;if(this.class.size){e.class=[...this.class]}else{delete e.class}if(!e.id){delete e.id}if(!e.data){delete e.data}if(!e.button){delete e.button}if(!e.hint){delete e.hint}if(!e.area){delete e.area}delete e.morphLog;delete e.$element;delete e.$style;return e};s.prototype.set=function(e){if(e.id!==undefined){this.id=e.id||null}if(e.class){if(typeof e.class==="string"){this.class.clear();this.class.add(e.class)}else if(Array.isArray(e.class)||e.class instanceof Set){this.class.clear();for(let t of e.class){this.class.add(t)}}else if(typeof e.class==="object"){for(let t in e.class){if(e.class[t]){this.class.add(t)}else{this.class.delete(t)}}}}if(e.style){for(let t in e.style){this.style[this.toCamelCase(t)]=e.style[t]===null?"":e.style[t]}}if(e.data!==undefined){if(!e.data){this.data=null}else{if(!this.data){this.data={}}Object.assign(this.data,e.data)}}if(e.button!==undefined){this.button=e.button||null}if(e.hint!==undefined){this.hint=e.hint||null}if(e.area!==undefined){this.area=e.area||null}};var o=0;s.prototype.morph=function(e){var t=Object.assign({},e);t._v=o++;this.morphLog.push(t);this.set(e)};s.prototype.exportMorphLog=function(){if(!this.morphLog.length){return null}var e={l:[...this.morphLog]};this.morphLog.length=0;return e};s.prototype.importMorphLog=function(e){if(!e||!e.l||!e.l.length){this.morphLog.length=0}else{this.morphLog=e.l}};s.prototype.toCamelCase=(e=>n.toCamelCase(e,true));s.prototype.escape=function(e){if(typeof e==="object"){return null}if(typeof e!=="string"){return e}return r.htmlAttr(e)};s.prototype.renderText=function(e=this){var t,i,r="",s="",o=this.svgAttributes(e);r+="<"+this.svgTag;if(this.id){r+=' id="'+this.escape(this.id)+'"'}if(this.button){r+=' button="'+this.escape(this.button)+'"'}if(this.hint){r+=' hint="'+this.escape(this.hint)+'"'}if(this.area){r+=' area="'+this.escape(this.area)+'"'}if(this.class.size){r+=' class="';let e=true;for(let t of this.class){if(!e){r+=" "}r+=this.escape(t);e=false}r+='"'}for(t in o){r+=" "+t+'="'+this.escape(o[t])+'"'}if(this.data){for(t in this.data){r+=" data-"+this.escape(t)+'="'+this.escape(this.data[t])+'"'}}for(t in this.style){s+=this.escape(n.camelCaseToDash(t))+":"+this.escape(this.style[t])+";"}if(s){r+=' style="'+s+'"'}if(this.svgTextNode){r+=this.svgTextNode()}if(!this.isContainer){r+=" />";return r}r+=">";if(this.css&&this.css.length){r+="<style>\n";for(i of this.css){r+=i.select+" {\n";for(t in i.style){r+="    "+this.escape(n.camelCaseToDash(t))+": "+this.escape(i.style[t])+";\n"}r+="}\n"}r+="</style>"}if(this.items){for(let t of this.items){r+=t.renderText(e)}}r+="</"+this.svgTag+">";return r};s.prototype.renderDom=function(e={},t=this){var i,r,s,o=this.svgAttributes(t);this.$element=document.createElementNS("http://www.w3.org/2000/svg",e.overrideTag||this.svgTag);if(this.id){this.$element.setAttribute("id",this.id)}if(this.button){this.$element.setAttribute("button",this.button)}if(this.hint){this.$element.setAttribute("hint",this.hint)}if(this.area){this.$element.setAttribute("area",this.area)}if(this.class.size){this.class.forEach(e=>this.$element.classList.add(e))}for(i in o){this.$element.setAttribute(i,o[i])}if(this.data){for(i in this.data){this.$element.setAttribute("data-"+i,this.data[i])}}for(i in this.style){this.$element.style[i]=this.style[i]}if(this.svgTextNode){this.$element.appendChild(document.createTextNode(this.svgTextNode()))}if(!this.isContainer){return this.$element}if(this.css&&this.css.length){this.$style=document.createElementNS("http://www.w3.org/2000/svg","style");s="";for(r of this.css){s+=r.select+" {\n";for(i in r.style){s+=this.escape(n.camelCaseToDash(i))+": "+this.escape(r.style[i])+";\n"}s+="}\n"}this.$style.appendChild(document.createTextNode(s));this.$element.appendChild(this.$style)}if(this.items){for(let e of this.items){this.$element.appendChild(e.renderDom(undefined,t))}}return this.$element};s.prototype.morphDom=function(e=this){this.morphLog.forEach(t=>this.morphOneEntryDom(t,e));this.morphLog.length=0;return this.$element};s.prototype.morphOneEntryDom=function(e,t=this){var i;if(e.button){this.$element.setAttribute("button",e.button)}if(e.hint){this.$element.setAttribute("hint",e.hint)}if(e.area){this.$element.setAttribute("area",e.area)}if(e.class){if(Array.isArray(e.class)){this.$element.setAttribute("class",e.class.join(" "))}else if(e.class instanceof Set){this.$element.setAttribute("class",[...e.class].join(" "))}else if(typeof e.class==="object"){for(let t in e.class){if(e.class[t]){this.$element.classList.add(t)}else{this.$element.classList.remove(t)}}}}if(e.attr){for(i in e.attr){this.$element.setAttribute(i,e.attr[i])}}if(e.data){for(i in e.data){this.$element.setAttribute("data-"+i,e.data[i])}}if(e.style){for(i in e.style){this.$element.style[i]=e.style[i]===null?"":e.style[i]}}}},{"../package.json":45,"string-kit/lib/camel":43,"string-kit/lib/escape":44}],38:[function(e,t,i){"use strict";const n=e("./VGItem.js");function r(e){n.call(this,e);this.commands=[];if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGPath";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="path";r.prototype.svgAttributes=function(e=this){var t={d:this.toD(e)};return t};r.prototype.set=function(e){n.prototype.set.call(this,e);if(Array.isArray(e.commands)){this.commands=e.commands}};r.prototype.toD=function(e=this){var t={root:e,d:"",pu:false,cx:0,cy:0,ca:e.invertY?-Math.PI/2:Math.PI/2};this.commands.forEach((e,i)=>{if(i){t.d+=" "}a[e.type](e,t)});return t.d};const s=e=>e*Math.PI/180;const o=e=>e*180/Math.PI;const a={};a.close=((e,t)=>{t.d+="z"});a.move=((e,t)=>{var i=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="m "+e.x+" "+i;t.cx+=e.x;t.cy+=i}else{t.d+="M "+e.x+" "+i;t.cx=e.x;t.cy=i}});a.line=((e,t)=>{var i=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="l "+e.x+" "+i;t.cx+=e.x;t.cy+=i}else{t.d+="L "+e.x+" "+i;t.cx=e.x;t.cy=i}});a.curve=((e,t)=>{var i=t.root.invertY?-e.cy1:e.cy1,n=t.root.invertY?-e.cy2:e.cy2,r=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="c "+e.cx1+" "+i+" "+e.cx2+" "+n+" "+e.x+" "+r;t.cx+=e.x;t.cy+=r}else{t.d+="C "+e.cx1+" "+i+" "+e.cx2+" "+n+" "+e.x+" "+r;t.cx=e.x;t.cy=r}});a.smoothCurve=((e,t)=>{var i=t.root.invertY?-e.cy:e.cy,n=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="s "+e.cx+" "+i+" "+e.x+" "+n;t.cx+=e.x;t.cy+=n}else{t.d+="S "+e.cx+" "+i+" "+e.x+" "+n;t.cx=e.x;t.cy=n}});a.qCurve=((e,t)=>{var i=t.root.invertY?-e.cy:e.cy,n=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="q "+e.cx+" "+i+" "+e.x+" "+n;t.cx+=e.x;t.cy+=n}else{t.d+="Q "+e.cx+" "+i+" "+e.x+" "+n;t.cx=e.x;t.cy=n}});a.smoothQCurve=((e,t)=>{var i=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="t "+e.x+" "+i;t.cx+=e.x;t.cy+=i}else{t.d+="T "+e.x+" "+i;t.cx=e.x;t.cy=i}});a.arc=((e,t)=>{var i=t.root.invertY?-e.ra:e.ra,n=t.root.invertY?!e.pr:e.pr,r=t.root.invertY?-e.y:e.y;if(e.rel){t.d+="a "+e.rx+" "+e.ry+" "+i+" "+ +e.la+" "+ +n+" "+e.x+" "+r;t.cx+=e.x;t.cy+=r}else{t.d+="A "+e.rx+" "+e.ry+" "+i+" "+ +e.la+" "+ +n+" "+e.x+" "+r;t.cx=e.x;t.cy=r}});function l(e){if(!e){return 0}var t=s(e);var i=Math.cos(t/2),n=Math.sin(t/2),r=(4-i)/3,o=(1-i)*(3-i)/(3*n);return Math.sqrt((i-r)**2+(n-o)**2)}a.centerArc=((e,t)=>{var{x:i,y:n,cx:r,cy:s}=e;if(e.rel){i+=t.cx;n+=t.cy;r+=t.cx;s+=t.cy}var o=Math.atan2(t.cy-s,t.cx-r),a=Math.atan2(n-s,i-r);t.cx=i;t.cy=n});a.pen=((e,t)=>{t.pu=e.u});a.forward=((e,t)=>{var i=e.l*Math.cos(t.ca),n=e.l*Math.sin(t.ca);if(t.pu){t.d+="m "+i+" "+n}else{t.d+="l "+i+" "+n}t.cx+=i;t.cy+=n});a.turn=((e,t)=>{var i=t.root.invertY?-e.a:e.a;if(e.rel){t.ca+=s(i)}else{t.ca=s(i)}});a.forwardTurn=((e,t)=>{var i=t.root.invertY?-e.a:e.a;var n=s(i),r=n>=0?1:-1,o=Math.abs(n),a=e.l/o,l=a*Math.cos(o),c=a*Math.sin(o),u=Math.sqrt((a-l)**2+c**2),h=Math.atan2(a-l,c);var f=u*Math.cos(t.ca+r*h),p=u*Math.sin(t.ca+r*h);if(t.pu){t.d+="m "+f+" "+p}else{t.d+="a "+a+" "+a+" 0 "+(o>Math.PI?1:0)+" "+(n>=0?1:0)+" "+f+" "+p}t.cx+=f;t.cy+=p;t.ca+=n});r.prototype.close=function(){this.commands.push({type:"close"})};r.prototype.move=function(e){this.commands.push({type:"move",rel:true,x:e.x||0,y:e.y||0})};r.prototype.moveTo=function(e){this.commands.push({type:"move",x:e.x||0,y:e.y||0})};r.prototype.line=function(e){this.commands.push({type:"line",rel:true,x:e.x||0,y:e.y||0})};r.prototype.lineTo=function(e){this.commands.push({type:"line",x:e.x||0,y:e.y||0})};r.prototype.curve=function(e){this.commands.push({type:"curve",rel:true,cx1:e.cx1||0,cy1:e.cy1||0,cx2:e.cx2||0,cy2:e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.curveTo=function(e){this.commands.push({type:"curve",cx1:e.cx1||0,cy1:e.cy1||0,cx2:e.cx2||0,cy2:e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.smoothCurve=function(e){this.commands.push({type:"smoothCurve",rel:true,cx:e.cx||e.cx2||0,cy:e.cy||e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.smoothCurveTo=function(e){this.commands.push({type:"smoothCurve",cx:e.cx||e.cx2||0,cy:e.cy||e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.qCurve=function(e){this.commands.push({type:"qCurve",rel:true,cx:e.cx||e.cx1||0,cy:e.cy||e.cy1||0,x:e.x||0,y:e.y||0})};r.prototype.qCurveTo=function(e){this.commands.push({type:"qCurve",cx:e.cx||e.cx1||0,cy:e.cy||e.cy1||0,x:e.x||0,y:e.y||0})};r.prototype.smoothQCurve=function(e){this.commands.push({type:"smoothQCurve",rel:true,x:e.x||0,y:e.y||0})};r.prototype.smoothQCurveTo=function(e){this.commands.push({type:"smoothQCurve",x:e.x||0,y:e.y||0})};r.prototype.arc=function(e){this.commands.push({type:"arc",rel:true,rx:e.rx||0,ry:e.ry||0,ra:e.ra||e.a||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true,x:e.x||0,y:e.y||0})};r.prototype.arcTo=function(e){this.commands.push({type:"arc",rx:e.rx||0,ry:e.ry||0,ra:e.ra||e.a||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true,x:e.x||0,y:e.y||0})};r.prototype.negativeArc=function(e){this.commands.push({type:"arc",rel:true,rx:e.rx||0,ry:e.ry||0,ra:-(e.ra||e.a||0),la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:!(e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true),x:e.x||0,y:e.y||0})};r.prototype.negativeArcTo=function(e){this.commands.push({type:"arc",rx:e.rx||0,ry:e.ry||0,ra:-(e.ra||e.a||0),la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:!(e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true),x:e.x||0,y:e.y||0})};r.prototype.centerArc=function(e){this.commands.push({type:"centerArc",rel:true,cx:e.cx||0,cy:e.cy||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,x:e.x||0,y:e.y||0})};r.prototype.centerArcTo=function(e){this.commands.push({type:"centerArc",cx:e.cx||0,cy:e.cy||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,x:e.x||0,y:e.y||0})};r.prototype.penUp=function(e){this.commands.push({type:"pen",u:true})};r.prototype.penDown=function(e){this.commands.push({type:"pen",u:false})};r.prototype.forward=function(e){this.commands.push({type:"forward",l:typeof e==="number"?e:e.length||e.l||0})};r.prototype.backward=function(e){this.commands.push({type:"forward",l:-(typeof e==="number"?e:e.length||e.l||0)})};r.prototype.turn=function(e){this.commands.push({type:"turn",rel:true,a:typeof e==="number"?e:e.angle||e.a||0})};r.prototype.turnTo=function(e){this.commands.push({type:"turn",a:typeof e==="number"?e:e.angle||e.a||0})};r.prototype.negativeTurn=function(e){this.commands.push({type:"turn",rel:true,a:-(typeof e==="number"?e:e.angle||e.a||0)})};r.prototype.negativeTurnTo=function(e){this.commands.push({type:"turn",a:90-(typeof e==="number"?e:e.angle||e.a||0)})};r.prototype.forwardTurn=function(e){this.commands.push({type:"forwardTurn",l:e.length||e.l||0,a:e.angle||e.a||0})};r.prototype.forwardNegativeTurn=function(e){this.commands.push({type:"forwardTurn",l:e.length||e.l||0,a:-(e.angle||e.a||0)})}},{"../package.json":45,"./VGItem.js":37}],39:[function(e,t,i){"use strict";const n=e("./VGItem.js");function r(e){n.call(this,e);this.x=0;this.y=0;this.width=0;this.height=0;this.rx=0;this.ry=0;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGRect";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="rect";r.prototype.svgAttributes=function(e=this){var t={x:this.x,y:e.invertY?-this.y:this.y,width:this.width,height:this.height,rx:this.rx,ry:this.ry};return t};r.prototype.set=function(e){n.prototype.set.call(this,e);if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.width!==undefined){this.width=e.width}if(e.height!==undefined){this.height=e.height}if(e.r!==undefined){this.rx=this.ry=e.r}if(e.rx!==undefined){this.rx=e.rx}if(e.ry!==undefined){this.ry=e.ry}}},{"../package.json":45,"./VGItem.js":37}],40:[function(e,t,i){"use strict";const n=e("./VGItem.js");function r(e){n.call(this,e);this.x=0;this.y=0;this.text="";this.anchor=null;this.length=null;this.adjustGlyph=false;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(n.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGText";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="text";r.prototype.svgAttributes=function(e=this){var t={x:this.x,y:e.invertY?-this.y:this.y,"text-anchor":this.anchor||"middle"};if(this.length!==null){t.textLength=this.length}if(this.adjustGlyph!==null){t.lengthAdjust="spacingAndGlyphs"}return t};r.prototype.svgTextNode=function(){return this.text};r.prototype.set=function(e){n.prototype.set.call(this,e);if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.text!==undefined){this.text=e.text}if(e.textAnchor!==undefined){this.anchor=e.textAnchor}if(e.anchor!==undefined){this.anchor=e.anchor}if(e.textLength!==undefined){this.length=e.textLength}if(e.length!==undefined){this.length=e.length}if(e.lengthAdjust==="spacingAndGlyphs"){this.adjustGlyph=true}else if(e.lengthAdjust==="spacing"){this.adjustGlyph=false}if(e.adjustGlyph!==undefined){this.adjustGlyph=!!e.adjustGlyph}}},{"../package.json":45,"./VGItem.js":37}],41:[function(e,t,i){"use strict";const n={};t.exports=n;n.dFromPoints=((e,t)=>{var i=t?-1:1,n="M";e.forEach(e=>{n+=" "+e.x+","+e.y*i});return n})},{}],42:[function(e,t,i){(function(i){"use strict";const n=e("fs").promises;const r=e("dom-kit");const s=e("seventh");const o=e("string-kit/lib/escape.js");function a(){}const l={};t.exports=l;l.path=e("./path.js");l.VG=e("./VG.js");l.VGItem=e("./VGItem.js");l.VGContainer=e("./VGContainer.js");l.VGGroup=e("./VGGroup.js");l.VGRect=e("./VGRect.js");l.VGEllipse=e("./VGEllipse.js");l.VGPath=e("./VGPath.js");l.VGText=e("./VGText.js");l.load=async function(e,t={}){var s,o,a;if(!i.browser){if(e.substring(0,7)==="file://"){e=e.slice(7)}s=await n.readFile(e,"utf8");o=r.fromXml(s)}else{o=await l.ajax(e)}if(t.removeComments){r.removeComments(o);delete t.removeComments}a=o.documentElement;l.inject(a,t);return a};l.loadFromString=async function(e,t={}){var i=r.fromXml(e);if(t.removeComments){r.removeComments(i);delete t.removeComments}var n=i.documentElement;l.inject(n,t);return n};l.ajax=function(e){var t=new s,i=new XMLHttpRequest;i.responseType="document";i.onreadystatechange=(()=>{try{if(i.readyState===4){if(i.status===200){t.resolve(i.responseXML)}else if(i.status===0&&i.responseXML){t.resolve(i.responseXML)}else if(i.status){t.reject(i.status)}else{t.reject(new Error("[svg-kit] ajaxStatus(): Error with falsy status"))}}}catch(e){t.reject(e)}});i.open("GET",e);i.send();return t};l.inject=function(e,t){l.patch(e,t);if(t.into){t.into.appendChild(e)}if(t.as){r.moveAttributes(e,t.as);r.moveChildrenInto(e,t.as)}};l.patch=function(e,t){var i,n,s;l.lightCleanup(e);if(t.id!==undefined){if(typeof t.id==="string"){e.setAttribute("id",t.id)}else if(!t.id){e.removeAttribute("id")}}if(t.class){if(typeof t.class==="string"){e.classList.add(t.class)}else if(typeof t.class==="object"){r.class(e,t.class)}}if(t.hidden){e.style.visibility="hidden"}if(t.prefixIds){r.prefixIds(e,t.prefixIds)}if(t.removeIds){r.removeAllAttributes(e,"id")}if(t.removeSvgStyle){e.removeAttribute("style")}if(t.removeDefaultStyles){l.removeDefaultStyles(e)}if(t.removeComments){r.removeComments(e)}if(t.removeExoticNamespaces){r.filterByNamespace(e,{primary:"svg",whitelist:[]})}if(t.removeSize){n=e.getAttribute("width")||e.style.width;s=e.getAttribute("height")||e.style.height;e.removeAttribute("height");e.removeAttribute("width");e.style.width=null;e.style.height=null;if(!e.getAttribute("viewBox")&&n&&s){i="0 0 "+n+" "+s;e.setAttribute("viewBox",i)}}if(t.css){r.css(e,t.css)}if(t.colorClass){l.colorClass(e)}if(t.removeWhiteSpaces){r.removeWhiteSpaces(e)}else if(t.removeWhiteLines){r.removeWhiteSpaces(e,true)}};l.patchDocument=function(e,t){var i=t.removeWhiteSpaces,n=t.removeWhiteLines,s=t.removeComments;delete t.removeWhiteSpaces;delete t.removeWhiteLines;delete t.removeComments;if(s){r.removeComments(e)}l.patch(e.documentElement,t);if(i){r.removeWhiteSpaces(e)}else if(n){r.removeWhiteSpaces(e,true)}};l.lightCleanup=function(e){r.removeAllTags(e,"metadata");r.removeAllTags(e,"script");r.removeAllTags(e,"defs",true)};const c=["path","circle","ellipse","line","rect","polyline","polygone","text","textPath"];const u=[["font-style","normal"],["font-weight","normal"],["font-variant","normal"],["font-stretch","normal"],["font-size","medium"],["line-height","normal"],["font-variant-ligatures","normal"],["font-variant-position","normal"],["font-variant-caps","normal"],["font-variant-numeric","normal"],["font-variant-alternates","normal"],["font-variant-east-asian","normal"],["font-feature-settings","normal"],["text-indent","0"],["text-align","start"],["text-decoration","none"],["text-decoration-line","none"],["text-decoration-style","solid"],["text-decoration-color","#000000"],["letter-spacing","normal"],["word-spacing","normal"],["text-transform","none"],["writing-mode","lr-tb"],["direction","ltr"],["text-orientation","mixed"],["dominant-baseline","auto"],["baseline-shift","baseline"],["text-anchor","start"],["white-space","normal"],["shape-padding","0"],["display","inline"],["visibility","visible"],["overflow","visible"],["opacity","1"],["isolation","auto"],["mix-blend-mode","normal"],["color-interpolation","sRGB"],["color-interpolation-filters","linearRGB"],["solid-color","#000000"],["solid-opacity","1"],["vector-effect","none"],["fill-rule","nonzero"],["clip-rule","nonzero"],["color-rendering","auto"],["image-rendering","auto"],["shape-rendering","auto"],["text-rendering","auto"],["enable-background","accumulate"],["stroke-dasharray","none"],["stroke-dashoffset","0"],["paint-order","normal"],["paint-order","fill stroke markers"]];l.colorClass=function(e){c.forEach(t=>{Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!e.getAttribute("class")){e.classList.add("primary")}r.styleToAttribute(e,"fill",["none"]);r.styleToAttribute(e,"stroke",["none"])})})};l.removeDefaultStyles=function(e){c.forEach(t=>{Array.from(e.getElementsByTagName(t)).forEach(e=>{var t=e.getAttribute("style");u.forEach(e=>{var i=e[0];var n=e[1];t=t.replace(new RegExp("(^|;) *"+o.regExp(i)+" *: *"+o.regExp(n)+" *(?:;|$)"),(e,t)=>t)});e.setAttribute("style",t)})})};l.getViewBox=function(e){var t=e.getAttribute("viewBox");if(!t){return null}var i=t.split(/ +/);return{x:parseFloat(i[0],10),y:parseFloat(i[1],10),width:parseFloat(i[2],10),height:parseFloat(i[3],10)}};l.setViewBox=function(e,t){e.setAttribute("viewBox",t.x+" "+t.y+" "+t.width+" "+t.height)};l.toAreaArray=function(e){if(e.min&&e.max){return[e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y]}else if(e.xmin!==undefined&&e.xmax!==undefined&&e.ymin!==undefined&&e.ymax!==undefined){return[e.xmin,e.ymin,e.xmax-e.xmin,e.ymax-e.ymin]}else if(e.x!==undefined&&e.y!==undefined&&e.width!==undefined&&e.height!==undefined){return[e.x,e.y,e.width,e.height]}return[0,0,100,100]};l.standalone=function(e,t){var i='<?xml version="1.0" encoding="UTF-8"?>\n';if(!Array.isArray(t)){t=l.toAreaArray(t)}i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+t.join(" ")+'">\n';i+=e;i+="\n</svg>\n";return i};l.unserializeVG=(e=>l.objectToVG(JSON.parse(e)));l.objectToVG=function(e){if(!e._type||!e._type.startsWith("svg-kit/")){return e}var t=e._type.slice(8);if(!l[t]){return e}return new l[t](e)}}).call(this,e("_process"))},{"./VG.js":33,"./VGContainer.js":34,"./VGEllipse.js":35,"./VGGroup.js":36,"./VGItem.js":37,"./VGPath.js":38,"./VGRect.js":39,"./VGText.js":40,"./path.js":41,_process:13,"dom-kit":7,fs:6,seventh:25,"string-kit/lib/escape.js":44}],43:[function(e,t,i){"use strict";var n={};t.exports=n;n.toCamelCase=function(e,t=false){if(!e||typeof e!=="string"){return""}return e.replace(/^[\s_-]*([^\s_-]+)|[\s_-]+([^\s_-]?)([^\s_-]*)/g,(e,i,n,r)=>{if(t){if(i){return i}if(!n){return""}return n.toUpperCase()+r}if(i){return i.toLowerCase()}if(!n){return""}return n.toUpperCase()+r.toLowerCase()})};n.camelCaseToSeparated=function(e,t=" "){if(!e||typeof e!=="string"){return""}return e.replace(/^([A-Z])|([A-Z])/g,(e,i,n)=>{if(i){return i.toLowerCase()}return t+n.toLowerCase()})};n.camelCaseToDash=n.camelCaseToDashed=(e=>n.camelCaseToSeparated(e,"-"))},{}],44:[function(e,t,i){arguments[4][28][0].apply(i,arguments)},{dup:28}],45:[function(e,t,i){t.exports={_from:"svg-kit@0.2.3",_id:"svg-kit@0.2.3",_inBundle:false,_integrity:"sha512-foEXyUwrL2r3ie15sO6a/KQ2qQLzfvjZ/xw+d0JWa5SzPly9Rgs7iJaQaeLjpsNucAtQ+XRM+jcI5cHPpDptkA==",_location:"/svg-kit",_phantomChildren:{},_requested:{type:"version",registry:true,raw:"svg-kit@0.2.3",name:"svg-kit",escapedName:"svg-kit",rawSpec:"0.2.3",saveSpec:null,fetchSpec:"0.2.3"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/svg-kit/-/svg-kit-0.2.3.tgz",_shasum:"7bbd11739ddd1b402648eb199d1f1e5d91007cc1",_spec:"svg-kit@0.2.3",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cédric Ronvel"},bin:{svgkit:"bin/svgkit"},bugs:{url:"https://github.com/cronvel/svg-kit/issues"},bundleDependencies:false,copyright:{title:"SVG Kit",years:[2017,2019],owner:"Cédric Ronvel"},dependencies:{"@cronvel/xmldom":"^0.1.31","dom-kit":"^0.3.14",minimist:"^1.2.0",seventh:"^0.7.30","string-kit":"^0.10.1","terminal-kit":"^1.31.4"},deprecated:false,description:"A small SVG toolkit.",devDependencies:{},directories:{test:"test"},homepage:"https://github.com/cronvel/svg-kit#readme",keywords:["svg"],license:"MIT",main:"lib/svg-kit.js",name:"svg-kit",repository:{type:"git",url:"git+https://github.com/cronvel/svg-kit.git"},scripts:{test:"tea-time -R dot"},version:"0.2.3"}},{}],46:[function(e,t,i){(function(t,n){var r=e("process/browser.js").nextTick;var s=Function.prototype.apply;var o=Array.prototype.slice;var a={};var l=0;i.setTimeout=function(){return new c(s.call(setTimeout,window,arguments),clearTimeout)};i.setInterval=function(){return new c(s.call(setInterval,window,arguments),clearInterval)};i.clearTimeout=i.clearInterval=function(e){e.close()};function c(e,t){this._id=e;this._clearFn=t}c.prototype.unref=c.prototype.ref=function(){};c.prototype.close=function(){this._clearFn.call(window,this._id)};i.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};i.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;if(t>=0){e._idleTimeoutId=setTimeout(function t(){if(e._onTimeout)e._onTimeout()},t)}};i.setImmediate=typeof t==="function"?t:function(e){var t=l++;var n=arguments.length<2?false:o.call(arguments,1);a[t]=true;r(function r(){if(a[t]){if(n){e.apply(null,n)}else{e.call(null)}i.clearImmediate(t)}});return t};i.clearImmediate=typeof n==="function"?n:function(e){delete a[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":13,timers:46}],47:[function(e,t,i){"use strict";var n=e("punycode");var r=e("./util");i.parse=w;i.resolve=_;i.resolveObject=S;i.format=k;i.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(c),h=["'"].concat(u),f=["%","/","?",";","#"].concat(h),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:true,"javascript:":true},v={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},x=e("querystring");function w(e,t,i){if(e&&r.isObject(e)&&e instanceof s)return e;var n=new s;n.parse(e,t,i);return n}s.prototype.parse=function(e,t,i){if(!r.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",c=e.split(a),u=/\\/g;c[0]=c[0].replace(u,"/");e=c.join(a);var w=e;w=w.trim();if(!i&&e.split("#").length===1){var k=l.exec(w);if(k){this.path=w;this.href=w;this.pathname=k[1];if(k[2]){this.search=k[2];if(t){this.query=x.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var _=o.exec(w);if(_){_=_[0];var S=_.toLowerCase();this.protocol=S;w=w.substr(_.length)}if(i||_||w.match(/^\/\/[^@\/]+@[^@\/]+/)){var C=w.substr(0,2)==="//";if(C&&!(_&&v[_])){w=w.substr(2);this.slashes=true}}if(!v[_]&&(C||_&&!b[_])){var L=-1;for(var A=0;A<p.length;A++){var j=w.indexOf(p[A]);if(j!==-1&&(L===-1||j<L))L=j}var $,E;if(L===-1){E=w.lastIndexOf("@")}else{E=w.lastIndexOf("@",L)}if(E!==-1){$=w.slice(0,E);w=w.slice(E+1);this.auth=decodeURIComponent($)}L=-1;for(var A=0;A<f.length;A++){var j=w.indexOf(f[A]);if(j!==-1&&(L===-1||j<L))L=j}if(L===-1)L=w.length;this.host=w.slice(0,L);w=w.slice(L);this.parseHost();this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T){var I=this.hostname.split(/\./);for(var A=0,M=I.length;A<M;A++){var O=I[A];if(!O)continue;if(!O.match(m)){var N="";for(var B=0,G=O.length;B<G;B++){if(O.charCodeAt(B)>127){N+="x"}else{N+=O[B]}}if(!N.match(m)){var P=I.slice(0,A);var V=I.slice(A+1);var R=O.match(g);if(R){P.push(R[1]);V.unshift(R[2])}if(V.length){w="/"+V.join(".")+w}this.hostname=P.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!T){this.hostname=n.toASCII(this.hostname)}var F=this.port?":"+this.port:"";var D=this.hostname||"";this.host=D+F;this.href+=this.host;if(T){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(w[0]!=="/"){w="/"+w}}}if(!y[S]){for(var A=0,M=h.length;A<M;A++){var U=h[A];if(w.indexOf(U)===-1)continue;var W=encodeURIComponent(U);if(W===U){W=escape(U)}w=w.split(U).join(W)}}var Y=w.indexOf("#");if(Y!==-1){this.hash=w.substr(Y);w=w.slice(0,Y)}var q=w.indexOf("?");if(q!==-1){this.search=w.substr(q);this.query=w.substr(q+1);if(t){this.query=x.parse(this.query)}w=w.slice(0,q)}else if(t){this.search="";this.query={}}if(w)this.pathname=w;if(b[S]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var F=this.pathname||"";var H=this.search||"";this.path=F+H}this.href=this.format();return this};function k(e){if(r.isString(e))e=w(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",s=false,o="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&r.isObject(this.query)&&Object.keys(this.query).length){o=x.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(i&&i.charAt(0)!=="/")i="/"+i}else if(!s){s=""}if(n&&n.charAt(0)!=="#")n="#"+n;if(a&&a.charAt(0)!=="?")a="?"+a;i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+i+a+n};function _(e,t){return w(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(w(e,false,true)).format()};function S(e,t){if(!e)return t;return w(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(r.isString(e)){var t=new s;t.parse(e,false,true);e=t}var i=new s;var n=Object.keys(this);for(var o=0;o<n.length;o++){var a=n[o];i[a]=this[a]}i.hash=e.hash;if(e.href===""){i.href=i.format();return i}if(e.slashes&&!e.protocol){var l=Object.keys(e);for(var c=0;c<l.length;c++){var u=l[c];if(u!=="protocol")i[u]=e[u]}if(b[i.protocol]&&i.hostname&&!i.pathname){i.path=i.pathname="/"}i.href=i.format();return i}if(e.protocol&&e.protocol!==i.protocol){if(!b[e.protocol]){var h=Object.keys(e);for(var f=0;f<h.length;f++){var p=h[f];i[p]=e[p]}i.href=i.format();return i}i.protocol=e.protocol;if(!e.host&&!v[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");i.pathname=d.join("/")}else{i.pathname=e.pathname}i.search=e.search;i.query=e.query;i.host=e.host||"";i.auth=e.auth;i.hostname=e.hostname||e.host;i.port=e.port;if(i.pathname||i.search){var m=i.pathname||"";var g=i.search||"";i.path=m+g}i.slashes=i.slashes||e.slashes;i.href=i.format();return i}var y=i.pathname&&i.pathname.charAt(0)==="/",x=e.host||e.pathname&&e.pathname.charAt(0)==="/",w=x||y||i.host&&e.pathname,k=w,_=i.pathname&&i.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],S=i.protocol&&!b[i.protocol];if(S){i.hostname="";i.port=null;if(i.host){if(_[0]==="")_[0]=i.host;else _.unshift(i.host)}i.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}w=w&&(d[0]===""||_[0]==="")}if(x){i.host=e.host||e.host===""?e.host:i.host;i.hostname=e.hostname||e.hostname===""?e.hostname:i.hostname;i.search=e.search;i.query=e.query;_=d}else if(d.length){if(!_)_=[];_.pop();_=_.concat(d);i.search=e.search;i.query=e.query}else if(!r.isNullOrUndefined(e.search)){if(S){i.hostname=i.host=_.shift();var C=i.host&&i.host.indexOf("@")>0?i.host.split("@"):false;if(C){i.auth=C.shift();i.host=i.hostname=C.shift()}}i.search=e.search;i.query=e.query;if(!r.isNull(i.pathname)||!r.isNull(i.search)){i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")}i.href=i.format();return i}if(!_.length){i.pathname=null;if(i.search){i.path="/"+i.search}else{i.path=null}i.href=i.format();return i}var L=_.slice(-1)[0];var A=(i.host||e.host||_.length>1)&&(L==="."||L==="..")||L==="";var j=0;for(var $=_.length;$>=0;$--){L=_[$];if(L==="."){_.splice($,1)}else if(L===".."){_.splice($,1);j++}else if(j){_.splice($,1);j--}}if(!w&&!k){for(;j--;j){_.unshift("..")}}if(w&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")){_.unshift("")}if(A&&_.join("/").substr(-1)!=="/"){_.push("")}var E=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(S){i.hostname=i.host=E?"":_.length?_.shift():"";var C=i.host&&i.host.indexOf("@")>0?i.host.split("@"):false;if(C){i.auth=C.shift();i.host=i.hostname=C.shift()}}w=w||i.host&&_.length;if(w&&!E){_.unshift("")}if(!_.length){i.pathname=null;i.path=null}else{i.pathname=_.join("/")}if(!r.isNull(i.pathname)||!r.isNull(i.search)){i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")}i.auth=e.auth||i.auth;i.slashes=i.slashes||e.slashes;i.href=i.format();return i};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":48,punycode:14,querystring:17}],48:[function(e,t,i){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}]},{},[2])(2)});