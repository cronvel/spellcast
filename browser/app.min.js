(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var c=typeof require=="function"&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[o]={exports:{}};t[o][0].call(h.exports,function(e){var n=t[o][1][e];return i(n?n:e)},h,h.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";var r=e("nextgen-events");var i=e("dom-kit");var s=e("url");function o(e){return o.create(e)}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.create=function e(t){var n=Object.create(o.prototype,{token:{value:t.token||"null",writable:true,enumerable:true},ws:{value:null,writable:true,enumerable:true},proxy:{value:null,writable:true,enumerable:true}});return n};var a={classic:e("./ui/classic.js")};o.autoCreate=function e(){var t=s.parse(window.location.href,true).query;window.spellcastClient=o.create(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};o.prototype.run=function e(t){var n=this;this.ws=new WebSocket("ws://127.0.0.1:57311/"+this.token);this.proxy=new r.Proxy;this.ws.onopen=function e(){n.proxy.addRemoteService("book");n.proxy.addRemoteService("bookInput");n.ui.forEach(function(e){if(a[e]){a[e](window.spellcastClient)}});n.proxy.remoteServices.bookInput.emit("ready");console.log("Websocket opened!");if(typeof t==="function"){t()}};this.ws.onclose=function e(){n.proxy.destroy();console.log("Websocket closed!")};this.ws.onmessage=function e(t){var r;try{r=JSON.parse(t.data)}catch(e){return}console.log("Message received: ",r);n.proxy.receive(r)};n.proxy.send=function e(t){n.ws.send(JSON.stringify(t))}};o.autoCreate();i.ready(function(){window.spellcastClient.run()})},{"./ui/classic.js":2,"dom-kit":11,"nextgen-events":13,url:9}],2:[function(e,t,n){(function(n){"use strict";var r=e("dom-kit");function i(e,t){if(!t){t=Object.create(i.prototype,{client:{value:e,enumerable:true},remote:{value:e.proxy.remoteServices,enumerable:true}})}t.$text=document.querySelector("#text");t.$next=document.querySelector("#next");t.remote.book.on("message",{fn:i.message.bind(t),async:true});t.remote.book.on("extOutput",i.extOutput.bind(t));t.remote.book.on("extErrorOutput",i.extErrorOutput.bind(t));t.remote.book.on("enterScene",i.enterScene.bind(t));t.remote.book.on("next",i.next.bind(t));t.remote.book.on("textInput",i.textInput.bind(t));t.remote.book.on("exit",i.exit.bind(t));return t}t.exports=i;i.message=function e(t,n){var r=this,i=false;if(!n){n={}}this.$text.innerHTML="";this.$next.innerHTML="";var s=function e(){if(i){return}i=true};this.$text.insertAdjacentHTML("beforeend",'<p class="text classic-ui">'+t+"</p>");s()};i.enterScene=function e(){};i.next=function e(t){if(t.length===1){this.nextConfirm(t[0])}else{this.nextMenu(t)}};i.prototype.nextConfirm=function e(t){var n=this,r;this.$next.innerHTML="";if(t.label){this.$next.insertAdjacentHTML("beforeend",'<a id="next_0" class="next classic-ui">Next: '+t.label+"</a>")}else{this.$next.insertAdjacentHTML("beforeend",'<a id="next_0" class="next classic-ui">Next.</a>')}r=document.querySelector("#next_0");r.onclick=function(){n.remote.bookInput.emit("next",0);r.onclick=null}};i.prototype.nextMenu=function e(t){var n=this,r,i=97+t.length-1;this.$next.innerHTML="";t.forEach(function(e,t){n.$next.insertAdjacentHTML("beforeend",'<a id="next_'+t+'" class="next classic-ui">'+String.fromCharCode(97+t)+". "+e.label+"</a>")});r=document.querySelectorAll(".next");r=Array.prototype.slice.call(r);r.forEach(function(e,t){e.onclick=function(){n.remote.bookInput.emit("next",t);r.forEach(function(e,t){e.onclick=null})}})};i.extOutput=function e(t){n.stdout.write(t)};i.extErrorOutput=function e(t){n.stderr.write(t)};i.textInput=function e(t){var n=this;if(t){term(t)}var r={};term.inputField(r,function(e,t){term("\n");if(e){n.remote.bookInput.emit(e)}else{n.remote.bookInput.emit("textInput",t)}})};i.exit=function e(){term.styleReset()}}).call(this,e("_process"))},{_process:4,"dom-kit":11}],3:[function(e,t,n){},{}],4:[function(e,t,n){var r=t.exports={};var i;var s;(function(){try{i=setTimeout}catch(e){i=function(){throw new Error("setTimeout is not defined")}}try{s=clearTimeout}catch(e){s=function(){throw new Error("clearTimeout is not defined")}}})();var o=[];var a=false;var c;var u=-1;function h(){if(!a||!c){return}a=false;if(c.length){o=c.concat(o)}else{u=-1}if(o.length){f()}}function f(){if(a){return}var e=i(h);a=true;var t=o.length;while(t){c=o;o=[];while(++u<t){if(c){c[u].run()}}u=-1;t=o.length}c=null;a=false;s(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}o.push(new l(e,t));if(o.length===1&&!a){i(f,0)}};function l(e,t){this.fun=e;this.array=t}l.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function p(){}r.on=p;r.addListener=p;r.once=p;r.off=p;r.removeListener=p;r.removeAllListeners=p;r.emit=p;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],5:[function(t,n,r){(function(t){(function(i){var s=typeof r=="object"&&r&&!r.nodeType&&r;var o=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){i=a}var c,u=2147483647,h=36,f=1,l=26,p=38,v=700,d=72,m=128,y="-",g=/^xn--/,b=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=h-f,k=Math.floor,E=String.fromCharCode,j;function C(e){throw new RangeError(x[e])}function L(e,t){var n=e.length;var r=[];while(n--){r[n]=t(e[n])}return r}function O(e,t){var n=e.split("@");var r="";if(n.length>1){r=n[0]+"@";e=n[1]}e=e.replace(_,".");var i=e.split(".");var s=L(i,t).join(".");return r+s}function A(e){var t=[],n=0,r=e.length,i,s;while(n<r){i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((i&1023)<<10)+(s&1023)+65536)}else{t.push(i);n--}}else{t.push(i)}}return t}function S(e){return L(e,function(e){var t="";if(e>65535){e-=65536;t+=E(e>>>10&1023|55296);e=56320|e&1023}t+=E(e);return t}).join("")}function T(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return h}function N(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function I(e,t,n){var r=0;e=n?k(e/v):e>>1;e+=k(e/t);for(;e>w*l>>1;r+=h){e=k(e/w)}return k(r+(w+1)*e/(e+p))}function q(e){var t=[],n=e.length,r,i=0,s=m,o=d,a,c,p,v,g,b,_,x,w;a=e.lastIndexOf(y);if(a<0){a=0}for(c=0;c<a;++c){if(e.charCodeAt(c)>=128){C("not-basic")}t.push(e.charCodeAt(c))}for(p=a>0?a+1:0;p<n;){for(v=i,g=1,b=h;;b+=h){if(p>=n){C("invalid-input")}_=T(e.charCodeAt(p++));if(_>=h||_>k((u-i)/g)){C("overflow")}i+=_*g;x=b<=o?f:b>=o+l?l:b-o;if(_<x){break}w=h-x;if(g>k(u/w)){C("overflow")}g*=w}r=t.length+1;o=I(i-v,r,v==0);if(k(i/r)>u-s){C("overflow")}s+=k(i/r);i%=r;t.splice(i++,0,s)}return S(t)}function M(e){var t,n,r,i,s,o,a,c,p,v,g,b=[],_,x,w,j;e=A(e);_=e.length;t=m;n=0;s=d;for(o=0;o<_;++o){g=e[o];if(g<128){b.push(E(g))}}r=i=b.length;if(i){b.push(y)}while(r<_){for(a=u,o=0;o<_;++o){g=e[o];if(g>=t&&g<a){a=g}}x=r+1;if(a-t>k((u-n)/x)){C("overflow")}n+=(a-t)*x;t=a;for(o=0;o<_;++o){g=e[o];if(g<t&&++n>u){C("overflow")}if(g==t){for(c=n,p=h;;p+=h){v=p<=s?f:p>=s+l?l:p-s;if(c<v){break}j=c-v;w=h-v;b.push(E(N(v+j%w,0)));c=k(j/w)}b.push(E(N(c,0)));s=I(n,x,r==i);n=0;++r}}++n;++t}return b.join("")}function U(e){return O(e,function(e){return g.test(e)?q(e.slice(4).toLowerCase()):e})}function D(e){return O(e,function(e){return b.test(e)?"xn--"+M(e):e})}c={version:"1.4.1",ucs2:{decode:A,encode:S},decode:q,encode:M,toASCII:D,toUnicode:U};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return c})}else if(s&&o){if(n.exports==s){o.exports=c}else{for(j in c){c.hasOwnProperty(j)&&(s[j]=c[j])}}}else{i.punycode=c}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],6:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var c=1e3;if(s&&typeof s.maxKeys==="number"){c=s.maxKeys}var u=e.length;if(c>0&&u>c){u=c}for(var h=0;h<u;++h){var f=e[h].replace(a,"%20"),l=f.indexOf(n),p,v,d,m;if(l>=0){p=f.substr(0,l);v=f.substr(l+1)}else{p=f;v=""}d=decodeURIComponent(p);m=decodeURIComponent(v);if(!r(o,d)){o[d]=m}else if(i(o[d])){o[d].push(m)}else{o[d]=[o[d],m]}}return o};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],7:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(r(o))+n;if(i(e[o])){return s(e[o],function(e){return a+encodeURIComponent(r(e))}).join(t)}else{return a+encodeURIComponent(r(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(r(a))+n+encodeURIComponent(r(e))};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var r=0;r<e.length;r++){n.push(t(e[r],r))}return n}var o=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],8:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":6,"./encode":7}],9:[function(e,t,n){"use strict";var r=e("punycode");var i=e("./util");n.parse=x;n.resolve=k;n.resolveObject=E;n.format=w;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["<",">",'"',"`"," ","\r","\n","\t"],h=["{","}","|","\\","^","`"].concat(u),f=["'"].concat(h),l=["%","/","?",";","#"].concat(f),p=["/","?","#"],v=255,d=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:true,"javascript:":true},g={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},_=e("querystring");function x(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;r.parse(e,t,n);return r}s.prototype.parse=function(e,t,n){if(!i.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",u=e.split(a),h=/\\/g;u[0]=u[0].replace(h,"/");e=u.join(a);var x=e;x=x.trim();if(!n&&e.split("#").length===1){var w=c.exec(x);if(w){this.path=x;this.href=x;this.pathname=w[1];if(w[2]){this.search=w[2];if(t){this.query=_.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var k=o.exec(x);if(k){k=k[0];var E=k.toLowerCase();this.protocol=E;x=x.substr(k.length)}if(n||k||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var j=x.substr(0,2)==="//";if(j&&!(k&&g[k])){x=x.substr(2);this.slashes=true}}if(!g[k]&&(j||k&&!b[k])){var C=-1;for(var L=0;L<p.length;L++){var O=x.indexOf(p[L]);if(O!==-1&&(C===-1||O<C))C=O}var A,S;if(C===-1){S=x.lastIndexOf("@")}else{S=x.lastIndexOf("@",C)}if(S!==-1){A=x.slice(0,S);x=x.slice(S+1);this.auth=decodeURIComponent(A)}C=-1;for(var L=0;L<l.length;L++){var O=x.indexOf(l[L]);if(O!==-1&&(C===-1||O<C))C=O}if(C===-1)C=x.length;this.host=x.slice(0,C);x=x.slice(C);this.parseHost();this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T){var N=this.hostname.split(/\./);for(var L=0,I=N.length;L<I;L++){var q=N[L];if(!q)continue;if(!q.match(d)){var M="";for(var U=0,D=q.length;U<D;U++){if(q.charCodeAt(U)>127){M+="x"}else{M+=q[U]}}if(!M.match(d)){var R=N.slice(0,L);var P=N.slice(L+1);var X=q.match(m);if(X){R.push(X[1]);P.unshift(X[2])}if(P.length){x="/"+P.join(".")+x}this.hostname=R.join(".");break}}}}if(this.hostname.length>v){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!T){this.hostname=r.toASCII(this.hostname)}var H=this.port?":"+this.port:"";var $=this.hostname||"";this.host=$+H;this.href+=this.host;if(T){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(x[0]!=="/"){x="/"+x}}}if(!y[E]){for(var L=0,I=f.length;L<I;L++){var W=f[L];if(x.indexOf(W)===-1)continue;var F=encodeURIComponent(W);if(F===W){F=escape(W)}x=x.split(W).join(F)}}var B=x.indexOf("#");if(B!==-1){this.hash=x.substr(B);x=x.slice(0,B)}var Q=x.indexOf("?");if(Q!==-1){this.search=x.substr(Q);this.query=x.substr(Q+1);if(t){this.query=_.parse(this.query)}x=x.slice(0,Q)}else if(t){this.search="";this.query={}}if(x)this.pathname=x;if(b[E]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var H=this.pathname||"";var z=this.search||"";this.path=H+z}this.href=this.format();return this};function w(e){if(i.isString(e))e=x(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=false,o="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&i.isObject(this.query)&&Object.keys(this.query).length){o=_.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(r&&r.charAt(0)!=="#")r="#"+r;if(a&&a.charAt(0)!=="?")a="?"+a;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+n+a+r};function k(e,t){return x(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(x(e,false,true)).format()};function E(e,t){if(!e)return t;return x(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var r=Object.keys(this);for(var o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var c=Object.keys(e);for(var u=0;u<c.length;u++){var h=c[u];if(h!=="protocol")n[h]=e[h]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var f=Object.keys(e);for(var l=0;l<f.length;l++){var p=f[l];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!g[e.protocol]){var v=(e.pathname||"").split("/");while(v.length&&!(e.host=v.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(v[0]!=="")v.unshift("");if(v.length<2)v.unshift("");n.pathname=v.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var d=n.pathname||"";var m=n.search||"";n.path=d+m}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var y=n.pathname&&n.pathname.charAt(0)==="/",_=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=_||y||n.host&&e.pathname,w=x,k=n.pathname&&n.pathname.split("/")||[],v=e.pathname&&e.pathname.split("/")||[],E=n.protocol&&!b[n.protocol];if(E){n.hostname="";n.port=null;if(n.host){if(k[0]==="")k[0]=n.host;else k.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(v[0]==="")v[0]=e.host;else v.unshift(e.host)}e.host=null}x=x&&(v[0]===""||k[0]==="")}if(_){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;k=v}else if(v.length){if(!k)k=[];k.pop();k=k.concat(v);n.search=e.search;n.query=e.query}else if(!i.isNullOrUndefined(e.search)){if(E){n.hostname=n.host=k.shift();var j=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(j){n.auth=j.shift();n.host=n.hostname=j.shift()}}n.search=e.search;n.query=e.query;if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!k.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var C=k.slice(-1)[0];var L=(n.host||e.host||k.length>1)&&(C==="."||C==="..")||C==="";var O=0;for(var A=k.length;A>=0;A--){C=k[A];if(C==="."){k.splice(A,1)}else if(C===".."){k.splice(A,1);O++}else if(O){k.splice(A,1);O--}}if(!x&&!w){for(;O--;O){k.unshift("..")}}if(x&&k[0]!==""&&(!k[0]||k[0].charAt(0)!=="/")){k.unshift("")}if(L&&k.join("/").substr(-1)!=="/"){k.push("")}var S=k[0]===""||k[0]&&k[0].charAt(0)==="/";if(E){n.hostname=n.host=S?"":k.length?k.shift():"";var j=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(j){n.auth=j.shift();n.host=n.hostname=j.shift()}}x=x||n.host&&k.length;if(x&&!S){k.unshift("")}if(!k.length){n.pathname=null;n.path=null}else{n.pathname=k.join("/")}if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":10,punycode:5,querystring:8}],10:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}],11:[function(e,t,n){var r={};t.exports=r;r.svg=e("./svg.js");r.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};r.fromHtml=function e(t){var n,r,i;i=document.createDocumentFragment();r=document.createElement("div");r.insertAdjacentHTML("beforeend",t);for(n=0;n<r.children.length;n++){i.appendChild(r.children[n])}return i};r.batch=function e(t,n){var r,i=Array.prototype.slice.call(arguments,1);if(n instanceof Element){i[0]=n;t.apply(this,i)}else if(Array.isArray(n)){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}else if(n instanceof NodeList||n instanceof NamedNodeMap){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}};r.css=function e(t,n){var r;for(r in n){t.style[r]=n[r]}};r.attr=function e(t,n){var r;for(r in n){if(n[r]===null){t.removeAttribute(r)}else{t.setAttribute(r,n[r])}}};r.remove=function e(t){t.parentNode.removeChild(t)};r.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};r.cloneInto=function e(t,n){r.empty(t);t.appendChild(n.cloneNode(true))};r.insertInto=function e(t,n){r.empty(t);t.appendChild(n)};r.idNamespace=function e(t,n){var i,s={};i=t.querySelectorAll("*");r.batch(r.idNamespace.idAttributePass,i,n,s);r.batch(r.idNamespace.otherAttributesPass,i,s)};r.idNamespace.idAttributePass=function e(t,n,r){r[t.id]=n+"."+t.id;t.id=r[t.id]};r.idNamespace.otherAttributesPass=function e(t,n){r.batch(r.idNamespace.oneAttributeSubPass,t.attributes,n)};r.idNamespace.oneAttributeSubPass=function e(t,n){t.value=t.value.replace(/url\(#([^)]+)\)/g,function(e,t){if(!n[t]){return e}return"url(#"+n[t]+")"})};r.id=function e(t,e){t.id=e};r.text=function e(t,e){t.textContent=e};r.html=function e(t,e){t.innerHTML=e}},{"./svg.js":12}],12:[function(e,t,n){var r=e("fs");var i=e("./dom.js");var s={};t.exports=s;s.load=function e(t,n,i,o){if(typeof i==="function"){o=i}if(!i||typeof i!=="object"){i={}}if(n.substring(0,7)==="file://"){r.readFile(n.slice(7),function(e,n){if(e){o(e);return}var r=new DOMParser;var a=r.parseFromString(n.toString(),"application/xml").documentElement;try{s.attachXmlTo(t,a,i)}catch(e){o(e);return}o(undefined,a)})}else{s.ajax(n,function(e,n){var r=n.documentElement;if(e){o(e);return}try{s.attachXmlTo(t,r,i)}catch(e){o(e);return}o(undefined,r)})}};s.attachXmlTo=function e(t,n,r){s.lightCleanup(n);if(r.id!==undefined){if(typeof r.id==="string"){n.setAttribute("id",r.id)}else if(!r.id){n.removeAttribute("id")}}if(typeof r.class==="string"){n.setAttribute("class",r.class)}if(r.idNamespace){i.idNamespace(n,r.idNamespace)}if(r.hidden){n.style.visibility="hidden"}t.appendChild(n)};s.lightCleanup=function e(t){o(t,"metadata");o(t,"script")};function o(e,t){var n,r,i;r=e.getElementsByTagName(t);for(n=0;n<r.length;n++){i=r.item(n);i.parentNode.removeChild(i)}}s.ajax=function e(t,n){var r=new XMLHttpRequest;r.responseType="document";r.onreadystatechange=s.ajax.ajaxStatus.bind(r,n);r.open("GET",t);r.send()};s.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[dom-kit.svg] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}}},{"./dom.js":11,fs:3}],13:[function(e,t,n){"use strict";function r(){return Object.create(r.prototype)}t.exports=r;r.SYNC=-Infinity;r.init=function e(){Object.defineProperty(this,"__ngev",{value:{nice:r.SYNC,interruptible:false,recursion:0,contexts:{},events:{error:[],interrupt:[],newListener:[],removeListener:[]}}})};r.filterOutCallback=function(e,t){return e!==t};r.prototype.addListener=function e(t,n,i){var s={};if(!this.__ngev){r.init.call(this)}if(!this.__ngev.events[t]){this.__ngev.events[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}s.fn=n||i.fn;s.id=typeof i.id==="string"?i.id:s.fn;s.once=!!i.once;s.async=!!i.async;s.eventObject=!!i.eventObject;s.nice=i.nice!==undefined?Math.floor(i.nice):r.SYNC;s.context=typeof i.context==="string"?i.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(s.context&&typeof s.context==="string"&&!this.__ngev.contexts[s.context]){this.addListenerContext(s.context)}s.event=t;if(this.__ngev.events.newListener.length){this.emit("newListener",[s])}this.__ngev.events[t].push(s);return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function e(t,n,r){if(n&&typeof n==="object"){n.once=true}else if(r&&typeof r==="object"){r.once=true}else{r={once:true}}return this.addListener(t,n,r)};r.prototype.removeListener=function e(t,n){var i,s,o=[],a=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.events[t]){this.__ngev.events[t]=[]}s=this.__ngev.events[t].length;for(i=0;i<s;i++){if(this.__ngev.events[t][i].id===n){a.push(this.__ngev.events[t][i])}else{o.push(this.__ngev.events[t][i])}}this.__ngev.events[t]=o;if(a.length&&this.__ngev.events.removeListener.length){this.emit("removeListener",a)}return this};r.prototype.off=r.prototype.removeListener;r.prototype.removeAllListeners=function e(t){var n;if(!this.__ngev){r.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListener(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.events[t]){this.__ngev.events[t]=[]}n=this.__ngev.events[t];this.__ngev.events[t]=[];if(n.length&&this.__ngev.events.removeListener.length){this.emit("removeListener",n)}}else{this.__ngev.events={}}return this};r.listenerWrapper=function e(t,n,i){var s,o,a;if(n.interrupt){return}if(t.async){if(i){o=i.serial;i.ready=!o}a=function(e){n.listenersDone++;if(e&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=e;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners&&n.callback){n.callback(undefined,n);delete n.callback}if(o){r.processQueue.call(n.emitter,t.context,true)}};if(t.eventObject){t.fn(n,a)}else{s=t.fn.apply(undefined,n.args.concat(a))}}else{if(t.eventObject){t.fn(n)}else{s=t.fn.apply(undefined,n.args)}n.listenersDone++}if(s&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=s;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners&&n.callback){n.callback(undefined,n);delete n.callback}};var i=0;r.prototype.emit=function e(){var t;t={emitter:this};if(typeof arguments[0]==="number"){t.nice=Math.floor(arguments[0]);t.name=arguments[1];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,2,-1)}else{t.args=Array.prototype.slice.call(arguments,2)}}else{t.name=arguments[0];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}t.args=Array.prototype.slice.call(arguments,1);if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,1,-1)}else{t.args=Array.prototype.slice.call(arguments,1)}}return r.emitEvent(t)};r.emitEvent=function e(t){var n=t.emitter,s,o,a=0,c,u,h,f,l=[];if(!n.__ngev){r.init.call(n)}if(!n.__ngev.events[t.name]){n.__ngev.events[t.name]=[]}t.id=i++;t.listenersDone=0;if(t.nice===undefined||t.nice===null){t.nice=n.__ngev.nice}t.listeners=n.__ngev.events[t.name].length;n.__ngev.recursion++;f=n.__ngev.events[t.name].slice();for(s=0,o=f.length;s<o;s++){a++;c=f[s];u=c.context&&n.__ngev.contexts[c.context];if(u&&u.status===r.CONTEXT_DISABLED){continue}if(u){h=Math.max(t.nice,c.nice,u.nice)}else{h=Math.max(t.nice,c.nice)}if(c.once){n.__ngev.events[t.name]=n.__ngev.events[t.name].filter(r.filterOutCallback.bind(undefined,c));l.push(c)}if(u&&(u.status===r.CONTEXT_QUEUED||!u.ready)){u.queue.push({event:t,listener:c,nice:h})}else{try{if(h<0){if(n.__ngev.recursion>=-h){setImmediate(r.listenerWrapper.bind(n,c,t,u))}else{r.listenerWrapper.call(n,c,t,u)}}else{setTimeout(r.listenerWrapper.bind(n,c,t,u),h)}}catch(e){n.__ngev.recursion--;throw e}}}n.__ngev.recursion--;if(l.length&&n.__ngev.events.removeListener.length){n.emit("removeListener",l)}if(!a){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){t.callback(undefined,t);delete t.callback}}return t};r.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.events[t]){this.__ngev.events[t]=[]}return this.__ngev.events[t].slice()};r.listenerCount=function(e,t){if(!e||!(e instanceof r)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};r.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.events[e]){this.__ngev.events[e]=[]}return this.__ngev.events[e].length};r.prototype.setNice=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};r.prototype.setInterruptible=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.interruptible=!!t};r.prototype.setMaxListeners=function(){};r.noop=function(){};r.CONTEXT_ENABLED=0;r.CONTEXT_DISABLED=1;r.CONTEXT_QUEUED=2;r.prototype.addListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!n||typeof n!=="object"){n={}}if(!this.__ngev.contexts[t]){this.__ngev.contexts[t]=Object.create(r.prototype);this.__ngev.contexts[t].nice=r.SYNC;this.__ngev.contexts[t].ready=true;this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;this.__ngev.contexts[t].serial=false;this.__ngev.contexts[t].queue=[]}if(n.nice!==undefined){this.__ngev.contexts[t].nice=Math.floor(n.nice)}if(n.status!==undefined){this.__ngev.contexts[t].status=n.status}if(n.serial!==undefined){this.__ngev.contexts[t].serial=!!n.serial}return this};r.prototype.disableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_DISABLED;return this};r.prototype.enableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;if(this.__ngev.contexts[t].queue.length>0){r.processQueue.call(this,t)}return this};r.prototype.queueListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_QUEUED;return this};r.prototype.serializeListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=n===undefined?true:!!n;return this};r.prototype.setListenerContextNice=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(n);return this};r.prototype.destroyListenerContext=function e(t){var n,i,s,o,a=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}for(s in this.__ngev.events){o=null;i=this.__ngev.events[s].length;for(n=0;n<i;n++){if(this.__ngev.events[s][n].context===t){o=[];a.push(this.__ngev.events[s][n])}else if(o){o.push(this.__ngev.events[s][n])}}if(o){this.__ngev.events[s]=o}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(a.length&&this.__ngev.events.removeListener.length){this.emit("removeListener",a)}return this};r.processQueue=function e(t,n){var i,s;if(!this.__ngev.contexts[t]){return}i=this.__ngev.contexts[t];if(n){i.ready=true}this.__ngev.recursion++;while(i.ready&&i.queue.length){s=i.queue.shift();if(s.event.interrupt){continue}try{if(s.nice<0){if(this.__ngev.recursion>=-s.nice){setImmediate(r.listenerWrapper.bind(this,s.listener,s.event,i))}else{r.listenerWrapper.call(this,s.listener,s.event,i)}}else{setTimeout(r.listenerWrapper.bind(this,s.listener,s.event,i),s.nice)}}catch(e){this.__ngev.recursion--;
throw e}}this.__ngev.recursion--};r.on=r.prototype.on;r.once=r.prototype.once;r.off=r.prototype.off;r.Proxy=e("./Proxy.js")},{"./Proxy.js":14}],14:[function(e,t,n){"use strict";function r(){return r.create()}t.exports=r;var i=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}r.create=function e(){var t=Object.create(r.prototype,{localServices:{value:{},enumerable:true},remoteServices:{value:{},enumerable:true},nextAckId:{value:1,writable:true,enumerable:true}});return t};r.prototype.addLocalService=function e(t,n,r){this.localServices[t]=a.create(this,t,n,r);return this.localServices[t]};r.prototype.addRemoteService=function e(t){this.remoteServices[t]=c.create(this,t);return this.remoteServices[t]};r.prototype.destroy=function e(){var t=this;Object.keys(this.localServices).forEach(function(e){t.localServices[e].destroy();delete t.localServices[e]});Object.keys(this.remoteServices).forEach(function(e){t.remoteServices[e].destroy();delete t.remoteServices[e]});this.receive=this.send=o};r.prototype.push=function e(t){if(t.type!==s||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};r.prototype.receive=function e(t){this.push(t)};r.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,n,r){return a.create(e,t,n,r)}r.LocalService=a;a.create=function e(t,n,r,s){var o=Object.create(a.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:r,writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!s.listen,writable:true,enumerable:true},canEmit:{value:!!s.emit,writable:true,enumerable:true},canAck:{value:!!s.ack,writable:true,enumerable:true},canRpc:{value:!!s.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return o};a.prototype.destroy=function e(){var t=this;Object.keys(this.events).forEach(function(e){t.emitter.off(e,t.events[e]);delete t.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var n=this;var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(r){n.proxy.send({type:s,service:n.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:r})}}i.emitEvent(r)};a.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};a.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};a.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t)};a.forward=function e(t){if(this.destroyed){return}this.proxy.send({type:s,service:this.id,method:"event",event:t.name,args:t.args})};a.forward.ack=false;a.forwardWithAck=function e(t,n){if(this.destroyed){return}var r=this;if(!t.callback){this.proxy.send({type:s,service:this.id,method:"event",event:t.name,args:t.args});n();return}var i=false;var o=this.proxy.nextAckId++;var a=function e(t){if(i||t.ack!==o){return}i=true;r.internalEvents.off("ack",e);n()};this.internalEvents.on("ack",a);this.proxy.send({type:s,service:this.id,method:"event",event:t.name,ack:o,args:t.args})};a.forwardWithAck.ack=true;function c(e,t){return c.create(e,t)}r.RemoteService=c;var u=1;var h=2;c.create=function e(t,n){var r=Object.create(c.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:Object.create(i.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return r};c.prototype.destroy=function e(){var t=this;this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(function(e){delete t.events[e]});this.destroyed=true};c.prototype.emit=function e(t){if(this.destroyed){return}var n=this,r,i,o,a;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof arguments[arguments.length-1]!=="function"){r=Array.prototype.slice.call(arguments,1);this.proxy.send({type:s,service:this.id,method:"emit",event:t,args:r});return}r=Array.prototype.slice.call(arguments,1,-1);i=arguments[arguments.length-1];o=this.proxy.nextAckId++;a=false;var c=function e(t){if(a||t.ack!==o){return}a=true;n.internalEvents.off("ack",e);i(t.interruption)};this.internalEvents.on("ack",c);this.proxy.send({type:s,service:this.id,method:"emit",ack:o,event:t,args:r})};c.prototype.addListener=function e(t,n,r){if(this.destroyed){return}if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}r.fn=n||r.fn;this.emitter.addListener(t,r);if(!this.emitter.__ngev.events[t]||!this.emitter.__ngev.events[t].length){return}if(r.async&&this.events[t]!==h){this.events[t]=h;this.proxy.send({type:s,service:this.id,method:"listen",ack:true,event:t})}else if(!r.async&&!this.events[t]){this.events[t]=u;this.proxy.send({type:s,service:this.id,method:"listen",event:t})}};c.prototype.on=c.prototype.addListener;c.prototype.once=i.prototype.once;c.prototype.removeListener=function e(t,n){if(this.destroyed){return}this.emitter.removeListener(t,n);if((!this.emitter.__ngev.events[t]||!this.emitter.__ngev.events[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({type:s,service:this.id,method:"ignore",event:t})}};c.prototype.off=c.prototype.removeListener;c.prototype.receiveEvent=function e(t){var n=this;if(this.destroyed||!this.events[t.event]){return}var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(){n.proxy.send({type:s,service:n.id,method:"ackEvent",ack:t.ack,event:t.event})}}i.emitEvent(r);var o=r.name;if(!this.emitter.__ngev.events[o]||!this.emitter.__ngev.events[o].length){this.events[o]=0;this.proxy.send({type:s,service:this.id,method:"ignore",event:o})}};c.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==h){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":13}]},{},[1])(1)});