(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var l=typeof require=="function"&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){(function(n){"use strict";var i,r;if(n.browser){i=new DOMParser;r=new XMLSerializer}else{var s=e("@cronvel/xmldom");i=new s.DOMParser;r=new s.XMLSerializer}var o={};t.exports=o;o.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};o.fromXml=function e(t){return i.parseFromString(t,"application/xml")};o.toXml=function e(t){return r.serializeToString(t)};o.fromHtml=function e(t){var n,i,r;r=document.createDocumentFragment();i=document.createElement("div");i.insertAdjacentHTML("beforeend",t);for(n=0;n<i.children.length;n++){r.appendChild(i.children[n])}return r};o.batch=function e(t,n){var i,r=Array.prototype.slice.call(arguments,1);if(n instanceof Element){r[0]=n;t.apply(this,r)}else if(Array.isArray(n)){for(i=0;i<n.length;i++){r[0]=n[i];t.apply(this,r)}}else if(n instanceof NodeList||n instanceof NamedNodeMap){for(i=0;i<n.length;i++){r[0]=n[i];t.apply(this,r)}}};o.css=function e(t,n){var i;for(i in n){t.style[i]=n[i]}};o.attr=function e(t,n){var i;for(i in n){if(n[i]===null){t.removeAttribute(i)}else{t.setAttribute(i,n[i])}}};o.class=function e(t,n){var i;for(i in n){if(n[i]){t.classList.add(i)}else{t.classList.remove(i)}}};o.remove=function e(t){t.parentNode.removeChild(t)};o.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};o.cloneInto=function e(t,n){o.empty(n);n.appendChild(t.cloneNode(true))};o.insertInto=function e(t,n){o.empty(n);n.appendChild(t)};o.moveChildrenInto=function e(t,n){o.empty(n);while(t.firstChild){n.appendChild(t.firstChild)}};o.moveAttributes=function e(t,n){Array.from(t.attributes).forEach(function(e){var i=e.name;var r=e.value;t.removeAttribute(i);if(i!=="xmlns"&&i.indexOf(":")===-1&&r){n.setAttribute(i,r)}})};o.styleToAttribute=function e(t,n){if(t.style[n]){t.setAttribute(n,t.style[n]);t.style[n]=null}};o.prefixIds=function e(t,n){var i,r={};i=t.querySelectorAll("*");o.batch(o.prefixIds.idAttributePass,i,n,r);o.batch(o.prefixIds.otherAttributesPass,i,r)};o.prefixIds.idAttributePass=function e(t,n,i){i[t.id]=n+"."+t.id;t.id=i[t.id]};o.prefixIds.otherAttributesPass=function e(t,n){o.batch(o.prefixIds.oneAttributeSubPass,t.attributes,n)};o.prefixIds.oneAttributeSubPass=function e(t,n){t.value=t.value.replace(/url\(#([^)]+)\)/g,function(e,t){if(!n[t]){return e}return"url(#"+n[t]+")"})};o.removeAllTags=function e(t,n,i){Array.from(t.getElementsByTagName(n)).forEach(function(e){if(!i||!e.firstChild){e.parentNode.removeChild(e)}})};o.removeAllAttributes=function e(t,n){t.removeAttribute(n);Array.from(t.querySelectorAll("["+n+"]")).forEach(function(e){e.removeAttribute(n)})};o.id=function e(t,e){t.id=e};o.text=function e(t,e){t.textContent=e};o.html=function e(t,e){t.innerHTML=e}}).call(this,e("_process"))},{"@cronvel/xmldom":6,_process:11}],2:[function(e,t,n){"use strict";var i=e("dom-kit");var r=e("svg-kit");function s(){}function o(){return o.create()}t.exports=o;o.create=function e(){var t=Object.create(o.prototype);t.$body=document.querySelector("body");t.$theme=document.querySelector("#theme");t.$gfx=document.querySelector("#gfx");t.$sceneImage=document.querySelector(".scene-image");t.$main=document.querySelector("main");t.$mainBuffer=document.querySelector("#main-buffer");t.$altBuffer=document.querySelector("#alt-buffer");t.$dialogWrapper=document.querySelector("#dialog-wrapper");t.$lobby=document.querySelector("#lobby");t.$clientStatus=t.$lobby.querySelector(".client-status");t.$status=document.querySelector("#status");t.$panel=document.querySelector("#panel");t.$music=document.querySelector("#music");t.$sound0=document.querySelector("#sound0");t.$sound1=document.querySelector("#sound1");t.$sound2=document.querySelector("#sound2");t.$sound3=document.querySelector("#sound3");t.choices=[];t.newSegmentNeeded=false;t.onSelect=null;t.toMainBuffer();t.nextSoundChannel=0;t.sprites={};t.animations={};t.hideContentTimer=null;t.onChatSubmit=null;t.initEvents();return t};o.prototype.cleanUrl=function e(t){if(t[0]==="/"){return t}return"/script/"+t};o.prototype.setTheme=function e(t){this.$theme.setAttribute("href",this.cleanUrl(t.url))};o.prototype.initEvents=function e(){var t=this;this.$gfx.addEventListener("click",this.toggleContent.bind(this),false);this.$dialogWrapper.addEventListener("click",this.clearDialog.bind(this),false);this.$lobby.addEventListener("click",function(){t.$lobby.classList.toggle("toggled")});this.$status.addEventListener("click",function(){t.$status.classList.toggle("toggled")});this.$panel.addEventListener("click",function(){t.$panel.classList.toggle("toggled")})};o.prototype.toggleContent=function e(){if(this.$main.classList.contains("hidden")){this.showContent()}else{this.hideContent()}};o.prototype.hideContent=function e(){if(this.hideContentTimer!==null){clearTimeout(this.hideContentTimer);this.hideContentTimer=null}this.$main.classList.add("hidden");this.hideContentTimer=setTimeout(this.showContent.bind(this),8e3)};o.prototype.showContent=function e(){if(this.hideContentTimer!==null){clearTimeout(this.hideContentTimer);this.hideContentTimer=null}this.$main.classList.remove("hidden")};o.prototype.toMainBuffer=function e(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHints();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$importantMessages=null;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.getSwitchedElements()};o.prototype.toAltBuffer=function e(){if(this.$activeBuffer===this.$altBuffer){return}this.$importantMessages=this.$activeSegment;this.$activeBuffer=this.$altBuffer;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.getSwitchedElements()};o.prototype.getSwitchedElements=function e(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$hint=this.$activeBuffer.querySelector(".hint");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};o.prototype.clientStatus=function e(t){this.$clientStatus.setAttribute("data-status",t);this.$clientStatus.setAttribute("title",t)};o.prototype.setMultiplayer=function e(t,n){n=n||s;if(t||t===undefined){this.$body.classList.add("multiplayer")}else{this.$body.classList.remove("multiplayer")}n()};o.prototype.clear=function e(t){t=t||s;i.empty(this.$hint);i.empty(this.$dialogWrapper);i.empty(this.$activeMessages);i.empty(this.$choices);t()};o.prototype.clearHints=function e(t){t=t||s;i.empty(this.$hint);t()};o.prototype.clearMessages=function e(t){t=t||s;i.empty(this.$activeMessages);t()};o.prototype.clearHistory=function e(t){t=t||s;i.empty(this.$history);t()};o.prototype.newSegment=function e(t){t=t||s;this.newSegmentNeeded=false;if(this.$activeSegment&&!this.$activeSegment.textContent){t();return}var n=this.$activeSegment;var i=document.createElement("segment");this.$activeSegment=i;this.$activeMessages.appendChild(i);if(n){this.$history.appendChild(n);n.scrollIntoView(false)}t()};o.prototype.newSegmentOnContent=function e(){this.newSegmentNeeded=true};o.prototype.addMessage=function e(t,n,i){i=i||s;var r=document.createElement("p");r.classList.add("text");r.innerHTML=t;if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(r);if(n.important&&this.$importantMessages){this.$importantMessages.appendChild(r.cloneNode(true))}i()};o.prototype.messageNext=function e(t){t()};o.prototype.addIndicators=function e(t,n,r){var o=this;r=r||s;if(n){i.empty(this.$status);if(t.length){this.$status.classList.remove("empty")}else{this.$status.classList.add("empty");r();return}}var a=document.createElement("indicator-list");t.forEach(function(e){var t,n,i,r,s,l;t=document.createElement("indicator");n=document.createElement("label");n.classList.add("label");if(e.image){t.classList.add("has-image");i=document.createElement("img");i.classList.add("image");i.setAttribute("src",o.cleanUrl(e.image));if(e.label){i.setAttribute("alt",e.label);i.setAttribute("title",e.label)}n.appendChild(i)}else{n.textContent=e.label}t.appendChild(n);r=document.createElement("widget");r.classList.add("widget");r.classList.add(e.type);r.setAttribute("data-value",e.value);switch(e.type){case"hbar":l=document.createElement("outer-bar");r.appendChild(l);s=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){s.style.backgroundColor=e.color}s.style.width=""+e.value+"%";l.appendChild(s);break;case"vbar":l=document.createElement("outer-bar");r.appendChild(l);s=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){s.style.backgroundColor=e.color}s.style.height=""+e.value+"%";l.appendChild(s);break;case"text":default:r.textContent=e.value}t.appendChild(r);a.appendChild(t)});if(n){this.$status.appendChild(a)}else{if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(a)}r()};o.prototype.createOnSelect=function e(t){var n=this;this.onSelect=function(e){var n=e.currentTarget;var i=n.getAttribute("data-select-index");if(!i){return}i=parseInt(i,10);t(i)}};o.prototype.addPanel=function e(t,n,o){var a=this;o=o||s;if(n){i.empty(this.$panel);if(t.length){this.$panel.classList.remove("empty")}else{this.$panel.classList.add("empty");o();return}}else if(t.length){this.$panel.classList.remove("empty")}t.forEach(function(e){var t,n,i="button-"+e.id;if(document.getElementById(i)){return}t=document.createElement("item");t.classList.add("item");t.setAttribute("id",i);if(e.image){t.classList.add("has-image");if(e.image.endsWith(".svg")){n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("svg");r.load(a.cleanUrl(e.image),{removeSize:true,removeIds:true,colorClass:true,as:n})}else{n=document.createElement("img");n.setAttribute("src",a.cleanUrl(e.image))}n.classList.add("icon");n.classList.add("image");if(e.label){n.setAttribute("alt",e.label);n.setAttribute("title",e.label)}t.appendChild(n)}else{t.textContent=e.label}t.addEventListener("click",a.onSelect,false);a.$panel.appendChild(t)});o()};o.prototype.clearChoices=function e(t){var n=this,r,o,a,l;t=t||s;this.choices.forEach(function(e){if(!e.button){return}var t="button-"+e.button;if((l=document.getElementById(t))&&l.getAttribute("data-select-index")){l.removeAttribute("data-select-index");l.removeEventListener("click",n.onSelect)}});i.empty(this.$choices);this.choices.length=0;this.onSelect=null;t()};o.prototype.addChoices=function e(t,n,i){var r=this,o=false;var a=document.createDocumentFragment();var l=document.createElement("group");i=i||s;this.createOnSelect(n);t.forEach(function(e){var t;r.choices.push(e);if(e.button&&(t=document.getElementById("button-"+e.button))&&!t.getAttribute("data-select-index")){if(e.groupBreak){o=true}t.setAttribute("data-select-index",e.index);t.addEventListener("click",r.onSelect);return}var n=document.createElement("choice");n.classList.add("choice",e.type);n.setAttribute("data-select-index",e.index);if(e.image){n.classList.add("has-image");var i=document.createElement("img");i.classList.add("image");i.setAttribute("src",r.cleanUrl(e.image));n.appendChild(i)}var s=document.createElement("span");s.classList.add("label");s.textContent=e.label;n.appendChild(s);if(e.selectedBy&&e.selectedBy.length){var c=document.createElement("span");c.classList.add("italic","brightBlack");c.textContent=" "+e.selectedBy.join(", ");n.appendChild(c)}n.addEventListener("click",r.onSelect);if(e.groupBreak||o){o=false;a.appendChild(l);l=document.createElement("group")}l.appendChild(n)});a.appendChild(l);this.$choices.appendChild(a);i()};o.prototype.getChoiceColumnsCount=function e(t){var n=0,i=0;t.forEach(function(e){if(e.groupBreak){if(n>i){i=n}n=0}n++});if(n>i){i=n}return i};o.prototype.setChoices=function e(t,n,i,r,o){var a=this;r=r||{};o=o||s;this.clearChoices(function(){switch(r.style){case"inline":case"smallInline":case"list":case"smallList":a.$choices.setAttribute("data-choice-style",r.style);break;case"table":a.$choices.setAttribute("data-choice-style",r.style);a.$choices.classList.add("columns-"+a.getChoiceColumnsCount(t));break;default:a.$choices.setAttribute("data-choice-style","list")}a.addChoices(t,i,o);if(n&&n.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=n.join(", ");a.$choices.appendChild(e)}if(typeof r.timeout==="number"){a.choiceTimeout(r.timeout)}})};o.prototype.updateChoices=o.prototype.setChoices;o.prototype.choiceTimeout=function e(t){var n=Date.now(),i,r;i=document.createElement("p");i.classList.add("timer");i.textContent=Math.round(t/1e3);this.$choices.appendChild(i);r=setInterval(function(){if(!i.parentNode){clearInterval(r);return}i.textContent=Math.round((t+n-Date.now())/1e3)},1e3)};o.prototype.textInputDisabled=function e(t){var n=document.createElement("form"),i=document.createElement("label"),r=document.createElement("input");i.textContent=t.label;r.setAttribute("placeholder",t.placeholder);r.setAttribute("disabled",true);r.setAttribute("type","text");r.classList.add("text-input");n.appendChild(i);n.appendChild(r);if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(n)};o.prototype.textInput=function e(t,n){var i=document.createElement("form"),r=document.createElement("label"),s=document.createElement("input");r.classList.add("text");r.textContent=t.label;s.setAttribute("type","text");s.classList.add("text-input");i.appendChild(r);i.appendChild(s);if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(i);s.focus();var o=function e(t){t.preventDefault();i.removeEventListener("submit",e);s.setAttribute("disabled",true);n(s.value)};i.addEventListener("submit",o)};o.prototype.enableChat=function e(t){var n=this;if(!this.onChatSubmit){this.onChatSubmit=function(e){e.preventDefault();t(n.$chatInput.value);n.$chatInput.value=""};this.$chatForm.addEventListener("submit",this.onChatSubmit);this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};o.prototype.disableChat=function e(){this.$chatForm.removeEventListener("submit",this.onChatSubmit);this.onChatSubmit=null;this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};o.prototype.clearHint=function e(){i.empty(this.$hint)};o.prototype.setBigHint=function e(t,n){var r=document.createElement("h2");r.textContent=t;if(n){i.class(r,n)}i.empty(this.$hint);this.$hint.appendChild(r)};o.prototype.clearDialog=function e(){var t=this;this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var n=false;var r=function(){t.$dialogWrapper.removeEventListener("transitionstart",r);if(n){return}n=true;t.$dialogWrapper.addEventListener("transitionend",s)};var s=function(){t.$dialogWrapper.removeEventListener("transitionend",s);i.empty(this.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",r);setTimeout(function(){if(n){return}n=true;i.empty(this.$dialogWrapper)},10)};o.prototype.setDialog=function e(t,n,r){n=n||{};r=r||s;if(n.contentDelay&&!this.newSegmentNeeded){delete n.contentDelay;var o=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var a=Math.min(o*10,5e3);console.warn("contentLength/delay",o,a);setTimeout(this.setDialog.bind(this,t,n,r),a);return}var l=document.createElement("div");l.classList.add("dialog");if(n.title){var c=document.createElement("h2");c.classList.add("title");c.textContent=n.title;l.appendChild(c)}var u=document.createElement("div");u.classList.add("message");u.textContent=t;l.appendChild(u);if(n.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(n.big){l.classList.add("big")}if(n.fun){l.classList.add("fun")}if(n.alert){l.classList.add("alert")}if(n.modal){l.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}i.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(l);this.$dialogWrapper.classList.remove("empty");r()};o.prototype.setSceneImage=function e(t){var n=false;var i=this.$sceneImage;this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(t.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")'}if(t.origin&&typeof t.origin==="string"){this.$sceneImage.style.backgroundPosition=t.origin}var r=function e(){if(n){return}n=true;i.remove()};if(i){i.addEventListener("transitionend",r,false);this.$gfx.insertBefore(this.$sceneImage,i);i.classList.add("hidden");setTimeout(r,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(t.position){case"left":this.$body.setAttribute("data-image-position","left");break;case"right":default:this.$body.setAttribute("data-image-position","right");break}};o.prototype.showSprite=function e(t,n){var r=this,s,o;if(!n.url||typeof n.url!=="string"){return}o=this.sprites[t];s=this.sprites[t]={actionCallback:n.actionCallback,action:null,style:{},animation:null};s.$img=document.createElement("img");s.$img.classList.add("sprite");if(n.maskUrl){console.warn("has mask!");i.svg.load(null,this.cleanUrl(n.maskUrl),{class:{spriteMask:true,clickable:true},css:n.style,noWidthHeightAttr:true},function(e,t){if(e){console.warn(e);return}s.$mask=t;r.updateSprite(null,n,s);if(o){o.$img.remove()}r.$gfx.append(s.$img);r.$gfx.append(s.$mask)});return}this.updateSprite(null,n,s);if(o){o.$img.remove()}this.$gfx.append(s.$img)};o.prototype.updateSprite=function e(t,n,r){var s,o;if(!n.style||typeof n.style!=="object"){n.style={}}if(r){s=r}else{if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}s=this.sprites[t]}delete n.style.position;if(n.url){s.$img.setAttribute("src",this.cleanUrl(n.url))}if(n.action!==undefined){o=s.$mask||s.$img;if(n.action&&!s.action){s.onClick=function(e){s.actionCallback(s.action);e.stopPropagation()};o.classList.add("clickable");o.addEventListener("click",s.onClick)}else if(!n.action&&s.action){o.classList.remove("clickable");o.removeEventListener("click",s.onClick)}s.action=n.action||null}Object.assign(s.style,n.style);i.css(s.$img,n.style);if(s.$mask){console.warn("update mask!");i.css(s.$mask,n.style)}};o.prototype.animateSprite=function e(t,n){var i=this,r,s,o,a=0;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}r=this.sprites[t];s=this.animations[n];r.animation=n;if(!Array.isArray(s.frames)||!s.frames.length){return}var l=function(){o=s.frames[a];i.updateSprite(null,o,r);if(++a<s.frames.length){setTimeout(l,o.duration*1e3)}else{r.animation=null}};l()};o.prototype.defineAnimation=function e(t,n){this.animations[t]=n};o.prototype.clearSprite=function e(t){var n;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}n=this.sprites[t];n.$img.remove();if(n.$mask){n.$mask.remove()}delete this.sprites[t]};o.prototype.sound=function e(t){var n=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,t,n);this.nextSoundChannel=(this.nextSoundChannel+1)%4;n.setAttribute("src",this.cleanUrl(t.url));n.play()};o.prototype.music=function e(t){var n=this,i=this.$music.getAttribute("src");if(t.url){t.url=this.cleanUrl(t.url);if(i){if(i!==t.url){u(this.$music,function(){n.$music.setAttribute("src",t.url);n.$music.play();c(n.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",t.url);this.$music.play();c(this.$music)}}else{if(i){u(this.$music,function(){n.$music.removeAttribute("src")})}}};var a=10;var l=.01;function c(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+l);e.__fadeTimer=setTimeout(c.bind(undefined,e,t),a)}function u(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-l);e.__fadeTimer=setTimeout(u.bind(undefined,e,t),a)}},{"dom-kit":1,"svg-kit":22}],3:[function(e,t,n){"use strict";var i=e("nextgen-events");var r=e("dom-kit");var s=e("url");function o(e){return o.create(e)}t.exports=o;o.prototype=Object.create(i.prototype);o.prototype.constructor=o;o.create=function e(t){var n=Object.create(o.prototype,{token:{value:t.token||"null",writable:true,enumerable:true},port:{value:t.port||80,writable:true,enumerable:true},userName:{value:t.name||"unknown_"+Math.floor(Math.random()*1e4),writable:true,enumerable:true},ws:{value:null,writable:true,enumerable:true},proxy:{value:null,writable:true,enumerable:true}});return n};var a={classic:e("./ui/classic.js")};o.autoCreate=function e(){var t=s.parse(window.location.href,true).query;window.spellcastClient=o.create(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};o.prototype.run=function e(t){var n=this,r=false;this.proxy=new i.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(function(e){if(a[e]){a[e](n.proxy.remoteServices.bus,n)}});this.ws=new WebSocket("ws://127.0.0.1:"+this.port+"/"+this.token);this.emit("connecting");this.ws.onerror=function e(){if(!r){console.log("Can't open Websocket (error)...");n.emit("error","unreachable");return}};this.ws.onopen=function e(){r=true;console.log("Websocket opened!");n.emit("open");n.proxy.remoteServices.bus.emit("authenticate",{name:n.userName});if(typeof t==="function"){t()}};this.ws.onclose=function e(){if(!r){console.log("Can't open Websocket (close)...");n.emit("error","unreachable");return}r=false;n.proxy.destroy();console.log("Websocket closed!");n.emit("close")};this.ws.onmessage=function e(t){var i;try{i=JSON.parse(t.data)}catch(e){return}console.log("Message received: ",i);n.proxy.receive(i)};n.proxy.send=function e(t){n.ws.send(JSON.stringify(t))}};o.autoCreate();r.ready(function(){window.spellcastClient.run()})},{"./ui/classic.js":5,"dom-kit":1,"nextgen-events":8,url:20}],4:[function(e,t,n){"use strict";var i={};t.exports=i;var r=e("string-kit/lib/format.js").markupMethod;var s=e("string-kit/lib/escape.js").html;var o={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="brightBlue">',c:'<span class="cyan">',C:'<span class="brightCyan">',g:'<span class="green">',G:'<span class="brightGreen">',k:'<span class="black">',K:'<span class="brightBlack">',m:'<span class="magenta">',M:'<span class="brightMagenta">',r:'<span class="red">',R:'<span class="brightRed">',w:'<span class="white">',W:'<span class="brightWhite">',y:'<span class="yellow">',Y:'<span class="brightYellow">'}};i.markup=function(){var e=Array.from(arguments);e[0]=s(e[0]).replace(/\n/,"<br />");return r.apply(o,e)}},{"string-kit/lib/escape.js":17,"string-kit/lib/format.js":18}],5:[function(e,t,n){"use strict";var i=e("../Dom.js");var r=e("../toolkit.js");function s(e,t,n){console.log(Array.from(arguments));if(!n){n=Object.create(s.prototype,{bus:{value:e,enumerable:true},client:{value:t,enumerable:true},user:{value:null,writable:true,enumerable:true},users:{value:null,writable:true,enumerable:true},roles:{value:null,writable:true,enumerable:true},roleId:{value:null,writable:true,enumerable:true},config:{value:null,writable:true,enumerable:true},inGame:{value:false,writable:true,enumerable:true},nexts:{value:null,writable:true,enumerable:true},afterNext:{value:false,writable:true,enumerable:true},afterNextTriggered:{value:false,writable:true,enumerable:true},afterLeave:{value:false,writable:true,enumerable:true},hasNewContent:{value:false,writable:true,enumerable:true},dom:{value:i.create()}})}n.client.once("connecting",s.clientConnecting.bind(n));n.client.once("open",s.clientOpen.bind(n));n.client.once("close",s.clientClose.bind(n));n.client.on("error",s.clientError.bind(n));n.dom.enableChat(function(e){console.log("inGame?",n.inGame);n.bus.emit(n.inGame?"command":"chat",e)});return n}t.exports=s;function o(e){return this.find(function(t){return t.id===e})}s.prototype.initBus=function e(){this.bus.on("clientConfig",s.clientConfig.bind(this));this.bus.on("user",s.user.bind(this));this.bus.on("userList",s.userList.bind(this));this.bus.on("roleList",s.roleList.bind(this));this.bus.on("extOutput",s.extOutput.bind(this));this.bus.on("extErrorOutput",s.extErrorOutput.bind(this));this.bus.on("message",s.message.bind(this),{async:true});this.bus.on("indicators",s.indicators.bind(this));this.bus.on("status",s.status.bind(this));this.bus.on("panel",s.panel.bind(this));this.bus.on("theme",s.theme.bind(this));this.bus.on("image",s.image.bind(this));this.bus.on("sound",s.sound.bind(this));this.bus.on("music",s.music.bind(this));this.bus.on("defineAnimation",s.defineAnimation.bind(this));this.bus.on("showSprite",s.showSprite.bind(this));this.bus.on("updateSprite",s.prototype.updateSprite.bind(this));this.bus.on("animateSprite",s.animateSprite.bind(this));this.bus.on("clearSprite",s.clearSprite.bind(this));this.bus.on("enterScene",s.enterScene.bind(this));this.bus.on("leaveScene",s.leaveScene.bind(this));this.bus.on("nextList",s.nextList.bind(this));this.bus.on("nextTriggered",s.nextTriggered.bind(this));this.bus.on("textInput",s.textInput.bind(this));this.bus.on("rejoin",s.rejoin.bind(this));this.bus.on("wait",s.wait.bind(this));this.bus.on("end",s.end.bind(this),{async:true});this.bus.on("exit",s.exit.bind(this));this.bus.emit("ready")};s.clientConnecting=function e(){console.log("Connecting!");this.dom.clientStatus("connecting")};s.clientOpen=function e(){console.log("Connected!");this.dom.clientStatus("connected");this.initBus()};s.clientClose=function e(){console.log("Closed!");this.dom.clientStatus("closed")};s.clientError=function e(t){switch(t){case"unreachable":this.dom.clientStatus("unreachable");break}};s.clientConfig=function e(t){console.warn("Client config received: ",t);this.config=t;if(this.config.theme){this.dom.setTheme(this.config.theme)}};s.user=function e(t){console.log("User received: ",t);this.user=t};s.userList=function e(t){console.log("User-list received: ",t);t.get=o;this.users=t};s.roleList=function e(t,n,i){var r=this,s=[],a;if(!this.roles&&t.length>1){this.dom.setMultiplayer(true)}t.get=o;this.roles=t;if(this.inGame){return}if(i&&t.length<=1){this.roleId=t[0].id;return}t.forEach(function(e,t){var n=e.clientId&&r.users.get(e.clientId).name;s.push({index:t,label:e.label,type:"role",selectedBy:n&&[n]})});if(n.length){a=n.map(function(e){return r.users.get(e).name})}var l=function(e){if(t[e].clientId===r.user.id){r.bus.emit("selectRole",null)}else if(t[e].clientId!==null){return}else{r.bus.emit("selectRole",e)}};this.dom.setChoices(s,a,l);if(i){t.find(function(e,t){if(e.clientId===r.user.id){r.roleId=e.id;return true}return false});this.afterLeave=true;return}};s.message=function e(t,n,i){var s=this,o=false;this.hasNewContent=true;t=r.markup(t);if(!n){n={}}var a=function e(){if(o){return}o=true;if(n.next){s.messageNext(i);return}i()};this.dom.addMessage(t,n,a)};s.prototype.messageNext=function e(t){this.dom.messageNext(t)};s.indicators=function e(t){this.dom.addIndicators(t)};s.status=function e(t){this.dom.addIndicators(t,true)};s.panel=function e(t,n){this.dom.addPanel(t,n)};s.enterScene=function e(t,n){this.inGame=true;if(n){this.dom.toAltBuffer()}else if(!t){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};s.leaveScene=function e(t,n){if(n){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};s.nextTriggered=function e(){this.afterNextTriggered=true;this.hasNewContent=false;this.dom.clearChoices()};s.nextList=function e(t,n,i,r,s){var o=this,a=[],l,c=0;this.nexts=t;this.afterNext=true;if(s&&this.roles.length===1){return}t.forEach(function(e,t){var n=e.roleIds.map(function(e){return o.roles.get(e).label});if(e.label){c+=e.label.length}a.push({index:t,label:e.label||"Next",image:e.image,button:e.button,groupBreak:!!e.groupBreak,type:"next",selectedBy:n})});if(!r.style||r.style==="auto"){if(this.roles.length<=1&&a.length<=3&&c<20){r.style="inline"}else if(a.length>8){r.style="smallList"}else{r.style="list"}}if(i.length&&this.roles.length){l=i.map(function(e){return o.roles.get(e).label})}var u=function(e){if(t[e].roleIds.indexOf(o.roleId)!==-1){o.bus.emit("selectNext",null)}else{o.bus.emit("selectNext",e)}};this.dom.setChoices(a,l,u,{timeout:r.timeout,style:r.style})};s.extOutput=function e(t){alert("not coded ATM!")};s.extErrorOutput=function e(t){alert("not coded ATM!")};s.textInput=function e(t,n){var i=this,r={label:t};if(n.indexOf(this.roleId)===-1){r.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(r)}else{this.dom.textInput(r,function(e){i.bus.emit("textSubmit",e)})}};s.rejoin=function e(){};s.wait=function e(t){var n=this;switch(t){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoin",function(){n.dom.clearHint()});break;default:this.dom.setBigHint("WAITING FOR "+t,{wait:true,"pulse-animation":true})}};s.theme=function e(t){if(!t.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(t)};s.image=function e(t){this.dom.setSceneImage(t)};s.defineAnimation=function e(t,n){this.dom.defineAnimation(t,n)};s.showSprite=function e(t,n){if(!n.url||typeof n.url!=="string"){return}n.actionCallback=s.spriteActionCallback.bind(this);this.dom.showSprite(t,n)};s.spriteActionCallback=function e(t){console.warn("action triggered: ",t);this.bus.emit("action",t)};s.prototype.updateSprite=function e(t,n){this.dom.updateSprite(t,n)};s.animateSprite=function e(t,n){this.dom.animateSprite(t,n)};s.clearSprite=function e(t){this.dom.clearSprite(t)};s.sound=function e(t){this.dom.sound(t)};s.music=function e(t){this.dom.music(t)};s.end=function e(t,n,i){var r={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};switch(t){case"end":this.dom.setDialog("The End.",r,i);break;case"win":this.dom.setDialog("You Win!",r,i);break;case"lost":this.dom.setDialog("You Lose...",r,i);break;case"draw":this.dom.setDialog("Draw.",r,i);break}};s.exit=function e(){}},{"../Dom.js":2,"../toolkit.js":4}],6:[function(e,t,n){},{}],7:[function(e,t,n){t.exports=function(e){return e!=null&&(i(e)||r(e)||!!e._isBuffer)};function i(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}
function r(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&i(e.slice(0,0))}},{}],8:[function(e,t,n){(function(n){"use strict";function i(){return Object.create(i.prototype)}t.exports=i;i.prototype.__prototypeUID__="nextgen-events/NextGenEvents";i.prototype.__prototypeVersion__=e("../package.json").version;i.SYNC=-Infinity;i.init=function e(){Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:i.SYNC,interruptible:false,recursion:0,contexts:{},states:{},stateGroups:{},listeners:{error:[],interrupt:[],newListener:[],removeListener:[]}}})};i.initFrom=function e(t){if(!t.__ngev){i.init.call(t)}Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:t.__ngev.nice,interruptible:t.__ngev.interruptible,recursion:0,contexts:{},states:Object.assign({},t.__ngev.states),stateGroups:Object.assign({},t.__ngev.stateGroups),listeners:{}}});Object.keys(t.__ngev.listeners).forEach(e=>{this.__ngev.listeners[e]=t.__ngev.listeners[e].slice()});Object.keys(t.__ngev.contexts).forEach(e=>{var n=t.__ngev.contexts[e];this.addListenerContext(e,{nice:n.nice,status:n.status,serial:n.serial})})};i.mergeListeners=function e(t){if(!this.__ngev){i.init.call(this)}var n=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(n).forEach(e=>{this.__ngev.listeners[e]=[]});t.forEach(e=>{if(!e.__ngev){i.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(e=>{var i,r,s=[];if(n[e]){n[e].forEach(n=>{for(i=0,r=t.length;i<r;i++){if(!t[i].__ngev.listeners[e]||t[i].__ngev.listeners[e].indexOf(n)===-1){s.push(n);break}}})}t.forEach(t=>{t.__ngev.listeners[e].forEach(t=>{if(this.__ngev.listeners[e].indexOf(t)===-1&&s.indexOf(t)===-1){this.__ngev.listeners[e].push(t)}})})})};i.filterOutCallback=function(e,t){return e!==t};i.prototype.addListener=function e(t,n,r){var s={},o;if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}s.fn=n||r.fn;s.id=r.id!==undefined?r.id:s.fn;s.once=!!r.once;s.async=!!r.async;s.eventObject=!!r.eventObject;s.nice=r.nice!==undefined?Math.floor(r.nice):i.SYNC;s.context=typeof r.context==="string"?r.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(s.context&&typeof s.context==="string"&&!this.__ngev.contexts[s.context]){this.addListenerContext(s.context)}s.event=t;if(this.__ngev.listeners.newListener.length){o=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[t].push(s);i.emitEvent({emitter:this,name:"newListener",args:[[s]],listeners:o});if(this.__ngev.states[t]){i.emitToOneListener(this.__ngev.states[t],s)}return this}this.__ngev.listeners[t].push(s);if(this.__ngev.states[t]){i.emitToOneListener(this.__ngev.states[t],s)}return this};i.prototype.on=i.prototype.addListener;i.prototype.once=function e(t,n,i){if(n&&typeof n==="object"){n.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.addListener(t,n,i)};i.prototype.removeListener=function e(t,n){var r,s,o=[],a=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}s=this.__ngev.listeners[t].length;for(r=0;r<s;r++){if(this.__ngev.listeners[t][r].id===n){a.push(this.__ngev.listeners[t][r])}else{o.push(this.__ngev.listeners[t][r])}}this.__ngev.listeners[t]=o;if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};i.prototype.off=i.prototype.removeListener;i.prototype.removeAllListeners=function e(t){var n;if(!this.__ngev){i.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}n=this.__ngev.listeners[t];this.__ngev.listeners[t]=[];if(n.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",n)}}else{this.__ngev.listeners={}}return this};i.listenerWrapper=function e(t,n,r){var s,o,a;if(n.interrupt){return}if(t.async){if(r){o=r.serial;r.ready=!o}a=(e=>{n.listenersDone++;if(e&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=e;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}if(o){i.processQueue.call(n.emitter,t.context,true)}});if(t.eventObject){t.fn(n,a)}else{s=t.fn.apply(undefined,n.args.concat(a))}}else{if(t.eventObject){t.fn(n)}else{s=t.fn.apply(undefined,n.args)}n.listenersDone++}if(s&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=s;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}};var r=0;i.prototype.emit=function e(){var t;t={emitter:this};if(typeof arguments[0]==="number"){t.nice=Math.floor(arguments[0]);t.name=arguments[1];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,2,-1)}else{t.args=Array.prototype.slice.call(arguments,2)}}else{t.name=arguments[0];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}t.args=Array.prototype.slice.call(arguments,1);if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,1,-1)}else{t.args=Array.prototype.slice.call(arguments,1)}}return i.emitEvent(t)};i.emitEvent=function e(t){var n=t.emitter,s,o,a=0,l,c;if(!n.__ngev){i.init.call(n)}l=n.__ngev.states[t.name];if(l!==undefined){if(l&&t.args.length===l.args.length&&t.args.every((e,t)=>e===l.args[t])){return}n.__ngev.stateGroups[t.name].forEach(e=>{n.__ngev.states[e]=null});n.__ngev.states[t.name]=t}if(!n.__ngev.listeners[t.name]){n.__ngev.listeners[t.name]=[]}t.id=r++;t.listenersDone=0;t.once=!!t.once;if(t.nice===undefined||t.nice===null){t.nice=n.__ngev.nice}if(!t.listeners){t.listeners=n.__ngev.listeners[t.name].slice()}n.__ngev.recursion++;c=[];for(s=0,o=t.listeners.length;s<o;s++){a++;i.emitToOneListener(t,t.listeners[s],c)}n.__ngev.recursion--;if(c.length&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",c)}if(!a){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){t.callback(undefined,t);delete t.callback}}return t};i.emitToOneListener=function e(t,n,r){var s=t.emitter,o,a,l=false;o=n.context&&s.__ngev.contexts[n.context];if(o&&o.status===i.CONTEXT_DISABLED){return}if(o){a=Math.max(t.nice,n.nice,o.nice)}else{a=Math.max(t.nice,n.nice)}if(n.once){s.__ngev.listeners[t.name]=s.__ngev.listeners[t.name].filter(i.filterOutCallback.bind(undefined,n));if(r){r.push(n)}else{l=true}}if(o&&(o.status===i.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:t,listener:n,nice:a})}else{try{if(a<0){if(s.__ngev.recursion>=-a){setImmediate(i.listenerWrapper.bind(s,n,t,o))}else{i.listenerWrapper.call(s,n,t,o)}}else{setTimeout(i.listenerWrapper.bind(s,n,t,o),a)}}catch(e){s.__ngev.recursion--;throw e}}if(l&&s.__ngev.listeners.removeListener.length){s.emit("removeListener",[n])}};i.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}return this.__ngev.listeners[t].slice()};i.listenerCount=function(e,t){if(!e||!(e instanceof i)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};i.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};i.prototype.setNice=function e(t){if(!this.__ngev){i.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};i.prototype.setInterruptible=function e(t){if(!this.__ngev){i.init.call(this)}this.__ngev.interruptible=!!t};i.share=function(e,t){if(!(e instanceof i)||!(t instanceof i)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){i.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};i.reset=function e(t){Object.defineProperty(t,"__ngev",{configurable:true,value:null})};i.prototype.setMaxListeners=function(){};i.noop=function(){};i.prototype.defineStates=function e(){var t=this,n=Array.prototype.slice.call(arguments);if(!this.__ngev){i.init.call(this)}n.forEach(e=>{t.__ngev.states[e]=null;t.__ngev.stateGroups[e]=n})};i.prototype.hasState=function e(t){if(!this.__ngev){i.init.call(this)}return!!this.__ngev.states[t]};i.prototype.getAllStates=function e(){var t=this;if(!this.__ngev){i.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>t.__ngev.states[e])};i.groupAddListener=function e(t,n,i,r){if(typeof i!=="function"){r=i;i=undefined}if(!r||typeof r!=="object"){r={}}i=i||r.fn;delete r.fn;r.id=r.id||i;t.forEach(e=>{e.addListener(n,i.bind(undefined,e),r)})};i.groupOn=i.groupAddListener;i.groupOnce=function e(t,n,i,r){if(i&&typeof i==="object"){i.once=true}else if(r&&typeof r==="object"){r.once=true}else{r={once:true}}return this.groupAddListener(t,n,i,r)};i.groupGlobalOnce=function e(t,n,r,s){var o,a=false;if(typeof r!=="function"){s=r;r=undefined}if(!s||typeof s!=="object"){s={}}r=r||s.fn;delete s.fn;s.id=s.id||r;o=function(){if(a){return}a=true;i.groupRemoveListener(t,n,s.id);r.apply(undefined,arguments)};t.forEach(e=>{e.once(n,o.bind(undefined,e),s)})};i.groupGlobalOnceAll=function e(t,n,i,r){var s,o=false,a=t.length;if(typeof i!=="function"){r=i;i=undefined}if(!r||typeof r!=="object"){r={}}i=i||r.fn;delete r.fn;r.id=r.id||i;s=function(){if(o){return}if(--a){return}o=true;i.apply(undefined,arguments)};t.forEach(e=>{e.once(n,s.bind(undefined,e),r)})};i.groupRemoveListener=function e(t,n,i){t.forEach(e=>{e.removeListener(n,i)})};i.groupOff=i.groupRemoveListener;i.groupRemoveAllListeners=function e(t,n){t.forEach(e=>{e.removeAllListeners(n)})};i.groupEmit=function e(t){var n,r,s=2,o,a,l=t.length,c,u,f=false;if(typeof arguments[arguments.length-1]==="function"){o=-1;c=arguments[arguments.length-1];u=(e=>{if(f){return}if(e){f=true;c(e)}else if(!--l){f=true;c()}})}if(typeof arguments[1]==="number"){s=3;r=typeof arguments[1]}n=arguments[s-1];a=Array.prototype.slice.call(arguments,s,o);t.forEach(e=>{i.emitEvent({emitter:e,name:n,args:a,nice:r,callback:u})})};i.groupDefineStates=function e(t){var n=Array.prototype.slice.call(arguments,1);t.forEach(e=>{e.defineStates.apply(e,n)})};i.CONTEXT_ENABLED=0;i.CONTEXT_DISABLED=1;i.CONTEXT_QUEUED=2;i.prototype.addListenerContext=function e(t,n){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!n||typeof n!=="object"){n={}}if(!this.__ngev.contexts[t]){this.__ngev.contexts[t]=Object.create(i.prototype);this.__ngev.contexts[t].nice=i.SYNC;this.__ngev.contexts[t].ready=true;this.__ngev.contexts[t].status=i.CONTEXT_ENABLED;this.__ngev.contexts[t].serial=false;this.__ngev.contexts[t].queue=[]}if(n.nice!==undefined){this.__ngev.contexts[t].nice=Math.floor(n.nice)}if(n.status!==undefined){this.__ngev.contexts[t].status=n.status}if(n.serial!==undefined){this.__ngev.contexts[t].serial=!!n.serial}return this};i.prototype.disableListenerContext=function e(t){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=i.CONTEXT_DISABLED;return this};i.prototype.enableListenerContext=function e(t){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=i.CONTEXT_ENABLED;if(this.__ngev.contexts[t].queue.length>0){i.processQueue.call(this,t)}return this};i.prototype.queueListenerContext=function e(t){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=i.CONTEXT_QUEUED;return this};i.prototype.serializeListenerContext=function e(t,n){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=n===undefined?true:!!n;return this};i.prototype.setListenerContextNice=function e(t,n){if(!this.__ngev){i.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(n);return this};i.prototype.destroyListenerContext=function e(t){var n,r,s,o,a=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){i.init.call(this)}for(s in this.__ngev.listeners){o=null;r=this.__ngev.listeners[s].length;for(n=0;n<r;n++){if(this.__ngev.listeners[s][n].context===t){o=[];a.push(this.__ngev.listeners[s][n])}else if(o){o.push(this.__ngev.listeners[s][n])}}if(o){this.__ngev.listeners[s]=o}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};i.processQueue=function e(t,n){var r,s;if(!this.__ngev.contexts[t]){return}r=this.__ngev.contexts[t];if(n){r.ready=true}this.__ngev.recursion++;while(r.ready&&r.queue.length){s=r.queue.shift();if(s.event.interrupt){continue}try{if(s.nice<0){if(this.__ngev.recursion>=-s.nice){setImmediate(i.listenerWrapper.bind(this,s.listener,s.event,r))}else{i.listenerWrapper.call(this,s.listener,s.event,r)}}else{setTimeout(i.listenerWrapper.bind(this,s.listener,s.event,r),s.nice)}}catch(e){this.__ngev.recursion--;throw e}}this.__ngev.recursion--};i.on=i.prototype.on;i.once=i.prototype.once;i.off=i.prototype.off;if(n.AsyncTryCatch){i.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(i);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}i.Proxy=e("./Proxy.js")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":10,"./Proxy.js":9}],9:[function(e,t,n){"use strict";function i(){return i.create()}t.exports=i;var r=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}i.create=function e(){var t=Object.create(i.prototype,{localServices:{value:{},enumerable:true},remoteServices:{value:{},enumerable:true},nextAckId:{value:1,writable:true,enumerable:true}});return t};i.prototype.addLocalService=function e(t,n,i){this.localServices[t]=a.create(this,t,n,i);return this.localServices[t]};i.prototype.addRemoteService=function e(t){this.remoteServices[t]=l.create(this,t);return this.remoteServices[t]};i.prototype.destroy=function e(){var t=this;Object.keys(this.localServices).forEach(function(e){t.localServices[e].destroy();delete t.localServices[e]});Object.keys(this.remoteServices).forEach(function(e){t.remoteServices[e].destroy();delete t.remoteServices[e]});this.receive=this.send=o};i.prototype.push=function e(t){if(t.__type!==s||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};i.prototype.receive=function e(t){this.push(t)};i.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,n,i){return a.create(e,t,n,i)}i.LocalService=a;a.create=function e(t,n,i,s){var o=Object.create(a.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:i,writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!s.listen,writable:true,enumerable:true},canEmit:{value:!!s.emit,writable:true,enumerable:true},canAck:{value:!!s.ack,writable:true,enumerable:true},canRpc:{value:!!s.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return o};a.prototype.destroy=function e(){var t=this;Object.keys(this.events).forEach(function(e){t.emitter.off(e,t.events[e]);delete t.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var n=this;var i={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){i.callback=function e(i){n.proxy.send({__type:s,service:n.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:i})}}r.emitEvent(i)};a.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};a.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};a.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t)};a.forward=function e(t){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args})};a.forward.ack=false;a.forwardWithAck=function e(t,n){if(this.destroyed){return}var i=this;if(!t.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args});n();return}var r=false;var o=this.proxy.nextAckId++;var a=function e(t){if(r||t.ack!==o){return}r=true;i.internalEvents.off("ack",e);n()};this.internalEvents.on("ack",a);this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,ack:o,args:t.args})};a.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}i.RemoteService=l;var c=1;var u=2;l.create=function e(t,n){var i=Object.create(l.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:Object.create(r.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return i};l.prototype.destroy=function e(){var t=this;this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(function(e){delete t.events[e]});this.destroyed=true};l.prototype.emit=function e(t){if(this.destroyed){return}var n=this,i,r,o,a;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof arguments[arguments.length-1]!=="function"){i=Array.prototype.slice.call(arguments,1);this.proxy.send({__type:s,service:this.id,method:"emit",event:t,args:i});return}i=Array.prototype.slice.call(arguments,1,-1);r=arguments[arguments.length-1];o=this.proxy.nextAckId++;a=false;var l=function e(t){if(a||t.ack!==o){return}a=true;n.internalEvents.off("ack",e);r(t.interruption)};this.internalEvents.on("ack",l);this.proxy.send({__type:s,service:this.id,method:"emit",ack:o,event:t,args:i})};l.prototype.addListener=function e(t,n,i){if(this.destroyed){return}if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}i.fn=n||i.fn;this.emitter.addListener(t,i);if(!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length){return}if(i.async&&this.events[t]!==u){this.events[t]=u;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:t})}else if(!i.async&&!this.events[t]){this.events[t]=c;this.proxy.send({__type:s,service:this.id,method:"listen",event:t})}};l.prototype.on=l.prototype.addListener;l.prototype.once=r.prototype.once;l.prototype.removeListener=function e(t,n){if(this.destroyed){return}this.emitter.removeListener(t,n);if((!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:t})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function e(t){var n=this;if(this.destroyed||!this.events[t.event]){return}var i={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){i.callback=function e(){n.proxy.send({__type:s,service:n.id,method:"ackEvent",ack:t.ack,event:t.event})}}r.emitEvent(i);var o=i.name;if(!this.emitter.__ngev.listeners[o]||!this.emitter.__ngev.listeners[o].length){this.events[o]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:o})}};l.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==u){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":8}],10:[function(e,t,n){t.exports={_from:"nextgen-events@^0.10.0",_id:"nextgen-events@0.10.0",_inBundle:false,_integrity:"sha1-9H1NIOwRS/mfSPjEmujUq2Ni7s0=",_location:"/nextgen-events",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"nextgen-events@^0.10.0",name:"nextgen-events",escapedName:"nextgen-events",rawSpec:"^0.10.0",saveSpec:null,fetchSpec:"^0.10.0"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-0.10.0.tgz",_shasum:"f47d4d20ec114bf99f48f8c49ae8d4ab6362eecd",_spec:"nextgen-events@^0.10.0",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cdric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},bundleDependencies:false,config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2016],owner:"Cdric Ronvel"},dependencies:{},deprecated:false,description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^14.3.0","expect.js":"^0.3.1",jshint:"^2.9.2",mocha:"^2.5.3","uglify-js-es6":"^2.8.9",ws:"^2.2.3"},directories:{test:"test"},engines:{node:">=4.5.0"},homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",name:"nextgen-events",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"mocha -R dot"},version:"0.10.0"}},{}],11:[function(e,t,n){var i=t.exports={};var r;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=o}}catch(e){r=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(e){s=a}})();function l(e){if(r===setTimeout){return setTimeout(e,0)}if((r===o||!r)&&setTimeout){r=setTimeout;return setTimeout(e,0)}try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}function c(e){if(s===clearTimeout){return clearTimeout(e)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var u=[];var f=false;var h;var p=-1;function d(){if(!f||!h){return}f=false;if(h.length){u=h.concat(u)}else{p=-1}if(u.length){m()}}function m(){if(f){return}var e=l(d);f=true;var t=u.length;while(t){h=u;u=[];while(++p<t){if(h){h[p].run()}}p=-1;t=u.length}h=null;f=false;c(e)}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}u.push(new g(e,t));if(u.length===1&&!f){l(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function v(){}i.on=v;i.addListener=v;i.once=v;i.off=v;i.removeListener=v;i.removeAllListeners=v;i.emit=v;i.prependListener=v;i.prependOnceListener=v;i.listeners=function(e){return[]};i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}],12:[function(t,n,i){(function(t){(function(r){var s=typeof i=="object"&&i&&!i.nodeType&&i;var o=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){r=a}var l,c=2147483647,u=36,f=1,h=26,p=38,d=700,m=72,g=128,v="-",y=/^xn--/,b=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=u-f,w=Math.floor,S=String.fromCharCode,C;function E(e){throw new RangeError(x[e])}function L(e,t){var n=e.length;var i=[];while(n--){i[n]=t(e[n])}return i}function A(e,t){var n=e.split("@");var i="";if(n.length>1){i=n[0]+"@";e=n[1]}e=e.replace(_,".");var r=e.split(".");var s=L(r,t).join(".");return i+s}function $(e){var t=[],n=0,i=e.length,r,s;while(n<i){r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((r&1023)<<10)+(s&1023)+65536)}else{t.push(r);n--}}else{t.push(r)}}return t}function T(e){return L(e,function(e){var t="";if(e>65535){e-=65536;t+=S(e>>>10&1023|55296);e=56320|e&1023}t+=S(e);return t}).join("")}function j(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function O(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function M(e,t,n){var i=0;e=n?w(e/d):e>>1;e+=w(e/t);for(;e>k*h>>1;i+=u){e=w(e/k)}return w(i+(k+1)*e/(e+p))}function I(e){var t=[],n=e.length,i,r=0,s=g,o=m,a,l,p,d,y,b,_,x,k;a=e.lastIndexOf(v);if(a<0){a=0}for(l=0;l<a;++l){if(e.charCodeAt(l)>=128){E("not-basic")}t.push(e.charCodeAt(l))}for(p=a>0?a+1:0;p<n;){for(d=r,y=1,b=u;;b+=u){if(p>=n){E("invalid-input")}_=j(e.charCodeAt(p++));if(_>=u||_>w((c-r)/y)){E("overflow")}r+=_*y;x=b<=o?f:b>=o+h?h:b-o;if(_<x){break}k=u-x;if(y>w(c/k)){E("overflow")}y*=k}i=t.length+1;o=M(r-d,i,d==0);if(w(r/i)>c-s){E("overflow")}s+=w(r/i);r%=i;t.splice(r++,0,s)}return T(t)}function N(e){var t,n,i,r,s,o,a,l,p,d,y,b=[],_,x,k,C;e=$(e);_=e.length;t=g;n=0;s=m;for(o=0;o<_;++o){y=e[o];if(y<128){b.push(S(y))}}i=r=b.length;if(r){b.push(v)}while(i<_){for(a=c,o=0;o<_;++o){y=e[o];if(y>=t&&y<a){a=y}}x=i+1;if(a-t>w((c-n)/x)){E("overflow")}n+=(a-t)*x;t=a;for(o=0;o<_;++o){y=e[o];if(y<t&&++n>c){E("overflow")}if(y==t){for(l=n,p=u;;p+=u){d=p<=s?f:p>=s+h?h:p-s;if(l<d){break}C=l-d;k=u-d;b.push(S(O(d+C%k,0)));l=w(C/k)}b.push(S(O(l,0)));s=M(n,x,i==r);n=0;++i}}++n;++t}return b.join("")}function B(e){return A(e,function(e){return y.test(e)?I(e.slice(4).toLowerCase()):e})}function R(e){return A(e,function(e){return b.test(e)?"xn--"+N(e):e})}l={version:"1.4.1",ucs2:{decode:$,encode:T},decode:I,encode:N,toASCII:R,toUnicode:B};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return l})}else if(s&&o){if(n.exports==s){o.exports=l}else{for(C in l){l.hasOwnProperty(C)&&(s[C]=l[C])}}}else{r.punycode=l}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var l=1e3;if(s&&typeof s.maxKeys==="number"){l=s.maxKeys}var c=e.length;if(l>0&&c>l){c=l}for(var u=0;u<c;++u){var f=e[u].replace(a,"%20"),h=f.indexOf(n),p,d,m,g;if(h>=0){p=f.substr(0,h);d=f.substr(h+1)}else{p=f;d=""}m=decodeURIComponent(p);g=decodeURIComponent(d);if(!i(o,m)){o[m]=g}else if(r(o[m])){o[m].push(g)}else{o[m]=[o[m],g]}}return o};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],14:[function(e,t,n){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(i(o))+n;if(r(e[o])){return s(e[o],function(e){return a+encodeURIComponent(i(e))}).join(t)}else{return a+encodeURIComponent(i(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(i(a))+n+encodeURIComponent(i(e))};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var i=0;i<e.length;i++){n.push(t(e[i],i))}return n}var o=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],15:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":13,"./encode":14}],16:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"}},{}],17:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=function e(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")};n.regExpReplacement=function e(t){return t.replace(/\$/g,"$$$$")};n.format=function e(t){return t.replace(/%/g,"%%")};n.jsSingleQuote=function e(t){return n.control(t).replace(/'/g,"\\'")};n.jsDoubleQuote=function e(t){return n.control(t).replace(/"/g,'\\"')};n.shellArg=function e(t){
return"'"+t.replace(/\'/g,"'\\''")+"'"};var i={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=function e(t){return t.replace(/[\x00-\x1f\x7f]/g,function(e){if(i[e]!==undefined){return i[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t})};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=function e(t){return t.replace(/[&<>]/g,function(e){return r[e]})};n.htmlAttr=function e(t){return t.replace(/[&<>"]/g,function(e){return r[e]})};n.htmlSpecialChars=function e(t){return t.replace(/[&<>"']/g,function(e){return r[e]})}},{}],18:[function(e,t,n){(function(t){"use strict";var i=e("./inspect.js").inspect;var r=e("./inspect.js").inspectError;var s=e("./ansi.js");n.formatMethod=function e(n){if(typeof n!=="string"){if(!n){n=""}else if(typeof n.toString==="function"){n=n.toString()}else{n=""}}var s=this,o,a,l=1,c=arguments,u=arguments.length,f=false,h=null,p=[];if(this.markupReset&&this.startingMarkupReset){n=(typeof this.markupReset==="function"?this.markupReset(p):this.markupReset)+n}n=n.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,function(e,n,d,m,g,v,y){var b,_,x,k,w,S,C,E,L=[];if(d){return"%"}if(n){if(n==="^"){return"^"}if(s.shiftMarkup&&s.shiftMarkup[n]){h=s.shiftMarkup[n];return""}if(h){if(!s.shiftedMarkup||!s.shiftedMarkup[h]||!s.shiftedMarkup[h][n]){return""}f=true;if(typeof s.shiftedMarkup[h][n]==="function"){b=s.shiftedMarkup[h][n](p)}else{b=s.shiftedMarkup[h][n];p.push(b)}h=null}else{if(!s.markup||!s.markup[n]){return""}f=true;if(typeof s.markup[n]==="function"){b=s.markup[n](p)}else{b=s.markup[n];p.push(b)}}return b}if(g){g=parseInt(g);if(m){if(m==="+"){g=l+g}else if(m==="-"){g=l-g}}}else{g=l}l++;if(g>=u||g<1){o=undefined}else{o=c[g]}switch(y){case"s":if(o===null||o===undefined){return""}if(typeof o==="string"){return o}if(typeof o==="number"){return""+o}if(typeof o.toString==="function"){return o.toString()}return"";case"f":if(typeof o==="string"){o=parseFloat(o)}if(typeof o!=="number"){return"0"}if(v!==undefined){switch(v[0]){case"p":x=parseInt(v.slice(1),10);if(x>=1){o=o.toPrecision(x)}break;case"f":x=parseInt(v.slice(1),10);o=o.toFixed(x);break}}return""+o;case"d":case"i":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.floor(o)}return"0";case"u":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0)}return"0";case"U":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),1)}return"1";case"x":if(typeof o==="string"){o=parseInt(o)}if(typeof o!=="number"){return"0"}a=""+Math.max(Math.floor(o),0).toString(16);if(a.length%2){a="0"+a}return a;case"h":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0).toString(16)}return"0";case"o":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0).toString(8)}return"0";case"b":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0).toString(2)}return"0";case"z":if(typeof o==="string"){o=t.from(o)}else if(!t.isBuffer(o)){return""}return o.toString("base64");case"Z":if(typeof o==="string"){o=t.from(o)}else if(!t.isBuffer(o)){return""}return o.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"");case"I":k=3;if(v!==undefined){k=parseInt(v,10)}return i({depth:k,style:s&&s.color?"color":"none"},o);case"Y":k=3;if(v!==undefined){k=parseInt(v,10)}return i({depth:k,style:s&&s.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true},o);case"E":return r({style:s&&s.color?"color":"none"},o);case"J":return JSON.stringify(o);case"D":return"";case"F":l--;if(v===undefined){return""}w=v.split(":");S=w[0];C=w[1];if(!S){return""}if(C&&(E=C.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(_=0;_<E.length;_++){m=E[_][1];g=E[_][2];if(g){g=parseInt(g,10);if(m){if(m==="+"){g=l+g}else if(m==="-"){g=l-g}}}else{g=l}l++;if(g>=u||g<1){L[_]=undefined}else{L[_]=c[g]}}}if(!s||!s.fn||typeof s.fn[S]!=="function"){return""}return s.fn[S].apply(s,L);default:return""}});if(f&&this.markupReset&&this.endingMarkupReset){n+=typeof this.markupReset==="function"?this.markupReset(p):this.markupReset}if(this.extraArguments){for(;l<u;l++){o=c[l];if(o===null||o===undefined){continue}else if(typeof o==="string"){n+=o}else if(typeof o==="number"){n+=o}else if(typeof o.toString==="function"){n+=o.toString()}}}return n};var o={extraArguments:true,endingMarkupReset:true,startingMarkupReset:false,markupReset:s.reset,shiftMarkup:{"#":"background"},markup:{":":s.reset," ":s.reset+" ","-":s.dim,"+":s.bold,_:s.underline,"/":s.italic,"!":s.inverse,b:s.blue,B:s.brightBlue,c:s.cyan,C:s.brightCyan,g:s.green,G:s.brightGreen,k:s.black,K:s.brightBlack,m:s.magenta,M:s.brightMagenta,r:s.red,R:s.brightRed,w:s.white,W:s.brightWhite,y:s.yellow,Y:s.brightYellow},shiftedMarkup:{background:{":":s.reset," ":s.reset+" ",b:s.bgBlue,B:s.bgBrightBlue,c:s.bgCyan,C:s.bgBrightCyan,g:s.bgGreen,G:s.bgBrightGreen,k:s.bgBlack,K:s.bgBrightBlack,m:s.bgMagenta,M:s.bgBrightMagenta,r:s.bgRed,R:s.bgBrightRed,w:s.bgWhite,W:s.bgBrightWhite,y:s.bgYellow,Y:s.bgBrightYellow}}};n.format=n.formatMethod.bind(o);n.format.default=o;n.markupMethod=function e(t){if(typeof t!=="string"){if(!t){t=""}else if(typeof t.toString==="function"){t=t.toString()}else{t=""}}var n=this,i=false,r=null,s=[];if(this.markupReset&&this.startingMarkupReset){t=(typeof this.markupReset==="function"?this.markupReset(s):this.markupReset)+t}t=t.replace(/\^(.?)/g,function(e,t){var o;if(t==="^"){return"^"}if(n.shiftMarkup&&n.shiftMarkup[t]){r=n.shiftMarkup[t];return""}if(r){if(!n.shiftedMarkup||!n.shiftedMarkup[r]||!n.shiftedMarkup[r][t]){return""}i=true;if(typeof n.shiftedMarkup[r][t]==="function"){o=n.shiftedMarkup[r][t](s)}else{o=n.shiftedMarkup[r][t];s.push(o)}r=null}else{if(!n.markup||!n.markup[t]){return""}i=true;if(typeof n.markup[t]==="function"){o=n.markup[t](s)}else{o=n.markup[t];s.push(o)}}return o});if(i&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(s):this.markupReset}return t};n.markup=n.markupMethod.bind(o);n.format.count=function e(t){var n,i,r,s=1,o=0;if(typeof t!=="string"){return 0}var a=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=a.exec(t))!==null){r=n[1];i=n[2];if(i){i=parseInt(i,10);if(r){if(r==="+"){i=s+i}else if(r==="-"){i=s-i}}}else{i=s}s++;if(o<i){o=i}}return o};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}else{return false}}}).call(this,e("buffer").Buffer)},{"./ansi.js":16,"./inspect.js":19,buffer:6}],19:[function(e,t,n){(function(t,i){"use strict";var r=e("./escape.js");var s=e("./ansi.js");function o(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=h.none}else if(typeof e.style==="string"){e.style=h[e.style]}if(e.depth===undefined){e.depth=3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}return a(n,e,t)}function a(e,n,i){var s,o,u,f,h,p,d,m,g,v,y,b,_="",x="",k="",w,S;d=typeof i;g=n.style.tab.repeat(e.depth);if(d==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){k=[];if(!e.descriptor.configurable){k.push("-conf")}if(!e.descriptor.enumerable){k.push("-enum")}if(!e.descriptor.writable){k.push("-w")}if(k.length){k=k.join(" ")}else{k=""}}if(e.keyIsProperty){if(l(e.key)){x='"'+n.style.key(e.key)+'": '}else{x=n.style.key(e.key)+": "}}else{x="["+n.style.index(e.key)+"] "}if(k){k=" "+n.style.type(k)}}m=e.noPre?"":g+x;if(i===undefined){_+=m+n.style.constant("undefined")+k+n.style.nl}else if(i===null){_+=m+n.style.constant("null")+k+n.style.nl}else if(i===false){_+=m+n.style.constant("false")+k+n.style.nl}else if(i===true){_+=m+n.style.constant("true")+k+n.style.nl}else if(d==="number"){_+=m+n.style.number(i.toString())+(n.noType?"":" "+n.style.type("number"))+k+n.style.nl}else if(d==="string"){_+=m+'"'+n.style.string(r.control(i))+'" '+(n.noType?"":n.style.type("string")+n.style.length("("+i.length+")"))+k+n.style.nl}else if(t.isBuffer(i)){_+=m+n.style.inspect(i.inspect())+" "+(n.noType?"":n.style.type("Buffer")+n.style.length("("+i.length+")"))+k+n.style.nl}else if(d==="object"||d==="function"){o=u="";y=false;if(d==="function"){y=true;o=" "+n.style.funcName(i.name?i.name:"(anonymous)");u=n.style.length("("+i.length+")")}v=false;if(Array.isArray(i)){v=true;u=n.style.length("("+i.length+")")}if(!i.constructor){h="(no constructor)"}else if(!i.constructor.name){h="(anonymous)"}else{h=i.constructor.name}h=n.style.constructorName(h);_+=m;if(!n.noType){if(e.forceType){_+=n.style.type(e.forceType)}else{_+=h+o+u+" "+n.style.type(d)+k}if(!y||n.funcDetails){_+=" "}}f=Object.getOwnPropertyNames(i);if(n.sort){f.sort()}b=c(i);if(b!==undefined){_+="=> "+a({depth:e.depth,ancestors:e.ancestors,noPre:true},n,b)}else if(y&&!n.funcDetails){_+=n.style.nl}else if(!f.length&&!n.proto){_+="{}"+n.style.nl}else if(e.depth>=n.depth){_+=n.style.limit("[depth limit]")+n.style.nl}else if(e.ancestors.indexOf(i)!==-1){_+=n.style.limit("[circular]")+n.style.nl}else{_+=(v&&n.noType?"[":"{")+n.style.nl;S=e.ancestors.slice();S.push(i);for(s=0;s<f.length;s++){try{w=Object.getOwnPropertyDescriptor(i,f[s]);if(!w.enumerable&&n.enumOnly){continue}p=!v||!w.enumerable||isNaN(f[s]);if(!n.noDescriptor&&(w.get||w.set)){_+=a({depth:e.depth+1,ancestors:S,key:f[s],keyIsProperty:p,descriptor:w,forceType:"getter/setter"},n,{get:w.get,set:w.set})}else{_+=a({depth:e.depth+1,ancestors:S,key:f[s],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,i[f[s]])}}catch(t){_+=a({depth:e.depth+1,ancestors:S,key:f[s],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,t)}}if(n.proto){_+=a({depth:e.depth+1,ancestors:S,key:"__proto__",keyIsProperty:true},n,i.__proto__)}_+=g+(v&&n.noType?"]":"}")+n.style.nl}}if(e.depth===0){if(n.style==="html"){_=r.html(_)}}return _}n.inspect=o;function l(e){if(!e.length){return true}return false}function c(e){switch(e.constructor.name){case"Date":if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}break;case"Set":if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}break;case"Map":if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}break;case"ObjectID":if(e._bsontype){return e.toString()}break}return}function u(e,t){var n="",i,r,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"Not an error -- regular variable inspection: "+o(e,t)}if(!e.style){e.style=h.none}else if(typeof e.style==="string"){e.style=h[e.style]}if(t.stack){i=f(e,t.stack)}r=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(r)+(s?" ["+e.style.errorType(s)+"]":"")+": ";n+=e.style.errorMessage(t.message)+"\n";if(i){n+=e.style.errorStack(i)+"\n"}return n}n.inspectError=u;function f(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=h.none}else if(typeof e.style==="string"){e.style=h[e.style]}if(!t){return}if((e.browser||i.browser)&&t.indexOf("@")!==-1){t=t.replace(/[<\/]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,function(t,n,i,r,s){return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(i?e.style.errorStackFile(i):e.style.errorStack("unknown"))+(r?e.style.errorStack(":")+e.style.errorStackLine(r):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:([^\s:\(\)\[\]\n]+(?:\([^\)]+\))?)\s)?(?:\[as ([^\s:\(\)\[\]\n]+)\]\s)?(?:\(?([^:\(\)\[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,function(t,n,i,r,s,o,a){return e.style.errorStack("    at ")+(i?e.style.errorStackMethod(i)+" ":"")+(r?e.style.errorStack("[as ")+e.style.errorStackMethodAs(r)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(o?e.style.errorStack(":")+e.style.errorStackLine(o):"")+(a?e.style.errorStack(":")+e.style.errorStackColumn(a):"")+e.style.errorStack(")")})}return t}n.inspectStack=f;var h={};var p=function(e){return e};h.none={tab:"    ",nl:"\n",limit:p,type:function(e){return"<"+e+">"},constant:p,funcName:p,constructorName:function(e){return"<"+e+">"},length:p,key:p,index:p,number:p,inspect:p,string:p,errorType:p,errorMessage:p,errorStack:p,errorStackMethod:p,errorStackMethodAs:p,errorStackFile:p,errorStackLine:p,errorStackColumn:p};h.color=Object.assign({},h.none,{limit:function(e){return s.bold+s.brightRed+e+s.reset},type:function(e){return s.italic+s.brightBlack+e+s.reset},constant:function(e){return s.cyan+e+s.reset},funcName:function(e){return s.italic+s.magenta+e+s.reset},constructorName:function(e){return s.magenta+e+s.reset},length:function(e){return s.italic+s.brightBlack+e+s.reset},key:function(e){return s.green+e+s.reset},index:function(e){return s.blue+e+s.reset},number:function(e){return s.cyan+e+s.reset},inspect:function(e){return s.cyan+e+s.reset},string:function(e){return s.blue+e+s.reset},errorType:function(e){return s.red+s.bold+e+s.reset},errorMessage:function(e){return s.red+s.italic+e+s.reset},errorStack:function(e){return s.brightBlack+e+s.reset},errorStackMethod:function(e){return s.brightYellow+e+s.reset},errorStackMethodAs:function(e){return s.yellow+e+s.reset},errorStackFile:function(e){return s.brightCyan+e+s.reset},errorStackLine:function(e){return s.blue+e+s.reset},errorStackColumn:function(e){return s.magenta+e+s.reset}});h.html=Object.assign({},h.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",nl:"<br />",limit:function(e){return'<span style="color:red">'+e+"</span>"},type:function(e){return'<i style="color:gray">'+e+"</i>"},constant:function(e){return'<span style="color:cyan">'+e+"</span>"},funcName:function(e){return'<i style="color:magenta">'+e+"</i>"},constructorName:function(e){return'<span style="color:magenta">'+e+"</span>"},length:function(e){return'<i style="color:gray">'+e+"</i>"},key:function(e){return'<span style="color:green">'+e+"</span>"},index:function(e){return'<span style="color:blue">'+e+"</span>"},number:function(e){return'<span style="color:cyan">'+e+"</span>"},inspect:function(e){return'<span style="color:cyan">'+e+"</span>"},string:function(e){return'<span style="color:blue">'+e+"</span>"},errorType:function(e){return'<span style="color:red">'+e+"</span>"},errorMessage:function(e){return'<span style="color:red">'+e+"</span>"},errorStack:function(e){return'<span style="color:gray">'+e+"</span>"},errorStackMethod:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackMethodAs:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackFile:function(e){return'<span style="color:cyan">'+e+"</span>"},errorStackLine:function(e){return'<span style="color:blue">'+e+"</span>"},errorStackColumn:function(e){return'<span style="color:gray">'+e+"</span>"}})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":7,"./ansi.js":16,"./escape.js":17,_process:11}],20:[function(e,t,n){"use strict";var i=e("punycode");var r=e("./util");n.parse=x;n.resolve=w;n.resolveObject=S;n.format=k;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(c),f=["'"].concat(u),h=["%","/","?",";","#"].concat(f),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:true,"javascript:":true},y={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},_=e("querystring");function x(e,t,n){if(e&&r.isObject(e)&&e instanceof s)return e;var i=new s;i.parse(e,t,n);return i}s.prototype.parse=function(e,t,n){if(!r.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",c=e.split(a),u=/\\/g;c[0]=c[0].replace(u,"/");e=c.join(a);var x=e;x=x.trim();if(!n&&e.split("#").length===1){var k=l.exec(x);if(k){this.path=x;this.href=x;this.pathname=k[1];if(k[2]){this.search=k[2];if(t){this.query=_.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var w=o.exec(x);if(w){w=w[0];var S=w.toLowerCase();this.protocol=S;x=x.substr(w.length)}if(n||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var C=x.substr(0,2)==="//";if(C&&!(w&&y[w])){x=x.substr(2);this.slashes=true}}if(!y[w]&&(C||w&&!b[w])){var E=-1;for(var L=0;L<p.length;L++){var A=x.indexOf(p[L]);if(A!==-1&&(E===-1||A<E))E=A}var $,T;if(E===-1){T=x.lastIndexOf("@")}else{T=x.lastIndexOf("@",E)}if(T!==-1){$=x.slice(0,T);x=x.slice(T+1);this.auth=decodeURIComponent($)}E=-1;for(var L=0;L<h.length;L++){var A=x.indexOf(h[L]);if(A!==-1&&(E===-1||A<E))E=A}if(E===-1)E=x.length;this.host=x.slice(0,E);x=x.slice(E);this.parseHost();this.hostname=this.hostname||"";var j=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!j){var O=this.hostname.split(/\./);for(var L=0,M=O.length;L<M;L++){var I=O[L];if(!I)continue;if(!I.match(m)){var N="";for(var B=0,R=I.length;B<R;B++){if(I.charCodeAt(B)>127){N+="x"}else{N+=I[B]}}if(!N.match(m)){var q=O.slice(0,L);var D=O.slice(L+1);var U=I.match(g);if(U){q.push(U[1]);D.unshift(U[2])}if(D.length){x="/"+D.join(".")+x}this.hostname=q.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!j){this.hostname=i.toASCII(this.hostname)}var W=this.port?":"+this.port:"";var P=this.hostname||"";this.host=P+W;this.href+=this.host;if(j){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(x[0]!=="/"){x="/"+x}}}if(!v[S]){for(var L=0,M=f.length;L<M;L++){var G=f[L];if(x.indexOf(G)===-1)continue;var F=encodeURIComponent(G);if(F===G){F=escape(G)}x=x.split(G).join(F)}}var H=x.indexOf("#");if(H!==-1){this.hash=x.substr(H);x=x.slice(0,H)}var Y=x.indexOf("?");if(Y!==-1){this.search=x.substr(Y);this.query=x.substr(Y+1);if(t){this.query=_.parse(this.query)}x=x.slice(0,Y)}else if(t){this.search="";this.query={}}if(x)this.pathname=x;if(b[S]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var W=this.pathname||"";var z=this.search||"";this.path=W+z}this.href=this.format();return this};function k(e){if(r.isString(e))e=x(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",s=false,o="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&r.isObject(this.query)&&Object.keys(this.query).length){o=_.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(i&&i.charAt(0)!=="#")i="#"+i;if(a&&a.charAt(0)!=="?")a="?"+a;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+n+a+i};function w(e,t){return x(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(x(e,false,true)).format()};function S(e,t){if(!e)return t;return x(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(r.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var i=Object.keys(this);for(var o=0;o<i.length;o++){var a=i[o];n[a]=this[a]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var l=Object.keys(e);for(var c=0;c<l.length;c++){var u=l[c];if(u!=="protocol")n[u]=e[u]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var f=Object.keys(e);for(var h=0;h<f.length;h++){var p=f[h];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!y[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");n.pathname=d.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var g=n.search||"";n.path=m+g}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var v=n.pathname&&n.pathname.charAt(0)==="/",_=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=_||v||n.host&&e.pathname,k=x,w=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],S=n.protocol&&!b[n.protocol];if(S){n.hostname="";n.port=null;if(n.host){if(w[0]==="")w[0]=n.host;else w.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}x=x&&(d[0]===""||w[0]==="")}if(_){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;w=d}else if(d.length){if(!w)w=[];w.pop();w=w.concat(d);n.search=e.search;n.query=e.query}else if(!r.isNullOrUndefined(e.search)){if(S){n.hostname=n.host=w.shift();var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}n.search=e.search;n.query=e.query;if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!w.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var E=w.slice(-1)[0];var L=(n.host||e.host||w.length>1)&&(E==="."||E==="..")||E==="";var A=0;for(var $=w.length;$>=0;$--){E=w[$];if(E==="."){w.splice($,1)}else if(E===".."){w.splice($,1);A++}else if(A){w.splice($,1);A--}}if(!x&&!k){for(;A--;A){w.unshift("..")}}if(x&&w[0]!==""&&(!w[0]||w[0].charAt(0)!=="/")){w.unshift("")}if(L&&w.join("/").substr(-1)!=="/"){w.push("")}var T=w[0]===""||w[0]&&w[0].charAt(0)==="/";if(S){n.hostname=n.host=T?"":w.length?w.shift():"";var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}x=x||n.host&&w.length;if(x&&!T){w.unshift("")}if(!w.length){n.pathname=null;n.path=null}else{n.pathname=w.join("/")}if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":21,punycode:12,querystring:15}],21:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}],22:[function(e,t,n){(function(n){"use strict";var i=e("fs");var r=e("dom-kit");function s(){}var o={};t.exports=o;o.standalone=function e(t,n){var i='<?xml version="1.0" encoding="UTF-8"?>\n';if(!Array.isArray(n)){n=o.toAreaArray(n)}i+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+n.join(" ")+'">\n';i+=t;i+="\n</svg>\n";return i};o.toAreaArray=function e(t){if(t.xmin!==undefined&&t.xmax!==undefined&&t.ymin!==undefined&&t.ymax!==undefined){return[t.xmin,t.ymin,t.xmax-t.xmin,t.ymax-t.ymin]}else if(t.x!==undefined&&t.y!==undefined&&t.width!==undefined&&t.height!==undefined){return[t.x,t.y,t.width,t.height]}else{return[0,0,100,100]}};var a=["path","circle","ellipse","line","rect","polyline","polygone","text","textPath"];o.inject=function e(t,n){var i,s,a;o.lightCleanup(t);if(n.id!==undefined){if(typeof n.id==="string"){t.setAttribute("id",n.id)}else if(!n.id){t.removeAttribute("id")}}if(n.class){if(typeof n.class==="string"){t.classList.add(n.class)}else if(typeof n.class==="object"){r.class(t,n.class)}}if(n.prefixIds){r.prefixIds(t,n.prefixIds)}if(n.removeIds){r.removeAllAttributes(t,"id")}if(n.hidden){t.style.visibility="hidden"}if(n.removeSize){s=t.getAttribute("width")||t.style.width;a=t.getAttribute("height")||t.style.height;t.removeAttribute("height");t.removeAttribute("width");t.style.width=null;t.style.height=null;if(!t.getAttribute("viewBox")&&s&&a){i="0 0 "+s+" "+a;t.setAttribute("viewBox",i)}}if(n.css){r.css(t,n.css)}if(n.colorClass){o.colorClass(t)}if(n.into){n.into.appendChild(t)}if(n.as&&n.as.tagName.toLowerCase()==="svg"){r.moveAttributes(t,n.as);r.moveChildrenInto(t,n.as)}};o.lightCleanup=function e(t){r.removeAllTags(t,"metadata");r.removeAllTags(t,"script");r.removeAllTags(t,"defs",true)};o.colorClass=function e(t){a.forEach(function(e){Array.from(t.getElementsByTagName(e)).forEach(function(e){console.warn("$element.className",e.getAttribute("class"));if(!e.getAttribute("class")){e.classList.add("primary")}r.styleToAttribute(e,"fill");r.styleToAttribute(e,"stroke")})})};o.load=function e(t,a,l){if(typeof a==="function"){l=a;a={}}else if(!a||typeof a!=="object"){a={}}if(typeof l!=="function"){l=s}if(!n.browser){if(t.substring(0,7)==="file://"){t=t.slice(7)}i.readFile(t,"utf8",function(e,t){if(e){l(e);return}var n=r.fromXml(t).documentElement;try{o.inject(n,a)}catch(e){l(e);return}l(undefined,n)})}else{o.ajax(t,function(e,t){if(e){l(e);return}var n=t.documentElement;try{o.inject(n,a)}catch(e){l(e);return}l(undefined,n)})}};o.ajax=function e(t,n){var i=new XMLHttpRequest;i.responseType="document";i.onreadystatechange=o.ajax.ajaxStatus.bind(i,n);i.open("GET",t);i.send()};o.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[svg-kit] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}}}).call(this,e("_process"))},{_process:11,"dom-kit":1,fs:6}]},{},[3])(3)});