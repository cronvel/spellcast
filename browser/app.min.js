(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var u=typeof require=="function"&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";var r=e("dom-kit");var i=e("tree-kit/lib/extend.js");function s(){}function o(){return o.create()}t.exports=o;o.create=function e(){var t=Object.create(o.prototype);t.$body=document.querySelector("body");t.$theme=document.querySelector("#theme");t.$gfx=document.querySelector("#gfx");t.$sceneImage=document.querySelector(".scene-image");t.$main=document.querySelector("main");t.$mainBuffer=document.querySelector("#main-buffer");t.$altBuffer=document.querySelector("#alt-buffer");t.$dialogWrapper=document.querySelector("#dialog-wrapper");t.$connection=document.querySelector("#connection");t.$music=document.querySelector("#music");t.$sound0=document.querySelector("#sound0");t.$sound1=document.querySelector("#sound1");t.$sound2=document.querySelector("#sound2");t.$sound3=document.querySelector("#sound3");t.newSegmentNeeded=false;t.toMainBuffer();t.nextSoundChannel=0;t.sprites={};t.animations={};t.hideContentTimer=null;t.onChatSubmit=null;t.initEvents();window.dom=t;return t};o.prototype.cleanUrl=function e(t){if(t[0]==="/"){return t}return"/script/"+t};o.prototype.setTheme=function e(t){this.$theme.setAttribute("href",this.cleanUrl(t.url))};o.prototype.initEvents=function e(){this.$gfx.addEventListener("click",this.toggleContent.bind(this),false);this.$dialogWrapper.addEventListener("click",this.clearDialog.bind(this),false)};o.prototype.toggleContent=function e(){if(this.$main.classList.contains("hidden")){this.showContent()}else{this.hideContent()}};o.prototype.hideContent=function e(){if(this.hideContentTimer!==null){clearTimeout(this.hideContentTimer);this.hideContentTimer=null}this.$main.classList.add("hidden");this.hideContentTimer=setTimeout(this.showContent.bind(this),8e3)};o.prototype.showContent=function e(){if(this.hideContentTimer!==null){clearTimeout(this.hideContentTimer);this.hideContentTimer=null}this.$main.classList.remove("hidden")};o.prototype.toMainBuffer=function e(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHints();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.getSwitchedElements()};o.prototype.toAltBuffer=function e(){if(this.$activeBuffer===this.$altBuffer){return}this.$activeBuffer=this.$altBuffer;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.getSwitchedElements()};o.prototype.getSwitchedElements=function e(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$hint=this.$activeBuffer.querySelector(".hint");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};o.prototype.clientStatus=function e(t,n){var i=document.createElement("span");i.classList.add(n.color);i.textContent=t;r.empty(this.$connection);this.$connection.appendChild(i);this.$connection.classList.toggle("alert",n.alert)};o.prototype.setMultiplayer=function e(t,n){n=n||s;if(t||t===undefined){this.$body.classList.add("multiplayer")}else{this.$body.classList.remove("multiplayer")}n()};o.prototype.clear=function e(t){t=t||s;r.empty(this.$hint);r.empty(this.$dialogWrapper);r.empty(this.$activeMessages);r.empty(this.$choices);t()};o.prototype.clearHints=function e(t){t=t||s;r.empty(this.$hint);t()};o.prototype.clearMessages=function e(t){t=t||s;r.empty(this.$activeMessages);t()};o.prototype.clearHistory=function e(t){t=t||s;r.empty(this.$history);t()};o.prototype.newSegment=function e(t){t=t||s;this.newSegmentNeeded=false;if(this.$activeSegment&&!this.$activeSegment.textContent){t();return}var n=this.$activeSegment;var r=document.createElement("segment");this.$activeSegment=r;this.$activeMessages.appendChild(r);if(n){this.$history.appendChild(n);n.scrollIntoView(false)}t()};o.prototype.newSegmentOnContent=function e(){this.newSegmentNeeded=true};o.prototype.addMessage=function e(t,n,r){r=r||s;var i=document.createElement("p");i.classList.add("text");i.innerHTML=t;if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(i);r()};o.prototype.messageNext=function e(t){t()};o.prototype.addIndicators=function e(t,n){var r=this;n=n||s;var i=document.createElement("indicator-list");t.forEach(function(e){var t,n,s,o,a,u;t=document.createElement("indicator");n=document.createElement("label");n.classList.add("label");if(e.image){t.classList.add("has-image");s=document.createElement("img");s.classList.add("image");s.setAttribute("src",r.cleanUrl(e.image));if(e.label){s.setAttribute("alt",e.label);s.setAttribute("title",e.label)}n.appendChild(s)}else{n.textContent=e.label}t.appendChild(n);o=document.createElement("widget");o.classList.add("widget");o.classList.add(e.type);o.setAttribute("data-value",e.value);switch(e.type){case"hbar":u=document.createElement("outer-bar");o.appendChild(u);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.width=""+e.value+"%";u.appendChild(a);break;case"vbar":u=document.createElement("outer-bar");o.appendChild(u);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.height=""+e.value+"%";u.appendChild(a);break;case"text":default:o.textContent=e.value}t.appendChild(o);i.appendChild(t)});if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(i);n()};o.prototype.clearChoices=function e(t){t=t||s;r.empty(this.$choices);t()};o.prototype.addChoices=function e(t,n,r){var i=this;var o=document.createDocumentFragment();var a=document.createElement("group");r=r||s;t.forEach(function(e){var t=document.createElement("choice");t.classList.add("choice",e.type);t.setAttribute("data-isOrdered",e.orderedList);if(e.image){t.classList.add("has-image");var r=document.createElement("img");r.classList.add("image");r.setAttribute("src",i.cleanUrl(e.image));t.appendChild(r)}var s=document.createElement("span");s.classList.add("label");s.textContent=e.label;t.appendChild(s);if(e.selectedBy&&e.selectedBy.length){var u=document.createElement("span");u.classList.add("italic","brightBlack");u.textContent=" "+e.selectedBy.join(", ");t.appendChild(u)}t.addEventListener("click",function(){n(e.index)});if(e.groupBreak){o.appendChild(a);a=document.createElement("group")}a.appendChild(t)});o.appendChild(a);this.$choices.appendChild(o);r()};o.prototype.getChoiceColumnsCount=function e(t){var n=0,r=0;t.forEach(function(e){if(e.groupBreak){if(n>r){r=n}n=0}n++});if(n>r){r=n}return r};o.prototype.setChoices=function e(t,n,r,i,o){var a=this;i=i||{};o=o||s;this.clearChoices(function(){switch(i.style){case"inline":case"smallInline":case"list":case"smallList":a.$choices.setAttribute("data-choice-style",i.style);break;case"table":a.$choices.setAttribute("data-choice-style",i.style);a.$choices.classList.add("columns-"+a.getChoiceColumnsCount(t));break;default:a.$choices.setAttribute("data-choice-style","list")}a.addChoices(t,r,o);if(n&&n.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=n.join(", ");a.$choices.appendChild(e)}if(typeof i.timeout==="number"){a.choiceTimeout(i.timeout)}})};o.prototype.updateChoices=o.prototype.setChoices;o.prototype.choiceTimeout=function e(t){var n=Date.now(),r,i;r=document.createElement("p");r.classList.add("timer");r.textContent=Math.round(t/1e3);this.$choices.appendChild(r);i=setInterval(function(){if(!r.parentNode){clearInterval(i);return}r.textContent=Math.round((t+n-Date.now())/1e3)},1e3)};o.prototype.textInputDisabled=function e(t){var n=document.createElement("form"),r=document.createElement("label"),i=document.createElement("input");r.textContent=t.label;i.setAttribute("placeholder",t.placeholder);i.setAttribute("disabled",true);i.setAttribute("type","text");i.classList.add("text-input");n.appendChild(r);n.appendChild(i);if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(n)};o.prototype.textInput=function e(t,n){var r=document.createElement("form"),i=document.createElement("label"),s=document.createElement("input");i.classList.add("text");i.textContent=t.label;s.setAttribute("type","text");s.classList.add("text-input");r.appendChild(i);r.appendChild(s);if(this.newSegmentNeeded){this.newSegment()}this.$activeSegment.appendChild(r);s.focus();var o=function e(t){t.preventDefault();r.removeEventListener("submit",e);s.setAttribute("disabled",true);n(s.value)};r.addEventListener("submit",o)};o.prototype.enableChat=function e(t){var n=this;if(!this.onChatSubmit){this.onChatSubmit=function(e){e.preventDefault();t(n.$chatInput.value);n.$chatInput.value=""};this.$chatForm.addEventListener("submit",this.onChatSubmit);this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};o.prototype.disableChat=function e(){this.$chatForm.removeEventListener("submit",this.onChatSubmit);this.onChatSubmit=null;this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};o.prototype.clearHint=function e(){r.empty(this.$hint)};o.prototype.setBigHint=function e(t,n){var i=document.createElement("h2");i.textContent=t;if(n){r.class(i,n)}r.empty(this.$hint);this.$hint.appendChild(i)};o.prototype.clearDialog=function e(){var t=this;this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var n=false;var i=function(){t.$dialogWrapper.removeEventListener("transitionstart",i);if(n){return}n=true;t.$dialogWrapper.addEventListener("transitionend",s)};var s=function(){t.$dialogWrapper.removeEventListener("transitionend",s);r.empty(this.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",i);setTimeout(function(){if(n){return}n=true;r.empty(this.$dialogWrapper)},10)};o.prototype.setDialog=function e(t,n,i){n=n||{};i=i||s;if(n.contentDelay&&!this.newSegmentNeeded){delete n.contentDelay;var o=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var a=Math.min(o*10,5e3);console.warn("contentLength/delay",o,a);setTimeout(this.setDialog.bind(this,t,n,i),a);return}var u=document.createElement("div");u.classList.add("dialog");if(n.title){var l=document.createElement("h2");l.classList.add("title");l.textContent=n.title;u.appendChild(l)}var f=document.createElement("div");f.classList.add("message");f.textContent=t;u.appendChild(f);if(n.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(n.big){u.classList.add("big")}if(n.fun){u.classList.add("fun")}if(n.alert){u.classList.add("alert")}if(n.modal){u.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}r.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(u);this.$dialogWrapper.classList.remove("empty");i()};o.prototype.setSceneImage=function e(t){var n=false;var r=this.$sceneImage;console.warn("setSceneImage: ",t);this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(t.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")'}if(t.origin&&typeof t.origin==="string"){this.$sceneImage.style.backgroundPosition=t.origin}var i=function e(){if(n){return}n=true;r.remove()};if(r){r.addEventListener("transitionend",i,false);this.$gfx.insertBefore(this.$sceneImage,r);r.classList.add("hidden");setTimeout(i,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(t.position){case"left":this.$body.setAttribute("data-image-position","left");break;case"right":default:this.$body.setAttribute("data-image-position","right");break}};o.prototype.showSprite=function e(t,n){var i=this,s,o;if(!n.url||typeof n.url!=="string"){return}o=this.sprites[t];s=this.sprites[t]={actionCallback:n.actionCallback,action:null,style:{},animation:null};s.$img=document.createElement("img");s.$img.classList.add("sprite");if(n.maskUrl){console.warn("has mask!");r.svg.load(null,this.cleanUrl(n.maskUrl),{class:{spriteMask:true,clickable:true},css:n.style,noWidthHeightAttr:true},function(e,t){if(e){console.warn(e);return}s.$mask=t;i.updateSprite(null,n,s);if(o){o.$img.remove()}i.$gfx.append(s.$img);i.$gfx.append(s.$mask)});return}this.updateSprite(null,n,s);if(o){o.$img.remove()}this.$gfx.append(s.$img)};o.prototype.updateSprite=function e(t,n,s){var o,a;if(!n.style||typeof n.style!=="object"){n.style={}}if(s){o=s}else{if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}o=this.sprites[t]}delete n.style.position;if(n.url){o.$img.setAttribute("src",this.cleanUrl(n.url))}if(n.action!==undefined){a=o.$mask||o.$img;if(n.action&&!o.action){o.onClick=function(e){o.actionCallback(o.action);e.stopPropagation()};a.classList.add("clickable");a.addEventListener("click",o.onClick)}else if(!n.action&&o.action){a.classList.remove("clickable");a.removeEventListener("click",o.onClick)}o.action=n.action||null}i(null,o.style,n.style);r.css(o.$img,n.style);if(o.$mask){console.warn("update mask!");r.css(o.$mask,n.style)}};o.prototype.animateSprite=function e(t,n){var r=this,i,s,o,a=0;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}i=this.sprites[t];s=this.animations[n];i.animation=n;if(!Array.isArray(s.frames)||!s.frames.length){return}var u=function(){o=s.frames[a];r.updateSprite(null,o,i);if(++a<s.frames.length){setTimeout(u,o.duration*1e3)}else{i.animation=null}};u()};o.prototype.defineAnimation=function e(t,n){this.animations[t]=n};o.prototype.clearSprite=function e(t){var n;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}n=this.sprites[t];n.$img.remove();if(n.$mask){n.$mask.remove()}delete this.sprites[t]};o.prototype.sound=function e(t){var n=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,t,n);this.nextSoundChannel=(this.nextSoundChannel+1)%4;n.setAttribute("src",this.cleanUrl(t.url));n.play()};o.prototype.music=function e(t){var n=this,r=this.$music.getAttribute("src");if(t.url){t.url=this.cleanUrl(t.url);if(r){if(r!==t.url){f(this.$music,function(){n.$music.setAttribute("src",t.url);n.$music.play();l(n.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",t.url);this.$music.play();l(this.$music)}}else{if(r){f(this.$music,function(){n.$music.removeAttribute("src")})}}};var a=10;var u=.01;function l(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+u);e.__fadeTimer=setTimeout(l.bind(undefined,e,t),a)}function f(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-u);e.__fadeTimer=setTimeout(f.bind(undefined,e,t),a)}},{"dom-kit":8,"tree-kit/lib/extend.js":24}],2:[function(e,t,n){"use strict";var r=e("nextgen-events");var i=e("dom-kit");var s=e("url");function o(e){return o.create(e)}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.create=function e(t){var n=Object.create(o.prototype,{token:{value:t.token||"null",writable:true,enumerable:true},port:{value:t.port||80,writable:true,enumerable:true},userName:{value:t.name||"unknown_"+Math.floor(Math.random()*1e4),writable:true,enumerable:true},ws:{value:null,writable:true,enumerable:true},proxy:{value:null,writable:true,enumerable:true}});return n};var a={classic:e("./ui/classic.js")};o.autoCreate=function e(){var t=s.parse(window.location.href,true).query;window.spellcastClient=o.create(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};o.prototype.run=function e(t){var n=this,i=false;this.proxy=new r.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(function(e){if(a[e]){a[e](n.proxy.remoteServices.bus,n)}});this.ws=new WebSocket("ws://127.0.0.1:"+this.port+"/"+this.token);this.emit("connecting");this.ws.onerror=function e(){if(!i){console.log("Can't open Websocket (error)...");n.emit("error","unreachable");return}};this.ws.onopen=function e(){i=true;console.log("Websocket opened!");n.emit("open");n.proxy.remoteServices.bus.emit("authenticate",{name:n.userName});if(typeof t==="function"){t()}};this.ws.onclose=function e(){if(!i){console.log("Can't open Websocket (close)...");n.emit("error","unreachable");return}i=false;n.proxy.destroy();console.log("Websocket closed!");n.emit("close")};this.ws.onmessage=function e(t){var r;try{r=JSON.parse(t.data)}catch(e){return}console.log("Message received: ",r);n.proxy.receive(r)};n.proxy.send=function e(t){n.ws.send(JSON.stringify(t))}};o.autoCreate();i.ready(function(){window.spellcastClient.run()})},{"./ui/classic.js":4,"dom-kit":8,"nextgen-events":12,url:25}],3:[function(e,t,n){"use strict";var r={};t.exports=r;var i=e("string-kit/lib/format.js").markupMethod;var s=e("string-kit/lib/escape.js").html;var o={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="brightBlue">',c:'<span class="cyan">',C:'<span class="brightCyan">',g:'<span class="green">',G:'<span class="brightGreen">',k:'<span class="black">',K:'<span class="brightBlack">',m:'<span class="magenta">',M:'<span class="brightMagenta">',r:'<span class="red">',R:'<span class="brightRed">',w:'<span class="white">',W:'<span class="brightWhite">',y:'<span class="yellow">',Y:'<span class="brightYellow">'}};r.markup=function(){var e=Array.from(arguments);e[0]=s(e[0]).replace(/\n/,"<br />");return i.apply(o,e)}},{"string-kit/lib/escape.js":21,"string-kit/lib/format.js":22}],4:[function(e,t,n){"use strict";var r=e("../Dom.js");var i=e("../toolkit.js");function s(e,t,n){console.log(Array.from(arguments));if(!n){n=Object.create(s.prototype,{bus:{value:e,enumerable:true},client:{value:t,enumerable:true},user:{value:null,writable:true,enumerable:true},users:{value:null,writable:true,enumerable:true},roles:{value:null,writable:true,enumerable:true},roleId:{value:null,writable:true,enumerable:true},config:{value:null,writable:true,enumerable:true},inGame:{value:false,writable:true,enumerable:true},nexts:{value:null,writable:true,enumerable:true},afterNext:{value:false,writable:true,enumerable:true},afterNextTriggered:{value:false,writable:true,enumerable:true},afterLeave:{value:false,writable:true,enumerable:true},hasNewContent:{value:false,writable:true,enumerable:true},dom:{value:r.create()}})}n.client.once("connecting",s.clientConnecting.bind(n));n.client.once("open",s.clientOpen.bind(n));n.client.once("close",s.clientClose.bind(n));n.client.on("error",s.clientError.bind(n));n.dom.enableChat(function(e){console.log("inGame?",n.inGame);n.bus.emit(n.inGame?"command":"chat",e)});return n}t.exports=s;function o(e){return this.find(function(t){return t.id===e})}s.prototype.initBus=function e(){this.bus.on("clientConfig",s.clientConfig.bind(this));this.bus.on("user",s.user.bind(this));this.bus.on("userList",s.userList.bind(this));this.bus.on("roleList",s.roleList.bind(this));this.bus.on("extOutput",s.extOutput.bind(this));this.bus.on("extErrorOutput",s.extErrorOutput.bind(this));this.bus.on("message",s.message.bind(this),{async:true});this.bus.on("indicators",s.indicators.bind(this));this.bus.on("status",s.status.bind(this));this.bus.on("theme",s.theme.bind(this));this.bus.on("image",s.image.bind(this));this.bus.on("sound",s.sound.bind(this));this.bus.on("music",s.music.bind(this));this.bus.on("defineAnimation",s.defineAnimation.bind(this));this.bus.on("showSprite",s.showSprite.bind(this));this.bus.on("updateSprite",s.prototype.updateSprite.bind(this));this.bus.on("animateSprite",s.animateSprite.bind(this));this.bus.on("clearSprite",s.clearSprite.bind(this));this.bus.on("enterScene",s.enterScene.bind(this));this.bus.on("leaveScene",s.leaveScene.bind(this));this.bus.on("nextList",s.nextList.bind(this));this.bus.on("nextTriggered",s.nextTriggered.bind(this));this.bus.on("textInput",s.textInput.bind(this));this.bus.on("rejoin",s.rejoin.bind(this));this.bus.on("wait",s.wait.bind(this));this.bus.on("end",s.end.bind(this),{async:true});this.bus.on("exit",s.exit.bind(this));this.bus.emit("ready")};s.clientConnecting=function e(){console.log("Connecting!");this.dom.clientStatus("connecting...",{color:"blue"})};s.clientOpen=function e(){console.log("Connected!");this.dom.clientStatus("connected",{color:"green"});this.initBus()};s.clientClose=function e(){console.log("Closed!");this.dom.clientStatus("connection closed",{color:"red",alert:true})};s.clientError=function e(t){switch(t){case"unreachable":this.dom.clientStatus("server unreachable",{color:"red",alert:true});break}};s.clientConfig=function e(t){console.warn("Client config received: ",t);this.config=t;if(this.config.theme){this.dom.setTheme(this.config.theme)}};s.user=function e(t){console.log("User received: ",t);this.user=t};s.userList=function e(t){console.log("User-list received: ",t);t.get=o;this.users=t};s.roleList=function e(t,n,r){var i=this,s=[],a;if(!this.roles&&t.length>1){this.dom.setMultiplayer(true)}t.get=o;this.roles=t;if(this.inGame){return}if(r&&t.length<=1){this.roleId=t[0].id;return}t.forEach(function(e,t){var n=e.clientId&&i.users.get(e.clientId).name;s.push({index:t,label:e.label,type:"role",selectedBy:n&&[n]})});if(n.length){a=n.map(function(e){return i.users.get(e).name})}var u=function(e){if(t[e].clientId===i.user.id){i.bus.emit("selectRole",null)}else if(t[e].clientId!==null){return}else{i.bus.emit("selectRole",e)}};this.dom.setChoices(s,a,u);if(r){t.find(function(e,t){if(e.clientId===i.user.id){i.roleId=e.id;return true}return false});this.afterLeave=true;return}};s.message=function e(t,n,r){var s=this,o=false;this.hasNewContent=true;t=i.markup(t);if(!n){n={}}var a=function e(){if(o){return}o=true;if(n.next){s.messageNext(r);return}r()};this.dom.addMessage(t,n,a)};s.prototype.messageNext=function e(t){this.dom.messageNext(t)};s.indicators=function e(t){this.dom.addIndicators(t)};s.status=function e(t){};s.enterScene=function e(t,n){this.inGame=true;if(n){this.dom.toAltBuffer()}else if(!t){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};s.leaveScene=function e(t,n){if(n){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};s.nextTriggered=function e(){this.afterNextTriggered=true;this.hasNewContent=false;this.dom.clearChoices()};s.nextList=function e(t,n,r,i,s){var o=this,a=[],u,l=0;this.nexts=t;this.afterNext=true;if(s&&this.roles.length===1){return}t.forEach(function(e,t){var n=e.roleIds.map(function(e){return o.roles.get(e).label});if(e.label){l+=e.label.length}a.push({index:t,label:e.label||"Next",image:e.image,groupBreak:!!e.groupBreak,type:"next",selectedBy:n})});if(!i.style||i.style==="auto"){if(this.roles.length<=1&&a.length<=3&&l<20){i.style="inline"}else if(a.length>8){i.style="smallList"}else{i.style="list"}}if(r.length&&this.roles.length){u=r.map(function(e){return o.roles.get(e).label})}var f=function(e){if(t[e].roleIds.indexOf(o.roleId)!==-1){o.bus.emit("selectNext",null)}else{o.bus.emit("selectNext",e)}};this.dom.setChoices(a,u,f,{timeout:i.timeout,style:i.style})};s.extOutput=function e(t){alert("not coded ATM!")};s.extErrorOutput=function e(t){alert("not coded ATM!")};s.textInput=function e(t,n){var r=this,i={label:t};if(n.indexOf(this.roleId)===-1){i.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(i)}else{this.dom.textInput(i,function(e){r.bus.emit("textSubmit",e)})}};s.rejoin=function e(){};s.wait=function e(t){var n=this;switch(t){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoin",function(){n.dom.clearHint()});break;default:this.dom.setBigHint("WAITING FOR "+t,{wait:true,"pulse-animation":true})}};s.theme=function e(t){if(!t.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(t)};s.image=function e(t){this.dom.setSceneImage(t)};s.defineAnimation=function e(t,n){this.dom.defineAnimation(t,n)};s.showSprite=function e(t,n){if(!n.url||typeof n.url!=="string"){return}n.actionCallback=s.spriteActionCallback.bind(this);this.dom.showSprite(t,n)};s.spriteActionCallback=function e(t){console.warn("action triggered: ",t);this.bus.emit("action",t)};s.prototype.updateSprite=function e(t,n){this.dom.updateSprite(t,n)};s.animateSprite=function e(t,n){this.dom.animateSprite(t,n)};s.clearSprite=function e(t){this.dom.clearSprite(t)};s.sound=function e(t){this.dom.sound(t)};s.music=function e(t){this.dom.music(t)};s.end=function e(t,n,r){var i={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};switch(t){case"end":this.dom.setDialog("The End.",i,r);break;case"win":this.dom.setDialog("You Win!",i,r);break;case"lost":this.dom.setDialog("You Lose...",i,r);break;case"draw":this.dom.setDialog("Draw.",i,r);break}};s.exit=function e(){}},{"../Dom.js":1,"../toolkit.js":3}],5:[function(e,t,n){"use strict";n.byteLength=f;n.toByteArray=c;n.fromByteArray=d;var r=[];var i=[];var s=typeof Uint8Array!=="undefined"?Uint8Array:Array;var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var a=0,u=o.length;a<u;++a){r[a]=o[a];i[o.charCodeAt(a)]=a}i["-".charCodeAt(0)]=62;i["_".charCodeAt(0)]=63;function l(e){var t=e.length;if(t%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return e[t-2]==="="?2:e[t-1]==="="?1:0}function f(e){return e.length*3/4-l(e)}function c(e){var t,n,r,o,a;var u=e.length;o=l(e);a=new s(u*3/4-o);n=o>0?u-4:u;var f=0;for(t=0;t<n;t+=4){r=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)];a[f++]=r>>16&255;a[f++]=r>>8&255;a[f++]=r&255}if(o===2){r=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4;a[f++]=r&255}else if(o===1){r=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2;a[f++]=r>>8&255;a[f++]=r&255}return a}function h(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[e&63]}function p(e,t,n){var r;var i=[];for(var s=t;s<n;s+=3){r=(e[s]<<16)+(e[s+1]<<8)+e[s+2];i.push(h(r))}return i.join("")}function d(e){var t;var n=e.length;var i=n%3;var s="";var o=[];var a=16383;for(var u=0,l=n-i;u<l;u+=a){o.push(p(e,u,u+a>l?l:u+a))}if(i===1){t=e[n-1];s+=r[t>>2];s+=r[t<<4&63];s+="=="}else if(i===2){t=(e[n-2]<<8)+e[n-1];s+=r[t>>10];s+=r[t>>4&63];s+=r[t<<2&63];s+="="}o.push(s);return o.join("")}},{}],6:[function(e,t,n){},{}],7:[function(e,t,n){"use strict";var r=e("base64-js");var i=e("ieee754");n.Buffer=u;n.SlowBuffer=v;n.INSPECT_MAX_BYTES=50;var s=2147483647;n.kMaxLength=s;u.TYPED_ARRAY_SUPPORT=o();if(!u.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function o(){try{var e=new Uint8Array(1);e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return e.foo()===42}catch(e){return false}}function a(e){if(e>s){throw new RangeError("Invalid typed array length")}var t=new Uint8Array(e);t.__proto__=u.prototype;return t}function u(e,t,n){if(typeof e==="number"){if(typeof t==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return h(e)}return l(e,t,n)}if(typeof Symbol!=="undefined"&&Symbol.species&&u[Symbol.species]===u){Object.defineProperty(u,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}u.poolSize=8192;function l(e,t,n){if(typeof e==="number"){throw new TypeError('"value" argument must not be a number')}if(J(e)){return m(e,t,n)}if(typeof e==="string"){return p(e,t)}return g(e)}u.from=function(e,t,n){return l(e,t,n)};u.prototype.__proto__=Uint8Array.prototype;u.__proto__=Uint8Array;function f(e){if(typeof e!=="number"){throw new TypeError('"size" argument must be a number')}else if(e<0){throw new RangeError('"size" argument must not be negative')}}function c(e,t,n){f(e);if(e<=0){return a(e)}if(t!==undefined){return typeof n==="string"?a(e).fill(t,n):a(e).fill(t)}return a(e)}u.alloc=function(e,t,n){return c(e,t,n)};function h(e){f(e);return a(e<0?0:y(e)|0)}u.allocUnsafe=function(e){return h(e)};u.allocUnsafeSlow=function(e){return h(e)};function p(e,t){if(typeof t!=="string"||t===""){t="utf8"}if(!u.isEncoding(t)){throw new TypeError('"encoding" must be a valid string encoding')}var n=b(e,t)|0;var r=a(n);var i=r.write(e,t);if(i!==n){r=r.slice(0,i)}return r}function d(e){var t=e.length<0?0:y(e.length)|0;var n=a(t);for(var r=0;r<t;r+=1){n[r]=e[r]&255}return n}function m(e,t,n){if(t<0||e.byteLength<t){throw new RangeError("'offset' is out of bounds")}if(e.byteLength<t+(n||0)){throw new RangeError("'length' is out of bounds")}var r;if(t===undefined&&n===undefined){r=new Uint8Array(e)}else if(n===undefined){r=new Uint8Array(e,t)}else{r=new Uint8Array(e,t,n)}r.__proto__=u.prototype;return r}function g(e){if(u.isBuffer(e)){var t=y(e.length)|0;var n=a(t);if(n.length===0){return n}e.copy(n,0,0,t);return n}if(e){if(K(e)||"length"in e){if(typeof e.length!=="number"||V(e.length)){return a(0)}return d(e)}if(e.type==="Buffer"&&Array.isArray(e.data)){return d(e.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function y(e){if(e>=s){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+s.toString(16)+" bytes")}return e|0}function v(e){if(+e!=e){e=0}return u.alloc(+e)}u.isBuffer=function e(t){return t!=null&&t._isBuffer===true};u.compare=function e(t,n){if(!u.isBuffer(t)||!u.isBuffer(n)){throw new TypeError("Arguments must be Buffers")}if(t===n)return 0;var r=t.length;var i=n.length;for(var s=0,o=Math.min(r,i);s<o;++s){if(t[s]!==n[s]){r=t[s];i=n[s];break}}if(r<i)return-1;if(i<r)return 1;return 0};u.isEncoding=function e(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};u.concat=function e(t,n){if(!Array.isArray(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return u.alloc(0)}var r;if(n===undefined){n=0;for(r=0;r<t.length;++r){n+=t[r].length}}var i=u.allocUnsafe(n);var s=0;for(r=0;r<t.length;++r){var o=t[r];if(!u.isBuffer(o)){
throw new TypeError('"list" argument must be an Array of Buffers')}o.copy(i,s);s+=o.length}return i};function b(e,t){if(u.isBuffer(e)){return e.length}if(K(e)||J(e)){return e.byteLength}if(typeof e!=="string"){e=""+e}var n=e.length;if(n===0)return 0;var r=false;for(;;){switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case undefined:return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return n*2;case"hex":return n>>>1;case"base64":return Q(e).length;default:if(r)return H(e).length;t=(""+t).toLowerCase();r=true}}}u.byteLength=b;function w(e,t,n){var r=false;if(t===undefined||t<0){t=0}if(t>this.length){return""}if(n===undefined||n>this.length){n=this.length}if(n<=0){return""}n>>>=0;t>>>=0;if(n<=t){return""}if(!e)e="utf8";while(true){switch(e){case"hex":return N(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return O(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase();r=true}}}u.prototype._isBuffer=true;function _(e,t,n){var r=e[t];e[t]=e[n];e[n]=r}u.prototype.swap16=function e(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var n=0;n<t;n+=2){_(this,n,n+1)}return this};u.prototype.swap32=function e(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var n=0;n<t;n+=4){_(this,n,n+3);_(this,n+1,n+2)}return this};u.prototype.swap64=function e(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var n=0;n<t;n+=8){_(this,n,n+7);_(this,n+1,n+6);_(this,n+2,n+5);_(this,n+3,n+4)}return this};u.prototype.toString=function e(){var t=this.length;if(t===0)return"";if(arguments.length===0)return T(this,0,t);return w.apply(this,arguments)};u.prototype.equals=function e(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return u.compare(this,t)===0};u.prototype.inspect=function e(){var t="";var r=n.INSPECT_MAX_BYTES;if(this.length>0){t=this.toString("hex",0,r).match(/.{2}/g).join(" ");if(this.length>r)t+=" ... "}return"<Buffer "+t+">"};u.prototype.compare=function e(t,n,r,i,s){if(!u.isBuffer(t)){throw new TypeError("Argument must be a Buffer")}if(n===undefined){n=0}if(r===undefined){r=t?t.length:0}if(i===undefined){i=0}if(s===undefined){s=this.length}if(n<0||r>t.length||i<0||s>this.length){throw new RangeError("out of range index")}if(i>=s&&n>=r){return 0}if(i>=s){return-1}if(n>=r){return 1}n>>>=0;r>>>=0;i>>>=0;s>>>=0;if(this===t)return 0;var o=s-i;var a=r-n;var l=Math.min(o,a);var f=this.slice(i,s);var c=t.slice(n,r);for(var h=0;h<l;++h){if(f[h]!==c[h]){o=f[h];a=c[h];break}}if(o<a)return-1;if(a<o)return 1;return 0};function k(e,t,n,r,i){if(e.length===0)return-1;if(typeof n==="string"){r=n;n=0}else if(n>2147483647){n=2147483647}else if(n<-2147483648){n=-2147483648}n=+n;if(V(n)){n=i?0:e.length-1}if(n<0)n=e.length+n;if(n>=e.length){if(i)return-1;else n=e.length-1}else if(n<0){if(i)n=0;else return-1}if(typeof t==="string"){t=u.from(t,r)}if(u.isBuffer(t)){if(t.length===0){return-1}return x(e,t,n,r,i)}else if(typeof t==="number"){t=t&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(i){return Uint8Array.prototype.indexOf.call(e,t,n)}else{return Uint8Array.prototype.lastIndexOf.call(e,t,n)}}return x(e,[t],n,r,i)}throw new TypeError("val must be string, number or Buffer")}function x(e,t,n,r,i){var s=1;var o=e.length;var a=t.length;if(r!==undefined){r=String(r).toLowerCase();if(r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le"){if(e.length<2||t.length<2){return-1}s=2;o/=2;a/=2;n/=2}}function u(e,t){if(s===1){return e[t]}else{return e.readUInt16BE(t*s)}}var l;if(i){var f=-1;for(l=n;l<o;l++){if(u(e,l)===u(t,f===-1?0:l-f)){if(f===-1)f=l;if(l-f+1===a)return f*s}else{if(f!==-1)l-=l-f;f=-1}}}else{if(n+a>o)n=o-a;for(l=n;l>=0;l--){var c=true;for(var h=0;h<a;h++){if(u(e,l+h)!==u(t,h)){c=false;break}}if(c)return l}}return-1}u.prototype.includes=function e(t,n,r){return this.indexOf(t,n,r)!==-1};u.prototype.indexOf=function e(t,n,r){return k(this,t,n,r,true)};u.prototype.lastIndexOf=function e(t,n,r){return k(this,t,n,r,false)};function E(e,t,n,r){n=Number(n)||0;var i=e.length-n;if(!r){r=i}else{r=Number(r);if(r>i){r=i}}var s=t.length;if(s%2!==0)throw new TypeError("Invalid hex string");if(r>s/2){r=s/2}for(var o=0;o<r;++o){var a=parseInt(t.substr(o*2,2),16);if(V(a))return o;e[n+o]=a}return o}function C(e,t,n,r){return Z(H(t,e.length-n),e,n,r)}function S(e,t,n,r){return Z(z(t),e,n,r)}function A(e,t,n,r){return S(e,t,n,r)}function L(e,t,n,r){return Z(Q(t),e,n,r)}function j(e,t,n,r){return Z(X(t,e.length-n),e,n,r)}u.prototype.write=function e(t,n,r,i){if(n===undefined){i="utf8";r=this.length;n=0}else if(r===undefined&&typeof n==="string"){i=n;r=this.length;n=0}else if(isFinite(n)){n=n>>>0;if(isFinite(r)){r=r>>>0;if(i===undefined)i="utf8"}else{i=r;r=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var s=this.length-n;if(r===undefined||r>s)r=s;if(t.length>0&&(r<0||n<0)||n>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!i)i="utf8";var o=false;for(;;){switch(i){case"hex":return E(this,t,n,r);case"utf8":case"utf-8":return C(this,t,n,r);case"ascii":return S(this,t,n,r);case"latin1":case"binary":return A(this,t,n,r);case"base64":return L(this,t,n,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,n,r);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase();o=true}}};u.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function O(e,t,n){if(t===0&&n===e.length){return r.fromByteArray(e)}else{return r.fromByteArray(e.slice(t,n))}}function T(e,t,n){n=Math.min(e.length,n);var r=[];var i=t;while(i<n){var s=e[i];var o=null;var a=s>239?4:s>223?3:s>191?2:1;if(i+a<=n){var u,l,f,c;switch(a){case 1:if(s<128){o=s}break;case 2:u=e[i+1];if((u&192)===128){c=(s&31)<<6|u&63;if(c>127){o=c}}break;case 3:u=e[i+1];l=e[i+2];if((u&192)===128&&(l&192)===128){c=(s&15)<<12|(u&63)<<6|l&63;if(c>2047&&(c<55296||c>57343)){o=c}}break;case 4:u=e[i+1];l=e[i+2];f=e[i+3];if((u&192)===128&&(l&192)===128&&(f&192)===128){c=(s&15)<<18|(u&63)<<12|(l&63)<<6|f&63;if(c>65535&&c<1114112){o=c}}}}if(o===null){o=65533;a=1}else if(o>65535){o-=65536;r.push(o>>>10&1023|55296);o=56320|o&1023}r.push(o);i+=a}return B(r)}var $=4096;function B(e){var t=e.length;if(t<=$){return String.fromCharCode.apply(String,e)}var n="";var r=0;while(r<t){n+=String.fromCharCode.apply(String,e.slice(r,r+=$))}return n}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i){r+=String.fromCharCode(e[i]&127)}return r}function M(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i){r+=String.fromCharCode(e[i])}return r}function N(e,t,n){var r=e.length;if(!t||t<0)t=0;if(!n||n<0||n>r)n=r;var i="";for(var s=t;s<n;++s){i+=Y(e[s])}return i}function R(e,t,n){var r=e.slice(t,n);var i="";for(var s=0;s<r.length;s+=2){i+=String.fromCharCode(r[s]+r[s+1]*256)}return i}u.prototype.slice=function e(t,n){var r=this.length;t=~~t;n=n===undefined?r:~~n;if(t<0){t+=r;if(t<0)t=0}else if(t>r){t=r}if(n<0){n+=r;if(n<0)n=0}else if(n>r){n=r}if(n<t)n=t;var i=this.subarray(t,n);i.__proto__=u.prototype;return i};function U(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUIntLE=function e(t,n,r){t=t>>>0;n=n>>>0;if(!r)U(t,n,this.length);var i=this[t];var s=1;var o=0;while(++o<n&&(s*=256)){i+=this[t+o]*s}return i};u.prototype.readUIntBE=function e(t,n,r){t=t>>>0;n=n>>>0;if(!r){U(t,n,this.length)}var i=this[t+--n];var s=1;while(n>0&&(s*=256)){i+=this[t+--n]*s}return i};u.prototype.readUInt8=function e(t,n){t=t>>>0;if(!n)U(t,1,this.length);return this[t]};u.prototype.readUInt16LE=function e(t,n){t=t>>>0;if(!n)U(t,2,this.length);return this[t]|this[t+1]<<8};u.prototype.readUInt16BE=function e(t,n){t=t>>>0;if(!n)U(t,2,this.length);return this[t]<<8|this[t+1]};u.prototype.readUInt32LE=function e(t,n){t=t>>>0;if(!n)U(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};u.prototype.readUInt32BE=function e(t,n){t=t>>>0;if(!n)U(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};u.prototype.readIntLE=function e(t,n,r){t=t>>>0;n=n>>>0;if(!r)U(t,n,this.length);var i=this[t];var s=1;var o=0;while(++o<n&&(s*=256)){i+=this[t+o]*s}s*=128;if(i>=s)i-=Math.pow(2,8*n);return i};u.prototype.readIntBE=function e(t,n,r){t=t>>>0;n=n>>>0;if(!r)U(t,n,this.length);var i=n;var s=1;var o=this[t+--i];while(i>0&&(s*=256)){o+=this[t+--i]*s}s*=128;if(o>=s)o-=Math.pow(2,8*n);return o};u.prototype.readInt8=function e(t,n){t=t>>>0;if(!n)U(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};u.prototype.readInt16LE=function e(t,n){t=t>>>0;if(!n)U(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};u.prototype.readInt16BE=function e(t,n){t=t>>>0;if(!n)U(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};u.prototype.readInt32LE=function e(t,n){t=t>>>0;if(!n)U(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};u.prototype.readInt32BE=function e(t,n){t=t>>>0;if(!n)U(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};u.prototype.readFloatLE=function e(t,n){t=t>>>0;if(!n)U(t,4,this.length);return i.read(this,t,true,23,4)};u.prototype.readFloatBE=function e(t,n){t=t>>>0;if(!n)U(t,4,this.length);return i.read(this,t,false,23,4)};u.prototype.readDoubleLE=function e(t,n){t=t>>>0;if(!n)U(t,8,this.length);return i.read(this,t,true,52,8)};u.prototype.readDoubleBE=function e(t,n){t=t>>>0;if(!n)U(t,8,this.length);return i.read(this,t,false,52,8)};function D(e,t,n,r,i,s){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}u.prototype.writeUIntLE=function e(t,n,r,i){t=+t;n=n>>>0;r=r>>>0;if(!i){var s=Math.pow(2,8*r)-1;D(this,t,n,r,s,0)}var o=1;var a=0;this[n]=t&255;while(++a<r&&(o*=256)){this[n+a]=t/o&255}return n+r};u.prototype.writeUIntBE=function e(t,n,r,i){t=+t;n=n>>>0;r=r>>>0;if(!i){var s=Math.pow(2,8*r)-1;D(this,t,n,r,s,0)}var o=r-1;var a=1;this[n+o]=t&255;while(--o>=0&&(a*=256)){this[n+o]=t/a&255}return n+r};u.prototype.writeUInt8=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,1,255,0);this[n]=t&255;return n+1};u.prototype.writeUInt16LE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,2,65535,0);this[n]=t&255;this[n+1]=t>>>8;return n+2};u.prototype.writeUInt16BE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,2,65535,0);this[n]=t>>>8;this[n+1]=t&255;return n+2};u.prototype.writeUInt32LE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,4,4294967295,0);this[n+3]=t>>>24;this[n+2]=t>>>16;this[n+1]=t>>>8;this[n]=t&255;return n+4};u.prototype.writeUInt32BE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,4,4294967295,0);this[n]=t>>>24;this[n+1]=t>>>16;this[n+2]=t>>>8;this[n+3]=t&255;return n+4};u.prototype.writeIntLE=function e(t,n,r,i){t=+t;n=n>>>0;if(!i){var s=Math.pow(2,8*r-1);D(this,t,n,r,s-1,-s)}var o=0;var a=1;var u=0;this[n]=t&255;while(++o<r&&(a*=256)){if(t<0&&u===0&&this[n+o-1]!==0){u=1}this[n+o]=(t/a>>0)-u&255}return n+r};u.prototype.writeIntBE=function e(t,n,r,i){t=+t;n=n>>>0;if(!i){var s=Math.pow(2,8*r-1);D(this,t,n,r,s-1,-s)}var o=r-1;var a=1;var u=0;this[n+o]=t&255;while(--o>=0&&(a*=256)){if(t<0&&u===0&&this[n+o+1]!==0){u=1}this[n+o]=(t/a>>0)-u&255}return n+r};u.prototype.writeInt8=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,1,127,-128);if(t<0)t=255+t+1;this[n]=t&255;return n+1};u.prototype.writeInt16LE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,2,32767,-32768);this[n]=t&255;this[n+1]=t>>>8;return n+2};u.prototype.writeInt16BE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,2,32767,-32768);this[n]=t>>>8;this[n+1]=t&255;return n+2};u.prototype.writeInt32LE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,4,2147483647,-2147483648);this[n]=t&255;this[n+1]=t>>>8;this[n+2]=t>>>16;this[n+3]=t>>>24;return n+4};u.prototype.writeInt32BE=function e(t,n,r){t=+t;n=n>>>0;if(!r)D(this,t,n,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;this[n]=t>>>24;this[n+1]=t>>>16;this[n+2]=t>>>8;this[n+3]=t&255;return n+4};function q(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,r,s){t=+t;n=n>>>0;if(!s){q(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38)}i.write(e,t,n,r,23,4);return n+4}u.prototype.writeFloatLE=function e(t,n,r){return F(this,t,n,true,r)};u.prototype.writeFloatBE=function e(t,n,r){return F(this,t,n,false,r)};function P(e,t,n,r,s){t=+t;n=n>>>0;if(!s){q(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308)}i.write(e,t,n,r,52,8);return n+8}u.prototype.writeDoubleLE=function e(t,n,r){return P(this,t,n,true,r)};u.prototype.writeDoubleBE=function e(t,n,r){return P(this,t,n,false,r)};u.prototype.copy=function e(t,n,r,i){if(!r)r=0;if(!i&&i!==0)i=this.length;if(n>=t.length)n=t.length;if(!n)n=0;if(i>0&&i<r)i=r;if(i===r)return 0;if(t.length===0||this.length===0)return 0;if(n<0){throw new RangeError("targetStart out of bounds")}if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");if(i>this.length)i=this.length;if(t.length-n<i-r){i=t.length-n+r}var s=i-r;var o;if(this===t&&r<n&&n<i){for(o=s-1;o>=0;--o){t[o+n]=this[o+r]}}else if(s<1e3){for(o=0;o<s;++o){t[o+n]=this[o+r]}}else{Uint8Array.prototype.set.call(t,this.subarray(r,r+s),n)}return s};u.prototype.fill=function e(t,n,r,i){if(typeof t==="string"){if(typeof n==="string"){i=n;n=0;r=this.length}else if(typeof r==="string"){i=r;r=this.length}if(t.length===1){var s=t.charCodeAt(0);if(s<256){t=s}}if(i!==undefined&&typeof i!=="string"){throw new TypeError("encoding must be a string")}if(typeof i==="string"&&!u.isEncoding(i)){throw new TypeError("Unknown encoding: "+i)}}else if(typeof t==="number"){t=t&255}if(n<0||this.length<n||this.length<r){throw new RangeError("Out of range index")}if(r<=n){return this}n=n>>>0;r=r===undefined?this.length:r>>>0;if(!t)t=0;var o;if(typeof t==="number"){for(o=n;o<r;++o){this[o]=t}}else{var a=u.isBuffer(t)?t:new u(t,i);var l=a.length;for(o=0;o<r-n;++o){this[o+n]=a[o%l]}}return this};var W=/[^+\/0-9A-Za-z-_]/g;function G(e){e=e.trim().replace(W,"");if(e.length<2)return"";while(e.length%4!==0){e=e+"="}return e}function Y(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function H(e,t){t=t||Infinity;var n;var r=e.length;var i=null;var s=[];for(var o=0;o<r;++o){n=e.charCodeAt(o);if(n>55295&&n<57344){if(!i){if(n>56319){if((t-=3)>-1)s.push(239,191,189);continue}else if(o+1===r){if((t-=3)>-1)s.push(239,191,189);continue}i=n;continue}if(n<56320){if((t-=3)>-1)s.push(239,191,189);i=n;continue}n=(i-55296<<10|n-56320)+65536}else if(i){if((t-=3)>-1)s.push(239,191,189)}i=null;if(n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,n&63|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,n&63|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,n&63|128)}else{throw new Error("Invalid code point")}}return s}function z(e){var t=[];for(var n=0;n<e.length;++n){t.push(e.charCodeAt(n)&255)}return t}function X(e,t){var n,r,i;var s=[];for(var o=0;o<e.length;++o){if((t-=2)<0)break;n=e.charCodeAt(o);r=n>>8;i=n%256;s.push(i);s.push(r)}return s}function Q(e){return r.toByteArray(G(e))}function Z(e,t,n,r){for(var i=0;i<r;++i){if(i+n>=t.length||i>=e.length)break;t[i+n]=e[i]}return i}function J(e){return e instanceof ArrayBuffer||e!=null&&e.constructor!=null&&e.constructor.name==="ArrayBuffer"&&typeof e.byteLength==="number"}function K(e){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(e)}function V(e){return e!==e}},{"base64-js":5,ieee754:10}],8:[function(e,t,n){var r={};t.exports=r;r.svg=e("./svg.js");r.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};r.fromHtml=function e(t){var n,r,i;i=document.createDocumentFragment();r=document.createElement("div");r.insertAdjacentHTML("beforeend",t);for(n=0;n<r.children.length;n++){i.appendChild(r.children[n])}return i};r.batch=function e(t,n){var r,i=Array.prototype.slice.call(arguments,1);if(n instanceof Element){i[0]=n;t.apply(this,i)}else if(Array.isArray(n)){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}else if(n instanceof NodeList||n instanceof NamedNodeMap){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}};r.css=function e(t,n){var r;for(r in n){t.style[r]=n[r]}};r.attr=function e(t,n){var r;for(r in n){if(n[r]===null){t.removeAttribute(r)}else{t.setAttribute(r,n[r])}}};r.class=function e(t,n){var r;for(r in n){if(n[r]){t.classList.add(r)}else{t.classList.remove(r)}}};r.remove=function e(t){t.parentNode.removeChild(t)};r.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};r.cloneInto=function e(t,n){r.empty(t);t.appendChild(n.cloneNode(true))};r.insertInto=function e(t,n){r.empty(t);t.appendChild(n)};r.idNamespace=function e(t,n){var i,s={};i=t.querySelectorAll("*");r.batch(r.idNamespace.idAttributePass,i,n,s);r.batch(r.idNamespace.otherAttributesPass,i,s)};r.idNamespace.idAttributePass=function e(t,n,r){r[t.id]=n+"."+t.id;t.id=r[t.id]};r.idNamespace.otherAttributesPass=function e(t,n){r.batch(r.idNamespace.oneAttributeSubPass,t.attributes,n)};r.idNamespace.oneAttributeSubPass=function e(t,n){t.value=t.value.replace(/url\(#([^)]+)\)/g,function(e,t){if(!n[t]){return e}return"url(#"+n[t]+")"})};r.id=function e(t,e){t.id=e};r.text=function e(t,e){t.textContent=e};r.html=function e(t,e){t.innerHTML=e}},{"./svg.js":9}],9:[function(e,t,n){(function(n){var r=e("fs");var i=e("./dom.js");var s={};t.exports=s;s.load=function e(t,i,o,a){if(typeof o==="function"){a=o}if(!o||typeof o!=="object"){o={}}if(i.substring(0,7)==="file://"&&!n.browser){r.readFile(i.slice(7),function(e,n){if(e){a(e);return}var r=new DOMParser;var i=r.parseFromString(n.toString(),"application/xml").documentElement;try{s.attachXmlTo(t,i,o)}catch(e){a(e);return}a(undefined,i)})}else{s.ajax(i,function(e,n){if(e){a(e);return}var r=n.documentElement;try{s.attachXmlTo(t,r,o)}catch(e){a(e);return}a(undefined,r)})}};s.attachXmlTo=function e(t,n,r){var o,a,u;s.lightCleanup(n);if(r.id!==undefined){if(typeof r.id==="string"){n.setAttribute("id",r.id)}else if(!r.id){n.removeAttribute("id")}}if(r.class&&typeof r.class==="object"){i.class(n,r.class)}if(r.idNamespace){i.idNamespace(n,r.idNamespace)}if(r.hidden){n.style.visibility="hidden"}if(r.noWidthHeightAttr){a=n.getAttribute("width");u=n.getAttribute("height");n.removeAttribute("height");n.removeAttribute("width");if(!n.getAttribute("viewBox")&&a&&u){o="0 0 "+a+" "+u;n.setAttribute("viewBox",o)}}if(r.css){i.css(n,r.css)}if(t){t.appendChild(n)}};s.lightCleanup=function e(t){o(t,"metadata");o(t,"script")};function o(e,t){var n,r,i;r=e.getElementsByTagName(t);for(n=0;n<r.length;n++){i=r.item(n);i.parentNode.removeChild(i)}}s.ajax=function e(t,n){var r=new XMLHttpRequest;r.responseType="document";r.onreadystatechange=s.ajax.ajaxStatus.bind(r,n);r.open("GET",t);r.send()};s.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[dom-kit.svg] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}}}).call(this,e("_process"))},{"./dom.js":8,_process:15,fs:6}],10:[function(e,t,n){n.read=function(e,t,n,r,i){var s,o;var a=i*8-r-1;var u=(1<<a)-1;var l=u>>1;var f=-7;var c=n?i-1:0;var h=n?-1:1;var p=e[t+c];c+=h;s=p&(1<<-f)-1;p>>=-f;f+=a;for(;f>0;s=s*256+e[t+c],c+=h,f-=8){}o=s&(1<<-f)-1;s>>=-f;f+=r;for(;f>0;o=o*256+e[t+c],c+=h,f-=8){}if(s===0){s=1-l}else if(s===u){return o?NaN:(p?-1:1)*Infinity}else{o=o+Math.pow(2,r);s=s-l}return(p?-1:1)*o*Math.pow(2,s-r)};n.write=function(e,t,n,r,i,s){var o,a,u;var l=s*8-i-1;var f=(1<<l)-1;var c=f>>1;var h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0;var p=r?0:s-1;var d=r?1:-1;var m=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){a=isNaN(t)?1:0;o=f}else{o=Math.floor(Math.log(t)/Math.LN2);if(t*(u=Math.pow(2,-o))<1){o--;u*=2}if(o+c>=1){t+=h/u}else{t+=h*Math.pow(2,1-c)}if(t*u>=2){o++;u/=2}if(o+c>=f){a=0;o=f}else if(o+c>=1){a=(t*u-1)*Math.pow(2,i);o=o+c}else{a=t*Math.pow(2,c-1)*Math.pow(2,i);o=0}}for(;i>=8;e[n+p]=a&255,p+=d,a/=256,i-=8){}o=o<<i|a;l+=i;for(;l>0;e[n+p]=o&255,p+=d,o/=256,l-=8){}e[n+p-d]|=m*128}},{}],11:[function(e,t,n){t.exports=function(e){return e!=null&&(r(e)||i(e)||!!e._isBuffer)};function r(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function i(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&r(e.slice(0,0))}},{}],12:[function(e,t,n){(function(n){"use strict";function r(){return Object.create(r.prototype)}t.exports=r;r.prototype.__prototypeUID__="nextgen-events/NextGenEvents";r.prototype.__prototypeVersion__=e("../package.json").version;r.SYNC=-Infinity;r.init=function e(){Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:r.SYNC,interruptible:false,recursion:0,contexts:{},states:{},stateGroups:{},listeners:{error:[],interrupt:[],newListener:[],removeListener:[]}}})};r.initFrom=function e(t){if(!t.__ngev){r.init.call(t)}Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:t.__ngev.nice,interruptible:t.__ngev.interruptible,recursion:0,contexts:{},states:Object.assign({},t.__ngev.states),stateGroups:Object.assign({},t.__ngev.stateGroups),listeners:{}}});Object.keys(t.__ngev.listeners).forEach(e=>{this.__ngev.listeners[e]=t.__ngev.listeners[e].slice()});Object.keys(t.__ngev.contexts).forEach(e=>{var n=t.__ngev.contexts[e];this.addListenerContext(e,{nice:n.nice,status:n.status,serial:n.serial})})};r.mergeListeners=function e(t){if(!this.__ngev){r.init.call(this)}var n=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(n).forEach(e=>{this.__ngev.listeners[e]=[]});t.forEach(e=>{if(!e.__ngev){r.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(e=>{var r,i,s=[];if(n[e]){n[e].forEach(n=>{for(r=0,i=t.length;r<i;r++){if(!t[r].__ngev.listeners[e]||t[r].__ngev.listeners[e].indexOf(n)===-1){s.push(n);break}}})}t.forEach(t=>{t.__ngev.listeners[e].forEach(t=>{if(this.__ngev.listeners[e].indexOf(t)===-1&&s.indexOf(t)===-1){this.__ngev.listeners[e].push(t)}})})})};r.filterOutCallback=function(e,t){return e!==t};r.prototype.addListener=function e(t,n,i){var s={},o;if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}s.fn=n||i.fn;s.id=i.id!==undefined?i.id:s.fn;s.once=!!i.once;s.async=!!i.async;s.eventObject=!!i.eventObject;s.nice=i.nice!==undefined?Math.floor(i.nice):r.SYNC;s.context=typeof i.context==="string"?i.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(s.context&&typeof s.context==="string"&&!this.__ngev.contexts[s.context]){this.addListenerContext(s.context)}s.event=t;if(this.__ngev.listeners.newListener.length){o=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[t].push(s);r.emitEvent({emitter:this,name:"newListener",args:[[s]],listeners:o});if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this}this.__ngev.listeners[t].push(s);if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function e(t,n,r){if(n&&typeof n==="object"){n.once=true}else if(r&&typeof r==="object"){r.once=true}else{r={once:true}}return this.addListener(t,n,r)};r.prototype.removeListener=function e(t,n){var i,s,o=[],a=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}s=this.__ngev.listeners[t].length;for(i=0;i<s;i++){if(this.__ngev.listeners[t][i].id===n){a.push(this.__ngev.listeners[t][i])}else{o.push(this.__ngev.listeners[t][i])}}this.__ngev.listeners[t]=o;if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.prototype.off=r.prototype.removeListener;r.prototype.removeAllListeners=function e(t){var n;if(!this.__ngev){r.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}n=this.__ngev.listeners[t];this.__ngev.listeners[t]=[];if(n.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",n)}}else{this.__ngev.listeners={}}return this};r.listenerWrapper=function e(t,n,i){var s,o,a;if(n.interrupt){return}if(t.async){if(i){o=i.serial;i.ready=!o}a=(e=>{n.listenersDone++;if(e&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=e;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}if(o){r.processQueue.call(n.emitter,t.context,true)}});if(t.eventObject){t.fn(n,a)}else{s=t.fn.apply(undefined,n.args.concat(a))}}else{if(t.eventObject){t.fn(n)}else{s=t.fn.apply(undefined,n.args)}n.listenersDone++}if(s&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=s;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}};var i=0;r.prototype.emit=function e(){var t;t={emitter:this};if(typeof arguments[0]==="number"){t.nice=Math.floor(arguments[0]);t.name=arguments[1];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,2,-1)}else{t.args=Array.prototype.slice.call(arguments,2)}}else{t.name=arguments[0];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}t.args=Array.prototype.slice.call(arguments,1);if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,1,-1)}else{t.args=Array.prototype.slice.call(arguments,1)}}return r.emitEvent(t)};r.emitEvent=function e(t){var n=t.emitter,s,o,a=0,u,l;if(!n.__ngev){r.init.call(n)}u=n.__ngev.states[t.name];if(u!==undefined){if(u&&t.args.length===u.args.length&&t.args.every((e,t)=>e===u.args[t])){return}n.__ngev.stateGroups[t.name].forEach(e=>{n.__ngev.states[e]=null});n.__ngev.states[t.name]=t}if(!n.__ngev.listeners[t.name]){n.__ngev.listeners[t.name]=[]}t.id=i++;t.listenersDone=0;t.once=!!t.once;if(t.nice===undefined||t.nice===null){t.nice=n.__ngev.nice}if(!t.listeners){t.listeners=n.__ngev.listeners[t.name].slice()}n.__ngev.recursion++;l=[];for(s=0,o=t.listeners.length;s<o;s++){a++;r.emitToOneListener(t,t.listeners[s],l)}n.__ngev.recursion--;if(l.length&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",l)}if(!a){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){t.callback(undefined,t);delete t.callback}}return t};r.emitToOneListener=function e(t,n,i){var s=t.emitter,o,a,u=false;o=n.context&&s.__ngev.contexts[n.context];if(o&&o.status===r.CONTEXT_DISABLED){return}if(o){a=Math.max(t.nice,n.nice,o.nice)}else{a=Math.max(t.nice,n.nice)}if(n.once){s.__ngev.listeners[t.name]=s.__ngev.listeners[t.name].filter(r.filterOutCallback.bind(undefined,n));if(i){i.push(n)}else{u=true}}if(o&&(o.status===r.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:t,listener:n,nice:a})}else{try{if(a<0){if(s.__ngev.recursion>=-a){setImmediate(r.listenerWrapper.bind(s,n,t,o))}else{r.listenerWrapper.call(s,n,t,o)}}else{setTimeout(r.listenerWrapper.bind(s,n,t,o),a)}}catch(e){s.__ngev.recursion--;throw e}}if(u&&s.__ngev.listeners.removeListener.length){s.emit("removeListener",[n])}};r.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}return this.__ngev.listeners[t].slice()};r.listenerCount=function(e,t){if(!e||!(e instanceof r)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};r.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};r.prototype.setNice=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};r.prototype.setInterruptible=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.interruptible=!!t};r.share=function(e,t){if(!(e instanceof r)||!(t instanceof r)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){r.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};r.reset=function e(t){Object.defineProperty(t,"__ngev",{configurable:true,value:null})};r.prototype.setMaxListeners=function(){};r.noop=function(){};r.prototype.defineStates=function e(){var t=this,n=Array.prototype.slice.call(arguments);if(!this.__ngev){r.init.call(this)}n.forEach(e=>{t.__ngev.states[e]=null;t.__ngev.stateGroups[e]=n})};r.prototype.hasState=function e(t){if(!this.__ngev){r.init.call(this)}return!!this.__ngev.states[t]};r.prototype.getAllStates=function e(){var t=this;if(!this.__ngev){r.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>t.__ngev.states[e])};r.groupAddListener=function e(t,n,r,i){if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;t.forEach(e=>{e.addListener(n,r.bind(undefined,e),i)})};r.groupOn=r.groupAddListener;r.groupOnce=function e(t,n,r,i){if(r&&typeof r==="object"){r.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.groupAddListener(t,n,r,i)};r.groupGlobalOnce=function e(t,n,i,s){var o,a=false;if(typeof i!=="function"){s=i;i=undefined}if(!s||typeof s!=="object"){s={}}i=i||s.fn;delete s.fn;s.id=s.id||i;o=function(){if(a){return}a=true;r.groupRemoveListener(t,n,s.id);i.apply(undefined,arguments)};t.forEach(e=>{e.once(n,o.bind(undefined,e),s)})};r.groupGlobalOnceAll=function e(t,n,r,i){var s,o=false,a=t.length;if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;s=function(){if(o){return}if(--a){return}o=true;r.apply(undefined,arguments)};t.forEach(e=>{e.once(n,s.bind(undefined,e),i)})};r.groupRemoveListener=function e(t,n,r){t.forEach(e=>{e.removeListener(n,r)})};r.groupOff=r.groupRemoveListener;r.groupRemoveAllListeners=function e(t,n){t.forEach(e=>{e.removeAllListeners(n)})};r.groupEmit=function e(t){
var n,i,s=2,o,a,u=t.length,l,f,c=false;if(typeof arguments[arguments.length-1]==="function"){o=-1;l=arguments[arguments.length-1];f=(e=>{if(c){return}if(e){c=true;l(e)}else if(!--u){c=true;l()}})}if(typeof arguments[1]==="number"){s=3;i=typeof arguments[1]}n=arguments[s-1];a=Array.prototype.slice.call(arguments,s,o);t.forEach(e=>{r.emitEvent({emitter:e,name:n,args:a,nice:i,callback:f})})};r.groupDefineStates=function e(t){var n=Array.prototype.slice.call(arguments,1);t.forEach(e=>{e.defineStates.apply(e,n)})};r.CONTEXT_ENABLED=0;r.CONTEXT_DISABLED=1;r.CONTEXT_QUEUED=2;r.prototype.addListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!n||typeof n!=="object"){n={}}if(!this.__ngev.contexts[t]){this.__ngev.contexts[t]=Object.create(r.prototype);this.__ngev.contexts[t].nice=r.SYNC;this.__ngev.contexts[t].ready=true;this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;this.__ngev.contexts[t].serial=false;this.__ngev.contexts[t].queue=[]}if(n.nice!==undefined){this.__ngev.contexts[t].nice=Math.floor(n.nice)}if(n.status!==undefined){this.__ngev.contexts[t].status=n.status}if(n.serial!==undefined){this.__ngev.contexts[t].serial=!!n.serial}return this};r.prototype.disableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_DISABLED;return this};r.prototype.enableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;if(this.__ngev.contexts[t].queue.length>0){r.processQueue.call(this,t)}return this};r.prototype.queueListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_QUEUED;return this};r.prototype.serializeListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=n===undefined?true:!!n;return this};r.prototype.setListenerContextNice=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(n);return this};r.prototype.destroyListenerContext=function e(t){var n,i,s,o,a=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}for(s in this.__ngev.listeners){o=null;i=this.__ngev.listeners[s].length;for(n=0;n<i;n++){if(this.__ngev.listeners[s][n].context===t){o=[];a.push(this.__ngev.listeners[s][n])}else if(o){o.push(this.__ngev.listeners[s][n])}}if(o){this.__ngev.listeners[s]=o}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.processQueue=function e(t,n){var i,s;if(!this.__ngev.contexts[t]){return}i=this.__ngev.contexts[t];if(n){i.ready=true}this.__ngev.recursion++;while(i.ready&&i.queue.length){s=i.queue.shift();if(s.event.interrupt){continue}try{if(s.nice<0){if(this.__ngev.recursion>=-s.nice){setImmediate(r.listenerWrapper.bind(this,s.listener,s.event,i))}else{r.listenerWrapper.call(this,s.listener,s.event,i)}}else{setTimeout(r.listenerWrapper.bind(this,s.listener,s.event,i),s.nice)}}catch(e){this.__ngev.recursion--;throw e}}this.__ngev.recursion--};r.on=r.prototype.on;r.once=r.prototype.once;r.off=r.prototype.off;if(n.AsyncTryCatch){r.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(r);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}r.Proxy=e("./Proxy.js")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":14,"./Proxy.js":13}],13:[function(e,t,n){"use strict";function r(){return r.create()}t.exports=r;var i=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}r.create=function e(){var t=Object.create(r.prototype,{localServices:{value:{},enumerable:true},remoteServices:{value:{},enumerable:true},nextAckId:{value:1,writable:true,enumerable:true}});return t};r.prototype.addLocalService=function e(t,n,r){this.localServices[t]=a.create(this,t,n,r);return this.localServices[t]};r.prototype.addRemoteService=function e(t){this.remoteServices[t]=u.create(this,t);return this.remoteServices[t]};r.prototype.destroy=function e(){var t=this;Object.keys(this.localServices).forEach(function(e){t.localServices[e].destroy();delete t.localServices[e]});Object.keys(this.remoteServices).forEach(function(e){t.remoteServices[e].destroy();delete t.remoteServices[e]});this.receive=this.send=o};r.prototype.push=function e(t){if(t.__type!==s||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};r.prototype.receive=function e(t){this.push(t)};r.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,n,r){return a.create(e,t,n,r)}r.LocalService=a;a.create=function e(t,n,r,s){var o=Object.create(a.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:r,writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!s.listen,writable:true,enumerable:true},canEmit:{value:!!s.emit,writable:true,enumerable:true},canAck:{value:!!s.ack,writable:true,enumerable:true},canRpc:{value:!!s.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return o};a.prototype.destroy=function e(){var t=this;Object.keys(this.events).forEach(function(e){t.emitter.off(e,t.events[e]);delete t.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var n=this;var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(r){n.proxy.send({__type:s,service:n.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:r})}}i.emitEvent(r)};a.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};a.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};a.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t)};a.forward=function e(t){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args})};a.forward.ack=false;a.forwardWithAck=function e(t,n){if(this.destroyed){return}var r=this;if(!t.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args});n();return}var i=false;var o=this.proxy.nextAckId++;var a=function e(t){if(i||t.ack!==o){return}i=true;r.internalEvents.off("ack",e);n()};this.internalEvents.on("ack",a);this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,ack:o,args:t.args})};a.forwardWithAck.ack=true;function u(e,t){return u.create(e,t)}r.RemoteService=u;var l=1;var f=2;u.create=function e(t,n){var r=Object.create(u.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:Object.create(i.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return r};u.prototype.destroy=function e(){var t=this;this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(function(e){delete t.events[e]});this.destroyed=true};u.prototype.emit=function e(t){if(this.destroyed){return}var n=this,r,i,o,a;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof arguments[arguments.length-1]!=="function"){r=Array.prototype.slice.call(arguments,1);this.proxy.send({__type:s,service:this.id,method:"emit",event:t,args:r});return}r=Array.prototype.slice.call(arguments,1,-1);i=arguments[arguments.length-1];o=this.proxy.nextAckId++;a=false;var u=function e(t){if(a||t.ack!==o){return}a=true;n.internalEvents.off("ack",e);i(t.interruption)};this.internalEvents.on("ack",u);this.proxy.send({__type:s,service:this.id,method:"emit",ack:o,event:t,args:r})};u.prototype.addListener=function e(t,n,r){if(this.destroyed){return}if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}r.fn=n||r.fn;this.emitter.addListener(t,r);if(!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length){return}if(r.async&&this.events[t]!==f){this.events[t]=f;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:t})}else if(!r.async&&!this.events[t]){this.events[t]=l;this.proxy.send({__type:s,service:this.id,method:"listen",event:t})}};u.prototype.on=u.prototype.addListener;u.prototype.once=i.prototype.once;u.prototype.removeListener=function e(t,n){if(this.destroyed){return}this.emitter.removeListener(t,n);if((!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:t})}};u.prototype.off=u.prototype.removeListener;u.prototype.receiveEvent=function e(t){var n=this;if(this.destroyed||!this.events[t.event]){return}var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(){n.proxy.send({__type:s,service:n.id,method:"ackEvent",ack:t.ack,event:t.event})}}i.emitEvent(r);var o=r.name;if(!this.emitter.__ngev.listeners[o]||!this.emitter.__ngev.listeners[o].length){this.events[o]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:o})}};u.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==f){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":12}],14:[function(e,t,n){t.exports={_from:"nextgen-events@^0.10.0",_id:"nextgen-events@0.10.0",_inBundle:false,_integrity:"sha1-9H1NIOwRS/mfSPjEmujUq2Ni7s0=",_location:"/nextgen-events",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"nextgen-events@^0.10.0",name:"nextgen-events",escapedName:"nextgen-events",rawSpec:"^0.10.0",saveSpec:null,fetchSpec:"^0.10.0"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-0.10.0.tgz",_shasum:"f47d4d20ec114bf99f48f8c49ae8d4ab6362eecd",_spec:"nextgen-events@^0.10.0",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cdric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},bundleDependencies:false,config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2016],owner:"Cdric Ronvel"},dependencies:{},deprecated:false,description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^14.3.0","expect.js":"^0.3.1",jshint:"^2.9.2",mocha:"^2.5.3","uglify-js-es6":"^2.8.9",ws:"^2.2.3"},directories:{test:"test"},engines:{node:">=4.5.0"},homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",name:"nextgen-events",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"mocha -R dot"},version:"0.10.0"}},{}],15:[function(e,t,n){var r=t.exports={};var i;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){i=setTimeout}else{i=o}}catch(e){i=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(e){s=a}})();function u(e){if(i===setTimeout){return setTimeout(e,0)}if((i===o||!i)&&setTimeout){i=setTimeout;return setTimeout(e,0)}try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function l(e){if(s===clearTimeout){return clearTimeout(e)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var f=[];var c=false;var h;var p=-1;function d(){if(!c||!h){return}c=false;if(h.length){f=h.concat(f)}else{p=-1}if(f.length){m()}}function m(){if(c){return}var e=u(d);c=true;var t=f.length;while(t){h=f;f=[];while(++p<t){if(h){h[p].run()}}p=-1;t=f.length}h=null;c=false;l(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}f.push(new g(e,t));if(f.length===1&&!c){u(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function y(){}r.on=y;r.addListener=y;r.once=y;r.off=y;r.removeListener=y;r.removeAllListeners=y;r.emit=y;r.prependListener=y;r.prependOnceListener=y;r.listeners=function(e){return[]};r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],16:[function(t,n,r){(function(t){(function(i){var s=typeof r=="object"&&r&&!r.nodeType&&r;var o=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){i=a}var u,l=2147483647,f=36,c=1,h=26,p=38,d=700,m=72,g=128,y="-",v=/^xn--/,b=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=f-c,x=Math.floor,E=String.fromCharCode,C;function S(e){throw new RangeError(_[e])}function A(e,t){var n=e.length;var r=[];while(n--){r[n]=t(e[n])}return r}function L(e,t){var n=e.split("@");var r="";if(n.length>1){r=n[0]+"@";e=n[1]}e=e.replace(w,".");var i=e.split(".");var s=A(i,t).join(".");return r+s}function j(e){var t=[],n=0,r=e.length,i,s;while(n<r){i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((i&1023)<<10)+(s&1023)+65536)}else{t.push(i);n--}}else{t.push(i)}}return t}function O(e){return A(e,function(e){var t="";if(e>65535){e-=65536;t+=E(e>>>10&1023|55296);e=56320|e&1023}t+=E(e);return t}).join("")}function T(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return f}function $(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function B(e,t,n){var r=0;e=n?x(e/d):e>>1;e+=x(e/t);for(;e>k*h>>1;r+=f){e=x(e/k)}return x(r+(k+1)*e/(e+p))}function I(e){var t=[],n=e.length,r,i=0,s=g,o=m,a,u,p,d,v,b,w,_,k;a=e.lastIndexOf(y);if(a<0){a=0}for(u=0;u<a;++u){if(e.charCodeAt(u)>=128){S("not-basic")}t.push(e.charCodeAt(u))}for(p=a>0?a+1:0;p<n;){for(d=i,v=1,b=f;;b+=f){if(p>=n){S("invalid-input")}w=T(e.charCodeAt(p++));if(w>=f||w>x((l-i)/v)){S("overflow")}i+=w*v;_=b<=o?c:b>=o+h?h:b-o;if(w<_){break}k=f-_;if(v>x(l/k)){S("overflow")}v*=k}r=t.length+1;o=B(i-d,r,d==0);if(x(i/r)>l-s){S("overflow")}s+=x(i/r);i%=r;t.splice(i++,0,s)}return O(t)}function M(e){var t,n,r,i,s,o,a,u,p,d,v,b=[],w,_,k,C;e=j(e);w=e.length;t=g;n=0;s=m;for(o=0;o<w;++o){v=e[o];if(v<128){b.push(E(v))}}r=i=b.length;if(i){b.push(y)}while(r<w){for(a=l,o=0;o<w;++o){v=e[o];if(v>=t&&v<a){a=v}}_=r+1;if(a-t>x((l-n)/_)){S("overflow")}n+=(a-t)*_;t=a;for(o=0;o<w;++o){v=e[o];if(v<t&&++n>l){S("overflow")}if(v==t){for(u=n,p=f;;p+=f){d=p<=s?c:p>=s+h?h:p-s;if(u<d){break}C=u-d;k=f-d;b.push(E($(d+C%k,0)));u=x(C/k)}b.push(E($(u,0)));s=B(n,_,r==i);n=0;++r}}++n;++t}return b.join("")}function N(e){return L(e,function(e){return v.test(e)?I(e.slice(4).toLowerCase()):e})}function R(e){return L(e,function(e){return b.test(e)?"xn--"+M(e):e})}u={version:"1.4.1",ucs2:{decode:j,encode:O},decode:I,encode:M,toASCII:R,toUnicode:N};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return u})}else if(s&&o){if(n.exports==s){o.exports=u}else{for(C in u){u.hasOwnProperty(C)&&(s[C]=u[C])}}}else{i.punycode=u}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],17:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var u=1e3;if(s&&typeof s.maxKeys==="number"){u=s.maxKeys}var l=e.length;if(u>0&&l>u){l=u}for(var f=0;f<l;++f){var c=e[f].replace(a,"%20"),h=c.indexOf(n),p,d,m,g;if(h>=0){p=c.substr(0,h);d=c.substr(h+1)}else{p=c;d=""}m=decodeURIComponent(p);g=decodeURIComponent(d);if(!r(o,m)){o[m]=g}else if(i(o[m])){o[m].push(g)}else{o[m]=[o[m],g]}}return o};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],18:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(r(o))+n;if(i(e[o])){return s(e[o],function(e){return a+encodeURIComponent(r(e))}).join(t)}else{return a+encodeURIComponent(r(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(r(a))+n+encodeURIComponent(r(e))};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var r=0;r<e.length;r++){n.push(t(e[r],r))}return n}var o=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],19:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":17,"./encode":18}],20:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"}},{}],21:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=function e(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")};n.regExpReplacement=function e(t){return t.replace(/\$/g,"$$$$")};n.format=function e(t){return t.replace(/%/g,"%%")};n.jsSingleQuote=function e(t){return n.control(t).replace(/'/g,"\\'")};n.jsDoubleQuote=function e(t){return n.control(t).replace(/"/g,'\\"')};n.shellArg=function e(t){return"'"+t.replace(/\'/g,"'\\''")+"'"};var r={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=function e(t){return t.replace(/[\x00-\x1f\x7f]/g,function(e){if(r[e]!==undefined){return r[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t})};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=function e(t){return t.replace(/[&<>]/g,function(e){return i[e]})};n.htmlAttr=function e(t){return t.replace(/[&<>"]/g,function(e){return i[e]})};n.htmlSpecialChars=function e(t){return t.replace(/[&<>"']/g,function(e){return i[e]})}},{}],22:[function(e,t,n){(function(t){"use strict";var r=e("./inspect.js").inspect;var i=e("./inspect.js").inspectError;var s=e("./ansi.js");n.formatMethod=function e(n){if(typeof n!=="string"){if(!n){n=""}else if(typeof n.toString==="function"){n=n.toString()}else{n=""}}var s=this,o,a,u=1,l=arguments,f=arguments.length,c=false,h=null,p=[];if(this.markupReset&&this.startingMarkupReset){n=(typeof this.markupReset==="function"?this.markupReset(p):this.markupReset)+n}n=n.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,function(e,n,d,m,g,y,v){var b,w,_,k,x,E,C,S,A=[];if(d){return"%"}if(n){if(n==="^"){return"^"}if(s.shiftMarkup&&s.shiftMarkup[n]){h=s.shiftMarkup[n];return""}if(h){if(!s.shiftedMarkup||!s.shiftedMarkup[h]||!s.shiftedMarkup[h][n]){return""}c=true;if(typeof s.shiftedMarkup[h][n]==="function"){b=s.shiftedMarkup[h][n](p)}else{b=s.shiftedMarkup[h][n];p.push(b)}h=null}else{if(!s.markup||!s.markup[n]){return""}c=true;if(typeof s.markup[n]==="function"){b=s.markup[n](p)}else{b=s.markup[n];p.push(b)}}return b}if(g){g=parseInt(g);if(m){if(m==="+"){g=u+g}else if(m==="-"){g=u-g}}}else{g=u}u++;if(g>=f||g<1){o=undefined}else{o=l[g]}switch(v){case"s":if(o===null||o===undefined){return""}if(typeof o==="string"){return o}if(typeof o==="number"){return""+o}if(typeof o.toString==="function"){return o.toString()}return"";case"f":if(typeof o==="string"){o=parseFloat(o)}if(typeof o!=="number"){return"0"}if(y!==undefined){switch(y[0]){case"p":_=parseInt(y.slice(1),10);if(_>=1){o=o.toPrecision(_)}break;case"f":_=parseInt(y.slice(1),10);o=o.toFixed(_);break}}return""+o;case"d":case"i":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.floor(o)}return"0";case"u":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0)}return"0";case"U":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),1)}return"1";case"x":if(typeof o==="string"){o=parseInt(o)}if(typeof o!=="number"){return"0"}a=""+Math.max(Math.floor(o),0).toString(16);if(a.length%2){a="0"+a}return a;case"h":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0).toString(16)}return"0";case"o":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0).toString(8)}return"0";case"b":if(typeof o==="string"){o=parseInt(o)}if(typeof o==="number"){return""+Math.max(Math.floor(o),0).toString(2)}return"0";case"z":if(typeof o==="string"){o=t.from(o)}else if(!t.isBuffer(o)){return""}return o.toString("base64");case"Z":if(typeof o==="string"){o=t.from(o)}else if(!t.isBuffer(o)){return""}return o.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"");case"I":k=3;if(y!==undefined){k=parseInt(y,10)}return r({depth:k,style:s&&s.color?"color":"none"},o);case"Y":k=3;if(y!==undefined){k=parseInt(y,10)}return r({depth:k,style:s&&s.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true},o);case"E":return i({style:s&&s.color?"color":"none"},o);case"J":return JSON.stringify(o);case"D":return"";case"F":u--;if(y===undefined){return""}x=y.split(":");E=x[0];C=x[1];if(!E){return""}if(C&&(S=C.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(w=0;w<S.length;w++){m=S[w][1];g=S[w][2];if(g){g=parseInt(g,10);if(m){if(m==="+"){g=u+g}else if(m==="-"){g=u-g}}}else{g=u}u++;if(g>=f||g<1){A[w]=undefined}else{A[w]=l[g]}}}if(!s||!s.fn||typeof s.fn[E]!=="function"){return""}return s.fn[E].apply(s,A);default:return""}});if(c&&this.markupReset&&this.endingMarkupReset){n+=typeof this.markupReset==="function"?this.markupReset(p):this.markupReset}if(this.extraArguments){for(;u<f;u++){o=l[u];if(o===null||o===undefined){continue}else if(typeof o==="string"){n+=o}else if(typeof o==="number"){n+=o}else if(typeof o.toString==="function"){n+=o.toString()}}}return n};var o={extraArguments:true,endingMarkupReset:true,startingMarkupReset:false,markupReset:s.reset,shiftMarkup:{"#":"background"},markup:{":":s.reset," ":s.reset+" ","-":s.dim,"+":s.bold,_:s.underline,"/":s.italic,"!":s.inverse,b:s.blue,B:s.brightBlue,c:s.cyan,C:s.brightCyan,g:s.green,G:s.brightGreen,k:s.black,K:s.brightBlack,m:s.magenta,M:s.brightMagenta,r:s.red,R:s.brightRed,w:s.white,W:s.brightWhite,y:s.yellow,Y:s.brightYellow},shiftedMarkup:{background:{":":s.reset," ":s.reset+" ",b:s.bgBlue,B:s.bgBrightBlue,c:s.bgCyan,C:s.bgBrightCyan,g:s.bgGreen,G:s.bgBrightGreen,k:s.bgBlack,K:s.bgBrightBlack,m:s.bgMagenta,M:s.bgBrightMagenta,r:s.bgRed,R:s.bgBrightRed,w:s.bgWhite,W:s.bgBrightWhite,y:s.bgYellow,Y:s.bgBrightYellow}}};n.format=n.formatMethod.bind(o);n.format.default=o;n.markupMethod=function e(t){if(typeof t!=="string"){if(!t){t=""}else if(typeof t.toString==="function"){t=t.toString()}else{t=""}}var n=this,r=false,i=null,s=[];if(this.markupReset&&this.startingMarkupReset){t=(typeof this.markupReset==="function"?this.markupReset(s):this.markupReset)+t}t=t.replace(/\^(.?)/g,function(e,t){var o;if(t==="^"){return"^"}if(n.shiftMarkup&&n.shiftMarkup[t]){i=n.shiftMarkup[t];return""}if(i){if(!n.shiftedMarkup||!n.shiftedMarkup[i]||!n.shiftedMarkup[i][t]){return""}r=true;if(typeof n.shiftedMarkup[i][t]==="function"){o=n.shiftedMarkup[i][t](s)}else{o=n.shiftedMarkup[i][t];s.push(o)}i=null}else{if(!n.markup||!n.markup[t]){return""}r=true;if(typeof n.markup[t]==="function"){o=n.markup[t](s)}else{o=n.markup[t];s.push(o)}}return o});if(r&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(s):this.markupReset}return t};n.markup=n.markupMethod.bind(o);n.format.count=function e(t){var n,r,i,s=1,o=0;if(typeof t!=="string"){return 0}var a=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=a.exec(t))!==null){i=n[1];r=n[2];if(r){r=parseInt(r,10);if(i){if(i==="+"){r=s+r}else if(i==="-"){r=s-r}}}else{r=s}s++;if(o<r){o=r}}return o};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}else{return false}}}).call(this,e("buffer").Buffer)},{"./ansi.js":20,"./inspect.js":23,buffer:7}],23:[function(e,t,n){(function(t,r){"use strict";var i=e("tree-kit/lib/extend.js");var s=e("./escape.js");var o=e("./ansi.js");function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(e.depth===undefined){e.depth=3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}return u(n,e,t)}function u(e,n,r){var i,o,a,c,h,p,d,m,g,y,v,b,w="",_="",k="",x,E;d=typeof r;g=n.style.tab.repeat(e.depth);if(d==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){k=[];if(!e.descriptor.configurable){k.push("-conf")}if(!e.descriptor.enumerable){k.push("-enum")}if(!e.descriptor.writable){k.push("-w")}if(k.length){k=k.join(" ")}else{k=""}}if(e.keyIsProperty){if(l(e.key)){_='"'+n.style.key(e.key)+'": '}else{_=n.style.key(e.key)+": "}}else{_="["+n.style.index(e.key)+"] "}if(k){k=" "+n.style.type(k)}}m=e.noPre?"":g+_;if(r===undefined){w+=m+n.style.constant("undefined")+k+n.style.nl}else if(r===null){w+=m+n.style.constant("null")+k+n.style.nl}else if(r===false){w+=m+n.style.constant("false")+k+n.style.nl}else if(r===true){w+=m+n.style.constant("true")+k+n.style.nl}else if(d==="number"){w+=m+n.style.number(r.toString())+(n.noType?"":" "+n.style.type("number"))+k+n.style.nl}else if(d==="string"){w+=m+'"'+n.style.string(s.control(r))+'" '+(n.noType?"":n.style.type("string")+n.style.length("("+r.length+")"))+k+n.style.nl}else if(t.isBuffer(r)){w+=m+n.style.inspect(r.inspect())+" "+(n.noType?"":n.style.type("Buffer")+n.style.length("("+r.length+")"))+k+n.style.nl}else if(d==="object"||d==="function"){o=a="";v=false;if(d==="function"){v=true;o=" "+n.style.funcName(r.name?r.name:"(anonymous)");a=n.style.length("("+r.length+")")}y=false;if(Array.isArray(r)){y=true;a=n.style.length("("+r.length+")")}if(!r.constructor){h="(no constructor)"}else if(!r.constructor.name){h="(anonymous)"}else{h=r.constructor.name}h=n.style.constructorName(h);w+=m;if(!n.noType){if(e.forceType){w+=n.style.type(e.forceType)}else{w+=h+o+a+" "+n.style.type(d)+k}if(!v||n.funcDetails){w+=" "}}c=Object.getOwnPropertyNames(r);if(n.sort){c.sort()}b=f(r);if(b!==undefined){w+="=> "+u({depth:e.depth,ancestors:e.ancestors,noPre:true},n,b)}else if(v&&!n.funcDetails){w+=n.style.nl}else if(!c.length&&!n.proto){w+="{}"+n.style.nl}else if(e.depth>=n.depth){w+=n.style.limit("[depth limit]")+n.style.nl}else if(e.ancestors.indexOf(r)!==-1){w+=n.style.limit("[circular]")+n.style.nl}else{w+=(y&&n.noType?"[":"{")+n.style.nl;E=e.ancestors.slice();E.push(r);for(i=0;i<c.length;i++){try{x=Object.getOwnPropertyDescriptor(r,c[i]);if(!x.enumerable&&n.enumOnly){continue}p=!y||!x.enumerable||isNaN(c[i]);if(!n.noDescriptor&&(x.get||x.set)){w+=u({depth:e.depth+1,ancestors:E,key:c[i],keyIsProperty:p,descriptor:x,forceType:"getter/setter"},n,{get:x.get,set:x.set})}else{w+=u({depth:e.depth+1,ancestors:E,key:c[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:x},n,r[c[i]])}}catch(t){w+=u({depth:e.depth+1,ancestors:E,key:c[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:x},n,t)}}if(n.proto){w+=u({depth:e.depth+1,ancestors:E,key:"__proto__",keyIsProperty:true},n,r.__proto__)}w+=g+(y&&n.noType?"]":"}")+n.style.nl}}if(e.depth===0){if(n.style==="html"){w=s.html(w)}}return w}n.inspect=a;function l(e){if(!e.length){return true}return false}function f(e){switch(e.constructor.name){case"Date":if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}break;case"Set":if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}break;case"Map":if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}break;case"ObjectID":if(e._bsontype){return e.toString()}break}return}function c(e,t){var n="",r,i,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"Not an error -- regular variable inspection: "+a(e,t)}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(t.stack){r=h(e,t.stack)}i=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(i)+(s?" ["+e.style.errorType(s)+"]":"")+": "
;n+=e.style.errorMessage(t.message)+"\n";if(r){n+=e.style.errorStack(r)+"\n"}return n}n.inspectError=c;function h(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(!t){return}if((e.browser||r.browser)&&t.indexOf("@")!==-1){t=t.replace(/[<\/]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,function(t,n,r,i,s){return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(r?e.style.errorStackFile(r):e.style.errorStack("unknown"))+(i?e.style.errorStack(":")+e.style.errorStackLine(i):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:([^\s:\(\)\[\]\n]+(?:\([^\)]+\))?)\s)?(?:\[as ([^\s:\(\)\[\]\n]+)\]\s)?(?:\(?([^:\(\)\[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,function(t,n,r,i,s,o,a){return e.style.errorStack("    at ")+(r?e.style.errorStackMethod(r)+" ":"")+(i?e.style.errorStack("[as ")+e.style.errorStackMethodAs(i)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(o?e.style.errorStack(":")+e.style.errorStackLine(o):"")+(a?e.style.errorStack(":")+e.style.errorStackColumn(a):"")+e.style.errorStack(")")})}return t}n.inspectStack=h;var p={};var d=function(e){return e};p.none={tab:"    ",nl:"\n",limit:d,type:function(e){return"<"+e+">"},constant:d,funcName:d,constructorName:function(e){return"<"+e+">"},length:d,key:d,index:d,number:d,inspect:d,string:d,errorType:d,errorMessage:d,errorStack:d,errorStackMethod:d,errorStackMethodAs:d,errorStackFile:d,errorStackLine:d,errorStackColumn:d};p.color=i(null,{},p.none,{limit:function(e){return o.bold+o.brightRed+e+o.reset},type:function(e){return o.italic+o.brightBlack+e+o.reset},constant:function(e){return o.cyan+e+o.reset},funcName:function(e){return o.italic+o.magenta+e+o.reset},constructorName:function(e){return o.magenta+e+o.reset},length:function(e){return o.italic+o.brightBlack+e+o.reset},key:function(e){return o.green+e+o.reset},index:function(e){return o.blue+e+o.reset},number:function(e){return o.cyan+e+o.reset},inspect:function(e){return o.cyan+e+o.reset},string:function(e){return o.blue+e+o.reset},errorType:function(e){return o.red+o.bold+e+o.reset},errorMessage:function(e){return o.red+o.italic+e+o.reset},errorStack:function(e){return o.brightBlack+e+o.reset},errorStackMethod:function(e){return o.brightYellow+e+o.reset},errorStackMethodAs:function(e){return o.yellow+e+o.reset},errorStackFile:function(e){return o.brightCyan+e+o.reset},errorStackLine:function(e){return o.blue+e+o.reset},errorStackColumn:function(e){return o.magenta+e+o.reset}});p.html=i(null,{},p.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",nl:"<br />",limit:function(e){return'<span style="color:red">'+e+"</span>"},type:function(e){return'<i style="color:gray">'+e+"</i>"},constant:function(e){return'<span style="color:cyan">'+e+"</span>"},funcName:function(e){return'<i style="color:magenta">'+e+"</i>"},constructorName:function(e){return'<span style="color:magenta">'+e+"</span>"},length:function(e){return'<i style="color:gray">'+e+"</i>"},key:function(e){return'<span style="color:green">'+e+"</span>"},index:function(e){return'<span style="color:blue">'+e+"</span>"},number:function(e){return'<span style="color:cyan">'+e+"</span>"},inspect:function(e){return'<span style="color:cyan">'+e+"</span>"},string:function(e){return'<span style="color:blue">'+e+"</span>"},errorType:function(e){return'<span style="color:red">'+e+"</span>"},errorMessage:function(e){return'<span style="color:red">'+e+"</span>"},errorStack:function(e){return'<span style="color:gray">'+e+"</span>"},errorStackMethod:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackMethodAs:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackFile:function(e){return'<span style="color:cyan">'+e+"</span>"},errorStackLine:function(e){return'<span style="color:blue">'+e+"</span>"},errorStackColumn:function(e){return'<span style="color:gray">'+e+"</span>"}})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":11,"./ansi.js":20,"./escape.js":21,_process:15,"tree-kit/lib/extend.js":24}],24:[function(e,t,n){"use strict";function r(e,t){var n,r,s=false,o=arguments.length;if(o<3){return t}var a=Array.prototype.slice.call(arguments,2);o=a.length;if(!e||typeof e!=="object"){e={}}var u={depth:0,prefix:""};if(!e.maxDepth&&e.deep&&!e.circular){e.maxDepth=100}if(e.deepFunc){e.deep=true}if(e.deepFilter&&typeof e.deepFilter==="object"){if(e.deepFilter.whitelist&&(!Array.isArray(e.deepFilter.whitelist)||!e.deepFilter.whitelist.length)){delete e.deepFilter.whitelist}if(e.deepFilter.blacklist&&(!Array.isArray(e.deepFilter.blacklist)||!e.deepFilter.blacklist.length)){delete e.deepFilter.blacklist}if(!e.deepFilter.whitelist&&!e.deepFilter.blacklist){delete e.deepFilter}}if(e.flat){e.deep=true;e.proto=false;e.inherit=false;e.unflat=false;if(typeof e.flat!=="string"){e.flat="."}}if(e.unflat){e.deep=false;e.proto=false;e.inherit=false;e.flat=false;if(typeof e.unflat!=="string"){e.unflat="."}}if(e.inherit){e.own=true;e.proto=false}else if(e.proto){e.own=true}if(!t||typeof t!=="object"&&typeof t!=="function"){s=true}if(!e.skipRoot&&(e.inherit||e.proto)){for(n=o-1;n>=0;n--){r=a[n];if(r&&(typeof r==="object"||typeof r==="function")){if(e.inherit){if(s){t=Object.create(r)}else{Object.setPrototypeOf(t,r)}}else if(e.proto){if(s){t=Object.create(Object.getPrototypeOf(r))}else{Object.setPrototypeOf(t,Object.getPrototypeOf(r))}}break}}}else if(s){t={}}u.references={sources:[],targets:[]};for(n=0;n<o;n++){r=a[n];if(!r||typeof r!=="object"&&typeof r!=="function"){continue}i(u,e,t,r)}return t}t.exports=r;function i(e,t,n,r){var s,o,a,u,l,f,c,h,p,d,m,g=-1;if(t.maxDepth&&e.depth>t.maxDepth){throw new Error("[tree] extend(): max depth reached("+t.maxDepth+")")}if(t.circular){e.references.sources.push(r);e.references.targets.push(n)}if(t.own){if(t.nonEnum){a=Object.getOwnPropertyNames(r)}else{a=Object.keys(r)}}else{a=r}for(u in a){if(t.own){u=a[u]}if(t.descriptor){h=Object.getOwnPropertyDescriptor(r,u);l=h.value}else{l=r[u]}d=n;p=e.prefix+u;if(t.nofunc&&typeof l==="function"){continue}if(t.unflat&&e.depth===0){m=u.split(t.unflat);o=m.length-1;if(o){for(s=0;s<o;s++){if(!d[m[s]]||typeof d[m[s]]!=="object"&&typeof d[m[s]]!=="function"){d[m[s]]={}}d=d[m[s]]}p=e.prefix+m[o]}}if(t.deep&&l&&(typeof l==="object"||t.deepFunc&&typeof l==="function")&&(!t.descriptor||!h.get)&&((f=Object.getPrototypeOf(l))||true)&&(!t.deepFilter||(!t.deepFilter.whitelist||t.deepFilter.whitelist.indexOf(f)!==-1)&&(!t.deepFilter.blacklist||t.deepFilter.blacklist.indexOf(f)===-1))){if(t.circular){g=e.references.sources.indexOf(l)}if(t.flat){if(g>=0){continue}i({depth:e.depth+1,prefix:e.prefix+u+t.flat,references:e.references},t,d,l)}else{if(g>=0){if(t.descriptor){Object.defineProperty(d,p,{value:e.references.targets[g],enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=e.references.targets[g]}continue}if(!d[p]||!d.hasOwnProperty(p)||typeof d[p]!=="object"&&typeof d[p]!=="function"){if(Array.isArray(l)){c=[]}else if(t.proto){c=Object.create(f)}else if(t.inherit){c=Object.create(l)}else{c={}}if(t.descriptor){Object.defineProperty(d,p,{value:c,enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=c}}else if(t.proto&&Object.getPrototypeOf(d[p])!==f){Object.setPrototypeOf(d[p],f)}else if(t.inherit&&Object.getPrototypeOf(d[p])!==l){Object.setPrototypeOf(d[p],l)}if(t.circular){e.references.sources.push(l);e.references.targets.push(d[p])}i({depth:e.depth+1,prefix:"",references:e.references},t,d[p],l)}}else if(t.preserve&&d[p]!==undefined){continue}else if(!t.inherit){if(t.descriptor){Object.defineProperty(d,p,h)}else{d[p]=l}}if(t.move){delete r[u]}}}},{}],25:[function(e,t,n){"use strict";var r=e("punycode");var i=e("./util");n.parse=_;n.resolve=x;n.resolveObject=E;n.format=k;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["<",">",'"',"`"," ","\r","\n","\t"],f=["{","}","|","\\","^","`"].concat(l),c=["'"].concat(f),h=["%","/","?",";","#"].concat(c),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:true,"javascript:":true},v={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},w=e("querystring");function _(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;r.parse(e,t,n);return r}s.prototype.parse=function(e,t,n){if(!i.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",l=e.split(a),f=/\\/g;l[0]=l[0].replace(f,"/");e=l.join(a);var _=e;_=_.trim();if(!n&&e.split("#").length===1){var k=u.exec(_);if(k){this.path=_;this.href=_;this.pathname=k[1];if(k[2]){this.search=k[2];if(t){this.query=w.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var x=o.exec(_);if(x){x=x[0];var E=x.toLowerCase();this.protocol=E;_=_.substr(x.length)}if(n||x||_.match(/^\/\/[^@\/]+@[^@\/]+/)){var C=_.substr(0,2)==="//";if(C&&!(x&&v[x])){_=_.substr(2);this.slashes=true}}if(!v[x]&&(C||x&&!b[x])){var S=-1;for(var A=0;A<p.length;A++){var L=_.indexOf(p[A]);if(L!==-1&&(S===-1||L<S))S=L}var j,O;if(S===-1){O=_.lastIndexOf("@")}else{O=_.lastIndexOf("@",S)}if(O!==-1){j=_.slice(0,O);_=_.slice(O+1);this.auth=decodeURIComponent(j)}S=-1;for(var A=0;A<h.length;A++){var L=_.indexOf(h[A]);if(L!==-1&&(S===-1||L<S))S=L}if(S===-1)S=_.length;this.host=_.slice(0,S);_=_.slice(S);this.parseHost();this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T){var $=this.hostname.split(/\./);for(var A=0,B=$.length;A<B;A++){var I=$[A];if(!I)continue;if(!I.match(m)){var M="";for(var N=0,R=I.length;N<R;N++){if(I.charCodeAt(N)>127){M+="x"}else{M+=I[N]}}if(!M.match(m)){var U=$.slice(0,A);var D=$.slice(A+1);var q=I.match(g);if(q){U.push(q[1]);D.unshift(q[2])}if(D.length){_="/"+D.join(".")+_}this.hostname=U.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!T){this.hostname=r.toASCII(this.hostname)}var F=this.port?":"+this.port:"";var P=this.hostname||"";this.host=P+F;this.href+=this.host;if(T){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(_[0]!=="/"){_="/"+_}}}if(!y[E]){for(var A=0,B=c.length;A<B;A++){var W=c[A];if(_.indexOf(W)===-1)continue;var G=encodeURIComponent(W);if(G===W){G=escape(W)}_=_.split(W).join(G)}}var Y=_.indexOf("#");if(Y!==-1){this.hash=_.substr(Y);_=_.slice(0,Y)}var H=_.indexOf("?");if(H!==-1){this.search=_.substr(H);this.query=_.substr(H+1);if(t){this.query=w.parse(this.query)}_=_.slice(0,H)}else if(t){this.search="";this.query={}}if(_)this.pathname=_;if(b[E]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var F=this.pathname||"";var z=this.search||"";this.path=F+z}this.href=this.format();return this};function k(e){if(i.isString(e))e=_(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=false,o="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&i.isObject(this.query)&&Object.keys(this.query).length){o=w.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(r&&r.charAt(0)!=="#")r="#"+r;if(a&&a.charAt(0)!=="?")a="?"+a;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+n+a+r};function x(e,t){return _(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(_(e,false,true)).format()};function E(e,t){if(!e)return t;return _(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var r=Object.keys(this);for(var o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var u=Object.keys(e);for(var l=0;l<u.length;l++){var f=u[l];if(f!=="protocol")n[f]=e[f]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var c=Object.keys(e);for(var h=0;h<c.length;h++){var p=c[h];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!v[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");n.pathname=d.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var g=n.search||"";n.path=m+g}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var y=n.pathname&&n.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",_=w||y||n.host&&e.pathname,k=_,x=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],E=n.protocol&&!b[n.protocol];if(E){n.hostname="";n.port=null;if(n.host){if(x[0]==="")x[0]=n.host;else x.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}_=_&&(d[0]===""||x[0]==="")}if(w){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;x=d}else if(d.length){if(!x)x=[];x.pop();x=x.concat(d);n.search=e.search;n.query=e.query}else if(!i.isNullOrUndefined(e.search)){if(E){n.hostname=n.host=x.shift();var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}n.search=e.search;n.query=e.query;if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!x.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var S=x.slice(-1)[0];var A=(n.host||e.host||x.length>1)&&(S==="."||S==="..")||S==="";var L=0;for(var j=x.length;j>=0;j--){S=x[j];if(S==="."){x.splice(j,1)}else if(S===".."){x.splice(j,1);L++}else if(L){x.splice(j,1);L--}}if(!_&&!k){for(;L--;L){x.unshift("..")}}if(_&&x[0]!==""&&(!x[0]||x[0].charAt(0)!=="/")){x.unshift("")}if(A&&x.join("/").substr(-1)!=="/"){x.push("")}var O=x[0]===""||x[0]&&x[0].charAt(0)==="/";if(E){n.hostname=n.host=O?"":x.length?x.shift():"";var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}_=_||n.host&&x.length;if(_&&!O){x.unshift("")}if(!x.length){n.pathname=null;n.path=null}else{n.pathname=x.join("/")}if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":26,punycode:16,querystring:19}],26:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}]},{},[2])(2)});