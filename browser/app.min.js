(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function(){function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}return e}()({1:[function(e,t,n){"use strict";const i=e("nextgen-events/lib/browser.js");const r=e("seventh");const s=e("dom-kit");const o=e("svg-kit");const a=e("../../commonUtils.js");function l(){}function c(){this.$body=document.querySelector("body");this.$spellcast=document.querySelector("spellcast");this.$theme=document.querySelector("#theme");this.$gfx=document.querySelector("#gfx");this.$sceneImage=document.querySelector(".scene-image");this.$main=document.querySelector("main");this.$mainBuffer=document.querySelector("#main-buffer");this.$altBuffer=document.querySelector("#alt-buffer");this.$closeAltButton=document.querySelector("#button-close-alt");this.$dialogWrapper=document.querySelector("#dialog-wrapper");this.$hint=document.querySelector("#hint");this.$lobby=document.querySelector("#lobby");this.$clientStatus=this.$lobby.querySelector(".client-status");this.$status=document.querySelector("#status");this.$panel=document.querySelector("#panel");this.$music=document.querySelector("#music");this.$sound0=document.querySelector("#sound0");this.$sound1=document.querySelector("#sound1");this.$sound2=document.querySelector("#sound2");this.$sound3=document.querySelector("#sound3");this.choices=[];this.newSegmentNeeded=null;this.onSelect=null;this.onLeave=null;this.onEnter=null;this.toMainBuffer();this.nextSoundChannel=0;this.sprites={};this.vgs={};this.markers={};this.cards={};this.gItemLocations={};this.animations={};this.hintTimer=null;this.sceneImageOnTimer=null;this.onCommandSubmit=null;this.uiLoadingCount=0;this.initEvents()}t.exports=c;c.prototype=Object.create(i.prototype);c.prototype.constructor=c;c.prototype.cleanUrl=function(e){if(e[0]==="/"){return window.location.pathname+e.slice(1)}return window.location.pathname+"script/"+e};c.prototype.setTheme=function(e){this.$theme.setAttribute("href",this.cleanUrl(e.url))};c.prototype.preload=function(){s.preload(["icons/plugged.svg","icons/plugging.svg","icons/unplugged.svg","icons/unreachable-plug.svg"])};c.prototype.initEvents=function(){this.$main.addEventListener("click",()=>this.emit("continue"),false);this.$gfx.addEventListener("click",e=>{if(e.target.classList.contains("scene-image")){this.toggleSceneImage()}},false);this.$dialogWrapper.addEventListener("click",()=>this.clearDialog(),false);this.$lobby.addEventListener("click",()=>{this.$lobby.classList.toggle("toggled")});this.$status.addEventListener("click",()=>{this.$status.classList.toggle("toggled")});this.$panel.addEventListener("click",()=>{this.$panel.classList.toggle("toggled")})};c.prototype.toggleSceneImage=function(){if(this.$gfx.classList.contains("toggled")){this.sceneImageOff()}else{this.sceneImageOn()}};c.prototype.sceneImageOn=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.add("toggled");this.$spellcast.classList.add("gfx-toggled");this.sceneImageOnTimer=setTimeout(this.sceneImageOff.bind(this),8e3)};c.prototype.sceneImageOff=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.remove("toggled");this.$spellcast.classList.remove("gfx-toggled")};c.prototype.toMainBuffer=function(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHint();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$importantMessages=null;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.$closeAltButton.classList.add("inactive");this.getSwitchedElements();return true};c.prototype.toAltBuffer=function(){if(this.$activeBuffer===this.$altBuffer){return}this.$activeBuffer=this.$altBuffer;this.$importantMessages=this.$activeSegment;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.$closeAltButton.classList.remove("inactive");this.getSwitchedElements();return true};c.prototype.getSwitchedElements=function(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};c.prototype.clientStatus=function(e){this.$clientStatus.setAttribute("data-status",e);this.$clientStatus.setAttribute("title",e)};c.prototype.setMultiplayer=function(e,t){t=t||l;if(e||e===undefined){this.$spellcast.classList.add("multiplayer")}else{this.$spellcast.classList.remove("multiplayer")}t()};c.prototype.clear=function(e){e=e||l;s.empty(this.$hint);s.empty(this.$dialogWrapper);s.empty(this.$activeMessages);s.empty(this.$choices);e()};c.prototype.clearMessages=function(e){e=e||l;s.empty(this.$activeMessages);e()};c.prototype.clearHistory=function(e){e=e||l;s.empty(this.$history);e()};c.prototype.newSegment=function(e){var t,n=e==="inter-segment";this.newSegmentNeeded=null;if(n){if(this.$activeSegment&&this.$activeSegment.tagName.toLowerCase()==="inter-segment"){return}t=document.createElement("inter-segment")}else{t=document.createElement("segment")}if(this.$activeSegment&&!this.$activeSegment.children.length){this.$activeSegment.remove()}this.$activeSegment=t;this.$activeMessages.appendChild(t);if(!n){this.moveToHistory()}};c.prototype.moveToHistory=function(){var e,t;var n=Array.from(this.$activeMessages.children);t=n.length-2;while(t>=0&&n[t].tagName.toLowerCase()==="inter-segment"){t--}if(t<0){return}for(e=0;e<=t;e++){this.$history.appendChild(n[e])}n[t].scrollIntoView(false)};c.prototype.newSegmentOnContent=function(e){e=e||"segment";this.newSegmentNeeded=e};c.prototype.addSelectedChoice=function(e){var t=document.createElement("p");t.classList.add("chosen");t.textContent=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};c.prototype.addMessage=function(e,t,n){var i=false;n=n||l;var r=()=>{if(i){return}i=true;if(t.next){o.scrollIntoView(false);this.messageNext(t.next,n);return}n()};var o=document.createElement("p");o.classList.add("text");if(t.next){o.classList.add("continue")}if(t.class){s.class(o,a.toClassObject(t.class),"s-")}if(t.style){s.css(o,t.style)}o.innerHTML=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(o);if(t.important&&this.$importantMessages){this.$importantMessages.appendChild(o.cloneNode(true))}r()};c.prototype.messageNext=function(e,t){var n=false;var i=()=>{if(n){return}n=true;this.$spellcast.classList.remove("continue");t()};this.$spellcast.classList.add("continue");this.once("continue",i);if(typeof e==="number"&&isFinite(e)&&e>0){setTimeout(i,e*1e3)}};c.prototype.addIndicators=function(e,t,n){n=n||l;if(t){s.empty(this.$status);if(e.length){this.$status.classList.remove("empty")}else{this.$status.classList.add("empty");n();return}}var i=document.createElement("indicator-list");e.forEach(e=>{var t,n,r,s,o,a;t=document.createElement("indicator");n=document.createElement("label");n.classList.add("label");if(e.image){t.classList.add("has-image");r=document.createElement("img");r.classList.add("image");r.setAttribute("src",this.cleanUrl(e.image));if(e.label){r.setAttribute("alt",e.label);r.setAttribute("title",e.label)}n.appendChild(r)}else{n.textContent=e.label}t.appendChild(n);s=document.createElement("widget");s.classList.add("widget");s.classList.add(e.type);s.setAttribute("data-value",e.value);switch(e.type){case"hbar":a=document.createElement("outer-bar");s.appendChild(a);o=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){o.style.backgroundColor=e.color}o.style.width=""+e.value+"%";a.appendChild(o);break;case"vbar":a=document.createElement("outer-bar");s.appendChild(a);o=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){o.style.backgroundColor=e.color}o.style.height=""+e.value+"%";a.appendChild(o);break;case"text":default:s.textContent=e.value}t.appendChild(s);i.appendChild(t)});if(t){this.$status.appendChild(i)}else{if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(i)}n()};c.prototype.createChoiceEventHandlers=function(e){this.onSelect=(t=>{var n=t.currentTarget;var i=n.getAttribute("data-select-index");if(!i){return}i=parseInt(i,10);e(i)});this.onLeave=(e=>{this.clearHint()});this.onEnter=(e=>{var t=e.currentTarget;var n=t.getAttribute("data-button-hint");if(!n){return}this.setHint(n,{active:true})})};c.prototype.addPanel=function(e,t,n){n=n||l;if(t){s.empty(this.$panel);if(e.length){this.$panel.classList.remove("empty")}else{this.$panel.classList.add("empty");n();return}}else if(e.length){this.$panel.classList.remove("empty")}e.forEach(e=>{var t,n,i="button-"+e.id;if(document.getElementById(i)){return}t=document.createElement("item");t.classList.add("button");t.classList.add("disabled");t.setAttribute("id",i);if(e.image){t.classList.add("has-image");if(e.image.endsWith(".svg")){n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("svg");o.load(this.cleanUrl(e.image),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,colorClass:true,as:n})}else{n=document.createElement("img");n.setAttribute("src",this.cleanUrl(e.image))}n.classList.add("icon");n.classList.add("image");if(e.label){n.setAttribute("alt",e.label);n.setAttribute("title",e.label)}t.appendChild(n)}else{t.textContent=e.label}this.$panel.appendChild(t)});n()};c.prototype.clearChoices=function(e){var t;e=e||l;this.choices.forEach(e=>{if(!e.button){return}var n="button-"+e.button;t=document.getElementById(n);if(t){t.removeAttribute("data-select-index");t.classList.add("disabled");t.removeEventListener("click",this.onSelect);t.removeEventListener("mouseleave",this.onLeave);t.removeEventListener("mouseenter",this.onEnter)}});s.empty(this.$choices);this.choices.length=0;this.onSelect=null;this.onLeave=null;this.onEnter=null;e()};c.prototype.addChoices=function(e,t,n){if(this.uiLoadingCount){this.once("uiLoaded",this.addChoices.bind(this,e,t,n));return}var i=false;var r=document.createDocumentFragment();var o=document.createElement("group");n=n||l;this.createChoiceEventHandlers(t);e.forEach(e=>{var t;this.choices.push(e);if(e.button&&(t=document.getElementById("button-"+e.button))&&!t.getAttribute("data-select-index")&&!t.classList.contains("inactive")){if(e.groupBreak){i=true}t.setAttribute("data-select-index",e.index);t.classList.remove("disabled");t.addEventListener("click",this.onSelect);if(e.label){t.setAttribute("data-button-hint",e.label);t.addEventListener("mouseleave",this.onLeave);t.addEventListener("mouseenter",this.onEnter)}return}var n=document.createElement("choice");n.classList.add("choice",e.type);n.setAttribute("data-select-index",e.index);n.classList.remove("disabled");if(e.class){s.class(n,a.toClassObject(e.class),"s-")}if(e.style){s.css(n,e.style)}if(e.image){n.classList.add("has-image");var l=document.createElement("img");l.classList.add("image");l.setAttribute("src",this.cleanUrl(e.image));n.appendChild(l)}var c=document.createElement("span");c.classList.add("label");c.textContent=e.label;n.appendChild(c);if(e.selectedBy&&e.selectedBy.length){var u=document.createElement("span");u.classList.add("italic","brightBlack");u.textContent=" "+e.selectedBy.join(", ");n.appendChild(u)}n.addEventListener("click",this.onSelect);if(e.groupBreak||i){i=false;r.appendChild(o);o=document.createElement("group")}o.appendChild(n)});r.appendChild(o);this.$choices.appendChild(r);n()};c.prototype.getChoiceColumnsCount=function(e){var t=0,n=0;e.forEach(e=>{if(e.groupBreak){if(t>n){n=t}t=0}t++});if(t>n){n=t}return n};c.prototype.setChoices=function(e,t,n,i,r){i=i||{};r=r||l;this.clearChoices(()=>{switch(i.nextStyle){case"inline":case"smallInline":case"list":case"smallList":this.$choices.setAttribute("data-choice-style",i.nextStyle);break;case"table":this.$choices.setAttribute("data-choice-style",i.nextStyle);this.$choices.classList.add("columns-"+this.getChoiceColumnsCount(e));break;default:this.$choices.setAttribute("data-choice-style","list")}this.addChoices(e,n,r);if(t&&t.length){var s=document.createElement("p");s.classList.add("unassigned-users");s.textContent=t.join(", ");this.$choices.appendChild(s)}if(typeof i.timeout==="number"){this.choiceTimeout(i.timeout)}})};c.prototype.updateChoices=c.prototype.setChoices;c.prototype.choiceTimeout=function(e){var t=Date.now(),n,i;n=document.createElement("p");n.classList.add("timer");n.textContent=Math.round(e/1e3);this.$choices.appendChild(n);i=setInterval(()=>{if(!n.parentNode){clearInterval(i);return}n.textContent=Math.round((e+t-Date.now())/1e3)},1e3)};c.prototype.textInputDisabled=function(e){var t=document.createElement("form"),n=document.createElement("label"),i=document.createElement("input");n.textContent=e.label;i.setAttribute("placeholder",e.placeholder);i.setAttribute("disabled",true);i.setAttribute("type","text");i.classList.add("text-input");t.appendChild(n);t.appendChild(i);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};c.prototype.textInput=function(e,t){var n=document.createElement("form"),i=document.createElement("label"),r=document.createElement("input");i.classList.add("text");i.textContent=e.label;r.setAttribute("type","text");r.classList.add("text-input");n.appendChild(i);n.appendChild(r);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(n);r.focus();var s=function(e){e.preventDefault();n.removeEventListener("submit",s);r.setAttribute("disabled",true);t(r.value)};n.addEventListener("submit",s)};c.prototype.enableCommand=function(e){if(!this.onCommandSubmit){this.onCommandSubmit=(t=>{t.preventDefault();e(this.$chatInput.value);this.$chatInput.value=""});this.$chatForm.addEventListener("submit",this.onCommandSubmit);this.$mainBuffer.classList.remove("chat-hidden");this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};c.prototype.disableCommand=function(){this.$chatForm.removeEventListener("submit",this.onCommandSubmit);this.onCommandSubmit=null;this.$mainBuffer.classList.add("chat-hidden");this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};c.prototype.clearHint=function(){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint)},3e3)};c.prototype.setHint=function(e,t){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}if(this.$hint.textContent){this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint);this.setHint(e,t)},300);return}this.$hint.textContent=e;this.$hint.classList.remove("empty");s.class(this.$hint,{passive:!!t.passive,active:!!t.active});this.hintTimer=setTimeout(this.clearHint.bind(this),3e3)};c.prototype.setBigHint=function(e,t){var n=document.createElement("h2");n.textContent=e;if(t){s.class(n,t)}s.empty(this.$hint);this.$hint.appendChild(n)};c.prototype.clearDialog=function(){this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var e=false;var t=()=>{this.$dialogWrapper.removeEventListener("transitionstart",t);if(e){return}e=true;this.$dialogWrapper.addEventListener("transitionend",n)};var n=()=>{this.$dialogWrapper.removeEventListener("transitionend",n);s.empty(this.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",t);setTimeout(()=>{if(e){return}e=true;s.empty(this.$dialogWrapper)},10)};c.prototype.setDialog=function(e,t,n){t=t||{};n=n||l;if(t.contentDelay&&!this.newSegmentNeeded){delete t.contentDelay;var i=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var r=Math.min(i*10,5e3);console.warn("contentLength/delay",i,r);setTimeout(this.setDialog.bind(this,e,t,n),r);return}var o=document.createElement("div");o.classList.add("dialog");if(t.title){var a=document.createElement("h2");a.classList.add("title");a.textContent=t.title;o.appendChild(a)}var c=document.createElement("div");c.classList.add("message");c.textContent=e;o.appendChild(c);if(t.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(t.big){o.classList.add("big")}if(t.fun){o.classList.add("fun")}if(t.alert){o.classList.add("alert")}if(t.modal){o.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}s.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(o);this.$dialogWrapper.classList.remove("empty");n()};c.prototype.setSceneImage=function(e){var t=false;var n=this.$sceneImage;this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(e.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(e.url)+'")'}if(e.origin&&typeof e.origin==="string"){this.$sceneImage.style.backgroundPosition=e.origin}var i=()=>{if(t){return}t=true;n.remove()};if(n){n.addEventListener("transitionend",i,false);this.$gfx.insertBefore(this.$sceneImage,n);n.classList.add("hidden");setTimeout(i,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(e.position){case"left":this.$spellcast.setAttribute("data-image-position","left");break;case"right":default:this.$spellcast.setAttribute("data-image-position","right");break}};c.prototype.clearSprite=function(e){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return}this.clearGItem(this.sprites[e]);delete this.sprites[e]};c.prototype.clearVg=function(e){if(!this.vgs[e]){console.warn("Unknown VG id: ",e);return}this.clearGItem(this.vgs[e]);delete this.vgs[e]};c.prototype.clearMarker=function(e){if(!this.markers[e]){console.warn("Unknown Marker id: ",e);return}this.clearGItem(this.markers[e]);delete this.markers[e]};c.prototype.clearCard=function(e){if(!this.cards[e]){console.warn("Unknown Card id: ",e);return}this.clearGItem(this.cards[e]);delete this.cards[e]};c.prototype.showSprite=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.sprites[e]){this.clearGItem(this.sprites[e])}var n=this.sprites[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"sprite",location:null,class:t.class,style:{},animation:null});return this.updateGItem(n,t,true)};c.prototype.showVg=function(e,t){if((!t.url||typeof t.url!=="string")&&(!t.vgObject||typeof t.vgObject!=="object")){return r.resolved}if(this.vgs[e]){this.clearGItem(this.vgs[e])}var n=this.vgs[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"vg",vgObject:null,class:t.class,style:{},area:{},animation:null});return this.updateGItem(n,t,true)};c.prototype.showMarker=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.markers[e]){this.clearGItem(this.markers[e])}var n=this.markers[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"marker",vg:null,location:null,class:t.class,style:{},animation:null});return this.updateGItem(n,t,true)};var u=0;c.prototype.showCard=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.cards[e]){this.clearGItem(this.cards[e])}var n=this.cards[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"card",location:"showing",$locationSlot:null,pose:null,order:u++,class:t.class,style:{},imageStyle:{},animation:null,contents:{}});this.createCardMarkup(n);return this.updateGItem(n,t,true)};c.prototype.updateSprite=function(e,t){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return r.resolved}return this.updateGItem(this.sprites[e],t)};c.prototype.updateVg=function(e,t){if(!this.vgs[e]){console.warn("Unknown VG id: ",e);return r.resolved}return this.updateGItem(this.vgs[e],t)};c.prototype.updateMarker=function(e,t){if(!this.markers[e]){console.warn("Unknown marker id: ",e);return r.resolved}return this.updateGItem(this.markers[e],t)};c.prototype.updateCard=function(e,t){if(!this.cards[e]){console.warn("Unknown card id: ",e);return r.resolved}return this.updateGItem(this.cards[e],t)};c.prototype.animateSprite=function(e,t){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.sprites[e],this.animations[t])};c.prototype.animateVg=function(e,t){if(!this.vgs[e]){console.warn("Unknown VG id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.vgs[e],this.animations[t])};c.prototype.animateMarker=function(e,t){if(!this.markers[e]){console.warn("Unknown marker id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.markers[e],this.animations[t])};c.prototype.animateCard=function(e,t){if(!this.cards[e]){console.warn("Unknown card id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.cards[e],this.animations[t])};c.prototype.createGItem=function(e){var t=new i;if(e.type!=="marker"){t.$wrapper=document.createElement("div");t.$wrapper.style.visibility="hidden";t.$wrapper.style.transition="none";t.$wrapper.classList.add("g-item-wrapper",e.type+"-wrapper");this.$gfx.append(t.$wrapper)}t.size={mode:"relative",xy:1};t.position={mode:"relative",x:0,y:0};t.vgInvert=false;t.transform={};Object.assign(t,e);t.defineStates("loaded","loading");return t};c.prototype.clearGItem=function(e){if(e.$locationSlot){e.$locationSlot.remove()}e.$wrapper.remove()};c.prototype.updateGItem=async function(e,t,n=false){if(t.vgObject){this.updateGItemVgObject(e,t)}else if(t.vgMorph){this.updateGItemVgMorph(e,t)}if(t.url){await this.updateGItemImage(e,t)}if(t.backUrl){await this.updateGItemBackImage(e,t)}if(t.maskUrl){await this.updateGItemMask(e,t)}if(t.content){this.updateGItemContent(e,t)}if(t.button!==undefined){this.updateGItemButton(e,t)}if(t.area){this.updateVgArea(e,t.area)}if(e.type==="marker"&&(t.vg||t.location)){this.updateMarkerLocation(e,t.vg,t.location)}return this.updateGItemCosmetics(e,t,n)};c.prototype.updateGItemCosmetics=async function(e,t,n=false){if(!n&&e.type!=="marker"&&t.transition!==undefined){if(t.transition===null){e.$wrapper.style.transition=""}else if(!t.transition){e.$wrapper.style.transition="none"}else{e.$wrapper.style.transition="all "+t.transition+"s"}}if(t.location!==undefined&&e.type!=="marker"){await this.moveGItemToLocation(e,t)}if(t.pose!==undefined){this.updateGItemPose(e,t)}if(t.status){this.updateGItemStatus(e,t)}if(t.style&&e.$wrapper){delete t.style.position;Object.assign(e.style,t.style);s.css(e.$wrapper,t.style)}if(t.imageStyle&&e.$image){delete t.imageStyle.position;Object.assign(e.imageStyle,t.imageStyle);s.css(e.$image,t.imageStyle)}if(t.backImageStyle&&e.$backImage){delete t.backImageStyle.position;Object.assign(e.backImageStyle,t.backImageStyle);s.css(e.$backImage,t.backImageStyle)}if(t.maskStyle&&e.$mask){delete t.maskStyle.position;Object.assign(e.maskStyle,t.maskStyle);s.css(e.$mask,t.maskStyle)}if(t.size||t.position||t.vgInvert!==undefined){this.updateGItemTransform(e,t)}if(t.class){t.class=a.toClassObject(t.class);Object.assign(e.class,t.class);s.class(e.$wrapper||e.$image,t.class,"s-")}if(n&&e.type!=="marker"){e.$wrapper.style.visibility="visible";await r.resolveAtAnimationFrame();if(t.transition===undefined||t.transition===null){e.$wrapper.style.transition=""}else if(!t.transition){e.$wrapper.style.transition="none"}else{e.$wrapper.style.transition="all "+t.transition+"s"}}};c.prototype.updateGItemImage=function(e,t){var n=new r;e.vgObject=null;if(e.type==="card"){e.$image.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")';n.resolve();return n}if(t.url.endsWith(".svg")){if(e.$image){e.$image.remove()}if(e.type==="marker"){e.$image=document.createElementNS("http://www.w3.org/2000/svg","g")}else{e.$image=document.createElementNS("http://www.w3.org/2000/svg","svg");e.$image.classList.add("svg")}switch(e.type){case"vg":e.onClick=(e=>{e.stopPropagation()});e.$image.addEventListener("click",e.onClick);e.$image.classList.add("vg");this.uiLoadingCount++;break;case"sprite":e.$image.classList.add("sprite");break;case"marker":e.$image.classList.add("marker");break}o.load(this.cleanUrl(t.url),{removeSvgStyle:true,removeComments:true,removeExoticNamespaces:true,as:e.$image}).then(()=>{console.warn("loaded!");if(e.type==="vg"){this.setVgButtons(e.$image);this.setVgPassiveHints(e.$image);e.emit("loaded");if(--this.uiLoadingCount<=0){this.emit("uiLoaded")}}else{e.emit("loaded")}n.resolve()});console.warn("Aft load");e.emit("loading")}else{if(!e.$image||e.$image.tagName.toLowerCase()!=="img"){if(e.$image){e.$image.remove()}e.$image=document.createElement("img");e.$image.classList.add(e.type)}e.$image.setAttribute("src",this.cleanUrl(t.url));e.$image.onload=(()=>n.resolve())}if(e.type!=="marker"){e.$wrapper.append(e.$image)}return n};c.prototype.updateGItemVgObject=function(e,t){var n=t.vgObject;if(!(n instanceof o.VG)){n=o.objectToVG(n);if(!(n instanceof o.VG)){return}}e.vgObject=n;if(e.$image){e.$image.remove()}if(e.type==="marker"){e.$image=n.renderDom({overrideTag:"g"})}else{e.$image=n.renderDom();e.$image.classList.add("svg");e.$image.classList.add("vg-object")}switch(e.type){case"vg":e.onClick=(e=>{e.stopPropagation()});e.$image.addEventListener("click",e.onClick);e.$image.classList.add("vg");this.setVgButtons(e.$image);this.setVgPassiveHints(e.$image);break;case"sprite":e.$image.classList.add("sprite");break;case"marker":e.$image.classList.add("marker");break}if(e.type!=="marker"){e.$wrapper.append(e.$image)}return};c.prototype.updateGItemVgMorph=function(e,t){var n=e.vgObject;if(!n){console.warn("Has no VG object, abort...");return}n.importMorphLog(t.vgMorph);n.morphDom();return};c.prototype.updateGItemBackImage=function(e,t){if(e.type==="card"){e.$backImage.style.backgroundImage='url("'+this.cleanUrl(t.backUrl)+'")'}return r.resolved};c.prototype.updateGItemMask=function(e,t){var n=new r;if(t.maskUrl.endsWith(".svg")&&e.type==="sprite"){console.warn("has mask!");if(e.$mask){e.$mask.remove()}e.$mask=document.createElementNS("http://www.w3.org/2000/svg","svg");e.$mask.classList.add("sprite-mask");o.load(this.cleanUrl(t.maskUrl),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,as:e.$mask}).then(()=>n.resolve());e.$wrapper.append(e.$mask);e.$wrapper.classList.add("has-mask")}else if(e.$mask){e.$mask.remove();e.$wrapper.classList.remove("has-mask");n.resolve()}return n};c.prototype.updateGItemTransform=function(e,t){var n,i,r,o,a,l,c,u,h;if(!e.$wrapper||!e.$image){return}if(t.size){e.size=t.size}if(t.position){e.position=t.position}if(t.vgInvert!==undefined){e.vgInvert=!!t.vgInvert;if(e.vgInvert){e.$image.classList.add("vg-invert")}else{e.$image.classList.remove("vg-invert")}}if(e.$image.tagName.toLowerCase()==="svg"){n=e.$wrapper.offsetWidth/e.$wrapper.offsetHeight;i=e.$image.width.baseVal.value/e.$image.height.baseVal.value;if(i>n){r=e.$wrapper.offsetWidth;o=r/i}else{o=e.$wrapper.offsetHeight;r=o*i}console.log("dbg svg:",{wrapperAspect:n,imageAspect:i,imageWidth:r,imageHeight:o})}else{r=e.$image.offsetWidth;o=e.$image.offsetHeight}switch(e.size.mode){case"area":case"areaMin":default:a=e.transform.scaleX=e.transform.scaleY=e.size.xy;console.log("transform after .updateGItemSize()",e.transform);break}switch(e.position.mode){case"areaInSpriteOut":l=c=0;u=this.$gfx.offsetWidth-r;h=this.$gfx.offsetHeight-o;if(a!==undefined){l=-.5*r*(1-a);c=-.5*o*(1-a);u+=r*(1-a);h+=o*(1-a)}console.log("dbg:",{xMinOffset:l,xFactor:u,yFactor:h});if(e.position.x<-1){e.transform.translateX=l+(e.position.x+1)*r*a}else if(e.position.x>1){e.transform.translateX=l+u+(e.position.x-1)*r*a}else{e.transform.translateX=l+(.5+e.position.x/2)*u}if(e.position.y<-1){e.transform.translateY=c+h-(e.position.y+1)*o*a}else if(e.position.y>1){e.transform.translateY=c-(e.position.y-1)*o*a}else{e.transform.translateY=c+(.5-e.position.y/2)*h}console.log("transform after .updateGItemPosition()",e.transform);break;case"area":default:l=c=0;u=this.$gfx.offsetWidth-r;h=this.$gfx.offsetHeight-o;if(a!==undefined){l=-.5*r*(1-a);c=-.5*o*(1-a);u+=r*(1-a);h+=o*(1-a)}console.log("dbg:",{xMinOffset:l,xFactor:u,yFactor:h});e.transform.translateX=l+(.5+e.position.x/2)*u;e.transform.translateY=c+(.5-e.position.y/2)*h;console.log("transform after .updateGItemPosition()",e.transform);break}if(e.vgInvert){if(e.transform.scaleY){e.transform.scaleY=-e.transform.scaleY}else{e.transform.scaleY=-1}}s.transform(e.$wrapper,e.transform)};c.prototype.updateGItemContent=function(e,t){var n,i;if(e.type!=="card"){return}for(let r in t.content){n=t.content[r];i=e.contents[r];if(!i){i=e.contents[r]=document.createElement("div");i.classList.add("content-"+r);e.$front.append(i)}i.textContent=n;i.setAttribute("content",n)}};c.prototype.updateGItemPose=function(e,t){if(typeof t.pose==="string"){e.$wrapper.setAttribute("pose",t.pose);e.pose=t.pose}else{e.$wrapper.removeAttribute("pose");e.pose=null}};c.prototype.updateGItemStatus=function(e,t){var n,i;for(i in t.status){n=t.status[i];if(n){e.$wrapper.classList.add("status-"+i);if(typeof n==="number"||typeof n==="string"){e.$wrapper.setAttribute("status-"+i,n)}}else{e.$wrapper.classList.remove("status-"+i);if(e.$wrapper.hasAttribute("status-"+i)){e.$wrapper.removeAttribute("status-"+i)}}}};c.prototype.updateGItemButton=function(e,t){var n=e.$mask||e.$wrapper;var i=t.button;n.setAttribute("id","button-"+i);n.classList.add("button");n.classList.add("disabled")};c.prototype.updateGItemAction=function(e,t){var n=e.$mask||e.$image;if(t.action&&!e.action){e.onClick=(t=>{e.actionCallback(e.action);t.stopPropagation()});n.classList.add("button");n.addEventListener("click",e.onClick)}else if(!t.action&&e.action){n.classList.remove("button");n.removeEventListener("click",e.onClick)}e.action=t.action||null};c.prototype.moveGItemToLocation=function(e,t){var n=new r,i=t.location;if(e.location===i){n.resolve();return n}var o,a,l,c,u,h,f,p,d,m,g,y,v;var b=10;l=e.location;a=l?this.gItemLocations[l]:this.$gfx;u=e.$locationSlot||this.$gfx;e.location=i;o=i?this.gItemLocations[i]:this.$gfx;if(!o){o=this.gItemLocations[i]=document.createElement("div");o.classList.add("g-item-location");o.classList.add("g-item-location-"+i);this.$gfx.append(o)}var x=window.getComputedStyle(e.$wrapper);var w=window.getComputedStyle(o);var _=parseFloat(x.width);var k=parseFloat(x.height);if(o===this.$gfx){c=this.$gfx}else{c=e.$locationSlot=document.createElement("div");c.classList.add("g-item-slot");c.style.order=e.order}p=[...Object.values(this.cards),...Object.values(this.sprites),...Object.values(this.vgs)].filter(t=>t!==e&&t.location&&(t.location===i||t.location===l));d=p.map(e=>e.$locationSlot.getBoundingClientRect());if(c!==this.$gfx){if(o.lastChild&&parseFloat(o.lastChild.style.order)>e.order){o.prepend(c)}else{o.append(c)}}v=u.getBoundingClientRect();if(u!==this.$gfx){u.remove()}m=p.map(e=>e.$locationSlot.getBoundingClientRect());p.forEach((e,t)=>{var n=d[t],i=m[t];var r=e.$wrapper.style.transition;var o=e.$wrapper.style.transform;var a=Object.assign({},e.localTransform);a.translateX+=n.left-i.left;a.translateY+=n.top-n.top;e.$wrapper.style.transition="none";e.$wrapper.style.transform=s.stringifyTransform(a);setTimeout(()=>{e.$wrapper.style.transition=r;e.$wrapper.style.transform=o},b)});var S={translateX:0,translateY:0};switch(w.flexDirection){case"row":case"row-reverse":g=parseFloat(w.height);S.scaleX=S.scaleY=g/k;break;case"column":case"column-reverse":g=parseFloat(w.width);S.scaleX=S.scaleY=g/_;break;default:g=parseFloat(w.height);S.scaleX=S.scaleY=g/k;console.warn("flex-direction",w.flexDirection)}S.translateX-=(_-_*S.scaleX)/2;S.translateY-=(k-k*S.scaleY)/2;var C=e.localTransform;e.localTransform=S;if(u===this.$gfx){e.$wrapper.style.transform=s.stringifyTransform(S);c.append(e.$wrapper);n.resolve();return n}var L=window.getComputedStyle(a);switch(L.flexDirection){case"column":case"column-reverse":f="column";break;default:f="row"}y=c.getBoundingClientRect();var j={translateX:v.left+C.translateX-y.left,translateY:v.top+C.translateY-y.top,scaleX:C.scaleX,scaleY:C.scaleY};e.$wrapper.style.transform=s.stringifyTransform(j);c.append(e.$wrapper);setTimeout(()=>{e.$wrapper.style.transform=s.stringifyTransform(S);n.resolve()},b);return n};c.prototype.updateVgArea=function(e,t){var n;if(e.type!=="vg"){return}if(!e.hasState("loaded")){e.once("loaded",this.updateVgArea.bind(this,e,t));return}for(n in t){if(!e.area[n]){e.area[n]={}}if(!e.area[n].status){e.area[n].status={}}if(t[n].hint!==undefined){e.area[n].hint=t[n].hint||null}if(t[n].status){Object.assign(e.area[n].status,t[n].status)}Array.from(e.$image.querySelectorAll("[area="+n+"]")).forEach(e=>{var i;if(t[n].hint!==undefined){if(t[n].hint){e.setAttribute("data-passive-hint",t[n].hint);e.classList.add("passive-hint")}else{e.removeAttribute("data-passive-hint");e.classList.remove("passive-hint")}}if(t[n].status){for(i in t[n].status){if(t[n].status[i]){e.classList.add("status-"+i)}else{e.classList.remove("status-"+i)}}}})}};c.prototype.updateMarkerLocation=function(e,t,n){var i,r,s,a,l,c,u,h,f,p;if(!e.hasState("loaded")){e.once("loaded",this.updateMarkerLocation.bind(this,e,t,n));return}if(!t){t=e.vg}if(!n){n=e.location}if(!this.vgs[t]){console.warn("Unknown VG id: ",t);return}i=this.vgs[t];if(!i.hasState("loaded")){i.once("loaded",this.updateMarkerLocation.bind(this,e,t,n));return}r=i.$image.querySelector("[area="+n+"]");if(!r){console.warn("VG "+t+": area not found",n);return}e.vg=t;e.location=n;s=r.getBBox();f=s.x+s.width/2;p=s.y+s.height/2;a=o.getViewBox(e.$image);l=parseFloat(e.$image.getAttribute("width"))||a.width;c=parseFloat(e.$image.getAttribute("height"))||a.height;if(!isNaN(u=parseFloat(e.$image.getAttribute("originX")))){f-=(u-a.x)/a.width*l}if(!isNaN(h=parseFloat(e.$image.getAttribute("originY")))){p-=(h-a.y)/a.height*c}e.$image.style.transform="translate("+f+"px , "+p+"px )"+"scale("+l/a.width+" , "+c/a.height+")";if(e.$image.ownerSVGElement!==i.$image){i.$image.append(e.$image)}};c.prototype.createGItemLocation=function(e){var t;if(this.gItemLocations[e]){return}t=this.gItemLocations[e]=document.createElement("div");t.classList.add("g-item-location");t.classList.add("g-item-location-"+e);this.$gfx.append(t)};c.prototype.createCardMarkup=function(e){e.$card=document.createElement("div");e.$card.classList.add("card");e.$wrapper.append(e.$card);e.$front=document.createElement("div");e.$front.classList.add("front");e.$card.append(e.$front);e.$image=document.createElement("div");e.$image.classList.add("card-image");e.$front.append(e.$image);e.$back=document.createElement("div");e.$back.classList.add("back");e.$card.append(e.$back);e.$backImage=document.createElement("div");e.$backImage.classList.add("card-image");e.$back.append(e.$backImage)};c.prototype.animateGItem=async function(e,t){var n,i=0;e.animation=t.id;if(!Array.isArray(t.frames)||!t.frames.length){return}for(n of t.frames){await this.updateGItem(e,n);await r.resolveTimeout(n.duration*1e3)}e.animation=null};c.prototype.defineAnimation=function(e,t){t.id=e;this.animations[e]=t};c.prototype.setVgButtons=function(e){Array.from(e.querySelectorAll("[button]")).forEach(e=>{var t=e.getAttribute("button");e.setAttribute("id","button-"+t);if(!e.getAttribute("area")){e.setAttribute("area",t)}e.classList.add("button");e.classList.add("disabled")})};c.prototype.setVgPassiveHints=function(e){Array.from(e.querySelectorAll("[hint]")).forEach(e=>{var t=e.getAttribute("hint");e.setAttribute("data-passive-hint",t);e.classList.add("passive-hint");e.addEventListener("mouseleave",e=>{this.clearHint()});e.addEventListener("mouseenter",e=>{var t=e.currentTarget;var n=t.getAttribute("data-passive-hint");if(!n){return}this.setHint(n,{passive:true})})})};c.prototype.sound=function(e){var t=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,e,t);this.nextSoundChannel=(this.nextSoundChannel+1)%4;t.setAttribute("src",this.cleanUrl(e.url));t.play()};c.prototype.music=function(e){var t=this.$music.getAttribute("src");if(e.url){e.url=this.cleanUrl(e.url);if(t){if(t!==e.url){d(this.$music,()=>{this.$music.setAttribute("src",e.url);this.$music.play();p(this.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",e.url);this.$music.play();p(this.$music)}}else if(t){d(this.$music,()=>{this.$music.removeAttribute("src")})}};var h=10;var f=.01;function p(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+f);e.__fadeTimer=setTimeout(p.bind(undefined,e,t),h)}function d(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-f);e.__fadeTimer=setTimeout(d.bind(undefined,e,t),h)}},{"../../commonUtils.js":5,"dom-kit":7,"nextgen-events/lib/browser.js":11,seventh:25,"svg-kit":43}],2:[function(e,t,n){"use strict";const i=e("nextgen-events/lib/browser.js");const r=e("dom-kit");const s=e("url");function o(e){this.domain=e.domain||"localhost";this.port=e.port||80;this.path=e.path||"/";this.token=e.token||"";this.userName=e.name||"unknown_"+Math.floor(Math.random()*1e4);this.ws=null;this.proxy=null}t.exports=o;o.prototype=Object.create(i.prototype);o.prototype.constructor=o;const a={classic:e("./ui/classic.js")};o.autoCreate=function(){var e={port:window.location.port,domain:window.location.hostname,path:window.location.pathname};Object.assign(e,s.parse(window.location.href,true).query);window.spellcastClient=new o(e);if(!e.ui){e.ui=["classic"]}else if(!Array.isArray(e.ui)){e.ui=[e.ui]}window.spellcastClient.ui=e.ui;return window.spellcastClient};o.prototype.run=function(e){var t=false;this.proxy=new i.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(e=>{if(a[e]){new a[e](this.proxy.remoteServices.bus,this)}});var n="ws://"+this.domain+(this.port?":"+this.port:"")+this.path+(this.token||"");console.log("Websocket URL:",n);this.ws=new WebSocket(n);this.emit("connecting");this.ws.onerror=(()=>{if(!t){console.log("Can't open Websocket (error)...");this.emit("error","unreachable");return}});this.ws.onopen=(()=>{t=true;console.log("Websocket opened!");this.emit("open");this.proxy.remoteServices.bus.emit("authenticate",{name:this.userName});if(typeof e==="function"){e()}});this.ws.onclose=(()=>{if(!t){console.log("Can't open Websocket (close)...");this.emit("error","unreachable");return}t=false;this.proxy.destroy();console.log("Websocket closed!");this.emit("close")});this.ws.onmessage=(e=>{var t;try{t=JSON.parse(e.data)}catch(e){return}console.log("Message received: ",t);this.proxy.receive(t)});this.proxy.send=(e=>{this.ws.send(JSON.stringify(e))})};o.autoCreate();r.ready(()=>{window.spellcastClient.run();document.body.onkeypress=(e=>{if(e.keyCode!==120){return}var t,n=document.querySelectorAll("link[rel=stylesheet]");for(var i=0;i<n.length;i++){t=n[i].getAttribute("href").split("?")[0]+"?"+Math.random();n[i].setAttribute("href",t)}})})},{"./ui/classic.js":4,"dom-kit":7,"nextgen-events/lib/browser.js":11,url:32}],3:[function(e,t,n){"use strict";const i={};t.exports=i;const r=e("string-kit/lib/format.js").markupMethod;const s=e("string-kit/lib/escape.js").html;const o={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="bright blue">',c:'<span class="cyan">',C:'<span class="bright cyan">',g:'<span class="green">',G:'<span class="bright green">',k:'<span class="black">',K:'<span class="grey">',m:'<span class="magenta">',M:'<span class="bright magenta">',r:'<span class="red">',R:'<span class="bright red">',w:'<span class="white">',W:'<span class="bright white">',y:'<span class="yellow">',Y:'<span class="bright yellow">'}};i.markup=function(...e){e[0]=s(e[0]).replace(/\n/,"<br />");return r.apply(o,e)}},{"string-kit/lib/escape.js":28,"string-kit/lib/format.js":29}],4:[function(e,t,n){"use strict";const i=e("nextgen-events/lib/browser.js");const r=e("../Dom.js");const s=e("../toolkit.js");function o(e,t){console.log(Array.from(arguments));this.bus=e;this.client=t;this.user=null;this.users=null;this.roles=null;this.roleId=null;this.config=null;this.inGame=false;this.nexts=null;this.afterNext=false;this.afterNextTriggered=false;this.afterLeave=false;this.hasNewContent=false;this.dom=new r;this.ended=false;this.client.once("connecting",o.clientConnecting.bind(this));this.client.once("open",o.clientOpen.bind(this));this.client.once("close",o.clientClose.bind(this));this.client.on("error",o.clientError.bind(this));this.commandConfig({enabled:true});this.dom.preload()}t.exports=o;o.prototype=Object.create(i.prototype);o.prototype.constructor=o;function a(e){return this.find(t=>{return t.id===e})}o.prototype.initBus=function(){this.bus.on("clientConfig",o.clientConfig.bind(this));this.bus.on("user",o.user.bind(this));this.bus.on("userList",o.userList.bind(this));this.bus.on("roleList",o.roleList.bind(this));this.bus.on("extOutput",o.extOutput.bind(this));this.bus.on("extErrorOutput",o.extErrorOutput.bind(this));this.bus.on("message",o.message.bind(this),{async:true});this.bus.on("indicators",o.indicators.bind(this));this.bus.on("status",o.status.bind(this));this.bus.on("panel",o.panel.bind(this));this.bus.on("theme",o.theme.bind(this));this.bus.on("image",o.image.bind(this));this.bus.on("sound",o.sound.bind(this));this.bus.on("music",o.music.bind(this));this.bus.on("defineAnimation",o.defineAnimation.bind(this));this.bus.on("showSprite",o.showSprite.bind(this),{async:true});this.bus.on("updateSprite",o.updateSprite.bind(this),{async:true});this.bus.on("animateSprite",o.animateSprite.bind(this),{async:true});this.bus.on("clearSprite",o.clearSprite.bind(this));this.bus.on("showVg",o.showVg.bind(this));this.bus.on("updateVg",o.updateVg.bind(this));this.bus.on("animateVg",o.animateVg.bind(this));this.bus.on("clearVg",o.clearVg.bind(this));this.bus.on("showMarker",o.showMarker.bind(this));this.bus.on("updateMarker",o.updateMarker.bind(this));this.bus.on("animateMarker",o.animateMarker.bind(this));this.bus.on("clearMarker",o.clearMarker.bind(this));this.bus.on("showCard",o.showCard.bind(this));this.bus.on("updateCard",o.updateCard.bind(this));this.bus.on("animateCard",o.animateCard.bind(this));this.bus.on("clearCard",o.clearCard.bind(this));this.bus.on("enterScene",o.enterScene.bind(this));this.bus.on("leaveScene",o.leaveScene.bind(this));this.bus.on("nextList",o.nextList.bind(this));this.bus.on("nextTriggered",o.nextTriggered.bind(this));this.bus.on("textInput",o.textInput.bind(this));this.bus.on("commandConfig",o.prototype.commandConfig.bind(this));this.bus.on("rejoinRoles",o.rejoinRoles.bind(this));this.bus.on("pause",o.pause.bind(this));this.bus.on("unpause",o.unpause.bind(this));this.bus.on("wait",o.wait.bind(this));this.bus.on("end",o.end.bind(this),{async:true});this.bus.on("custom",o.custom.bind(this));this.bus.on("exit",o.exit.bind(this),{async:true});this.bus.emit("ready");this.defineStates("end")};o.clientConnecting=function(){console.log("Connecting!");this.dom.clientStatus("connecting")};o.clientOpen=function(){console.log("Connected!");this.dom.clientStatus("connected");this.initBus()};o.clientClose=function(){console.log("Closed!");this.dom.clientStatus("closed")};o.clientError=function(e){switch(e){case"unreachable":this.dom.clientStatus("unreachable");break}};o.clientConfig=function(e){console.warn("Client config received: ",e);this.config=e;if(this.config.theme){this.dom.setTheme(this.config.theme)}};o.user=function(e){console.log("User received: ",e);this.user=e};o.userList=function(e){console.log("User-list received: ",e);e.get=a;this.users=e};o.roleList=function(e,t,n){var i=[],r;if(!this.roles&&e.length>1){this.dom.setMultiplayer(true)}e.get=a;this.roles=e;if(this.inGame){return}if(n&&e.length<=1){this.roleId=e[0].id;return}e.forEach((e,t)=>{var n=e.clientId&&this.users.get(e.clientId).name;i.push({index:t,label:e.name,type:"role",selectedBy:n&&[n]})});if(t.length){r=t.map(e=>{return this.users.get(e).name})}var s=t=>{if(e[t].clientId===this.user.id){this.bus.emit("selectRole",null)}else if(e[t].clientId!==null){return}else{this.bus.emit("selectRole",e[t].id)}};this.dom.setChoices(i,r,s);if(n){e.find((e,t)=>{if(e.clientId===this.user.id){this.roleId=e.id;return true}return false});this.afterLeave=true;return}};o.message=function(e,t,n){var i=false;this.hasNewContent=true;e=s.markup(e);if(!t){t={}}this.dom.addMessage(e,t,n)};o.indicators=function(e){this.dom.addIndicators(e)};o.status=function(e){this.dom.addIndicators(e,true)};o.panel=function(e,t){this.dom.addPanel(e,t)};o.enterScene=function(e,t){var n;this.inGame=true;if(t){n=this.dom.toAltBuffer()}if(!e&&!n){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};o.leaveScene=function(e,t){if(t){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};o.nextTriggered=function(e){var t=this.nexts.find(t=>t.id===e);this.dom.newSegmentOnContent("inter-segment");if(t&&t.label&&!t.button){this.dom.addSelectedChoice(t.label)}this.dom.clearChoices();this.afterNextTriggered=true;this.hasNewContent=false};o.nextList=function(e,t,n,i){var r=[],s,o=0;this.nexts=e;this.afterNext=true;if(i&&this.roles.length===1){return}e.forEach((e,t)=>{var n=e.roleIds.map(e=>{return this.roles.get(e).name});if(e.label){o+=e.label.length}r.push({index:t,label:e.label||"Next",style:e.style,class:e.class,image:e.image,button:e.button,groupBreak:!!e.groupBreak,type:"next",selectedBy:n})});if(!n.nextStyle||n.nextStyle==="auto"){if(this.roles.length<=1&&r.length<=3&&o<20){n.nextStyle="inline"}else if(r.length>8){n.nextStyle="smallList"}else{n.nextStyle="list"}}if(t.length&&this.roles.length){s=t.map(e=>{return this.roles.get(e).name})}var a=t=>{if(e[t].roleIds.indexOf(this.roleId)!==-1){this.bus.emit("selectNext",null)}else{this.bus.emit("selectNext",e[t].id)}};this.dom.setChoices(r,s,a,{timeout:n.timeout,nextStyle:n.nextStyle})};o.extOutput=function(e){alert("not coded ATM!")};o.extErrorOutput=function(e){alert("not coded ATM!")};o.textInput=function(e,t){var n={label:e};if(t.indexOf(this.roleId)===-1){n.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(n)}else{this.dom.textInput(n,e=>{this.bus.emit("textSubmit",e)})}};o.prototype.commandConfig=function(e){console.warn("Received command config:",e);if(e.enabled===true){this.dom.enableCommand(e=>{this.bus.emit(this.inGame?"command":"chat",e)})}else if(e.enabled===false){this.dom.disableCommand()}};o.pause=function(e){console.log("Received a pause event for",e,"seconds")};o.unpause=function(){console.log("Received an unpause event")};o.rejoinRoles=function(){};o.wait=function(e){switch(e){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoinRoles",()=>this.dom.clearHint());break;default:this.dom.setBigHint("WAITING FOR "+e,{wait:true,"pulse-animation":true})}};o.theme=function(e){if(!e.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(e)};o.image=function(e){this.dom.setSceneImage(e)};o.defineAnimation=function(e,t){this.dom.defineAnimation(e,t)};o.showSprite=function(e,t,n){if(!t.url||typeof t.url!=="string"){n();return}t.actionCallback=o.spriteActionCallback.bind(this);this.dom.showSprite(e,t).then(n)};o.spriteActionCallback=function(e){console.warn("Sprite action triggered: ",e);this.bus.emit("action",e)};o.updateSprite=function(e,t,n){this.dom.updateSprite(e,t).then(n)};o.animateSprite=function(e,t,n){this.dom.animateSprite(e,t).then(n)};o.clearSprite=function(e){this.dom.clearSprite(e)};o.showVg=function(e,t){if((!t.url||typeof t.url!=="string")&&(!t.vgObject||typeof t.vgObject!=="object")){return}t.actionCallback=o.vgActionCallback.bind(this);this.dom.showVg(e,t)};o.vgActionCallback=function(e){console.warn("VG action triggered: ",e);this.bus.emit("action",e)};o.updateVg=function(e,t){this.dom.updateVg(e,t)};o.animateVg=function(e,t){this.dom.animateVg(e,t)};o.clearVg=function(e){this.dom.clearVg(e)};o.showMarker=function(e,t){if(!t.url||typeof t.url!=="string"){return}t.actionCallback=o.markerActionCallback.bind(this);this.dom.showMarker(e,t)};o.markerActionCallback=function(e){console.warn("Marker action triggered: ",e);this.bus.emit("action",e)};o.updateMarker=function(e,t){this.dom.updateMarker(e,t)};o.animateMarker=function(e,t){this.dom.animateMarker(e,t)};o.clearMarker=function(e){this.dom.clearMarker(e)};o.showCard=function(e,t){if(!t.url||typeof t.url!=="string"){return}t.actionCallback=o.cardActionCallback.bind(this);this.dom.showCard(e,t)};o.cardActionCallback=function(e){console.warn("Card action triggered: ",e);this.bus.emit("action",e)};o.updateCard=function(e,t){this.dom.updateCard(e,t)};o.animateCard=function(e,t){this.dom.animateCard(e,t)};o.clearCard=function(e){this.dom.clearCard(e)};o.sound=function(e){this.dom.sound(e)};o.music=function(e){this.dom.music(e)};o.end=function(e,t,n){var i={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};var r=()=>{if(this.ended){return}this.ended=true;console.log("finished!");this.emit("end");n()};switch(e){case"end":this.dom.setDialog("The End.",i,r);break;case"win":this.dom.setDialog("You Win!",i,r);break;case"lost":this.dom.setDialog("You Lose...",i,r);break;case"draw":this.dom.setDialog("Draw.",i,r);break}};o.custom=function(e,t){console.log("Received a custom event",e,t)};o.exit=function(e,t,n){console.log("exit cb",n);this.once("end",()=>{setTimeout(200,n)})}},{"../Dom.js":1,"../toolkit.js":3,"nextgen-events/lib/browser.js":11}],5:[function(e,t,n){"use strict";n.toClassObject=function e(t){var n={};if(!t){return n}if(typeof t==="string"){n[t]=true;return n}if(typeof t==="object"){if(Array.isArray(t)){t.forEach(e=>n[e]=true);return n}return t}return n}},{}],6:[function(e,t,n){},{}],7:[function(e,t,n){(function(n){"use strict";var i,r;if(n.browser){i=new DOMParser;r=new XMLSerializer}else{var s=e("@cronvel/xmldom");i=new s.DOMParser;r=new s.XMLSerializer}var o={};t.exports=o;o.ready=function(e){document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t,false);e()},false)};o.fromXml=function(e){return i.parseFromString(e,"application/xml")};o.toXml=function(e){return r.serializeToString(e)};o.fromHtml=function(e){var t,n,i;i=document.createDocumentFragment();n=document.createElement("div");n.insertAdjacentHTML("beforeend",e);for(t=0;t<n.children.length;t++){i.appendChild(n.children[t])}return i};o.appendJs=function(e){var t=document.createElement("script");t.setAttribute("src",e);document.body.appendChild(t)};o.batch=function(e,t,...n){var i;if(t instanceof Element){e(t,...n)}else if(Array.isArray(t)){for(i=0;i<t.length;i++){e(t[i],...n)}}else if(t instanceof NodeList||t instanceof NamedNodeMap){for(i=0;i<t.length;i++){e(t[i],...n)}}};o.css=function(e,t){var n;for(n in t){e.style[n]=t[n]}};o.attr=function(e,t,n){var i;n=n||"";for(i in t){if(t[i]===null){e.removeAttribute(n+i)}else{e.setAttribute(n+i,t[i])}}};o.class=function(e,t,n){var i;n=n||"";for(i in t){if(t[i]){e.classList.add(n+i)}else{e.classList.remove(n+i)}}};o.remove=function(e){e.parentNode.removeChild(e)};o.empty=function(e){while(e.firstChild){e.removeChild(e.firstChild)}};o.cloneInto=function(e,t){o.empty(t);t.appendChild(e.cloneNode(true))};o.insertInto=function(e,t){o.empty(t);t.appendChild(e)};o.moveChildrenInto=function(e,t){o.empty(t);while(e.firstChild){t.appendChild(e.firstChild)}};o.moveAttributes=function(e,t){Array.from(e.attributes).forEach(n=>{var i=n.name;var r=n.value;e.removeAttribute(i);if(i!=="xmlns"&&i.indexOf(":")===-1&&r){t.setAttribute(i,r)}})};o.styleToAttribute=function(e,t,n){if(e.style[t]&&(!n||n.indexOf(e.style[t])===-1)){e.setAttribute(t,e.style[t]);e.style[t]=null}};o.prefixIds=function(e,t){var n,i={};n=e.querySelectorAll("*");o.batch(o.prefixIds.idAttributePass,n,t,i);o.batch(o.prefixIds.otherAttributesPass,n,i)};o.prefixIds.idAttributePass=function(e,t,n){n[e.id]=t+"."+e.id;e.id=n[e.id]};o.prefixIds.otherAttributesPass=function(e,t){o.batch(o.prefixIds.oneAttributeSubPass,e.attributes,t)};o.prefixIds.oneAttributeSubPass=function(e,t){e.value=e.value.replace(/url\(#([^)]+)\)/g,(e,n)=>{if(!t[n]){return e}return"url(#"+t[n]+")"})};o.removeAllTags=function(e,t,n){Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!n||!e.firstChild){e.parentNode.removeChild(e)}})};o.removeAllAttributes=function(e,t){e.removeAttribute(t);Array.from(e.querySelectorAll("["+t+"]")).forEach(e=>{e.removeAttribute(t)})};o.preload=function(e){if(!Array.isArray(e)){e=[e]}e.forEach(e=>{if(o.preload.preloaded[e]){return}o.preload.preloaded[e]=new Image;o.preload.preloaded[e].src=e})};o.preload.preloaded={};o.filterByNamespace=function(e,t){var n,i,r,s,a;if(!t||typeof t!=="object"){return}o.filterAttributesByNamespace(e,t);for(n=e.childNodes.length-1;n>=0;n--){i=e.childNodes[n];if(i.nodeType===1){if(i.tagName.indexOf(":")!==-1){a=i.tagName.split(":");r=a[0];s=a[1];if(r===t.primary){i.tagName=s;o.filterByNamespace(i,t)}else if(t.whitelist){if(t.whitelist.indexOf(r)!==-1){o.filterByNamespace(i,t)}else{e.removeChild(i)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeChild(i)}else{o.filterByNamespace(i,t)}}else{o.filterByNamespace(i,t)}}else{o.filterByNamespace(i,t)}}}};o.filterAttributesByNamespace=function(e,t){var n,i,r,s,o,a;if(!t||typeof t!=="object"){return}for(n=e.attributes.length-1;n>=0;n--){i=e.attributes[n];if(i.name.indexOf(":")!==-1){a=i.name.split(":");r=a[0];s=a[1];o=i.value;if(r===t.primary){e.removeAttributeNode(i);e.setAttribute(s,o)}else if(t.whitelist){if(t.whitelist.indexOf(r)===-1){e.removeAttributeNode(i)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeAttributeNode(i)}}}}};o.removeComments=function(e){var t,n;for(t=e.childNodes.length-1;t>=0;t--){n=e.childNodes[t];if(n.nodeType===8){e.removeChild(n)}else if(n.nodeType===1){o.removeComments(n)}}};o.removeWhiteSpaces=function(e,t){var n,i,r=null;for(n=e.childNodes.length-1;n>=0;n--){i=e.childNodes[n];if(i.nodeType===3){if(t){if(r){r.nodeValue=(i.nodeValue+r.nodeValue).replace(/^\s*(\n[\t ]*)$/,"$1");e.removeChild(i)}else{i.nodeValue=i.nodeValue.replace(/^\s*(\n[\t ]*)$/,"$1");r=i}}else if(!/\S/.test(i.nodeValue)){e.removeChild(i)}}else if(i.nodeType===1){r=null;o.removeWhiteSpaces(i,t)}else{r=null}}};o.parseMatrix=function(e){var t=e.match(/(matrix|matrix3d)\(([0-9., -]+)\)/);if(!t){return null}return t[2].trim().split(/ ?, ?/).map(e=>{return parseFloat(e)})};o.decomposeMatrix=function(e){if(e.length===6){return o.decomposeMatrix2d(e)}if(e.length===16){return o.decomposeMatrix3d(e)}return null};o.decomposeMatrix2d=function(e){var t=Math.atan2(e[1],e[0]),n=e[0]*e[0]+e[1]*e[1],i=Math.sqrt(n),r=(e[0]*e[3]-e[2]*e[1])/i,s=Math.atan2(e[0]*e[2]+e[1]*e[3],n);return{rotate:180*t/Math.PI,scaleX:i,scaleY:r,skewX:180*s/Math.PI,skewY:0,translateX:e[4],translateY:e[5]}};o.decomposeMatrix3d=function(e){var t=Math.PI/180;var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);var s=Math.atan2(-e[9]/r,e[10]/r)/t,o=Math.asin(e[8]/r)/t,a=Math.atan2(-e[4]/i,e[0]/n)/t;if(e[4]===1||e[4]===-1){s=0;o=e[4]*-Math.PI/2;a=e[4]*Math.atan2(e[6]/i,e[5]/i)/t}var l=e[12]/n,c=e[13]/n,u=e[14]/n;return{translateX:l,translateY:c,translateZ:u,rotateX:s,rotateY:o,rotateZ:a,scaleX:n,scaleY:i,scaleZ:r}};o.stringifyTransform=function(e){var t=[];if(e.translateX){t.push("translateX("+e.translateX+"px)")}if(e.translateY){t.push("translateY("+e.translateY+"px)")}if(e.translateZ){t.push("translateZ("+e.translateZ+"px)")}if(e.rotate){t.push("rotate("+e.rotate+"deg)")}else{if(e.rotateX){t.push("rotateX("+e.rotateX+"deg)")}if(e.rotateY){t.push("rotateY("+e.rotateY+"deg)")}if(e.rotateZ){t.push("rotateZ("+e.rotateZ+"deg)")}}if(e.scale){t.push("scale("+e.scale+")")}else{if(e.scaleX){t.push("scaleX("+e.scaleX+")")}if(e.scaleY){t.push("scaleY("+e.scaleY+")")}if(e.scaleZ){t.push("scaleZ("+e.scaleZ+")")}}if(e.skewX){t.push("skewX("+e.skewX+"deg)")}if(e.skewY){t.push("skewY("+e.skewY+"deg)")}return t.join(" ")};o.transform=function(e,t){e.style.transform=o.stringifyTransform(t)};o.id=function(e,t){e.id=t};o.text=function(e,t){e.textContent=t};o.html=function(e,t){e.innerHTML=t}}).call(this,e("_process"))},{"@cronvel/xmldom":6,_process:13}],8:[function(e,t,n){t.exports=function(e){return e!=null&&(i(e)||r(e)||!!e._isBuffer)};function i(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function r(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&i(e.slice(0,0))}},{}],9:[function(e,t,n){(function(n,i,r){"use strict";const s=n.browser?window.setImmediate:n.nextTick;if(!i.__NEXTGEN_EVENTS__){i.__NEXTGEN_EVENTS__={recursions:0}}var o=i.__NEXTGEN_EVENTS__;function a(){}t.exports=a;a.prototype.__prototypeUID__="nextgen-events/NextGenEvents";a.prototype.__prototypeVersion__=e("../package.json").version;a.SYNC=-Infinity;a.DESYNC=-1;a.defaultMaxListeners=Infinity;a.init=function(){Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal})};a.Internal=function(e){this.nice=a.SYNC;this.interruptible=false;this.contexts={};this.desync=r;this.depth=0;this.states={};this.stateGroups={};this.listeners={error:[],interrupt:[],newListener:[],removeListener:[]};this.hasListenerPriority=false;this.maxListeners=a.defaultMaxListeners;if(e){this.nice=e.nice;this.interruptible=e.interruptible;Object.assign(this.states,e.states),Object.assign(this.stateGroups,e.stateGroups),Object.keys(e.listeners).forEach(t=>{this.listeners[t]=e.listeners[t].slice()});Object.keys(e.contexts).forEach(t=>{var n=e.contexts[t];this.contexts[t]={nice:n.nice,ready:true,status:n.status,serial:n.serial,scopes:{}}})}};a.initFrom=function(e){if(!e.__ngev){a.init.call(e)}Object.defineProperty(this,"__ngev",{configurable:true,value:new a.Internal(e.__ngev)})};a.mergeListeners=function(e){if(!this.__ngev){a.init.call(this)}var t=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(t).forEach(e=>{this.__ngev.listeners[e]=[]});e.forEach(e=>{if(!e.__ngev){a.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(n=>{var i,r,s=[];if(t[n]){t[n].forEach(t=>{for(i=0,r=e.length;i<r;i++){if(!e[i].__ngev.listeners[n]||e[i].__ngev.listeners[n].indexOf(t)===-1){s.push(t);break}}})}e.forEach(e=>{e.__ngev.listeners[n].forEach(e=>{if(this.__ngev.listeners[n].indexOf(e)===-1&&s.indexOf(e)===-1){this.__ngev.listeners[n].push(e)}})})})};a.filterOutCallback=function(e,t){return e!==t};a.prototype.addListener=function(e,t,i){var r,s;if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}if(!e||typeof e!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof t==="function"){r={};if(!i||typeof i!=="object"){i={}}}else if(i===true&&t&&typeof t==="object"){i=r=t;t=undefined}else{i=t;if(!i||typeof i!=="object"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}t=undefined;r={}}r.fn=t||i.fn;r.id=i.id!==undefined?i.id:r.fn;r.once=!!i.once;r.async=!!i.async;r.eventObject=!!i.eventObject;r.nice=i.nice!==undefined?Math.floor(i.nice):a.SYNC;r.priority=+i.priority||0;r.context=i.context&&(typeof i.context==="string"||typeof i.context==="object")?i.context:null;if(typeof r.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(typeof r.context==="string"){r.context=this.__ngev.contexts[r.context]||this.addListenerContext(r.context)}r.event=e;if(this.__ngev.listeners.newListener.length){s=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[e].push(r);a.emitEvent({emitter:this,name:"newListener",args:[[r]],listeners:s});if(this.__ngev.states[e]){a.emitToOneListener(this.__ngev.states[e],r)}return this}this.__ngev.listeners[e].push(r);if(this.__ngev.hasListenerPriority){this.__ngev.listeners[e].sort((e,t)=>t.priority-e.priority)}if(this.__ngev.listeners[e].length===this.__ngev.maxListeners+1){n.emitWarning("Possible NextGenEvents memory leak detected. "+this.__ngev.listeners[e].length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit",{type:"MaxListenersExceededWarning"})}if(this.__ngev.states[e]){a.emitToOneListener(this.__ngev.states[e],r)}return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function(e,t,n){if(t&&typeof t==="object"){t.once=true}else if(n&&typeof n==="object"){n.once=true}else{n={once:true}}return this.addListener(e,t,n)};a.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),{once:true})})};a.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),{once:true})})};a.prototype.removeListener=function(e,t){var n,i,r=[],s=[];if(!e||typeof e!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}i=this.__ngev.listeners[e].length;for(n=0;n<i;n++){if(this.__ngev.listeners[e][n].id===t){s.push(this.__ngev.listeners[e][n])}else{r.push(this.__ngev.listeners[e][n])}}this.__ngev.listeners[e]=r;if(s.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",s)}return this};a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(e){var t;if(!this.__ngev){a.init.call(this)}if(e){if(!e||typeof e!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}t=this.__ngev.listeners[e];this.__ngev.listeners[e]=[];if(t.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",t)}}else{this.__ngev.listeners={error:[],interrupt:[],newListener:[],removeListener:[]}}return this};a.listenerWrapper=function(e,t,n,i,r){var s,l,c=t.master||t,u=!!t.master||t.emitter.__ngev.interruptible;if(c.interrupt){return}if(e.async){if(n){n.ready=!i}if(r<0){if(o.recursions>=-r){t.emitter.__ngev.desync(a.listenerWrapper.bind(undefined,e,t,n,i,a.SYNC));return}}else{setTimeout(a.listenerWrapper.bind(undefined,e,t,n,i,a.SYNC),r);return}l=(e=>{c.listenersDone++;if(e&&u&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=e;if(c.callback){a.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){a.emitCallback(t)}if(i){a.processScopeQueue(n,true,true)}});if(e.eventObject){e.fn(t,l)}else{s=e.fn(...t.args,l)}}else{if(r<0){if(o.recursions>=-r){t.emitter.__ngev.desync(a.listenerWrapper.bind(undefined,e,t,n,i,a.SYNC));return}}else{setTimeout(a.listenerWrapper.bind(undefined,e,t,n,i,a.SYNC),r);return}if(e.eventObject){e.fn(t)}else{s=e.fn(...t.args)}c.listenersDone++}if(s&&u&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=s;if(c.callback){a.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){a.emitCallback(t)}};var l=0;a.prototype.emit=function(...e){var t=a.createEvent(this,...e);return a.emitEvent(t)};a.prototype.waitForEmit=function(...e){return new Promise(t=>{this.emit(...e,e=>t(e))})};a.createEvent=function(e,...t){var n={emitter:e,interrupt:null,master:null,sync:true};if(typeof t[0]==="number"){n.nice=Math.floor(t[0]);n.name=t[1];if(!n.name||typeof n.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof t[t.length-1]==="function"){n.callback=t[t.length-1];n.args=t.slice(2,-1)}else{n.args=t.slice(2)}}else{n.name=t[0];if(!n.name||typeof n.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}if(typeof t[t.length-1]==="function"){n.callback=t[t.length-1];n.args=t.slice(1,-1)}else{n.args=t.slice(1)}}return n};a.emitEvent=function(e){var t=e.emitter,n,i,r=0,s,c;if(!t.__ngev){a.init.call(t)}s=t.__ngev.states[e.name];if(s!==undefined){if(s&&e.args.length===s.args.length&&e.args.every((e,t)=>e===s.args[t])){return}t.__ngev.stateGroups[e.name].forEach(e=>{t.__ngev.states[e]=null});t.__ngev.states[e.name]=e}if(!t.__ngev.listeners[e.name]){t.__ngev.listeners[e.name]=[]}e.id=l++;e.listenersDone=0;if(e.nice===undefined||e.nice===null){e.nice=t.__ngev.nice}if(!e.listeners){e.listeners=t.__ngev.listeners[e.name].slice()}o.recursions++;e.depth=t.__ngev.depth++;c=[];try{for(n=0,i=e.listeners.length;n<i;n++){r++;a.emitToOneListener(e,e.listeners[n],c)}}catch(e){o.recursions--;t.__ngev.depth--;throw e}o.recursions--;if(!e.callback){t.__ngev.depth--}if(c.length&&t.__ngev.listeners.removeListener.length){t.emit("removeListener",c)}if(!r){if(e.name==="error"){if(e.args[0]){throw e.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(e.callback){a.emitCallback(e)}}e.sync=false;return e};a.emitIntricatedEvents=function(e,t){var n,i,r=0,s;if(!Array.isArray(e)){throw new TypeError(".emitCorrelatedEvents() argument should be an array")}var c=[],u={nice:a.DESYNC,ready:true,status:a.CONTEXT_ENABLED,serial:true,scopes:{}},h={sync:false,nice:a.DESYNC,context:u,interrupt:null,listeners:c,listenersDone:0,depth:0,callback:t};e.forEach(e=>{var t=a.createEvent(...e);t.master=h;if(!t.emitter.__ngev){a.init.call(t.emitter)}if(!t.emitter.__ngev.listeners[t.name]){t.emitter.__ngev.listeners[t.name]=[]}t.listeners=t.emitter.__ngev.listeners[t.name].slice();t.id=l++;t.listeners.forEach(e=>c.push({event:t,listener:e}))});c.sort((e,t)=>t.listener.priority-e.listener.priority);o.recursions++;s=[];try{for(n=0,i=c.length;n<i;n++){r++;a.emitToOneListener(c[n].event,c[n].listener,s)}}catch(e){o.recursions--;throw e}o.recursions--;if(!r&&h.callback){a.emitCallback(event)}h.sync=false};a.emitToOneListener=function(e,t,n){var i=e.emitter,r=e.master||e,s=e.master?e.master.context:t.context,o,l,c,u=false;if(s){if(s.status===a.CONTEXT_DISABLED){return}c=Math.max(r.nice,t.nice,s.nice);l=s.serial;o=a.getContextScope(s,r.depth)}else{c=Math.max(r.nice,t.nice)}if(t.once){i.__ngev.listeners[e.name]=i.__ngev.listeners[e.name].filter(a.filterOutCallback.bind(undefined,t));if(n){n.push(t)}else{u=true}}if(s&&(s.status===a.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:e,listener:t,nice:c})}else{a.listenerWrapper(t,e,o,l,c)}if(u&&i.__ngev.listeners.removeListener.length){i.emit("removeListener",[t])}};a.emitCallback=function(e){var t;if(e.master){t=e.master.callback;delete e.master.callback;if(e.master.sync){s(()=>t(e.master.interrupt,e))}else{t(e.master.interrupt,e)}return}t=e.callback;delete e.callback;if(e.sync&&e.emitter.__ngev.nice!==a.SYNC){e.emitter.__ngev.desync(()=>{e.emitter.__ngev.depth--;t(e.interrupt,e)})}else{e.emitter.__ngev.depth--;t(e.interrupt,e)}};a.prototype.listeners=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].slice()};a.listenerCount=function(e,t){if(!e||!(e instanceof a)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};a.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};a.prototype.setNice=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.nice=Math.floor(+e||0)};a.prototype.desyncUseNextTick=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.desync=e?s:r};a.prototype.setInterruptible=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.interruptible=!!e};a.prototype.setListenerPriority=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.hasListenerPriority=!!e};a.share=function(e,t){if(!(e instanceof a)||!(t instanceof a)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){a.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};a.reset=function(e){Object.defineProperty(e,"__ngev",{configurable:true,value:null})};a.prototype.getMaxListeners=function(){if(!this.__ngev){a.init.call(this)}return this.__ngev.maxListeners};a.prototype.setMaxListeners=function(e){if(!this.__ngev){a.init.call(this)}this.__ngev.maxListeners=typeof e==="number"&&!Number.isNaN(e)?Math.floor(e):a.defaultMaxListeners;return this};a.noop=(()=>undefined);a.prototype.defineStates=function(...e){if(!this.__ngev){a.init.call(this)}e.forEach(t=>{this.__ngev.states[t]=null;this.__ngev.stateGroups[t]=e})};a.prototype.hasState=function(e){if(!this.__ngev){a.init.call(this)}return!!this.__ngev.states[e]};a.prototype.getAllStates=function(){if(!this.__ngev){a.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>this.__ngev.states[e])};a.groupAddListener=function(e,t,n,i){if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}n=n||i.fn;delete i.fn;i.id=i.id||n;e.forEach(e=>{e.addListener(t,n.bind(undefined,e),i)})};a.groupOn=a.groupAddListener;a.groupOnce=function(e,t,n,i){if(n&&typeof n==="object"){n.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.groupAddListener(e,t,n,i)};a.groupWaitFor=function(e,t){return Promise.all(e.map(e=>e.waitFor(t)))};a.groupWaitForAll=function(e,t){return Promise.all(e.map(e=>e.waitForAll(t)))};a.groupOnceFirst=function(e,t,n,i){var r,s=false;if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}n=n||i.fn;delete i.fn;i.id=i.id||n;r=((...r)=>{if(s){return}s=true;a.groupRemoveListener(e,t,i.id);n(...r)});e.forEach(e=>{e.once(t,r.bind(undefined,e),i)})};a.groupWaitForFirst=function(e,t){return new Promise(n=>{a.groupOnceFirst(e,t,e=>n(e))})};a.groupWaitForFirstAll=function(e,t){return new Promise(n=>{a.groupOnceFirst(e,t,(...e)=>n(e))})};a.groupOnceLast=function(e,t,n,i){var r,s=false,o=e.length;if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}n=n||i.fn;delete i.fn;i.id=i.id||n;r=((...e)=>{if(s){return}if(--o){return}s=true;n(...e)});e.forEach(e=>{e.once(t,r.bind(undefined,e),i)})};a.groupWaitForLast=function(e,t){return new Promise(n=>{a.groupOnceLast(e,t,e=>n(e))})};a.groupWaitForLastAll=function(e,t){return new Promise(n=>{a.groupOnceLast(e,t,(...e)=>n(e))})};a.groupRemoveListener=function(e,t,n){e.forEach(e=>{e.removeListener(t,n)})};a.groupOff=a.groupRemoveListener;a.groupRemoveAllListeners=function(e,t){e.forEach(e=>{e.removeAllListeners(t)})};a.groupEmit=function(e,...t){var n,i,r=1,s,o=e.length,l,c,u=false;if(typeof t[t.length-1]==="function"){s=-1;l=t[t.length-1];c=(e=>{if(u){return}if(e){u=true;l(e)}else if(!--o){u=true;l()}})}if(typeof t[0]==="number"){r=2;i=typeof t[0]}n=t[r-1];t=t.slice(r,s);e.forEach(e=>{a.emitEvent({emitter:e,name:n,args:t,nice:i,callback:c})})};a.groupWaitForEmit=function(e,...t){return new Promise(n=>{a.groupEmit(e,...t,e=>n(e))})};a.groupDefineStates=function(e,...t){e.forEach(e=>{e.defineStates(...t)})};a.groupGlobalOnce=a.groupOnceFirst;a.groupGlobalOnceAll=a.groupOnceLast;a.CONTEXT_ENABLED=0;a.CONTEXT_DISABLED=1;a.CONTEXT_QUEUED=2;a.prototype.addListenerContext=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!t||typeof t!=="object"){t={}}var n=this.__ngev.contexts[e];if(!n){n=this.__ngev.contexts[e]={nice:a.SYNC,ready:true,status:a.CONTEXT_ENABLED,serial:false,scopes:{}}}if(t.nice!==undefined){n.nice=Math.floor(t.nice)}if(t.status!==undefined){n.status=t.status}if(t.serial!==undefined){n.serial=!!t.serial}return n};a.prototype.getListenerContext=function(e){return this.__ngev.contexts[e]};a.getContextScope=function(e,t){var n=e.scopes[t];if(!n){n=e.scopes[t]={ready:true,queue:[]}}return n};a.prototype.disableListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=a.CONTEXT_DISABLED;return this};a.prototype.enableListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}var t=this.__ngev.contexts[e];t.status=a.CONTEXT_ENABLED;Object.values(t.scopes).forEach(e=>{if(e.queue.length>0){a.processScopeQueue(e,t.serial)}});return this};a.prototype.queueListenerContext=function(e){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=a.CONTEXT_QUEUED;return this};a.prototype.serializeListenerContext=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].serial=t===undefined?true:!!t;return this};a.prototype.setListenerContextNice=function(e,t){if(!this.__ngev){a.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].nice=Math.floor(t);return this};a.prototype.destroyListenerContext=function(e){var t,n,i,r,s,o=[];if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){a.init.call(this)}i=this.__ngev.contexts[e];if(!i){return}for(r in this.__ngev.listeners){s=null;n=this.__ngev.listeners[r].length;for(t=0;t<n;t++){if(this.__ngev.listeners[r][t].context===i){s=[];o.push(this.__ngev.listeners[r][t])}else if(s){s.push(this.__ngev.listeners[r][t])}}if(s){this.__ngev.listeners[r]=s}}delete this.__ngev.contexts[e];if(o.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",o)}return this};a.processScopeQueue=function(e,t,n){var i,r,s,l;if(n){e.ready=true}o.recursions++;while(e.ready&&e.queue.length){i=e.queue.shift();r=i.event;s=r.master||r;l=r.emitter;if(s.interrupt){continue}a.listenerWrapper(i.listener,r,e,t,i.nice)}o.recursions--};a.on=a.prototype.on;a.once=a.prototype.once;a.off=a.prototype.off;if(i.AsyncTryCatch){a.prototype.asyncTryCatchId=i.AsyncTryCatch.NextGenEvents.length;i.AsyncTryCatch.NextGenEvents.push(a);if(i.AsyncTryCatch.substituted){i.AsyncTryCatch.substitute()}}a.Proxy=e("./Proxy.js")}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{"../package.json":12,"./Proxy.js":10,_process:13,timers:31}],10:[function(e,t,n){"use strict";function i(){this.localServices={};this.remoteServices={};this.nextAckId=1}t.exports=i;var r=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}i.create=((...e)=>new i(...e));i.prototype.addLocalService=function(e,t,n){this.localServices[e]=a.create(this,e,t,n);return this.localServices[e]};i.prototype.addRemoteService=function(e){this.remoteServices[e]=l.create(this,e);return this.remoteServices[e]};i.prototype.destroy=function(){Object.keys(this.localServices).forEach(e=>{this.localServices[e].destroy();delete this.localServices[e]});Object.keys(this.remoteServices).forEach(e=>{this.remoteServices[e].destroy();delete this.remoteServices[e]});this.receive=this.send=o};i.prototype.push=function(e){if(e.__type!==s||!e.service||typeof e.service!=="string"||!e.event||typeof e.event!=="string"||!e.method){return}switch(e.method){case"event":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveEvent(e);case"ackEmit":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveAckEmit(e);case"emit":return this.localServices[e.service]&&this.localServices[e.service].receiveEmit(e);case"listen":return this.localServices[e.service]&&this.localServices[e.service].receiveListen(e);case"ignore":return this.localServices[e.service]&&this.localServices[e.service].receiveIgnore(e);case"ackEvent":return this.localServices[e.service]&&this.localServices[e.service].receiveAckEvent(e);default:return}};i.prototype.receive=function(e){this.push(e)};i.prototype.send=function(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,n,i){return a.create(e,t,n,i)}i.LocalService=a;a.create=function(e,t,n,i){var s=Object.create(a.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:n,writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!i.listen,writable:true,enumerable:true},canEmit:{value:!!i.emit,writable:true,enumerable:true},canAck:{value:!!i.ack,writable:true,enumerable:true},canRpc:{value:!!i.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return s};a.prototype.destroy=function(){Object.keys(this.events).forEach(e=>{this.emitter.off(e,this.events[e]);delete this.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function(e){if(this.destroyed||!this.canEmit||e.ack&&!this.canAck){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(t=>{this.proxy.send({__type:s,service:this.id,method:"ackEmit",ack:e.ack,event:e.event,interruption:t})})}r.emitEvent(t)};a.prototype.receiveListen=function(e){if(this.destroyed||!this.canListen||e.ack&&!this.canAck){return}if(e.ack){if(this.events[e.event]){if(this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forwardWithAck.bind(this);this.events[e.event].ack=true;this.emitter.on(e.event,this.events[e.event],{eventObject:true,async:true})}else{if(this.events[e.event]){if(!this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=a.forward.bind(this);this.events[e.event].ack=false;this.emitter.on(e.event,this.events[e.event],{eventObject:true})}};a.prototype.receiveIgnore=function(e){if(this.destroyed||!this.canListen){return}if(!this.events[e.event]){return}this.emitter.off(e.event,this.events[e.event]);this.events[e.event]=null};a.prototype.receiveAckEvent=function(e){if(this.destroyed||!this.canListen||!this.canAck||!e.ack||!this.events[e.event]||!this.events[e.event].ack){return}this.internalEvents.emit("ack",e)};a.forward=function(e){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,args:e.args})};a.forward.ack=false;a.forwardWithAck=function(e,t){if(this.destroyed){return}if(!e.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,args:e.args});t();return}var n=false;var i=this.proxy.nextAckId++;var r=e=>{if(n||e.ack!==i){return}n=true;this.internalEvents.off("ack",r);t()};this.internalEvents.on("ack",r);this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,ack:i,args:e.args})};a.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}i.RemoteService=l;var c=1;var u=2;l.create=function(e,t){var n=Object.create(l.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:Object.create(r.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return n};l.prototype.destroy=function(){this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(e=>{delete this.events[e]});this.destroyed=true};l.prototype.emit=function(e,...t){if(this.destroyed){return}var n,i,r;if(typeof e==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof t[t.length-1]!=="function"){this.proxy.send({__type:s,service:this.id,method:"emit",event:e,args:t});return}n=t.pop();i=this.proxy.nextAckId++;r=false;var o=e=>{if(r||e.ack!==i){return}r=true;this.internalEvents.off("ack",o);n(e.interruption)};this.internalEvents.on("ack",o);this.proxy.send({__type:s,service:this.id,method:"emit",ack:i,event:e,args:t})};l.prototype.addListener=function(e,t,n){if(this.destroyed){return}if(typeof t!=="function"){n=t;t=undefined}if(!n||typeof n!=="object"){n={}}n.fn=t||n.fn;this.emitter.addListener(e,n);if(!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length){return}if(n.async&&this.events[e]!==u){this.events[e]=u;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:e})}else if(!n.async&&!this.events[e]){this.events[e]=c;this.proxy.send({__type:s,service:this.id,method:"listen",event:e})}};l.prototype.on=l.prototype.addListener;l.prototype.once=r.prototype.once;l.prototype.removeListener=function(e,t){if(this.destroyed){return}this.emitter.removeListener(e,t);if((!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length)&&this.events[e]){this.events[e]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:e})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function(e){if(this.destroyed||!this.events[e.event]){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(()=>{this.proxy.send({__type:s,service:this.id,method:"ackEvent",ack:e.ack,event:e.event})})}r.emitEvent(t);var n=t.name;if(!this.emitter.__ngev.listeners[n]||!this.emitter.__ngev.listeners[n].length){this.events[n]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:n})}};l.prototype.receiveAckEmit=function(e){if(this.destroyed||!e.ack||this.events[e.event]!==u){return}this.internalEvents.emit("ack",e)}},{"./NextGenEvents.js":9}],11:[function(e,t,n){(function(n){"use strict";if(typeof window.setImmediate!=="function"){window.setImmediate=(e=>setTimeout(e,0))}if(!n.emitWarning){n.emitWarning=(()=>undefined)}t.exports=e("./NextGenEvents.js");t.exports.isBrowser=true}).call(this,e("_process"))},{"./NextGenEvents.js":9,_process:13}],12:[function(e,t,n){t.exports={_from:"nextgen-events@^1.2.1",_id:"nextgen-events@1.3.0",_inBundle:false,_integrity:"sha512-eBz5mrO4Hw2eenPVm0AVPHuAzg/RZetAWMI547RH8O9+a0UYhCysiZ3KoNWslnWNlHetb9kzowEshsKsmFo2YQ==",_location:"/nextgen-events",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"nextgen-events@^1.2.1",name:"nextgen-events",escapedName:"nextgen-events",rawSpec:"^1.2.1",saveSpec:null,fetchSpec:"^1.2.1"},_requiredBy:["#USER","/","/server-kit","/terminal-kit"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-1.3.0.tgz",_shasum:"a32665d1ab6f026448b19d75c4603ec20292fa22",_spec:"nextgen-events@^1.2.1",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cédric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},bundleDependencies:false,config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2019],owner:"Cédric Ronvel"},dependencies:{},deprecated:false,description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^16.2.2","uglify-js-es6":"^2.8.9",ws:"^5.1.1"},directories:{test:"test"},engines:{node:">=6.0.0"},homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",name:"nextgen-events",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"tea-time -R dot"},version:"1.3.0"}},{}],13:[function(e,t,n){var i=t.exports={};var r;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=o}}catch(e){r=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(e){s=a}})();function l(e){if(r===setTimeout){return setTimeout(e,0)}if((r===o||!r)&&setTimeout){r=setTimeout;return setTimeout(e,0)}try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}function c(e){if(s===clearTimeout){return clearTimeout(e)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var u=[];var h=false;var f;var p=-1;function d(){if(!h||!f){return}h=false;if(f.length){u=f.concat(u)}else{p=-1}if(u.length){m()}}function m(){if(h){return}var e=l(d);h=true;var t=u.length;while(t){f=u;u=[];while(++p<t){if(f){f[p].run()}}p=-1;t=u.length}f=null;h=false;c(e)}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}u.push(new g(e,t));if(u.length===1&&!h){l(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function y(){}i.on=y;i.addListener=y;i.once=y;i.off=y;i.removeListener=y;i.removeAllListeners=y;i.emit=y;i.prependListener=y;i.prependOnceListener=y;i.listeners=function(e){return[]};i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}],14:[function(t,n,i){(function(t){(function(r){var s=typeof i=="object"&&i&&!i.nodeType&&i;var o=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){r=a}var l,c=2147483647,u=36,h=1,f=26,p=38,d=700,m=72,g=128,y="-",v=/^xn--/,b=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=u-h,k=Math.floor,S=String.fromCharCode,C;function L(e){throw new RangeError(w[e])}function j(e,t){var n=e.length;var i=[];while(n--){i[n]=t(e[n])}return i}function $(e,t){var n=e.split("@");var i="";if(n.length>1){i=n[0]+"@";e=n[1]}e=e.replace(x,".");var r=e.split(".");var s=j(r,t).join(".");return i+s}function A(e){var t=[],n=0,i=e.length,r,s;while(n<i){r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((r&1023)<<10)+(s&1023)+65536)}else{t.push(r);n--}}else{t.push(r)}}return t}function E(e){return j(e,function(e){var t="";if(e>65535){e-=65536;t+=S(e>>>10&1023|55296);e=56320|e&1023}t+=S(e);return t}).join("")}function T(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function I(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function M(e,t,n){var i=0;e=n?k(e/d):e>>1;e+=k(e/t);for(;e>_*f>>1;i+=u){e=k(e/_)}return k(i+(_+1)*e/(e+p))}function O(e){var t=[],n=e.length,i,r=0,s=g,o=m,a,l,p,d,v,b,x,w,_;a=e.lastIndexOf(y);if(a<0){a=0}for(l=0;l<a;++l){if(e.charCodeAt(l)>=128){L("not-basic")}t.push(e.charCodeAt(l))}for(p=a>0?a+1:0;p<n;){for(d=r,v=1,b=u;;b+=u){if(p>=n){L("invalid-input")}x=T(e.charCodeAt(p++));if(x>=u||x>k((c-r)/v)){L("overflow")}r+=x*v;w=b<=o?h:b>=o+f?f:b-o;if(x<w){break}_=u-w;if(v>k(c/_)){L("overflow")}v*=_}i=t.length+1;o=M(r-d,i,d==0);if(k(r/i)>c-s){L("overflow")}s+=k(r/i);r%=i;t.splice(r++,0,s)}return E(t)}function N(e){var t,n,i,r,s,o,a,l,p,d,v,b=[],x,w,_,C;e=A(e);x=e.length;t=g;n=0;s=m;for(o=0;o<x;++o){v=e[o];if(v<128){b.push(S(v))}}i=r=b.length;if(r){b.push(y)}while(i<x){for(a=c,o=0;o<x;++o){v=e[o];if(v>=t&&v<a){a=v}}w=i+1;if(a-t>k((c-n)/w)){L("overflow")}n+=(a-t)*w;t=a;for(o=0;o<x;++o){v=e[o];if(v<t&&++n>c){L("overflow")}if(v==t){for(l=n,p=u;;p+=u){d=p<=s?h:p>=s+f?f:p-s;if(l<d){break}C=l-d;_=u-d;b.push(S(I(d+C%_,0)));l=k(C/_)}b.push(S(I(l,0)));s=M(n,w,i==r);n=0;++i}}++n;++t}return b.join("")}function G(e){return $(e,function(e){return v.test(e)?O(e.slice(4).toLowerCase()):e})}function B(e){return $(e,function(e){return b.test(e)?"xn--"+N(e):e})}l={version:"1.4.1",ucs2:{decode:A,encode:E},decode:O,encode:N,toASCII:B,toUnicode:G};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return l})}else if(s&&o){if(n.exports==s){o.exports=l}else{for(C in l){l.hasOwnProperty(C)&&(s[C]=l[C])}}}else{r.punycode=l}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],15:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var l=1e3;if(s&&typeof s.maxKeys==="number"){l=s.maxKeys}var c=e.length;if(l>0&&c>l){c=l}for(var u=0;u<c;++u){var h=e[u].replace(a,"%20"),f=h.indexOf(n),p,d,m,g;if(f>=0){p=h.substr(0,f);d=h.substr(f+1)}else{p=h;d=""}m=decodeURIComponent(p);g=decodeURIComponent(d);if(!i(o,m)){o[m]=g}else if(r(o[m])){o[m].push(g)}else{o[m]=[o[m],g]}}return o};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],16:[function(e,t,n){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(i(o))+n;if(r(e[o])){return s(e[o],function(e){return a+encodeURIComponent(i(e))}).join(t)}else{return a+encodeURIComponent(i(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(i(a))+n+encodeURIComponent(i(e))};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var i=0;i<e.length;i++){n.push(t(e[i],i))}return n}var o=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],17:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":15,"./encode":16}],18:[function(e,t,n){(function(e,t){(function(t,n){"use strict";if(t.setImmediate){return}var i=1;var r={};var s=false;var o=t.document;var a;function l(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var n=0;n<t.length;n++){t[n]=arguments[n+1]}var s={callback:e,args:t};r[i]=s;a(i);return i++}function c(e){delete r[e]}function u(e){var t=e.callback;var i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i);break}}function h(e){if(s){setTimeout(h,0,e)}else{var t=r[e];if(t){s=true;try{u(t)}finally{c(e);s=false}}}}function f(){a=function(t){e.nextTick(function(){h(t)})}}function p(){if(t.postMessage&&!t.importScripts){var e=true;var n=t.onmessage;t.onmessage=function(){e=false};t.postMessage("","*");t.onmessage=n;return e}}function d(){var e="setImmediate$"+Math.random()+"$";var n=function(n){if(n.source===t&&typeof n.data==="string"&&n.data.indexOf(e)===0){h(+n.data.slice(e.length))}};if(t.addEventListener){t.addEventListener("message",n,false)}else{t.attachEvent("onmessage",n)}a=function(n){t.postMessage(e+n,"*")}}function m(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;h(t)};a=function(t){e.port2.postMessage(t)}}function g(){var e=o.documentElement;a=function(t){var n=o.createElement("script");n.onreadystatechange=function(){h(t);n.onreadystatechange=null;e.removeChild(n);n=null};e.appendChild(n)}}function y(){a=function(e){setTimeout(h,0,e)}}var v=Object.getPrototypeOf&&Object.getPrototypeOf(t);v=v&&v.setTimeout?v:t;if({}.toString.call(t.process)==="[object process]"){f()}else if(p()){d()}else if(t.MessageChannel){m()}else if(o&&"onreadystatechange"in o.createElement("script")){g()}else{y()}v.setImmediate=l;v.clearImmediate=c})(typeof self==="undefined"?typeof t==="undefined"?this:t:self)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:13}],19:[function(e,t,n){"use strict";var i=e("./seventh.js");i.promisifyNodeApi=((e,t,n,r,s)=>{var o;t=t||"Async";n=n||"AsyncAll";r=r||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(s){o=[];for(let t in e){if(typeof e[t]==="function"){o.push(t)}}}else{o=Object.keys(e)}o.filter(t=>{if(typeof e[t]!=="function"){return false}for(let n in e[t].prototype){return false}return r(t,e)}).forEach(r=>{const s=r+t;const o=r+n;if(!e[s]){e[s]=i.promisify(e[r],e)}if(!e[o]){e[o]=i.promisifyAll(e[r],e)}})});i.promisifyAnyNodeApi=((e,t,n,r)=>{i.promisifyNodeApi(e,t,n,r,true)})},{"./seventh.js":25}],20:[function(e,t,n){"use strict";var i=e("./seventh.js");const r={};function s(){}i.all=(e=>{var t=-1,n=false,r=0,s=Infinity,o,a=[],l=new i;for(o of e){if(n){break}t++;(()=>{const e=t;i.resolve(o).then(t=>{if(n){return}a[e]=t;r++;if(r>=s){n=true;l._resolveValue(a)}},e=>{if(n){return}n=true;l.reject(e)})})()}s=t+1;if(!s){l._resolveValue(a)}return l});i._allArray=(e=>{var t=e.length;if(!t){i._resolveValue([])}var n,r={settled:false,count:0,length:t,values:[],allPromise:new i};for(n=0;!r.settled&&n<t;n++){i._allArrayOne(e[n],n,r)}return r.allPromise});i._allArrayOne=((e,t,n)=>{i._bareThen(e,e=>{if(n.settled){return}n.values[t]=e;n.count++;if(n.count>=n.length){n.settled=true;n.allPromise._resolveValue(n.values)}},e=>{if(n.settled){return}n.settled=true;n.allPromise.reject(e)})});i.every=i.map=((e,t)=>{var n=-1,r=false,s=0,o=Infinity,a,l=[],c=new i;for(a of e){if(r){break}n++;(()=>{const e=n;i.resolve(a).then(n=>{if(r){return}return t(n,e)}).then(t=>{if(r){return}l[e]=t;s++;if(s>=o){r=true;c._resolveValue(l)}},e=>{if(r){return}r=true;c.reject(e)})})()}o=n+1;if(!o){c._resolveValue(l)}return c});i.any=(e=>{var t=-1,n=false,r=0,s=Infinity,o,a=[],l=new i;for(o of e){if(n){break}t++;(()=>{const e=t;i.resolve(o).then(e=>{if(n){return}n=true;l._resolveValue(e)},t=>{if(n){return}a[e]=t;r++;if(r>=s){n=true;l.reject(a)}})})()}s=t+1;if(!s){l.reject(new RangeError("Promise.any(): empty array"))}return l});i.some=((e,t)=>{var n=-1,r=false,s=0,o=Infinity,a,l=[],c=new i;for(a of e){if(r){break}n++;(()=>{const e=n;i.resolve(a).then(n=>{if(r){return}return t(n,e)}).then(e=>{if(r){return}r=true;c._resolveValue(e)},t=>{if(r){return}l[e]=t;s++;if(s>=o){r=true;c.reject(l)}})})()}o=n+1;if(!o){c.reject(new RangeError("Promise.any(): empty array"))}return c});i.filter=((e,t)=>{var n=-1,s=false,o=0,a=Infinity,l,c=[],u=new i;for(l of e){if(s){break}n++;(()=>{const e=n;i.resolve(l).then(n=>{if(s){return}c[e]=n;return t(n,e)}).then(t=>{if(s){return}o++;if(!t){c[e]=r}if(o>=a){s=true;c=c.filter(e=>e!==r);u._resolveValue(c)}},e=>{if(s){return}s=true;u.reject(e)})})()}a=n+1;if(!a){u._resolveValue(c)}else if(o>=a){s=true;c=c.filter(e=>e!==r);u._resolveValue(c)}return u});i.foreach=i.forEach=function(e,t,n){var r=-1,o=arguments.length>=3,a=e[Symbol.iterator](),l=new i,c=i.resolve(n);if(i.warnUnhandledRejection){i._handleAll(e)}var u=()=>{c.then(e=>{let{value:n,done:s}=a.next();r++;if(s){l.resolve(e)}else{c=i.resolve(n).then(o?n=>t(e,n,r):e=>t(e,r));u()}},e=>{l.reject(e);for(;;){let{value:e,done:t}=a.next();if(t){break}if(i.isThenable(e)){e.then(s,s)}}})};u();return l};i.reduce=((e,t,n)=>{return i.forEach(e,t,n)});i.mapObject=((e,t)=>{var n=false,r=0,s,o,a=Object.keys(e),l=a.length,c,u={},h=new i;for(s=0;!n&&s<l;s++){o=a[s];c=e[o];(()=>{const e=o;i.resolve(c).then(i=>{if(n){return}return t(i,e)}).then(t=>{if(n){return}u[e]=t;r++;if(r>=l){n=true;h._resolveValue(u)}},e=>{if(n){return}n=true;h.reject(e)})})()}if(!l){h._resolveValue(u)}return h});i.concurrent=((e,t,n)=>{var r=-1,s=false,o=0,a=0,l=Infinity,c,u=false,h=[],f=t[Symbol.iterator](),p=new i;if(i.warnUnhandledRejection){i._handleAll(t)}e=e||1;const d=()=>{while(!u&&o<e){({value:c,done:u}=f.next());if(u){l=r+1;if(a>=l){s=true;p._resolveValue(h);return}break}if(s){break}r++;(()=>{const t=r;o++;i.resolve(c).then(e=>{if(s){return}return n(e,t)}).then(n=>{if(s){return}h[t]=n;a++;o--;if(a>=l){s=true;p._resolveValue(h);return}if(o<e){d();return}},e=>{if(s){return}s=true;p.reject(e)})})()}};d();if(r<0){p._resolveValue(h)}return p});i.race=(e=>{var t=false,n,r=new i;for(n of e){if(t){break}i.resolve(n).then(e=>{if(t){return}t=true;r._resolveValue(e)},e=>{if(t){return}t=true;r.reject(e)})}return r})},{"./seventh.js":25}],21:[function(e,t,n){(function(n,i,r){"use strict";const s=i.Promise;var o;if(!n.browser){o=n.nextTick}else{e("setimmediate");o=r}function a(e){this.fn=e;this._then=a._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}t.exports=a;a.Native=s;a.warnUnhandledRejection=true;a.prototype._exec=function(){this._then=a._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};a.prototype.resolve=a.prototype.fulfill=function(e){if(this._then.settled){return this}if(a.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};a.prototype._resolveValue=function(e){this._then=a._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};a.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};a.prototype.reject=function(e){if(this._then.settled){return this}this._then=a._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(a.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};a.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};a.prototype._execOneFulfillHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};a.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};a.prototype._execOneRejectHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};a.prototype.resolveTimeout=a.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};a.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};a._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var n=new a;if(!this.thenHandlers){this.thenHandlers=[n,e,t]}else{this.thenHandlers[this.thenHandlers.length]=n;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return n};a._dormantThen.settled=false;a._pendingThen=function(e,t){var n=new a;if(!this.thenHandlers){this.thenHandlers=[n,e,t]}else{this.thenHandlers[this.thenHandlers.length]=n;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return n};a._pendingThen.settled=false;a._fulfilledThen=function(e){if(!e){return this}var t=new a;o(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};a._fulfilledThen.settled=true;a._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var n=new a;o(()=>{try{n.resolve(t(this.value))}catch(e){n.reject(e)}});return n};a._rejectedThen.settled=true;a.prototype.then=function(e,t){return this._then(e,t)};a.prototype.catch=function(e=(()=>undefined)){return this._then(undefined,e)};a.prototype.finally=function(e){return this._then(e,e)};a.prototype.tap=a.prototype.tapThen=function(e){this._then(e,undefined);return this};a.prototype.tapCatch=function(e){this._then(undefined,e);return this};a.prototype.tapFinally=function(e){this._then(e,e);return this};a.prototype.fatal=function(){this._then(undefined,e=>{o(()=>{throw e})})};a.prototype.done=function(e,t){this._then(e,t).fatal();return this};a.prototype.callback=function(e){this._then(t=>{e(undefined,t)},t=>{e(t)}).fatal();return this};a.prototype.callbackAll=function(e){this._then(t=>{if(Array.isArray(t)){e(undefined,...t)}else{e(undefined,t)}},t=>{e(t)}).fatal();return this};a.callback=function(e){return new a((t,n)=>{e((e,i)=>{if(e){n(e)}else{t(i)}})})};a.callbackAll=function(e){return new a((t,n)=>{e((e,...i)=>{if(e){n(e)}else{t(i)}})})};a.prototype.toPromise=a.prototype.propagate=function(e){this._then(t=>{e.resolve(t)},t=>{e.reject(t)});return this};a.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};a.finally=function(e,t){return e.then(t,t)};a.resolve=a.fulfill=function(e){if(a.isThenable(e)){return a.fromThenable(e)}return a._resolveValue(e)};a._resolveValue=function(e){var t=new a;t._then=a._fulfilledThen;t.value=e;return t};a.reject=function(e){var t=new a;t._then=a._rejectedThen;t.value=e;return t};a.resolveTimeout=a.fulfillTimeout=function(e,t){return new a(n=>setTimeout(()=>n(t),e))};a.rejectTimeout=function(e,t){return new a((n,i)=>setTimeout(()=>i(t),e))};a.resolveNextTick=a.fulfillNextTick=function(e){return new a(t=>o(()=>t(e)))};a.rejectNextTick=function(e){return new a((t,n)=>o(()=>n(e)))};a.dormant=function(e){var t=new a;t.fn=e;return t};a.try=function(e){try{return a.resolve(e())}catch(e){return a.reject(e)}};a.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};a.fromThenable=function(e){if(e instanceof a){return e}return new a((t,n)=>{e.then(e=>{t(e)},e=>{n(e)})})};a._bareThen=function(e,t,n){if(e&&typeof e==="object"){if(e instanceof a){if(e._then===a._fulfilledThen){t(e.value)}else if(e._then===a._rejectedThen){n(e.value)}else{e._then(t,n)}}else if(typeof e.then==="function"){e.then(t,n)}else{t(e)}}else{t(e)}};a._handleAll=function(e){var t;for(t of e){if(a.isThenable(t)){t.handledRejection=true}}};a.prototype._unhandledRejection=function(){this.handledRejection=false;const e=e=>setTimeout(e,0);if(this.value instanceof Error){e(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let t=new Error("Unhandled promise rejection");e(()=>{if(this.handledRejection===false){console.error(t);console.error("Rejection reason:",this.value)}})}};a.prototype.getStatus=function(){switch(this._then){case a._dormantThen:return"dormant";case a._pendingThen:return"pending";case a._fulfilledThen:return"fulfilled";case a._rejectedThen:return"rejected"}};a.prototype.inspect=function(){switch(this._then){case a._dormantThen:return"Promise { <DORMANT> }";case a._pendingThen:return"Promise { <PENDING> }";case a._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case a._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};a.resolved=a.dummy=a.resolve();if(n.browser){a.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};a.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};a.resolveAtAnimationFrame=function(e){return new a(t=>window.requestAnimationFrame(()=>t(e)))};a.rejectAtAnimationFrame=function(e){return new a((t,n)=>window.requestAnimationFrame(()=>n(e)))}}}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{_process:13,setimmediate:18,timers:31}],22:[function(e,t,n){"use strict";var i=e("./seventh.js");i.promisifyAll=((e,t)=>{if(t){return(...n)=>{return new i((i,r)=>{e.call(t,...n,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}r(e)}else{i(t)}})})}}return function(...t){return new i((n,i)=>{e.call(this,...t,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}i(e)}else{n(t)}})})}});i.promisify=((e,t)=>{if(t){return(...n)=>{return new i((i,r)=>{e.call(t,...n,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}r(e)}else{i(t)}})})}}return function(...t){return new i((n,i)=>{e.call(this,...t,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}i(e)}else{n(t)}})})}});i.returnValueInterceptor=((e,t,n)=>{return function(...i){var r=t.call(n||this,...i);e(r);return r}});i.once=((e,t)=>{var n=false;var i;return function(...r){if(!n){n=true;i=e.call(t||this,...r)}return i}});i.serialize=((e,t)=>{var n=new i.resolve;return function(...r){var s=new i;n.finally(()=>{i.propagate(e.call(t||this,...r),s)});n=s;return s}});i.debounce=((e,t)=>{var n=null;const r=()=>{n=null};return function(...s){if(n){return n}n=e.call(t||this,...s);i.finally(n,r);return n}});i.debounceUpdate=((e,t)=>{var n=null;var r=null;var s=null;const o=()=>{var t,a;n=null;if(r){t=r;r=null;a=s;s=null;n=e.call(...t);i.propagate(n,a);i.finally(n,o);return n}};return function(...a){var l=t||this;if(n){if(!s){s=new i}r=[l,...a];return s}n=e.call(l,...a);i.finally(n,o);return n}});i.debounceSync=((e,t)=>{var n=new Map;const r=e=>{var t=n.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null};n.set(e,t)}return t};const s=(e,n)=>{var r,o,a,l=new Date;e.inProgress=null;if(n>=2){e.lastFullSyncTime=e.lastTime=l}else if(n>=1){e.lastTime=l}if(e.nextFullSyncWith){if(t.delay&&e.lastFullSyncTime&&(r=l-e.lastFullSyncTime-t.delay)<0){e.inProgress=i.resolveTimeout(-r+1);e.inProgress.finally(()=>s(e,0));return e.nextFullSyncPromise}o=e.nextFullSyncWith;e.nextFullSyncWith=null;a=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=t.fn.call(...o);i.propagate(e.inProgress,a);i.finally(e.inProgress,()=>s(e,2));return e.inProgress}};const o=function(t,...n){var o=e.thisBinding||this,a=r(t);if(a.inProgress){return a.inProgress}if(e.delay&&a.lastTime&&new Date-a.lastTime<e.delay){return a.last}a.last=a.inProgress=e.fn.call(o,t,...n);a.inProgressIsFull=false;i.finally(a.inProgress,()=>s(a,1));return a.inProgress};const a=function(e,...n){var o,a=t.thisBinding||this,l=r(e);if(!l.inProgress&&t.delay&&l.lastFullSyncTime&&(o=new Date-l.lastFullSyncTime-t.delay)<0){l.inProgress=i.resolveTimeout(-o+1);i.finally(l.inProgress,()=>s(l,0))}if(l.inProgress){if(!l.nextFullSyncPromise){l.nextFullSyncPromise=new i}l.nextFullSyncWith=[a,e,...n];return l.nextFullSyncPromise}l.lastFullSync=l.last=l.inProgress=t.fn.call(a,e,...n);i.finally(l.inProgress,()=>s(l,2));return l.inProgress};return[o,a]});i.timeout=((e,t,n)=>{return function(...i){var r=t.call(n||this,...i);setTimeout(()=>r.reject(new Error("Timeout")),e);return r}});i.variableTimeout=((e,t)=>{return function(n,...i){var r=e.call(t||this,...i);setTimeout(()=>r.reject(new Error("Timeout")),n);return r}})},{"./seventh.js":25}],23:[function(e,t,n){(function(t){"use strict";var n=e("./seventh.js");var i=false;n.asyncExit=function(e,r){if(i){return}i=true;var s=t.listeners("asyncExit");if(!s.length){t.exit(e);return}if(r===undefined){r=1e3}const o=t=>{if(t.length<3){t(e,r);return n.dummy}return new n(n=>{t(e,r,()=>{n()})})};n.map(s,o).finally(()=>t.exit(e));setTimeout(()=>t.exit(e),r)};n.resolveSafeTimeout=function(e,t){return new n(n=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>n(t),0)},e/2)},e/2)},0)})}}).call(this,e("_process"))},{"./seventh.js":25,_process:13}],24:[function(e,t,n){"use strict";var i=e("./seventh.js");i.parasite=(()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>i.Native.prototype[e]=i.prototype[e]);i.Native.prototype._then=i.Native.prototype.then})},{"./seventh.js":25}],25:[function(e,t,n){"use strict";const i=e("./core.js");t.exports=i;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./api.js":19,"./batch.js":20,"./core.js":21,"./decorators.js":22,"./misc.js":23,"./parasite.js":24,"./wrapper.js":26}],26:[function(e,t,n){"use strict";var i=e("./seventh.js");i.timeLimit=((e,t)=>{return new i((n,r)=>{if(typeof t==="function"){t=t()}i.resolve(t).then(n,r);setTimeout(()=>r(new Error("Timeout")),e)})});i.retry=((e,t)=>{var n=e.retries||1,r=e.coolDown||0,s=e.raiseFactor||1,o=e.maxCoolDown||Infinity,a=e.timeout||0,l=e.catch||null;const c=()=>{return(a?i.timeLimit(a,t):t()).catch(e=>{if(!n--){throw e}var t=r;r=Math.min(r*s,o);if(l){return i.resolve(l(e)).then(()=>i.resolveTimeout(t).then(c))}return i.resolveTimeout(t).then(c)})};return c()});i.onceEvent=((e,t)=>{return new i(n=>e.once(t,n))});i.onceEventAll=((e,t)=>{return new i(n=>e.once(t,(...e)=>n(e)))});i.onceEventOrError=((e,t,n)=>{return new i((i,r)=>{var s;var o=t=>{e.removeListener("error",a);if(s){for(let t in s){e.removeListener(t,s[t])}}i(t)};var a=n=>{e.removeListener(t,o);if(s){for(let t in s){e.removeListener(t,s[t])}}r(n)};e.once(t,o);e.once("error",a);if(n){if(!Array.isArray(n)){n=[n]}s={};n.forEach(n=>{var i=(...i)=>{e.removeListener("error",a);e.removeListener(t,o);var s=new Error("Received an excluded event: "+n);s.event=n;s.eventArgs=i;r(s)};e.once(n,i);s[n]=i})}})});i.onceEventAllOrError=((e,t,n)=>{return new i((i,r)=>{var s;var o=(...t)=>{e.removeListener("error",a);if(s){for(let t in s){e.removeListener(t,s[t])}}i(t)};var a=n=>{e.removeListener(t,o);if(s){for(let t in s){e.removeListener(t,s[t])}}r(n)};e.once(t,o);e.once("error",a);if(n){if(!Array.isArray(n)){n=[n]}s={};n.forEach(n=>{var i=(...i)=>{e.removeListener("error",a);e.removeListener(t,o);var s=new Error("Received an excluded event: "+n);s.event=n;s.eventArgs=i;r(s)};e.once(n,i);s[n]=i})}})})},{"./seventh.js":25}],27:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",grey:"[90m",gray:"[90m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgGrey:"[100m",bgGray:"[100m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"}},{}],28:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=(e=>e.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1"));n.regExpReplacement=(e=>e.replace(/\$/g,"$$$$"));n.format=(e=>e.replace(/%/g,"%%"));n.jsSingleQuote=(e=>n.control(e).replace(/'/g,"\\'"));n.jsDoubleQuote=(e=>n.control(e).replace(/"/g,'\\"'));n.shellArg=(e=>"'"+e.replace(/'/g,"'\\''")+"'");var i={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=((e,t=false)=>e.replace(/[\x00-\x1f\x7f]/g,e=>{if(t&&(e==="\n"||e==="\t")){return e}if(i[e]!==undefined){return i[e]}var n=e.charCodeAt(0).toString(16);if(n.length%2){n="0"+n}return"\\x"+n}));var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=(e=>e.replace(/[&<>]/g,e=>r[e]));n.htmlAttr=(e=>e.replace(/[&<>"]/g,e=>r[e]));n.htmlSpecialChars=(e=>e.replace(/[&<>"']/g,e=>r[e]));n.unicodePercentEncode=(e=>e.replace(/[\x00-\x1f\u0100-\uffff\x7f%]/g,e=>{try{return encodeURI(e)}catch(e){return""}}));n.httpHeaderValue=(e=>n.unicodePercentEncode(e))},{}],29:[function(e,t,n){(function(t){"use strict";var i=e("./inspect.js").inspect;var r=e("./inspect.js").inspectError;var s=e("./escape.js");var o=e("./ansi.js");n.formatMethod=function e(...t){var n=t[0];if(typeof n!=="string"){if(!n){n=""}else if(typeof n.toString==="function"){n=n.toString()}else{n=""}}var i,r=1,s=t.length,o=false,l=null,c=[];if(this.markupReset&&this.startingMarkupReset){n=(typeof this.markupReset==="function"?this.markupReset(c):this.markupReset)+n}n=n.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,(e,n,u,h,f,p,d)=>{var m,g,y,v,b,x,w=[];if(u){return"%"}if(n){if(this.noMarkup){return"^"+n}if(n==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[n]){l=this.shiftMarkup[n];return""}if(l){if(!this.shiftedMarkup||!this.shiftedMarkup[l]||!this.shiftedMarkup[l][n]){return""}o=true;if(typeof this.shiftedMarkup[l][n]==="function"){m=this.shiftedMarkup[l][n](c)}else{m=this.shiftedMarkup[l][n];c.push(m)}l=null}else{if(!this.markup||!this.markup[n]){return""}o=true;if(typeof this.markup[n]==="function"){m=this.markup[n](c)}else{m=this.markup[n];c.push(m)}}return m}if(f){f=parseInt(f,10);if(h){if(h==="+"){f=r+f}else if(h==="-"){f=r-f}}}else{f=r}r++;if(f>=s||f<1){i=undefined}else{i=t[f]}if(a[d]){m=a[d](i,p,this);if(this.argumentSanitizer&&!a[d].noSanitize){m=this.argumentSanitizer(m)}return m}if(d==="F"){r--;if(p===undefined){return""}y=p.split(":");v=y[0];b=y[1];if(!v){return""}if(b&&(x=b.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(g=0;g<x.length;g++){h=x[g][1];f=x[g][2];if(f){f=parseInt(f,10);if(h){if(h==="+"){f=r+f}else if(h==="-"){f=r-f}}}else{f=r}r++;if(f>=s||f<1){w[g]=undefined}else{w[g]=t[f]}}}if(!this||!this.fn||typeof this.fn[v]!=="function"){return""}return this.fn[v].apply(this,w)}return""});if(o&&this.markupReset&&this.endingMarkupReset){n+=typeof this.markupReset==="function"?this.markupReset(c):this.markupReset}if(this.extraArguments){for(;r<s;r++){i=t[r];if(i===null||i===undefined){continue}else if(typeof i==="string"){n+=i}else if(typeof i==="number"){n+=i}else if(typeof i.toString==="function"){n+=i.toString()}}}return n};var a={};a.s=(e=>{if(typeof e==="string"){return e}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return e.toString()}return"("+e+")"});a.r=(e=>a.s(e));a.r.noSanitize=true;a.S=((e,t,i)=>{var r=e=>n.markupMethod.call(i,i.argumentSanitizer?i.argumentSanitizer(e):e);if(typeof e==="string"){return r(e)}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return r(e.toString())}return r("("+e+")")});a.S.noSanitize=true;const l=/([a-zA-Z]?)(.[^a-zA-Z]*)/g;a.f=((e,t)=>{var n,i,r,s,o,a=0,c,u,h;if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}if(t){l.index=0;while(n=l.exec(t)){[,i,r]=n;if(i==="p"){h=+r}else if(r[0]==="."){s=r[r.length-1];if(s==="!"){o=parseInt(r.slice(1,-1),10);a=10**-o;c=o}else if(s==="?"){o=parseInt(r.slice(1,-1),10);a=10**-o;c=o;u=true}else{o=parseInt(r.slice(1),10);a=10**-o}}else if(r[r.length-1]==="."){o=parseInt(r.slice(0,-1),10);a=10**o}else{o=parseInt(r,10);a=10**(Math.ceil(Math.log10(e+Number.EPSILON)+Number.EPSILON)-o)}}}if(a){e=d(e,a)}if(c!==undefined&&(!u||e!==Math.trunc(e))){e=e.toFixed(c)}else{e=""+e}if(h){o=e.indexOf(".");if(o===-1){o=e.length}if(o<h){e="0".repeat(h-o)+e}}return e});a.f.noSanitize=true;a.e=((e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}if(t){return""+e.toExponential(parseInt(t,10)-1)}return""+e.toExponential()});a.e.noSanitize=true;a.d=a.i=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.floor(e)}return"0"});a.i.noSanitize=true;a.u=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0)}return"0"});a.u.noSanitize=true;a.U=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),1)}return"1"});a.U.noSanitize=true;a.k=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"0"}return v(e)});a.k.noSanitize=true;a.t=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"(NaN)"}var t=Math.floor(e/1e3);if(t<60){return t+"s"}var n=Math.floor(t/60);t=t%60;if(n<60){return n+"min"+c(t)+"s"}var i=Math.floor(n/60);n=n%60;return i+"h"+c(n)+"min"+c(t)+"s"});a.t.noSanitize=true;function c(e,t=2){e=""+e;if(e.length<t){e="0".repeat(t-e.length)+e}return e}a.h=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(16)}return"0"});a.h.noSanitize=true;a.x=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"0"}var t=""+Math.max(Math.floor(e),0).toString(16);if(t.length%2){t="0"+t}return t});a.x.noSanitize=true;a.o=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(8)}return"0"});a.o.noSanitize=true;a.b=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(2)}return"0"});a.b.noSanitize=true;a.z=(e=>{if(typeof e==="string"){e=t.from(e)}else if(!t.isBuffer(e)){return""}return e.toString("base64")});a.Z=(e=>{if(typeof e==="string"){e=t.from(e)}else if(!t.isBuffer(e)){return""}return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"")});a.I=((e,t,n)=>{var r=3;if(t!==undefined){r=parseInt(t,10)}return i({depth:r,style:n&&n.color?"color":"none"},e)});a.I.noSanitize=true;a.Y=((e,t,n)=>{var r=3;if(t!==undefined){r=parseInt(t,10)}return i({depth:r,style:n&&n.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true,useInspect:true},e)});a.Y.noSanitize=true;a.E=((e,t,n)=>r({style:n&&n.color?"color":"none"},e));a.E.noSanitize=true;a.J=(e=>e===undefined?"null":JSON.stringify(e));a.D=(()=>"");a.D.noSanitize=true;var u={argumentSanitizer:e=>s.control(e,true),extraArguments:true,color:false,noMarkup:false,endingMarkupReset:true,startingMarkupReset:false,markupReset:o.reset,shiftMarkup:{"#":"background"},markup:{":":o.reset," ":o.reset+" ","-":o.dim,"+":o.bold,_:o.underline,"/":o.italic,"!":o.inverse,b:o.blue,B:o.brightBlue,c:o.cyan,C:o.brightCyan,g:o.green,G:o.brightGreen,k:o.black,K:o.brightBlack,m:o.magenta,M:o.brightMagenta,r:o.red,R:o.brightRed,w:o.white,W:o.brightWhite,y:o.yellow,Y:o.brightYellow},shiftedMarkup:{background:{":":o.reset," ":o.reset+" ",b:o.bgBlue,B:o.bgBrightBlue,c:o.bgCyan,C:o.bgBrightCyan,g:o.bgGreen,G:o.bgBrightGreen,k:o.bgBlack,K:o.bgBrightBlack,m:o.bgMagenta,M:o.bgBrightMagenta,r:o.bgRed,R:o.bgBrightRed,w:o.bgWhite,W:o.bgBrightWhite,y:o.bgYellow,Y:o.bgBrightYellow}}};n.createFormatter=(e=>n.formatMethod.bind(Object.assign({},u,e)));n.format=n.formatMethod.bind(u);n.format.default=u;n.markupMethod=function e(t){if(typeof t!=="string"){if(!t){t=""}else if(typeof t.toString==="function"){t=t.toString()}else{t=""}}var n=false,i=null,r=[];if(this.markupReset&&this.startingMarkupReset){t=(typeof this.markupReset==="function"?this.markupReset(r):this.markupReset)+t}t=t.replace(/\^(.?)/g,(e,t)=>{var s;if(t==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[t]){i=this.shiftMarkup[t];return""}if(i){if(!this.shiftedMarkup||!this.shiftedMarkup[i]||!this.shiftedMarkup[i][t]){return""}n=true;if(typeof this.shiftedMarkup[i][t]==="function"){s=this.shiftedMarkup[i][t](r)}else{s=this.shiftedMarkup[i][t];r.push(s)}i=null}else{if(!this.markup||!this.markup[t]){return""}n=true;if(typeof this.markup[t]==="function"){s=this.markup[t](r)}else{s=this.markup[t];r.push(s)}}return s});if(n&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(r):this.markupReset}return t};n.createMarkup=(e=>n.markupMethod.bind(Object.assign({},u,e)));n.markup=n.markupMethod.bind(u);n.format.count=function e(t){var n,i,r,s=1,o=0;if(typeof t!=="string"){return 0}var a=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=a.exec(t))!==null){r=n[1];i=n[2];if(i){i=parseInt(i,10);if(r){if(r==="+"){i=s+i}else if(r==="-"){i=s-i}}}else{i=s}s++;if(o<i){o=i}}return o};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}return false};const h=1e-10;const f=Math.round(1/h);function p(e){return Math.round(e*f)/f}function d(e,t){return p(t*Math.round(e*(1/t)))}const m=["","k","M","G","T","P","E","Z","Y"];const g=["","m","µ","n","p","f","a","z","y"];const y=[100,10,1];function v(e){var t,n,i,r,s;if(!e||e===1){return""+e}if(e<0){return"-"+v(-e)}if(e>1){t=Math.floor(Math.log10(e));n=Math.floor(t/3);i=t%3;r=b(e/Math.pow(1e3,n),y[i]);s=m[n]}else{t=Math.floor(Math.log10(e));n=Math.floor(t/3);i=t%3;if(i<0){i+=3}r=b(e/Math.pow(1e3,n),y[i]);s=g[-n]}return""+r+s}function b(e,t){return Math.round((e+Number.EPSILON)*t)/t}}).call(this,e("buffer").Buffer)},{"./ansi.js":27,"./escape.js":28,"./inspect.js":30,buffer:6}],30:[function(e,t,n){(function(t,i){"use strict";const r=e("./escape.js");const s=e("./ansi.js");const o={};function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(e.depth===undefined){e.depth=3}if(e.maxLength===undefined){e.maxLength=250}if(e.outputMaxLength===undefined){e.outputMaxLength=5e3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.noArrayProperty=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}var i=l(n,e,t);if(i.length>e.outputMaxLength){i=e.style.truncate(i,e.outputMaxLength)}return i}function l(e,n,i){var s,a,u,f,p,d,m,g,y,v,b,x,w,_="",k="",S="",C,L;g=typeof i;v=n.style.tab.repeat(e.depth);if(g==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){S=[];if(!e.descriptor.configurable){S.push("-conf")}if(!e.descriptor.enumerable){S.push("-enum")}if(!e.descriptor.writable){S.push("-w")}if(S.length){S=S.join(" ")}else{S=""}}if(e.keyIsProperty){if(c(e.key)){k='"'+n.style.key(e.key)+'": '}else{k=n.style.key(e.key)+": "}}else{k=n.style.index(e.key)}if(S){S=" "+n.style.type(S)}}y=e.noPre?"":v+k;if(i===undefined){_+=y+n.style.constant("undefined")+S+n.style.newline}else if(i===o){_+=y+n.style.constant("[empty]")+S+n.style.newline}else if(i===null){_+=y+n.style.constant("null")+S+n.style.newline}else if(i===false){_+=y+n.style.constant("false")+S+n.style.newline}else if(i===true){_+=y+n.style.constant("true")+S+n.style.newline}else if(g==="number"){_+=y+n.style.number(i.toString())+(n.noType?"":" "+n.style.type("number"))+S+n.style.newline}else if(g==="string"){if(i.length>n.maxLength){_+=y+'"'+n.style.string(r.control(i.slice(0,n.maxLength-1)))+'…"'+(n.noType?"":" "+n.style.type("string")+n.style.length("("+i.length+" - TRUNCATED)"))+S+n.style.newline}else{_+=y+'"'+n.style.string(r.control(i))+'"'+(n.noType?"":" "+n.style.type("string")+n.style.length("("+i.length+")"))+S+n.style.newline}}else if(t.isBuffer(i)){_+=y+n.style.inspect(i.inspect())+(n.noType?"":" "+n.style.type("Buffer")+n.style.length("("+i.length+")"))+S+n.style.newline}else if(g==="object"||g==="function"){a=u="";x=false;if(g==="function"){x=true;a=" "+n.style.funcName(i.name?i.name:"(anonymous)");u=n.style.length("("+i.length+")")}b=false;if(Array.isArray(i)){b=true;u=n.style.length("("+i.length+")")}if(!i.constructor){d="(no constructor)"}else if(!i.constructor.name){d="(anonymous)"}else{d=i.constructor.name}d=n.style.constructorName(d);f=Object.getPrototypeOf(i);_+=y;if(!n.noType){if(e.forceType){_+=n.style.type(e.forceType)}else{_+=d+a+u+" "+n.style.type(g)+S}if(!x||n.funcDetails){_+=" "}}if(b&&n.noArrayProperty){p=[...Array(i.length).keys()]}else{p=Object.getOwnPropertyNames(i)}if(n.sort){p.sort()}w=h(i,e,n);if(n.protoBlackList&&n.protoBlackList.has(f)){_+=n.style.limit("[skip]")+n.style.newline}else if(w!==undefined){if(typeof w==="string"){_+="=> "+w+n.style.newline}else{_+="=> "+l({depth:e.depth,ancestors:e.ancestors,noPre:true},n,w)}}else if(x&&!n.funcDetails){_+=n.style.newline}else if(!p.length&&!n.proto){_+=(b?"[]":"{}")+n.style.newline}else if(e.depth>=n.depth){_+=n.style.limit("[depth limit]")+n.style.newline}else if(e.ancestors.indexOf(i)!==-1){_+=n.style.limit("[circular]")+n.style.newline}else{_+=(b&&n.noType&&n.noArrayProperty?"[":"{")+n.style.newline;L=e.ancestors.slice();L.push(i);for(s=0;s<p.length&&_.length<n.outputMaxLength;s++){if(!b&&n.propertyBlackList&&n.propertyBlackList.has(p[s])){continue}if(b&&n.noArrayProperty&&!(p[s]in i)){_+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:false},n,o)}else{try{C=Object.getOwnPropertyDescriptor(i,p[s]);if(!C.enumerable&&n.enumOnly){continue}m=!b||!C.enumerable||isNaN(p[s]);if(!n.noDescriptor&&C&&(C.get||C.set)){_+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:m,descriptor:C,forceType:"getter/setter"},n,{get:C.get,set:C.set})}else{_+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:m,descriptor:n.noDescriptor?undefined:C},n,i[p[s]])}}catch(t){_+=l({depth:e.depth+1,ancestors:L,key:p[s],keyIsProperty:m,descriptor:n.noDescriptor?undefined:C},n,t)}}if(s<p.length-1){_+=n.style.comma}}if(n.proto){_+=l({depth:e.depth+1,ancestors:L,key:"__proto__",keyIsProperty:true},n,f)}_+=v+(b&&n.noType&&n.noArrayProperty?"]":"}");_+=n.style.newline}}if(e.depth===0){if(n.style.trim){_=_.trim()}if(n.style==="html"){_=r.html(_)}}return _}n.inspect=a;function c(e){if(!e.length){return true}return false}var u=["pending","fulfilled","rejected"];function h(e,t,n){if(typeof e.constructor!=="function"){return}if(e instanceof String){return e.toString()}if(e instanceof RegExp){return e.toString()}if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}if(e instanceof Promise){if(i&&i.binding&&i.binding("util")&&i.binding("util").getPromiseDetails){let r=i.binding("util").getPromiseDetails(e);let s=u[r[0]];let o="Promise <"+s+">";if(s==="fulfilled"){o+=" "+l({depth:t.depth,ancestors:t.ancestors,noPre:true},n,r[1])}else if(s==="rejected"){if(r[1]instanceof Error){o+=" "+f({style:n.style,noErrorStack:true},r[1])}else{o+=" "+l({depth:t.depth,ancestors:t.ancestors,noPre:true},n,r[1])}}return o}}if(e._bsontype){return e.toString()}if(n.useInspect&&typeof e.inspect==="function"){return e.inspect()}return}function f(e,t){var n="",i,r,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"inspectError: not an error -- regular variable inspection: "+a(e,t)}if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(t.stack&&!e.noErrorStack){i=p(e,t.stack)}r=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(r)+(s?" ["+e.style.errorType(s)+"]":"")+": ";n+=e.style.errorMessage(t.message)+"\n";if(i){n+=e.style.errorStack(i)+"\n"}if(t.from){n+=e.style.newline+e.style.errorFromMessage("Error created from:")+e.style.newline+f(e,t.from)}return n}n.inspectError=f;function p(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(!t){return}if((e.browser||i.browser)&&t.indexOf("@")!==-1){t=t.replace(/[</]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,(t,n,i,r,s)=>{return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(i?e.style.errorStackFile(i):e.style.errorStack("unknown"))+(r?e.style.errorStack(":")+e.style.errorStackLine(r):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:((?:new +)?[^\s:()[\]\n]+(?:\([^)]+\))?)\s)?(?:\[as ([^\s:()[\]\n]+)\]\s)?(?:\(?([^:()[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,(t,n,i,r,s,o,a)=>{return e.style.errorStack("    at ")+(i?e.style.errorStackMethod(i)+" ":"")+(r?e.style.errorStack("[as ")+e.style.errorStackMethodAs(r)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(o?e.style.errorStack(":")+e.style.errorStackLine(o):"")+(a?e.style.errorStack(":")+e.style.errorStackColumn(a):"")+e.style.errorStack(")")})}return t}n.inspectStack=p;var d={};var m=e=>e;d.none={trim:false,tab:"    ",newline:"\n",comma:"",limit:m,type:e=>"<"+e+">",constant:m,funcName:m,constructorName:e=>"<"+e+">",length:m,key:m,index:e=>"["+e+"] ",number:m,inspect:m,string:m,errorType:m,errorMessage:m,errorStack:m,errorStackMethod:m,errorStackMethodAs:m,errorStackFile:m,errorStackLine:m,errorStackColumn:m,errorFromMessage:m,truncate:(e,t)=>e.slice(0,t-1)+"…"};d.inline=Object.assign({},d.none,{trim:true,tab:"",newline:" ",comma:", ",length:()=>"",index:()=>""});d.color=Object.assign({},d.none,{limit:e=>s.bold+s.brightRed+e+s.reset,type:e=>s.italic+s.brightBlack+e+s.reset,constant:e=>s.cyan+e+s.reset,funcName:e=>s.italic+s.magenta+e+s.reset,constructorName:e=>s.magenta+e+s.reset,length:e=>s.italic+s.brightBlack+e+s.reset,key:e=>s.green+e+s.reset,index:e=>s.blue+"["+e+"]"+s.reset+" ",number:e=>s.cyan+e+s.reset,inspect:e=>s.cyan+e+s.reset,string:e=>s.blue+e+s.reset,errorType:e=>s.red+s.bold+e+s.reset,errorMessage:e=>s.red+s.italic+e+s.reset,errorStack:e=>s.brightBlack+e+s.reset,errorStackMethod:e=>s.brightYellow+e+s.reset,errorStackMethodAs:e=>s.yellow+e+s.reset,errorStackFile:e=>s.brightCyan+e+s.reset,errorStackLine:e=>s.blue+e+s.reset,errorStackColumn:e=>s.magenta+e+s.reset,errorFromMessage:e=>s.yellow+s.underline+e+s.reset,truncate:(e,t)=>{var n=s.gray+"…"+s.reset;e=e.slice(0,t-n.length);var i=e.lastIndexOf("");if(i>=e.length-6){e=e.slice(0,i)}return e+n}});d.html=Object.assign({},d.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",newline:"<br />",limit:e=>'<span style="color:red">'+e+"</span>",type:e=>'<i style="color:gray">'+e+"</i>",constant:e=>'<span style="color:cyan">'+e+"</span>",funcName:e=>'<i style="color:magenta">'+e+"</i>",constructorName:e=>'<span style="color:magenta">'+e+"</span>",length:e=>'<i style="color:gray">'+e+"</i>",key:e=>'<span style="color:green">'+e+"</span>",index:e=>'<span style="color:blue">['+e+"]</span> ",number:e=>'<span style="color:cyan">'+e+"</span>",inspect:e=>'<span style="color:cyan">'+e+"</span>",string:e=>'<span style="color:blue">'+e+"</span>",errorType:e=>'<span style="color:red">'+e+"</span>",errorMessage:e=>'<span style="color:red">'+e+"</span>",errorStack:e=>'<span style="color:gray">'+e+"</span>",errorStackMethod:e=>'<span style="color:yellow">'+e+"</span>",errorStackMethodAs:e=>'<span style="color:yellow">'+e+"</span>",errorStackFile:e=>'<span style="color:cyan">'+e+"</span>",errorStackLine:e=>'<span style="color:blue">'+e+"</span>",errorStackColumn:e=>'<span style="color:gray">'+e+"</span>",errorFromMessage:e=>'<span style="color:yellow">'+e+"</span>"})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":8,"./ansi.js":27,"./escape.js":28,_process:13}],31:[function(e,t,n){(function(t,i){var r=e("process/browser.js").nextTick;var s=Function.prototype.apply;var o=Array.prototype.slice;var a={};var l=0;n.setTimeout=function(){return new c(s.call(setTimeout,window,arguments),clearTimeout)};n.setInterval=function(){return new c(s.call(setInterval,window,arguments),clearInterval)};n.clearTimeout=n.clearInterval=function(e){e.close()};function c(e,t){this._id=e;this._clearFn=t}c.prototype.unref=c.prototype.ref=function(){};c.prototype.close=function(){this._clearFn.call(window,this._id)};n.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};n.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;if(t>=0){e._idleTimeoutId=setTimeout(function t(){if(e._onTimeout)e._onTimeout()},t)}};n.setImmediate=typeof t==="function"?t:function(e){var t=l++;var i=arguments.length<2?false:o.call(arguments,1);a[t]=true;r(function r(){if(a[t]){if(i){e.apply(null,i)}else{e.call(null)}n.clearImmediate(t)}});return t};n.clearImmediate=typeof i==="function"?i:function(e){delete a[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":13,timers:31}],32:[function(e,t,n){"use strict";var i=e("punycode");var r=e("./util");n.parse=w;n.resolve=k;n.resolveObject=S;n.format=_;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(c),h=["'"].concat(u),f=["%","/","?",";","#"].concat(h),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:true,"javascript:":true},v={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},x=e("querystring");function w(e,t,n){if(e&&r.isObject(e)&&e instanceof s)return e;var i=new s;i.parse(e,t,n);return i}s.prototype.parse=function(e,t,n){if(!r.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",c=e.split(a),u=/\\/g;c[0]=c[0].replace(u,"/");e=c.join(a);var w=e;w=w.trim();if(!n&&e.split("#").length===1){var _=l.exec(w);if(_){this.path=w;this.href=w;this.pathname=_[1];if(_[2]){this.search=_[2];if(t){this.query=x.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var k=o.exec(w);if(k){k=k[0];var S=k.toLowerCase();this.protocol=S;w=w.substr(k.length)}if(n||k||w.match(/^\/\/[^@\/]+@[^@\/]+/)){var C=w.substr(0,2)==="//";if(C&&!(k&&v[k])){w=w.substr(2);this.slashes=true}}if(!v[k]&&(C||k&&!b[k])){var L=-1;for(var j=0;j<p.length;j++){var $=w.indexOf(p[j]);if($!==-1&&(L===-1||$<L))L=$}var A,E;if(L===-1){E=w.lastIndexOf("@")}else{E=w.lastIndexOf("@",L)}if(E!==-1){A=w.slice(0,E);w=w.slice(E+1);this.auth=decodeURIComponent(A)}L=-1;for(var j=0;j<f.length;j++){var $=w.indexOf(f[j]);if($!==-1&&(L===-1||$<L))L=$}if(L===-1)L=w.length;this.host=w.slice(0,L);w=w.slice(L);this.parseHost();this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T){var I=this.hostname.split(/\./);for(var j=0,M=I.length;j<M;j++){var O=I[j];if(!O)continue;if(!O.match(m)){var N="";for(var G=0,B=O.length;G<B;G++){if(O.charCodeAt(G)>127){N+="x"}else{N+=O[G]}}if(!N.match(m)){var V=I.slice(0,j);var P=I.slice(j+1);var F=O.match(g);if(F){V.push(F[1]);P.unshift(F[2])}if(P.length){w="/"+P.join(".")+w}this.hostname=V.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!T){this.hostname=i.toASCII(this.hostname)}var R=this.port?":"+this.port:"";var D=this.hostname||"";this.host=D+R;this.href+=this.host;if(T){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(w[0]!=="/"){w="/"+w}}}if(!y[S]){for(var j=0,M=h.length;j<M;j++){var U=h[j];if(w.indexOf(U)===-1)continue;var W=encodeURIComponent(U);if(W===U){W=escape(U)}w=w.split(U).join(W)}}var q=w.indexOf("#");if(q!==-1){this.hash=w.substr(q);w=w.slice(0,q)}var H=w.indexOf("?");if(H!==-1){this.search=w.substr(H);this.query=w.substr(H+1);if(t){this.query=x.parse(this.query)}w=w.slice(0,H)}else if(t){this.search="";this.query={}}if(w)this.pathname=w;if(b[S]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var R=this.pathname||"";var Y=this.search||"";this.path=R+Y}this.href=this.format();return this};function _(e){if(r.isString(e))e=w(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",s=false,o="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&r.isObject(this.query)&&Object.keys(this.query).length){o=x.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(i&&i.charAt(0)!=="#")i="#"+i;if(a&&a.charAt(0)!=="?")a="?"+a;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+n+a+i};function k(e,t){return w(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(w(e,false,true)).format()};function S(e,t){if(!e)return t;return w(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(r.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var i=Object.keys(this);for(var o=0;o<i.length;o++){var a=i[o];n[a]=this[a]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var l=Object.keys(e);for(var c=0;c<l.length;c++){var u=l[c];if(u!=="protocol")n[u]=e[u]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var h=Object.keys(e);for(var f=0;f<h.length;f++){var p=h[f];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!v[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");n.pathname=d.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var g=n.search||"";n.path=m+g}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var y=n.pathname&&n.pathname.charAt(0)==="/",x=e.host||e.pathname&&e.pathname.charAt(0)==="/",w=x||y||n.host&&e.pathname,_=w,k=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],S=n.protocol&&!b[n.protocol];if(S){n.hostname="";n.port=null;if(n.host){if(k[0]==="")k[0]=n.host;else k.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}w=w&&(d[0]===""||k[0]==="")}if(x){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;k=d}else if(d.length){if(!k)k=[];k.pop();k=k.concat(d);n.search=e.search;n.query=e.query}else if(!r.isNullOrUndefined(e.search)){if(S){n.hostname=n.host=k.shift();var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}n.search=e.search;n.query=e.query;if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!k.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var L=k.slice(-1)[0];var j=(n.host||e.host||k.length>1)&&(L==="."||L==="..")||L==="";var $=0;for(var A=k.length;A>=0;A--){L=k[A];if(L==="."){k.splice(A,1)}else if(L===".."){k.splice(A,1);$++}else if($){k.splice(A,1);$--}}if(!w&&!_){for(;$--;$){k.unshift("..")}}if(w&&k[0]!==""&&(!k[0]||k[0].charAt(0)!=="/")){k.unshift("")}if(j&&k.join("/").substr(-1)!=="/"){k.push("")}var E=k[0]===""||k[0]&&k[0].charAt(0)==="/";if(S){n.hostname=n.host=E?"":k.length?k.shift():"";var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}w=w||n.host&&k.length;if(w&&!E){k.unshift("")}if(!k.length){n.pathname=null;n.path=null}else{n.pathname=k.join("/")}if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":33,punycode:14,querystring:17}],33:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}],34:[function(e,t,n){"use strict";const i=e("./svg-kit.js");const r=e("./VGContainer.js");var s=0;function o(e){r.call(this,e);this.id=e&&e.id||"vg_"+s++;this.viewBox={x:0,y:0,width:100,height:100};this.css=[];if(e){this.set(e)}}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.prototype.__prototypeUID__="svg-kit/VG";o.prototype.__prototypeVersion__=e("../package.json").version;o.prototype.svgTag="svg";o.prototype.svgAttributes=function(){var e={xmlns:"http://www.w3.org/2000/svg",viewBox:this.viewBox.x+" "+this.viewBox.y+" "+this.viewBox.width+" "+this.viewBox.height};return e};o.prototype.set=function(e){r.prototype.set.call(this,e);if(e.viewBox&&typeof e.viewBox==="object"){if(e.viewBox.x!==undefined){this.viewBox.x=e.viewBox.x}if(e.viewBox.y!==undefined){this.viewBox.y=e.viewBox.y}if(e.viewBox.width!==undefined){this.viewBox.width=e.viewBox.width}if(e.viewBox.height!==undefined){this.viewBox.height=e.viewBox.height}}if(e.css&&Array.isArray(e.css)){this.css.length=0;for(let t of e.css){this.addCssRule(t)}}};o.prototype.addCssRule=function(e){if(!e||typeof e!=="object"||!e.select||!e.style||typeof e.style!=="object"){return}this.css.push(e)}},{"../package.json":56,"./VGContainer.js":35,"./svg-kit.js":43}],35:[function(e,t,n){"use strict";const i=e("./svg-kit.js");const r=e("./VGItem.js");function s(e){r.call(this,e);this.items=[]}t.exports=s;s.prototype=Object.create(r.prototype);s.prototype.constructor=s;s.prototype.__prototypeUID__="svg-kit/VGContainer";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.isContainer=true;s.prototype.set=function(e){r.prototype.set.call(this,e);if(e.items&&Array.isArray(e.items)){for(let t of e.items){this.items.push(i.objectToVG(t))}}};s.prototype.exportMorphLog=function(){var e=false,t={};this.items.forEach((n,i)=>{var r=n.exportMorphLog();if(r){t[i]=r;e=true}});if(!e&&!this.morphLog.length){return null}var n={};if(this.morphLog.length){n.l=[...this.morphLog]}if(e){n.i=t}this.morphLog.length=0;return n};s.prototype.importMorphLog=function(e){var t,n;if(!e){this.morphLog.length=0;return}if(!e.l||!e.l.length){this.morphLog.length=0}else{this.morphLog=e.l}if(e.i){for(t in e.i){n=+t;if(this.items[n]){console.warn("Sub:",this.items[n],e.i[t]);this.items[n].importMorphLog(e.i[t])}}}};s.prototype.morphDom=function(){this.items.forEach(e=>e.morphDom());this.morphLog.forEach(e=>this.morphOneEntryDom(e));this.morphLog.length=0;return this.$element}},{"../package.json":56,"./VGItem.js":38,"./svg-kit.js":43}],36:[function(e,t,n){"use strict";const i=e("./VGItem.js");function r(e){i.call(this,e);this.x=0;this.y=0;this.rx=0;this.ry=0;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(i.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGEllipse";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="ellipse";r.prototype.svgAttributes=function(){var e={cx:this.x,cy:this.y,rx:this.rx,ry:this.ry};return e};r.prototype.set=function(e){i.prototype.set.call(this,e);if(e.cx!==undefined){this.x=e.cx}if(e.cy!==undefined){this.y=e.cy}if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.r!==undefined){this.rx=this.ry=e.r}if(e.rx!==undefined){this.rx=e.rx}if(e.ry!==undefined){this.ry=e.ry}}},{"../package.json":56,"./VGItem.js":38}],37:[function(e,t,n){"use strict";const i=e("./svg-kit.js");const r=e("./VGContainer.js");function s(e){r.call(this,e);if(e){this.set(e)}}t.exports=s;s.prototype=Object.create(r.prototype);s.prototype.constructor=s;s.prototype.__prototypeUID__="svg-kit/VGGroup";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.svgTag="g";s.prototype.set=function(e){r.prototype.set.call(this,e)}},{"../package.json":56,"./VGContainer.js":35,"./svg-kit.js":43}],38:[function(e,t,n){"use strict";const i=e("string-kit/lib/camel");const r=e("string-kit/lib/escape");function s(e){this.id=null;this.class=new Set;this.style={};this.data=null;this.button=null;this.hint=null;this.area=null;this.morphLog=[];this.$element=null;this.$style=null}t.exports=s;s.prototype.__prototypeUID__="svg-kit/VGItem";s.prototype.__prototypeVersion__=e("../package.json").version;s.prototype.isContainer=false;s.prototype.svgTag="none";s.prototype.svgAttributes=(()=>({}));s.prototype.toJSON=function(){var e=Object.assign({},this);e._type=this.__prototypeUID__;if(this.class.size){e.class=[...this.class]}else{delete e.class}if(!e.id){delete e.id}if(!e.data){delete e.data}if(!e.button){delete e.button}if(!e.hint){delete e.hint}if(!e.area){delete e.area}delete e.morphLog;delete e.$element;delete e.$style;return e};s.prototype.set=function(e){if(e.id!==undefined){this.id=e.id||null}if(e.class){if(typeof e.class==="string"){this.class.clear();this.class.add(e.class)}else if(Array.isArray(e.class)||e.class instanceof Set){this.class.clear();for(let t of e.class){this.class.add(t)}}else if(typeof e.class==="object"){for(let t in e.class){if(e.class[t]){this.class.add(t)}else{this.class.delete(t)}}}}if(e.style){for(let t in e.style){this.style[this.toCamelCase(t)]=e.style[t]===null?"":e.style[t]}}if(e.data!==undefined){if(!e.data){this.data=null}else{if(!this.data){this.data={}}Object.assign(this.data,e.data)}}if(e.button!==undefined){this.button=e.button||null}if(e.hint!==undefined){this.hint=e.hint||null}if(e.area!==undefined){this.area=e.area||null}};var o=0;s.prototype.morph=function(e){var t=Object.assign({},e);t._v=o++;this.morphLog.push(t);this.set(e)};s.prototype.exportMorphLog=function(){if(!this.morphLog.length){return null}var e={l:[...this.morphLog]};this.morphLog.length=0;return e};s.prototype.importMorphLog=function(e){if(!e||!e.l||!e.l.length){this.morphLog.length=0}else{this.morphLog=e.l}};s.prototype.toCamelCase=(e=>i.toCamelCase(e,true));s.prototype.escape=function(e){if(typeof e==="object"){return null}if(typeof e!=="string"){return e}return r.htmlAttr(e)};s.prototype.renderText=function(){var e,t,n="",r="",s=this.svgAttributes();n+="<"+this.svgTag;if(this.id){n+=' id="'+this.escape(this.id)+'"'}if(this.button){n+=' button="'+this.escape(this.button)+'"'}if(this.hint){n+=' hint="'+this.escape(this.hint)+'"'}if(this.area){n+=' area="'+this.escape(this.area)+'"'}if(this.class.size){n+=' class="';let e=true;for(let t of this.class){if(!e){n+=" "}n+=this.escape(t);e=false}n+='"'}for(e in s){n+=" "+e+'="'+this.escape(s[e])+'"'}if(this.data){for(e in this.data){n+=" data-"+this.escape(e)+'="'+this.escape(this.data[e])+'"'}}for(e in this.style){r+=this.escape(i.camelCaseToDash(e))+":"+this.escape(this.style[e])+";"}if(r){n+=' style="'+r+'"'}if(this.svgTextNode){n+=this.svgTextNode()}if(!this.isContainer){n+=" />";return n}n+=">";if(this.css&&this.css.length){n+="<style>\n";for(t of this.css){n+=t.select+" {\n";for(e in t.style){n+="    "+this.escape(i.camelCaseToDash(e))+": "+this.escape(t.style[e])+";\n"}n+="}\n"}n+="</style>"}if(this.items){for(let e of this.items){n+=e.renderText()}}n+="</"+this.svgTag+">";return n};s.prototype.renderDom=function(e={}){var t,n,r,s=this.svgAttributes();this.$element=document.createElementNS("http://www.w3.org/2000/svg",e.overrideTag||this.svgTag);if(this.id){this.$element.setAttribute("id",this.id)}if(this.button){this.$element.setAttribute("button",this.button)}if(this.hint){this.$element.setAttribute("hint",this.hint)}if(this.area){this.$element.setAttribute("area",this.area)}if(this.class.size){this.class.forEach(e=>this.$element.classList.add(e))}for(t in s){this.$element.setAttribute(t,s[t])}if(this.data){for(t in this.data){this.$element.setAttribute("data-"+t,this.data[t])}}for(t in this.style){this.$element.style[t]=this.style[t]}if(this.svgTextNode){console.warn("SVG text node!!!");this.$element.appendChild(document.createTextNode(this.svgTextNode()))}if(!this.isContainer){return this.$element}if(this.css&&this.css.length){this.$style=document.createElementNS("http://www.w3.org/2000/svg","style");r="";for(n of this.css){r+=n.select+" {\n";for(t in n.style){r+=this.escape(i.camelCaseToDash(t))+": "+this.escape(n.style[t])+";\n"}r+="}\n"}this.$style.appendChild(document.createTextNode(r));this.$element.appendChild(this.$style)}if(this.items){for(let e of this.items){this.$element.appendChild(e.renderDom())}}return this.$element};s.prototype.morphDom=function(){this.morphLog.forEach(e=>this.morphOneEntryDom(e));this.morphLog.length=0;return this.$element};s.prototype.morphOneEntryDom=function(e){var t;if(e.button){this.$element.setAttribute("button",e.button)}if(e.hint){this.$element.setAttribute("hint",e.hint)}if(e.area){this.$element.setAttribute("area",e.area)}if(e.class){if(Array.isArray(e.class)){this.$element.setAttribute("class",e.class.join(" "))}else if(e.class instanceof Set){this.$element.setAttribute("class",[...e.class].join(" "))}else if(typeof e.class==="object"){for(let t in e.class){if(e.class[t]){this.$element.classList.add(t)}else{this.$element.classList.remove(t)}}}}if(e.attr){for(t in e.attr){this.$element.setAttribute(t,e.attr[t])}}if(e.data){for(t in e.data){this.$element.setAttribute("data-"+t,e.data[t])}}if(e.style){for(t in e.style){this.$element.style[t]=e.style[t]===null?"":e.style[t]}}}},{"../package.json":56,"string-kit/lib/camel":54,"string-kit/lib/escape":55}],39:[function(e,t,n){"use strict";const i=e("./VGItem.js");function r(e){i.call(this,e);this.commands=[];if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(i.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGPath";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="path";r.prototype.svgAttributes=function(){var e={d:this.toD()};return e};r.prototype.set=function(e){i.prototype.set.call(this,e);if(Array.isArray(e.commands)){this.commands=e.commands}};r.prototype.toD=function(){var e={d:"",pu:false,cx:0,cy:0,ca:Math.PI/2};this.commands.forEach((t,n)=>{if(n){e.d+=" "}a[t.type](t,e)});return e.d};const s=e=>e*Math.PI/180;const o=e=>e*180/Math.PI;const a={};a.close=((e,t)=>{t.d+="z"});a.move=((e,t)=>{if(e.rel){t.d+="m "+e.x+" "+e.y;t.cx+=e.x;t.cy+=e.y}else{t.d+="M "+e.x+" "+e.y;t.cx=e.x;t.cy=e.y}});a.line=((e,t)=>{if(e.rel){t.d+="l "+e.x+" "+e.y;t.cx+=e.x;t.cy+=e.y}else{t.d+="L "+e.x+" "+e.y;t.cx=e.x;t.cy=e.y}});a.curve=((e,t)=>{if(e.rel){t.d+="c "+e.cx1+" "+e.cy1+" "+e.cx2+" "+e.cy2+" "+e.x+" "+e.y;t.cx+=e.x;t.cy+=e.y}else{t.d+="C "+e.cx1+" "+e.cy1+" "+e.cx2+" "+e.cy2+" "+e.x+" "+e.y;t.cx=e.x;t.cy=e.y}});a.smoothCurve=((e,t)=>{if(e.rel){t.d+="s "+e.cx+" "+e.cy+" "+e.x+" "+e.y;t.cx+=e.x;t.cy+=e.y}else{t.d+="S "+e.cx+" "+e.cy+" "+e.x+" "+e.y;t.cx=e.x;t.cy=e.y}});a.qCurve=((e,t)=>{if(e.rel){t.d+="q "+e.cx+" "+e.cy+" "+e.x+" "+e.y;t.cx+=e.x;t.cy+=e.y}else{t.d+="Q "+e.cx+" "+e.cy+" "+e.x+" "+e.y;t.cx=e.x;t.cy=e.y}});a.smoothQCurve=((e,t)=>{if(e.rel){t.d+="t "+e.x+" "+e.y;t.cx+=e.x;t.cy+=e.y}else{t.d+="T "+e.x+" "+e.y;t.cx=e.x;t.cy=e.y}});a.arc=((e,t)=>{if(e.rel){t.d+="a "+e.rx+" "+e.ry+" "+e.ra+" "+ +e.la+" "+ +e.pr+" "+e.x+" "+e.y;t.cx+=e.x;t.cy+=e.y}else{t.d+="A "+e.rx+" "+e.ry+" "+e.ra+" "+ +e.la+" "+ +e.pr+" "+e.x+" "+e.y;t.cx=e.x;t.cy=e.y}});function l(e){if(!e){return 0}var t=s(e);var n=Math.cos(t/2),i=Math.sin(t/2),r=(4-n)/3,o=(1-n)*(3-n)/(3*i);return Math.sqrt((n-r)**2+(i-o)**2)}a.centerArc=((e,t)=>{var{x:n,y:i,cx:r,cy:s}=e;if(e.rel){n+=t.cx;i+=t.cy;r+=t.cx;s+=t.cy}var o=Math.atan2(t.cy-s,t.cx-r),a=Math.atan2(i-s,n-r);t.cx=n;t.cy=i});a.pen=((e,t)=>{t.pu=e.u});a.forward=((e,t)=>{var n=e.l*Math.cos(t.ca),i=e.l*Math.sin(t.ca);if(t.pu){t.d+="m "+n+" "+i}else{t.d+="l "+n+" "+i}t.cx+=n;t.cy+=i});a.turn=((e,t)=>{if(e.rel){t.ca+=s(e.a)}else{t.ca=s(e.a)}});a.forwardTurn=((e,t)=>{var n=s(e.a),i=n>=0?1:-1,r=Math.abs(n),o=e.l/r,a=o*Math.cos(r),l=o*Math.sin(r),c=Math.sqrt((o-a)**2+l**2),u=Math.atan2(o-a,l);var h=c*Math.cos(t.ca+i*u),f=c*Math.sin(t.ca+i*u);if(t.pu){t.d+="m "+h+" "+f}else{t.d+="a "+o+" "+o+" 0 "+(r>Math.PI?1:0)+" "+(n>=0?1:0)+" "+h+" "+f}t.cx+=h;t.cy+=f;t.ca+=n});r.prototype.close=function(){this.commands.push({type:"close"})};r.prototype.move=function(e){this.commands.push({type:"move",rel:true,x:e.x||0,y:e.y||0})};r.prototype.moveTo=function(e){this.commands.push({type:"move",x:e.x||0,y:e.y||0})};r.prototype.line=function(e){this.commands.push({type:"line",rel:true,x:e.x||0,y:e.y||0})};r.prototype.lineTo=function(e){this.commands.push({type:"line",x:e.x||0,y:e.y||0})};r.prototype.curve=function(e){this.commands.push({type:"curve",rel:true,cx1:e.cx1||0,cy1:e.cy1||0,cx2:e.cx2||0,cy2:e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.curveTo=function(e){this.commands.push({type:"curve",cx1:e.cx1||0,cy1:e.cy1||0,cx2:e.cx2||0,cy2:e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.smoothCurve=function(e){this.commands.push({type:"smoothCurve",rel:true,cx:e.cx||e.cx2||0,cy:e.cy||e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.smoothCurveTo=function(e){this.commands.push({type:"smoothCurve",cx:e.cx||e.cx2||0,cy:e.cy||e.cy2||0,x:e.x||0,y:e.y||0})};r.prototype.qCurve=function(e){this.commands.push({type:"qCurve",rel:true,cx:e.cx||e.cx1||0,cy:e.cy||e.cy1||0,x:e.x||0,y:e.y||0})};r.prototype.qCurveTo=function(e){this.commands.push({type:"qCurve",cx:e.cx||e.cx1||0,cy:e.cy||e.cy1||0,x:e.x||0,y:e.y||0})};r.prototype.smoothQCurve=function(e){this.commands.push({type:"smoothQCurve",rel:true,x:e.x||0,y:e.y||0})};r.prototype.smoothQCurveTo=function(e){this.commands.push({type:"smoothQCurve",x:e.x||0,y:e.y||0})};r.prototype.arc=function(e){this.commands.push({type:"arc",rel:true,rx:e.rx||0,ry:e.ry||0,ra:e.ra||e.a||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true,x:e.x||0,y:e.y||0})};r.prototype.arcTo=function(e){this.commands.push({type:"arc",rx:e.rx||0,ry:e.ry||0,ra:e.ra||e.a||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true,x:e.x||0,y:e.y||0})};r.prototype.negativeArc=function(e){this.commands.push({type:"arc",rel:true,rx:e.rx||0,ry:e.ry||0,ra:-(e.ra||e.a||0),la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:!(e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true),x:e.x||0,y:e.y||0})};r.prototype.negativeArcTo=function(e){this.commands.push({type:"arc",rx:e.rx||0,ry:e.ry||0,ra:-(e.ra||e.a||0),la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,pr:!(e.positiveRotation!==undefined?!!e.positiveRotation:e.sweep!==undefined?!!e.sweep:e.pr!==undefined?!!e.pr:true),x:e.x||0,y:e.y||0})};r.prototype.centerArc=function(e){this.commands.push({type:"centerArc",rel:true,cx:e.cx||0,cy:e.cy||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,x:e.x||0,y:e.y||0})};r.prototype.centerArcTo=function(e){this.commands.push({type:"centerArc",cx:e.cx||0,cy:e.cy||0,la:e.largeArc!==undefined?!!e.largeArc:e.longArc!==undefined?!!e.longArc:e.la!==undefined?!!e.la:false,x:e.x||0,y:e.y||0})};r.prototype.penUp=function(e){this.commands.push({type:"pen",u:true})};r.prototype.penDown=function(e){this.commands.push({type:"pen",u:false})};r.prototype.forward=function(e){this.commands.push({type:"forward",l:typeof e==="number"?e:e.length||e.l||0})};r.prototype.backward=function(e){this.commands.push({type:"forward",l:-(typeof e==="number"?e:e.length||e.l||0)})};r.prototype.turn=function(e){this.commands.push({type:"turn",rel:true,a:typeof e==="number"?e:e.angle||e.a||0})};r.prototype.turnTo=function(e){this.commands.push({type:"turn",a:typeof e==="number"?e:e.angle||e.a||0})};r.prototype.negativeTurn=function(e){this.commands.push({type:"turn",rel:true,a:-(typeof e==="number"?e:e.angle||e.a||0)})};r.prototype.negativeTurnTo=function(e){this.commands.push({type:"turn",a:90-(typeof e==="number"?e:e.angle||e.a||0)})};r.prototype.forwardTurn=function(e){this.commands.push({type:"forwardTurn",l:e.length||e.l||0,a:e.angle||e.a||0})};r.prototype.forwardNegativeTurn=function(e){this.commands.push({type:"forwardTurn",l:e.length||e.l||0,a:-(e.angle||e.a||0)})}},{"../package.json":56,"./VGItem.js":38}],40:[function(e,t,n){"use strict";const i=e("./VGItem.js");function r(e){i.call(this,e);this.x=0;this.y=0;this.width=0;this.height=0;this.rx=0;this.ry=0;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(i.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGRect";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="rect";r.prototype.svgAttributes=function(){var e={x:this.x,y:this.y,width:this.width,height:this.height,rx:this.rx,ry:this.ry};return e};r.prototype.set=function(e){i.prototype.set.call(this,e);if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.width!==undefined){this.width=e.width}if(e.height!==undefined){this.height=e.height}if(e.r!==undefined){this.rx=this.ry=e.r}if(e.rx!==undefined){this.rx=e.rx}if(e.ry!==undefined){this.ry=e.ry}}},{"../package.json":56,"./VGItem.js":38}],41:[function(e,t,n){"use strict";const i=e("./VGItem.js");function r(e){i.call(this,e);this.x=0;this.y=0;this.text="";this.anchor=null;this.length=null;this.adjustGlyph=false;if(e){this.set(e)}}t.exports=r;r.prototype=Object.create(i.prototype);r.prototype.constructor=r;r.prototype.__prototypeUID__="svg-kit/VGText";r.prototype.__prototypeVersion__=e("../package.json").version;r.prototype.svgTag="text";r.prototype.svgAttributes=function(){var e={x:this.x,y:this.y,"text-anchor":this.anchor||"middle"};if(this.length!==null){e.textLength=this.length}if(this.adjustGlyph!==null){e.lengthAdjust="spacingAndGlyphs"}return e};r.prototype.svgTextNode=function(){return this.text};r.prototype.set=function(e){i.prototype.set.call(this,e);if(e.x!==undefined){this.x=e.x}if(e.y!==undefined){this.y=e.y}if(e.text!==undefined){this.text=e.text}if(e.textAnchor!==undefined){this.anchor=e.textAnchor}if(e.anchor!==undefined){this.anchor=e.anchor}if(e.textLength!==undefined){this.length=e.textLength}if(e.length!==undefined){this.length=e.length}if(e.lengthAdjust==="spacingAndGlyphs"){this.adjustGlyph=true}else if(e.lengthAdjust==="spacing"){this.adjustGlyph=false}if(e.adjustGlyph!==undefined){this.adjustGlyph=!!e.adjustGlyph}}},{"../package.json":56,"./VGItem.js":38}],42:[function(e,t,n){"use strict";const i={};t.exports=i;i.dFromPoints=((e,t)=>{var n=t?-1:1,i="M";e.forEach(e=>{i+=" "+e.x+","+e.y*n});return i})},{}],43:[function(e,t,n){(function(n){"use strict";const i=e("fs").promises;const r=e("dom-kit");const s=e("seventh");const o=e("string-kit/lib/escape.js");function a(){}const l={};t.exports=l;l.path=e("./path.js");l.VG=e("./VG.js");l.VGItem=e("./VGItem.js");l.VGContainer=e("./VGContainer.js");l.VGGroup=e("./VGGroup.js");l.VGRect=e("./VGRect.js");l.VGEllipse=e("./VGEllipse.js");l.VGPath=e("./VGPath.js");l.VGText=e("./VGText.js");l.load=async function(e,t={}){var s,o,a;if(!n.browser){if(e.substring(0,7)==="file://"){e=e.slice(7)}s=await i.readFile(e,"utf8");o=r.fromXml(s)}else{o=await l.ajax(e)}if(t.removeComments){r.removeComments(o);delete t.removeComments}a=o.documentElement;l.inject(a,t);return a};l.loadFromString=async function(e,t={}){var n=r.fromXml(e);if(t.removeComments){r.removeComments(n);delete t.removeComments}var i=n.documentElement;l.inject(i,t);return i};l.ajax=function(e){var t=new s,n=new XMLHttpRequest;n.responseType="document";n.onreadystatechange=(()=>{try{if(n.readyState===4){if(n.status===200){t.resolve(n.responseXML)}else if(n.status===0&&n.responseXML){t.resolve(n.responseXML)}else if(n.status){t.reject(n.status)}else{t.reject(new Error("[svg-kit] ajaxStatus(): Error with falsy status"))}}}catch(e){t.reject(e)}});n.open("GET",e);n.send();return t};l.inject=function(e,t){l.patch(e,t);if(t.into){t.into.appendChild(e)}if(t.as){r.moveAttributes(e,t.as);r.moveChildrenInto(e,t.as)}};l.patch=function(e,t){var n,i,s;l.lightCleanup(e);if(t.id!==undefined){if(typeof t.id==="string"){e.setAttribute("id",t.id)}else if(!t.id){e.removeAttribute("id")}}if(t.class){if(typeof t.class==="string"){e.classList.add(t.class)}else if(typeof t.class==="object"){r.class(e,t.class)}}if(t.hidden){e.style.visibility="hidden"}if(t.prefixIds){r.prefixIds(e,t.prefixIds)}if(t.removeIds){r.removeAllAttributes(e,"id")}if(t.removeSvgStyle){e.removeAttribute("style")}if(t.removeDefaultStyles){l.removeDefaultStyles(e)}if(t.removeComments){r.removeComments(e)}if(t.removeExoticNamespaces){r.filterByNamespace(e,{primary:"svg",whitelist:[]})}if(t.removeSize){i=e.getAttribute("width")||e.style.width;s=e.getAttribute("height")||e.style.height;e.removeAttribute("height");e.removeAttribute("width");e.style.width=null;e.style.height=null;if(!e.getAttribute("viewBox")&&i&&s){n="0 0 "+i+" "+s;e.setAttribute("viewBox",n)}}if(t.css){r.css(e,t.css)}if(t.colorClass){l.colorClass(e)}if(t.removeWhiteSpaces){r.removeWhiteSpaces(e)}else if(t.removeWhiteLines){r.removeWhiteSpaces(e,true)}};l.patchDocument=function(e,t){var n=t.removeWhiteSpaces,i=t.removeWhiteLines,s=t.removeComments;delete t.removeWhiteSpaces;delete t.removeWhiteLines;delete t.removeComments;if(s){r.removeComments(e)}l.patch(e.documentElement,t);if(n){r.removeWhiteSpaces(e)}else if(i){r.removeWhiteSpaces(e,true)}};l.lightCleanup=function(e){r.removeAllTags(e,"metadata");r.removeAllTags(e,"script");r.removeAllTags(e,"defs",true)};const c=["path","circle","ellipse","line","rect","polyline","polygone","text","textPath"];const u=[["font-style","normal"],["font-weight","normal"],["font-variant","normal"],["font-stretch","normal"],["font-size","medium"],["line-height","normal"],["font-variant-ligatures","normal"],["font-variant-position","normal"],["font-variant-caps","normal"],["font-variant-numeric","normal"],["font-variant-alternates","normal"],["font-variant-east-asian","normal"],["font-feature-settings","normal"],["text-indent","0"],["text-align","start"],["text-decoration","none"],["text-decoration-line","none"],["text-decoration-style","solid"],["text-decoration-color","#000000"],["letter-spacing","normal"],["word-spacing","normal"],["text-transform","none"],["writing-mode","lr-tb"],["direction","ltr"],["text-orientation","mixed"],["dominant-baseline","auto"],["baseline-shift","baseline"],["text-anchor","start"],["white-space","normal"],["shape-padding","0"],["display","inline"],["visibility","visible"],["overflow","visible"],["opacity","1"],["isolation","auto"],["mix-blend-mode","normal"],["color-interpolation","sRGB"],["color-interpolation-filters","linearRGB"],["solid-color","#000000"],["solid-opacity","1"],["vector-effect","none"],["fill-rule","nonzero"],["clip-rule","nonzero"],["color-rendering","auto"],["image-rendering","auto"],["shape-rendering","auto"],["text-rendering","auto"],["enable-background","accumulate"],["stroke-dasharray","none"],["stroke-dashoffset","0"],["paint-order","normal"],["paint-order","fill stroke markers"]];l.colorClass=function(e){c.forEach(t=>{Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!e.getAttribute("class")){e.classList.add("primary")}r.styleToAttribute(e,"fill",["none"]);r.styleToAttribute(e,"stroke",["none"])})})};l.removeDefaultStyles=function(e){c.forEach(t=>{Array.from(e.getElementsByTagName(t)).forEach(e=>{var t=e.getAttribute("style");u.forEach(e=>{var n=e[0];var i=e[1];t=t.replace(new RegExp("(^|;) *"+o.regExp(n)+" *: *"+o.regExp(i)+" *(?:;|$)"),(e,t)=>t)});e.setAttribute("style",t)})})};l.getViewBox=function(e){var t=e.getAttribute("viewBox");if(!t){return null}var n=t.split(/ +/);return{x:parseFloat(n[0],10),y:parseFloat(n[1],10),width:parseFloat(n[2],10),height:parseFloat(n[3],10)}};l.setViewBox=function(e,t){e.setAttribute("viewBox",t.x+" "+t.y+" "+t.width+" "+t.height)};l.toAreaArray=function(e){if(e.min&&e.max){return[e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y]}else if(e.xmin!==undefined&&e.xmax!==undefined&&e.ymin!==undefined&&e.ymax!==undefined){return[e.xmin,e.ymin,e.xmax-e.xmin,e.ymax-e.ymin]}else if(e.x!==undefined&&e.y!==undefined&&e.width!==undefined&&e.height!==undefined){return[e.x,e.y,e.width,e.height]}return[0,0,100,100]};l.standalone=function(e,t){var n='<?xml version="1.0" encoding="UTF-8"?>\n';if(!Array.isArray(t)){t=l.toAreaArray(t)}n+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+t.join(" ")+'">\n';n+=e;n+="\n</svg>\n";return n};l.unserializeVG=(e=>l.objectToVG(JSON.parse(e)));l.objectToVG=function(e){if(!e._type||!e._type.startsWith("svg-kit/")){return e}var t=e._type.slice(8);if(!l[t]){return e}return new l[t](e)}}).call(this,e("_process"))},{"./VG.js":34,"./VGContainer.js":35,"./VGEllipse.js":36,"./VGGroup.js":37,"./VGItem.js":38,"./VGPath.js":39,"./VGRect.js":40,"./VGText.js":41,"./path.js":42,_process:13,"dom-kit":44,fs:6,seventh:52,"string-kit/lib/escape.js":55}],44:[function(e,t,n){arguments[4][7][0].apply(n,arguments)},{"@cronvel/xmldom":6,_process:13,dup:7}],45:[function(e,t,n){arguments[4][18][0].apply(n,arguments)},{_process:13,dup:18}],46:[function(e,t,n){arguments[4][19][0].apply(n,arguments)},{"./seventh.js":52,dup:19}],47:[function(e,t,n){arguments[4][20][0].apply(n,arguments)},{"./seventh.js":52,dup:20}],48:[function(e,t,n){arguments[4][21][0].apply(n,arguments)},{_process:13,dup:21,setimmediate:45,timers:31}],49:[function(e,t,n){arguments[4][22][0].apply(n,arguments)},{"./seventh.js":52,dup:22}],50:[function(e,t,n){arguments[4][23][0].apply(n,arguments)},{"./seventh.js":52,_process:13,dup:23}],51:[function(e,t,n){arguments[4][24][0].apply(n,arguments)},{"./seventh.js":52,dup:24}],52:[function(e,t,n){arguments[4][25][0].apply(n,arguments)},{"./api.js":46,"./batch.js":47,"./core.js":48,"./decorators.js":49,"./misc.js":50,"./parasite.js":51,"./wrapper.js":53,dup:25}],53:[function(e,t,n){arguments[4][26][0].apply(n,arguments)},{"./seventh.js":52,dup:26}],54:[function(e,t,n){"use strict";var i={};t.exports=i;i.toCamelCase=function(e,t=false){if(!e||typeof e!=="string"){return""}return e.replace(/^[\s_-]*([^\s_-]+)|[\s_-]+([^\s_-]?)([^\s_-]*)/g,(e,n,i,r)=>{if(t){if(n){return n}if(!i){return""}return i.toUpperCase()+r}if(n){return n.toLowerCase()}if(!i){return""}return i.toUpperCase()+r.toLowerCase()})};i.camelCaseToSeparated=function(e,t=" "){if(!e||typeof e!=="string"){return""}return e.replace(/^([A-Z])|([A-Z])/g,(e,n,i)=>{if(n){return n.toLowerCase()}return t+i.toLowerCase()})};i.camelCaseToDash=i.camelCaseToDashed=(e=>i.camelCaseToSeparated(e,"-"))},{}],55:[function(e,t,n){arguments[4][28][0].apply(n,arguments)},{dup:28}],56:[function(e,t,n){t.exports={name:"svg-kit",version:"0.2.2",description:"A small SVG toolkit.",main:"lib/svg-kit.js",directories:{test:"test"},bin:{svgkit:"./bin/svgkit"},dependencies:{"@cronvel/xmldom":"^0.1.31","dom-kit":"^0.3.14",minimist:"^1.2.0",seventh:"^0.7.30","string-kit":"^0.10.1","terminal-kit":"^1.31.4"},devDependencies:{},scripts:{test:"tea-time -R dot"},repository:{type:"git",url:"https://github.com/cronvel/svg-kit.git"},keywords:["svg"],author:"Cédric Ronvel",license:"MIT",bugs:{url:"https://github.com/cronvel/svg-kit/issues"},copyright:{title:"SVG Kit",years:[2017,2019],owner:"Cédric Ronvel"}}},{}]},{},[2])(2)});