(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function(){function e(t,n,i){function r(a,o){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}return e}()({1:[function(e,t,n){"use strict";const i=e("nextgen-events/lib/browser.js");const r=e("seventh");const s=e("dom-kit");const a=e("svg-kit");const o=e("../../commonUtils.js");function l(){}function c(){this.$body=document.querySelector("body");this.$spellcast=document.querySelector("spellcast");this.$theme=document.querySelector("#theme");this.$gfx=document.querySelector("#gfx");this.$sceneImage=document.querySelector(".scene-image");this.$main=document.querySelector("main");this.$mainBuffer=document.querySelector("#main-buffer");this.$altBuffer=document.querySelector("#alt-buffer");this.$closeAltButton=document.querySelector("#button-close-alt");this.$dialogWrapper=document.querySelector("#dialog-wrapper");this.$hint=document.querySelector("#hint");this.$lobby=document.querySelector("#lobby");this.$clientStatus=this.$lobby.querySelector(".client-status");this.$status=document.querySelector("#status");this.$panel=document.querySelector("#panel");this.$music=document.querySelector("#music");this.$sound0=document.querySelector("#sound0");this.$sound1=document.querySelector("#sound1");this.$sound2=document.querySelector("#sound2");this.$sound3=document.querySelector("#sound3");this.choices=[];this.newSegmentNeeded=null;this.onSelect=null;this.onLeave=null;this.onEnter=null;this.toMainBuffer();this.nextSoundChannel=0;this.sprites={};this.uis={};this.markers={};this.cards={};this.gItemLocations={};this.animations={};this.hintTimer=null;this.sceneImageOnTimer=null;this.onCommandSubmit=null;this.uiLoadingCount=0;this.initEvents()}t.exports=c;c.prototype=Object.create(i.prototype);c.prototype.constructor=c;c.prototype.cleanUrl=function(e){if(e[0]==="/"){return window.location.pathname+e.slice(1)}return window.location.pathname+"script/"+e};c.prototype.setTheme=function(e){this.$theme.setAttribute("href",this.cleanUrl(e.url))};c.prototype.preload=function(){s.preload(["icons/plugged.svg","icons/plugging.svg","icons/unplugged.svg","icons/unreachable-plug.svg"])};c.prototype.initEvents=function(){this.$main.addEventListener("click",()=>this.emit("continue"),false);this.$gfx.addEventListener("click",e=>{if(e.target.classList.contains("scene-image")){this.toggleSceneImage()}},false);this.$dialogWrapper.addEventListener("click",()=>this.clearDialog(),false);this.$lobby.addEventListener("click",()=>{this.$lobby.classList.toggle("toggled")});this.$status.addEventListener("click",()=>{this.$status.classList.toggle("toggled")});this.$panel.addEventListener("click",()=>{this.$panel.classList.toggle("toggled")})};c.prototype.toggleSceneImage=function(){if(this.$gfx.classList.contains("toggled")){this.sceneImageOff()}else{this.sceneImageOn()}};c.prototype.sceneImageOn=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.add("toggled");this.$spellcast.classList.add("gfx-toggled");this.sceneImageOnTimer=setTimeout(this.sceneImageOff.bind(this),8e3)};c.prototype.sceneImageOff=function(){if(this.sceneImageOnTimer!==null){clearTimeout(this.sceneImageOnTimer);this.sceneImageOnTimer=null}this.$gfx.classList.remove("toggled");this.$spellcast.classList.remove("gfx-toggled")};c.prototype.toMainBuffer=function(){if(this.$activeBuffer===this.$mainBuffer){return}if(this.$activeBuffer){this.clearChoices();this.clearMessages();this.clearHint();this.clearHistory()}this.$activeBuffer=this.$mainBuffer;this.$importantMessages=null;this.$mainBuffer.classList.remove("inactive");this.$altBuffer.classList.add("inactive");this.$closeAltButton.classList.add("inactive");this.getSwitchedElements();return true};c.prototype.toAltBuffer=function(){if(this.$activeBuffer===this.$altBuffer){return}this.$activeBuffer=this.$altBuffer;this.$importantMessages=this.$activeSegment;this.$mainBuffer.classList.add("inactive");this.$altBuffer.classList.remove("inactive");this.$closeAltButton.classList.remove("inactive");this.getSwitchedElements();return true};c.prototype.getSwitchedElements=function(){this.$history=this.$activeBuffer.querySelector(".messages.history");this.$activeMessages=this.$activeBuffer.querySelector(".messages.active");this.$choices=this.$activeBuffer.querySelector(".choices");this.$chat=this.$activeBuffer.querySelector(".chat");this.$chatForm=this.$chat.querySelector(".chat-form");this.$chatInput=this.$chatForm.querySelector(".chat-input");this.$activeSegment=this.$activeMessages.querySelector("segment:last-child");if(!this.$activeSegment){this.newSegment()}else{this.newSegmentOnContent()}};c.prototype.clientStatus=function(e){this.$clientStatus.setAttribute("data-status",e);this.$clientStatus.setAttribute("title",e)};c.prototype.setMultiplayer=function(e,t){t=t||l;if(e||e===undefined){this.$spellcast.classList.add("multiplayer")}else{this.$spellcast.classList.remove("multiplayer")}t()};c.prototype.clear=function(e){e=e||l;s.empty(this.$hint);s.empty(this.$dialogWrapper);s.empty(this.$activeMessages);s.empty(this.$choices);e()};c.prototype.clearMessages=function(e){e=e||l;s.empty(this.$activeMessages);e()};c.prototype.clearHistory=function(e){e=e||l;s.empty(this.$history);e()};c.prototype.newSegment=function(e){var t,n=e==="inter-segment";this.newSegmentNeeded=null;if(n){if(this.$activeSegment&&this.$activeSegment.tagName.toLowerCase()==="inter-segment"){return}t=document.createElement("inter-segment")}else{t=document.createElement("segment")}if(this.$activeSegment&&!this.$activeSegment.children.length){this.$activeSegment.remove()}this.$activeSegment=t;this.$activeMessages.appendChild(t);if(!n){this.moveToHistory()}};c.prototype.moveToHistory=function(){var e,t;var n=Array.from(this.$activeMessages.children);t=n.length-2;while(t>=0&&n[t].tagName.toLowerCase()==="inter-segment"){t--}if(t<0){return}for(e=0;e<=t;e++){this.$history.appendChild(n[e])}n[t].scrollIntoView(false)};c.prototype.newSegmentOnContent=function(e){e=e||"segment";this.newSegmentNeeded=e};c.prototype.addSelectedChoice=function(e){var t=document.createElement("p");t.classList.add("chosen");t.textContent=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};c.prototype.addMessage=function(e,t,n){var i=false;n=n||l;var r=()=>{if(i){return}i=true;if(t.next){a.scrollIntoView(false);this.messageNext(t.next,n);return}n()};var a=document.createElement("p");a.classList.add("text");if(t.next){a.classList.add("continue")}if(t.class){s.class(a,o.toClassObject(t.class),"s-")}if(t.style){s.css(a,t.style)}a.innerHTML=e;if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(a);if(t.important&&this.$importantMessages){this.$importantMessages.appendChild(a.cloneNode(true))}r()};c.prototype.messageNext=function(e,t){var n=false;var i=()=>{if(n){return}n=true;this.$spellcast.classList.remove("continue");t()};this.$spellcast.classList.add("continue");this.once("continue",i);if(typeof e==="number"&&isFinite(e)&&e>0){setTimeout(i,e*1e3)}};c.prototype.addIndicators=function(e,t,n){n=n||l;if(t){s.empty(this.$status);if(e.length){this.$status.classList.remove("empty")}else{this.$status.classList.add("empty");n();return}}var i=document.createElement("indicator-list");e.forEach(e=>{var t,n,r,s,a,o;t=document.createElement("indicator");n=document.createElement("label");n.classList.add("label");if(e.image){t.classList.add("has-image");r=document.createElement("img");r.classList.add("image");r.setAttribute("src",this.cleanUrl(e.image));if(e.label){r.setAttribute("alt",e.label);r.setAttribute("title",e.label)}n.appendChild(r)}else{n.textContent=e.label}t.appendChild(n);s=document.createElement("widget");s.classList.add("widget");s.classList.add(e.type);s.setAttribute("data-value",e.value);switch(e.type){case"hbar":o=document.createElement("outer-bar");s.appendChild(o);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.width=""+e.value+"%";o.appendChild(a);break;case"vbar":o=document.createElement("outer-bar");s.appendChild(o);a=document.createElement("inner-bar");if(isNaN(e.value)){e.value=0}else if(e.value>100){e.value=100}else if(e.value<0){e.value=0}if(typeof e.color==="string"){a.style.backgroundColor=e.color}a.style.height=""+e.value+"%";o.appendChild(a);break;case"text":default:s.textContent=e.value}t.appendChild(s);i.appendChild(t)});if(t){this.$status.appendChild(i)}else{if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(i)}n()};c.prototype.createChoiceEventHandlers=function(e){this.onSelect=(t=>{var n=t.currentTarget;var i=n.getAttribute("data-select-index");if(!i){return}i=parseInt(i,10);e(i)});this.onLeave=(e=>{this.clearHint()});this.onEnter=(e=>{var t=e.currentTarget;var n=t.getAttribute("data-button-hint");if(!n){return}this.setHint(n,{active:true})})};c.prototype.addPanel=function(e,t,n){n=n||l;if(t){s.empty(this.$panel);if(e.length){this.$panel.classList.remove("empty")}else{this.$panel.classList.add("empty");n();return}}else if(e.length){this.$panel.classList.remove("empty")}e.forEach(e=>{var t,n,i="button-"+e.id;if(document.getElementById(i)){return}t=document.createElement("item");t.classList.add("button");t.classList.add("disabled");t.setAttribute("id",i);if(e.image){t.classList.add("has-image");if(e.image.endsWith(".svg")){n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.classList.add("svg");a.load(this.cleanUrl(e.image),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,colorClass:true,as:n})}else{n=document.createElement("img");n.setAttribute("src",this.cleanUrl(e.image))}n.classList.add("icon");n.classList.add("image");if(e.label){n.setAttribute("alt",e.label);n.setAttribute("title",e.label)}t.appendChild(n)}else{t.textContent=e.label}this.$panel.appendChild(t)});n()};c.prototype.clearChoices=function(e){var t;e=e||l;this.choices.forEach(e=>{if(!e.button){return}var n="button-"+e.button;t=document.getElementById(n);if(t){t.removeAttribute("data-select-index");t.classList.add("disabled");t.removeEventListener("click",this.onSelect);t.removeEventListener("mouseleave",this.onLeave);t.removeEventListener("mouseenter",this.onEnter)}});s.empty(this.$choices);this.choices.length=0;this.onSelect=null;this.onLeave=null;this.onEnter=null;e()};c.prototype.addChoices=function(e,t,n){if(this.uiLoadingCount){this.once("uiLoaded",this.addChoices.bind(this,e,t,n));return}var i=false;var r=document.createDocumentFragment();var a=document.createElement("group");n=n||l;this.createChoiceEventHandlers(t);e.forEach(e=>{var t;this.choices.push(e);if(e.button&&(t=document.getElementById("button-"+e.button))&&!t.getAttribute("data-select-index")&&!t.classList.contains("inactive")){if(e.groupBreak){i=true}t.setAttribute("data-select-index",e.index);t.classList.remove("disabled");t.addEventListener("click",this.onSelect);if(e.label){t.setAttribute("data-button-hint",e.label);t.addEventListener("mouseleave",this.onLeave);t.addEventListener("mouseenter",this.onEnter)}return}var n=document.createElement("choice");n.classList.add("choice",e.type);n.setAttribute("data-select-index",e.index);n.classList.remove("disabled");if(e.class){s.class(n,o.toClassObject(e.class),"s-")}if(e.style){s.css(n,e.style)}if(e.image){n.classList.add("has-image");var l=document.createElement("img");l.classList.add("image");l.setAttribute("src",this.cleanUrl(e.image));n.appendChild(l)}var c=document.createElement("span");c.classList.add("label");c.textContent=e.label;n.appendChild(c);if(e.selectedBy&&e.selectedBy.length){var u=document.createElement("span");u.classList.add("italic","brightBlack");u.textContent=" "+e.selectedBy.join(", ");n.appendChild(u)}n.addEventListener("click",this.onSelect);if(e.groupBreak||i){i=false;r.appendChild(a);a=document.createElement("group")}a.appendChild(n)});r.appendChild(a);this.$choices.appendChild(r);n()};c.prototype.getChoiceColumnsCount=function(e){var t=0,n=0;e.forEach(e=>{if(e.groupBreak){if(t>n){n=t}t=0}t++});if(t>n){n=t}return n};c.prototype.setChoices=function(e,t,n,i,r){i=i||{};r=r||l;this.clearChoices(()=>{switch(i.nextStyle){case"inline":case"smallInline":case"list":case"smallList":this.$choices.setAttribute("data-choice-style",i.nextStyle);break;case"table":this.$choices.setAttribute("data-choice-style",i.nextStyle);this.$choices.classList.add("columns-"+this.getChoiceColumnsCount(e));break;default:this.$choices.setAttribute("data-choice-style","list")}this.addChoices(e,n,r);if(t&&t.length){var s=document.createElement("p");s.classList.add("unassigned-users");s.textContent=t.join(", ");this.$choices.appendChild(s)}if(typeof i.timeout==="number"){this.choiceTimeout(i.timeout)}})};c.prototype.updateChoices=c.prototype.setChoices;c.prototype.choiceTimeout=function(e){var t=Date.now(),n,i;n=document.createElement("p");n.classList.add("timer");n.textContent=Math.round(e/1e3);this.$choices.appendChild(n);i=setInterval(()=>{if(!n.parentNode){clearInterval(i);return}n.textContent=Math.round((e+t-Date.now())/1e3)},1e3)};c.prototype.textInputDisabled=function(e){var t=document.createElement("form"),n=document.createElement("label"),i=document.createElement("input");n.textContent=e.label;i.setAttribute("placeholder",e.placeholder);i.setAttribute("disabled",true);i.setAttribute("type","text");i.classList.add("text-input");t.appendChild(n);t.appendChild(i);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(t)};c.prototype.textInput=function(e,t){var n=document.createElement("form"),i=document.createElement("label"),r=document.createElement("input");i.classList.add("text");i.textContent=e.label;r.setAttribute("type","text");r.classList.add("text-input");n.appendChild(i);n.appendChild(r);if(this.newSegmentNeeded){this.newSegment(this.newSegmentNeeded)}this.$activeSegment.appendChild(n);r.focus();var s=function(e){e.preventDefault();n.removeEventListener("submit",s);r.setAttribute("disabled",true);t(r.value)};n.addEventListener("submit",s)};c.prototype.enableCommand=function(e){if(!this.onCommandSubmit){this.onCommandSubmit=(t=>{t.preventDefault();e(this.$chatInput.value);this.$chatInput.value=""});this.$chatForm.addEventListener("submit",this.onCommandSubmit);this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};c.prototype.disableCommand=function(){this.$chatForm.removeEventListener("submit",this.onCommandSubmit);this.onCommandSubmit=null;this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};c.prototype.clearHint=function(){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint)},3e3)};c.prototype.setHint=function(e,t){if(this.hintTimer!==null){clearTimeout(this.hintTimer);this.hintTimer=null}if(this.$hint.textContent){this.$hint.classList.add("empty");this.hintTimer=setTimeout(()=>{s.empty(this.$hint);this.setHint(e,t)},300);return}this.$hint.textContent=e;this.$hint.classList.remove("empty");s.class(this.$hint,{passive:!!t.passive,active:!!t.active});this.hintTimer=setTimeout(this.clearHint.bind(this),3e3)};c.prototype.setBigHint=function(e,t){var n=document.createElement("h2");n.textContent=e;if(t){s.class(n,t)}s.empty(this.$hint);this.$hint.appendChild(n)};c.prototype.clearDialog=function(){this.$dialogWrapper.classList.add("empty");this.$dialogWrapper.classList.remove("modal");var e=false;var t=()=>{this.$dialogWrapper.removeEventListener("transitionstart",t);if(e){return}e=true;this.$dialogWrapper.addEventListener("transitionend",n)};var n=()=>{this.$dialogWrapper.removeEventListener("transitionend",n);s.empty(this.$dialogWrapper)};this.$dialogWrapper.addEventListener("transitionstart",t);setTimeout(()=>{if(e){return}e=true;s.empty(this.$dialogWrapper)},10)};c.prototype.setDialog=function(e,t,n){t=t||{};n=n||l;if(t.contentDelay&&!this.newSegmentNeeded){delete t.contentDelay;var i=this.$activeSegment.innerHTML.replace(/<[^>]+>|&[a-z]+;/g,"").length;var r=Math.min(i*10,5e3);console.warn("contentLength/delay",i,r);setTimeout(this.setDialog.bind(this,e,t,n),r);return}var a=document.createElement("div");a.classList.add("dialog");if(t.title){var o=document.createElement("h2");o.classList.add("title");o.textContent=t.title;a.appendChild(o)}var c=document.createElement("div");c.classList.add("message");c.textContent=e;a.appendChild(c);if(t.slow){this.$dialogWrapper.classList.add("slow")}else{this.$dialogWrapper.classList.remove("slow")}if(t.big){a.classList.add("big")}if(t.fun){a.classList.add("fun")}if(t.alert){a.classList.add("alert")}if(t.modal){a.classList.add("modal");this.$dialogWrapper.classList.add("modal")}else{this.$dialogWrapper.classList.remove("modal")}s.empty(this.$dialogWrapper);this.$dialogWrapper.appendChild(a);this.$dialogWrapper.classList.remove("empty");n()};c.prototype.setSceneImage=function(e){var t=false;var n=this.$sceneImage;this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(e.url){this.$sceneImage.style.backgroundImage='url("'+this.cleanUrl(e.url)+'")'}if(e.origin&&typeof e.origin==="string"){this.$sceneImage.style.backgroundPosition=e.origin}var i=()=>{if(t){return}t=true;n.remove()};if(n){n.addEventListener("transitionend",i,false);this.$gfx.insertBefore(this.$sceneImage,n);n.classList.add("hidden");setTimeout(i,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(e.position){case"left":this.$spellcast.setAttribute("data-image-position","left");break;case"right":default:this.$spellcast.setAttribute("data-image-position","right");break}};c.prototype.clearSprite=function(e){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return}this.clearGItem(this.sprites[e]);delete this.sprites[e]};c.prototype.clearUi=function(e){if(!this.uis[e]){console.warn("Unknown UI id: ",e);return}this.clearGItem(this.uis[e]);delete this.uis[e]};c.prototype.clearMarker=function(e){if(!this.markers[e]){console.warn("Unknown Marker id: ",e);return}this.clearGItem(this.markers[e]);delete this.markers[e]};c.prototype.clearCard=function(e){if(!this.cards[e]){console.warn("Unknown Card id: ",e);return}this.clearGItem(this.cards[e]);delete this.cards[e]};c.prototype.showSprite=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.sprites[e]){this.clearGItem(this.sprites[e])}var n=this.sprites[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"sprite",location:null,class:t.class,style:{},animation:null});return this.updateGItem(n,t,true)};c.prototype.showUi=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.uis[e]){this.clearGItem(this.uis[e])}var n=this.uis[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"ui",class:t.class,style:{},area:{},animation:null});return this.updateGItem(n,t,true)};c.prototype.showMarker=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.markers[e]){this.clearGItem(this.markers[e])}var n=this.markers[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"marker",ui:null,location:null,class:t.class,style:{},animation:null});return this.updateGItem(n,t,true)};var u=0;c.prototype.showCard=function(e,t){if(!t.url||typeof t.url!=="string"){return r.resolved}if(this.cards[e]){this.clearGItem(this.cards[e])}var n=this.cards[e]=this.createGItem({actionCallback:t.actionCallback,action:null,type:"card",location:"showing",$locationSlot:null,pose:null,order:u++,class:t.class,style:{},imageStyle:{},animation:null,contents:{}});this.createCardMarkup(n);return this.updateGItem(n,t,true)};c.prototype.updateSprite=function(e,t){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return r.resolved}return this.updateGItem(this.sprites[e],t)};c.prototype.updateUi=function(e,t){if(!this.uis[e]){console.warn("Unknown UI id: ",e);return r.resolved}return this.updateGItem(this.uis[e],t)};c.prototype.updateMarker=function(e,t){if(!this.markers[e]){console.warn("Unknown marker id: ",e);return r.resolved}return this.updateGItem(this.markers[e],t)};c.prototype.updateCard=function(e,t){if(!this.cards[e]){console.warn("Unknown card id: ",e);return r.resolved}return this.updateGItem(this.cards[e],t)};c.prototype.animateSprite=function(e,t){if(!this.sprites[e]){console.warn("Unknown sprite id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.sprites[e],this.animations[t])};c.prototype.animateUi=function(e,t){if(!this.uis[e]){console.warn("Unknown UI id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.uis[e],this.animations[t])};c.prototype.animateMarker=function(e,t){if(!this.markers[e]){console.warn("Unknown marker id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.markers[e],this.animations[t])};c.prototype.animateCard=function(e,t){if(!this.cards[e]){console.warn("Unknown card id: ",e);return r.resolved}if(!this.animations[t]){console.warn("Unknown animation id: ",t);return r.resolved}return this.animateGItem(this.cards[e],this.animations[t])};c.prototype.createGItem=function(e){var t=new i;if(e.type!=="marker"){t.$wrapper=document.createElement("div");t.$wrapper.style.visibility="hidden";t.$wrapper.classList.add("g-item-wrapper",e.type+"-wrapper");this.$gfx.append(t.$wrapper)}t.size={mode:"relative",xy:1};t.position={mode:"relative",x:0,y:0};t.transform={};Object.assign(t,e);t.defineStates("loaded","loading");return t};c.prototype.clearGItem=function(e){if(e.$locationSlot){e.$locationSlot.remove()}e.$wrapper.remove()};c.prototype.updateGItem=async function(e,t,n=false){if(t.url){await this.updateGItemImage(e,t)}if(t.backUrl){await this.updateGItemBackImage(e,t)}if(t.maskUrl){await this.updateGItemMask(e,t)}if(t.content){this.updateGItemContent(e,t)}if(t.button!==undefined){this.updateGItemButton(e,t)}if(t.area){this.updateUiArea(e,t.area)}if(e.type==="marker"&&(t.ui||t.location)){this.updateMarkerLocation(e,t.ui,t.location)}return this.updateGItemCosmetics(e,t,n)};c.prototype.updateGItemCosmetics=async function(e,t,n=false){if(n){e.$wrapper.style.transition="none"}else if(t.transition!==undefined){if(t.transition===null){e.$wrapper.style.transition=""}else if(!t.transition){e.$wrapper.style.transition="none"}else{e.$wrapper.style.transition="all "+t.transition+"s"}}if(t.location!==undefined&&e.type!=="marker"){await this.moveGItemToLocation(e,t)}if(t.pose!==undefined){this.updateGItemPose(e,t)}if(t.status){this.updateGItemStatus(e,t)}if(t.style&&e.$wrapper){delete t.style.position;Object.assign(e.style,t.style);s.css(e.$wrapper,t.style)}if(t.imageStyle&&e.$image){delete t.imageStyle.position;Object.assign(e.imageStyle,t.imageStyle);s.css(e.$image,t.imageStyle)}if(t.backImageStyle&&e.$backImage){delete t.backImageStyle.position;Object.assign(e.backImageStyle,t.backImageStyle);s.css(e.$backImage,t.backImageStyle)}if(t.maskStyle&&e.$mask){delete t.maskStyle.position;Object.assign(e.maskStyle,t.maskStyle);s.css(e.$mask,t.maskStyle)}if(t.size||t.position){this.updateGItemTransform(e,t)}if(t.class){t.class=o.toClassObject(t.class);Object.assign(e.class,t.class);s.class(e.$wrapper||e.$image,t.class,"s-")}if(n){e.$wrapper.style.visibility="visible";await r.resolveAtAnimationFrame();if(t.transition===undefined||t.transition===null){e.$wrapper.style.transition=""}else if(!t.transition){e.$wrapper.style.transition="none"}else{e.$wrapper.style.transition="all "+t.transition+"s"}}};c.prototype.updateGItemImage=function(e,t){var n=new r;if(e.type==="card"){e.$image.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")';n.resolve();return n}if(t.url.endsWith(".svg")){if(e.$image){e.$image.remove()}if(e.type==="marker"){e.$image=document.createElementNS("http://www.w3.org/2000/svg","g")}else{e.$image=document.createElementNS("http://www.w3.org/2000/svg","svg");e.$image.classList.add("svg")}switch(e.type){case"ui":e.onClick=(e=>{e.stopPropagation()});e.$image.addEventListener("click",e.onClick);e.$image.classList.add("ui");this.uiLoadingCount++;break;case"sprite":e.$image.classList.add("sprite");break;case"marker":e.$image.classList.add("marker");break}a.load(this.cleanUrl(t.url),{removeSvgStyle:true,removeComments:true,removeExoticNamespaces:true,as:e.$image},()=>{if(e.type==="ui"){this.setUiButtons(e.$image);this.setUiPassiveHints(e.$image);e.emit("loaded");if(--this.uiLoadingCount<=0){this.emit("uiLoaded")}}else{e.emit("loaded");n.resolve()}});e.emit("loading")}else{if(!e.$image||e.$image.tagName.toLowerCase()!=="img"){if(e.$image){e.$image.remove()}e.$image=document.createElement("img");e.$image.classList.add(e.type)}e.$image.setAttribute("src",this.cleanUrl(t.url));e.$image.onload=(()=>n.resolve())}if(e.type!=="marker"){e.$wrapper.append(e.$image)}return n};c.prototype.updateGItemBackImage=function(e,t){if(e.type==="card"){e.$backImage.style.backgroundImage='url("'+this.cleanUrl(t.backUrl)+'")'}return r.resolved};c.prototype.updateGItemMask=function(e,t){var n=new r;if(t.maskUrl.endsWith(".svg")&&e.type==="sprite"){console.warn("has mask!");if(e.$mask){e.$mask.remove()}e.$mask=document.createElementNS("http://www.w3.org/2000/svg","svg");e.$mask.classList.add("sprite-mask");a.load(this.cleanUrl(t.maskUrl),{removeSvgStyle:true,removeSize:true,removeIds:true,removeComments:true,removeExoticNamespaces:true,as:e.$mask},()=>n.resolve());e.$wrapper.append(e.$mask);e.$wrapper.classList.add("has-mask")}else if(e.$mask){e.$mask.remove();e.$wrapper.classList.remove("has-mask");n.resolve()}return n};c.prototype.updateGItemTransform=function(e,t){var n,i,r,a,o,l,c,u;if(!e.$wrapper||!e.$image){return}if(t.size){e.size=t.size}if(t.position){e.position=t.position}if(e.$image.tagName.toLowerCase()==="svg"){n=e.$wrapper.offsetWidth/e.$wrapper.offsetHeight;i=e.$image.width.baseVal.value/e.$image.height.baseVal.value;if(i>n){r=e.$wrapper.offsetWidth;a=r/i}else{a=e.$wrapper.offsetHeight;r=a*i}console.log("dbg svg:",{wrapperAspect:n,imageAspect:i,imageWidth:r,imageHeight:a})}else{r=e.$image.offsetWidth;a=e.$image.offsetHeight}switch(e.size.mode){case"area":case"areaMin":default:e.transform.scale=e.size.xy;console.log("transform after .updateGItemSize()",e.transform);break}switch(e.position.mode){case"areaInSpriteOut":o=l=0;c=this.$gfx.offsetWidth-r;u=this.$gfx.offsetHeight-a;if(e.transform.scale!==undefined){o=-.5*r*(1-e.transform.scale);l=-.5*a*(1-e.transform.scale);c+=r*(1-e.transform.scale);u+=a*(1-e.transform.scale)}console.log("dbg:",{xMinOffset:o,xFactor:c,yFactor:u});if(e.position.x<-1){e.transform.translateX=o+(e.position.x+1)*r*e.transform.scale}else if(e.position.x>1){e.transform.translateX=o+c+(e.position.x-1)*r*e.transform.scale}else{e.transform.translateX=o+(.5+e.position.x/2)*c}if(e.position.y<-1){e.transform.translateY=l+u-(e.position.y+1)*a*e.transform.scale}else if(e.position.y>1){e.transform.translateY=l-(e.position.y-1)*a*e.transform.scale}else{e.transform.translateY=l+(.5-e.position.y/2)*u}console.log("transform after .updateGItemPosition()",e.transform);break;case"area":default:o=l=0;c=this.$gfx.offsetWidth-r;u=this.$gfx.offsetHeight-a;if(e.transform.scale!==undefined){o=-.5*r*(1-e.transform.scale);l=-.5*a*(1-e.transform.scale);c+=r*(1-e.transform.scale);u+=a*(1-e.transform.scale)}console.log("dbg:",{xMinOffset:o,xFactor:c,yFactor:u});e.transform.translateX=o+(.5+e.position.x/2)*c;e.transform.translateY=l+(.5-e.position.y/2)*u;console.log("transform after .updateGItemPosition()",e.transform);break}s.transform(e.$wrapper,e.transform)};c.prototype.updateGItemContent=function(e,t){var n,i;if(e.type!=="card"){return}for(let r in t.content){n=t.content[r];i=e.contents[r];if(!i){i=e.contents[r]=document.createElement("div");i.classList.add("content-"+r);e.$front.append(i)}i.textContent=n;i.setAttribute("content",n)}};c.prototype.updateGItemPose=function(e,t){if(typeof t.pose==="string"){e.$wrapper.setAttribute("pose",t.pose);e.pose=t.pose}else{e.$wrapper.removeAttribute("pose");e.pose=null}};c.prototype.updateGItemStatus=function(e,t){var n,i;for(i in t.status){n=t.status[i];if(n){e.$wrapper.classList.add("status-"+i);if(typeof n==="number"||typeof n==="string"){e.$wrapper.setAttribute("status-"+i,n)}}else{e.$wrapper.classList.remove("status-"+i);if(e.$wrapper.hasAttribute("status-"+i)){e.$wrapper.removeAttribute("status-"+i)}}}};c.prototype.updateGItemButton=function(e,t){var n=e.$mask||e.$wrapper;var i=t.button;n.setAttribute("id","button-"+i);n.classList.add("button");n.classList.add("disabled")};c.prototype.updateGItemAction=function(e,t){var n=e.$mask||e.$image;if(t.action&&!e.action){e.onClick=(t=>{e.actionCallback(e.action);t.stopPropagation()});n.classList.add("button");n.addEventListener("click",e.onClick)}else if(!t.action&&e.action){n.classList.remove("button");n.removeEventListener("click",e.onClick)}e.action=t.action||null};c.prototype.moveGItemToLocation=function(e,t){var n=new r,i=t.location;if(e.location===i){n.resolve();return n}var a,o,l,c,u,f,h,p,d,m,g,v,y;var b=10;l=e.location;o=l?this.gItemLocations[l]:this.$gfx;u=e.$locationSlot||this.$gfx;e.location=i;a=i?this.gItemLocations[i]:this.$gfx;if(!a){a=this.gItemLocations[i]=document.createElement("div");a.classList.add("g-item-location");a.classList.add("g-item-location-"+i);this.$gfx.append(a)}var w=window.getComputedStyle(e.$wrapper);var k=window.getComputedStyle(a);var x=parseFloat(w.width);var _=parseFloat(w.height);if(a===this.$gfx){c=this.$gfx}else{c=e.$locationSlot=document.createElement("div");c.classList.add("g-item-slot");c.style.order=e.order}p=[...Object.values(this.cards),...Object.values(this.sprites),...Object.values(this.uis)].filter(t=>t!==e&&t.location&&(t.location===i||t.location===l));d=p.map(e=>e.$locationSlot.getBoundingClientRect());if(c!==this.$gfx){if(a.lastChild&&parseFloat(a.lastChild.style.order)>e.order){a.prepend(c)}else{a.append(c)}}y=u.getBoundingClientRect();if(u!==this.$gfx){u.remove()}m=p.map(e=>e.$locationSlot.getBoundingClientRect());p.forEach((e,t)=>{var n=d[t],i=m[t];var r=e.$wrapper.style.transition;var a=e.$wrapper.style.transform;var o=Object.assign({},e.localTransform);o.translateX+=n.left-i.left;o.translateY+=n.top-n.top;e.$wrapper.style.transition="none";e.$wrapper.style.transform=s.stringifyTransform(o);setTimeout(()=>{e.$wrapper.style.transition=r;e.$wrapper.style.transform=a},b)});var S={translateX:0,translateY:0};switch(k.flexDirection){case"row":case"row-reverse":g=parseFloat(k.height);S.scaleX=S.scaleY=g/_;break;case"column":case"column-reverse":g=parseFloat(k.width);S.scaleX=S.scaleY=g/x;break;default:g=parseFloat(k.height);S.scaleX=S.scaleY=g/_;console.warn("flex-direction",k.flexDirection)}S.translateX-=(x-x*S.scaleX)/2;S.translateY-=(_-_*S.scaleY)/2;var C=e.localTransform;e.localTransform=S;if(u===this.$gfx){e.$wrapper.style.transform=s.stringifyTransform(S);c.append(e.$wrapper);n.resolve();return n}var E=window.getComputedStyle(o);switch(E.flexDirection){case"column":case"column-reverse":h="column";break;default:h="row"}v=c.getBoundingClientRect();var L={translateX:y.left+C.translateX-v.left,translateY:y.top+C.translateY-v.top,scaleX:C.scaleX,scaleY:C.scaleY};e.$wrapper.style.transform=s.stringifyTransform(L);c.append(e.$wrapper);setTimeout(()=>{e.$wrapper.style.transform=s.stringifyTransform(S);n.resolve()},b);return n};c.prototype.updateUiArea=function(e,t){var n;if(e.type!=="ui"){return}if(!e.hasState("loaded")){e.once("loaded",this.updateUiArea.bind(this,e,t));return}for(n in t){if(!e.area[n]){e.area[n]={}}if(!e.area[n].status){e.area[n].status={}}if(t[n].hint!==undefined){e.area[n].hint=t[n].hint||null}if(t[n].status){Object.assign(e.area[n].status,t[n].status)}Array.from(e.$image.querySelectorAll("[area="+n+"]")).forEach(e=>{var i;if(t[n].hint!==undefined){if(t[n].hint){e.setAttribute("data-passive-hint",t[n].hint);e.classList.add("passive-hint")}else{e.removeAttribute("data-passive-hint");e.classList.remove("passive-hint")}}if(t[n].status){for(i in t[n].status){if(t[n].status[i]){e.classList.add("status-"+i)}else{e.classList.remove("status-"+i)}}}})}};c.prototype.updateMarkerLocation=function(e,t,n){var i,r,s,o,l,c,u,f,h,p;if(!e.hasState("loaded")){e.once("loaded",this.updateMarkerLocation.bind(this,e,t,n));return}if(!t){t=e.ui}if(!n){n=e.location}if(!this.uis[t]){console.warn("Unknown UI id: ",t);return}i=this.uis[t];if(!i.hasState("loaded")){i.once("loaded",this.updateMarkerLocation.bind(this,e,t,n));return}r=i.$image.querySelector("[area="+n+"]");if(!r){console.warn("UI "+t+": area not found",n);return}e.ui=t;e.location=n;s=r.getBBox();h=s.x+s.width/2;p=s.y+s.height/2;o=a.getViewBox(e.$image);l=parseFloat(e.$image.getAttribute("width"))||o.width;c=parseFloat(e.$image.getAttribute("height"))||o.height;if(!isNaN(u=parseFloat(e.$image.getAttribute("originX")))){h-=(u-o.x)/o.width*l}if(!isNaN(f=parseFloat(e.$image.getAttribute("originY")))){p-=(f-o.y)/o.height*c}e.$image.style.transform="translate("+h+"px , "+p+"px )"+"scale("+l/o.width+" , "+c/o.height+")";if(e.$image.ownerSVGElement!==i.$image){i.$image.append(e.$image)}};c.prototype.createGItemLocation=function(e){var t;if(this.gItemLocations[e]){return}t=this.gItemLocations[e]=document.createElement("div");t.classList.add("g-item-location");t.classList.add("g-item-location-"+e);this.$gfx.append(t)};c.prototype.createCardMarkup=function(e){e.$card=document.createElement("div");e.$card.classList.add("card");e.$wrapper.append(e.$card);e.$front=document.createElement("div");e.$front.classList.add("front");e.$card.append(e.$front);e.$image=document.createElement("div");e.$image.classList.add("card-image");e.$front.append(e.$image);e.$back=document.createElement("div");e.$back.classList.add("back");e.$card.append(e.$back);e.$backImage=document.createElement("div");e.$backImage.classList.add("card-image");e.$back.append(e.$backImage)};c.prototype.animateGItem=async function(e,t){var n,i=0;e.animation=t.id;if(!Array.isArray(t.frames)||!t.frames.length){return}for(n of t.frames){await this.updateGItem(e,n);await r.resolveTimeout(n.duration*1e3)}e.animation=null};c.prototype.defineAnimation=function(e,t){t.id=e;this.animations[e]=t};c.prototype.setUiButtons=function(e){Array.from(e.querySelectorAll("[button]")).forEach(e=>{var t=e.getAttribute("button");e.setAttribute("id","button-"+t);if(!e.getAttribute("area")){e.setAttribute("area",t)}e.classList.add("button");e.classList.add("disabled")})};c.prototype.setUiPassiveHints=function(e){Array.from(e.querySelectorAll("[hint]")).forEach(e=>{var t=e.getAttribute("hint");e.setAttribute("data-passive-hint",t);e.classList.add("passive-hint");e.addEventListener("mouseleave",e=>{this.clearHint()});e.addEventListener("mouseenter",e=>{var t=e.currentTarget;var n=t.getAttribute("data-passive-hint");if(!n){return}this.setHint(n,{passive:true})})})};c.prototype.sound=function(e){var t=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,e,t);this.nextSoundChannel=(this.nextSoundChannel+1)%4;t.setAttribute("src",this.cleanUrl(e.url));t.play()};c.prototype.music=function(e){var t=this.$music.getAttribute("src");if(e.url){e.url=this.cleanUrl(e.url);if(t){if(t!==e.url){d(this.$music,()=>{this.$music.setAttribute("src",e.url);this.$music.play();p(this.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",e.url);this.$music.play();p(this.$music)}}else if(t){d(this.$music,()=>{this.$music.removeAttribute("src")})}};var f=10;var h=.01;function p(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+h);e.__fadeTimer=setTimeout(p.bind(undefined,e,t),f)}function d(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-h);e.__fadeTimer=setTimeout(d.bind(undefined,e,t),f)}},{"../../commonUtils.js":5,"dom-kit":7,"nextgen-events/lib/browser.js":11,seventh:25,"svg-kit":32}],2:[function(e,t,n){"use strict";const i=e("nextgen-events/lib/browser.js");const r=e("dom-kit");const s=e("url");function a(e){this.domain=e.domain||"localhost";this.port=e.port||80;this.path=e.path||"/";this.token=e.token||"";this.userName=e.name||"unknown_"+Math.floor(Math.random()*1e4);this.ws=null;this.proxy=null}t.exports=a;a.prototype=Object.create(i.prototype);a.prototype.constructor=a;const o={classic:e("./ui/classic.js")};a.autoCreate=function(){var e={port:window.location.port,domain:window.location.hostname,path:window.location.pathname};Object.assign(e,s.parse(window.location.href,true).query);window.spellcastClient=new a(e);if(!e.ui){e.ui=["classic"]}else if(!Array.isArray(e.ui)){e.ui=[e.ui]}window.spellcastClient.ui=e.ui;return window.spellcastClient};a.prototype.run=function(e){var t=false;this.proxy=new i.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(e=>{if(o[e]){new o[e](this.proxy.remoteServices.bus,this)}});var n="ws://"+this.domain+(this.port?":"+this.port:"")+this.path+(this.token||"");console.log("Websocket URL:",n);this.ws=new WebSocket(n);this.emit("connecting");this.ws.onerror=(()=>{if(!t){console.log("Can't open Websocket (error)...");this.emit("error","unreachable");return}});this.ws.onopen=(()=>{t=true;console.log("Websocket opened!");this.emit("open");this.proxy.remoteServices.bus.emit("authenticate",{name:this.userName});if(typeof e==="function"){e()}});this.ws.onclose=(()=>{if(!t){console.log("Can't open Websocket (close)...");this.emit("error","unreachable");return}t=false;this.proxy.destroy();console.log("Websocket closed!");this.emit("close")});this.ws.onmessage=(e=>{var t;try{t=JSON.parse(e.data)}catch(e){return}console.log("Message received: ",t);this.proxy.receive(t)});this.proxy.send=(e=>{this.ws.send(JSON.stringify(e))})};a.autoCreate();r.ready(()=>{window.spellcastClient.run();document.body.onkeypress=(e=>{if(e.keyCode!==120){return}var t,n=document.querySelectorAll("link[rel=stylesheet]");for(var i=0;i<n.length;i++){t=n[i].getAttribute("href").split("?")[0]+"?"+Math.random();n[i].setAttribute("href",t)}})})},{"./ui/classic.js":4,"dom-kit":7,"nextgen-events/lib/browser.js":11,url:35}],3:[function(e,t,n){"use strict";const i={};t.exports=i;const r=e("string-kit/lib/format.js").markupMethod;const s=e("string-kit/lib/escape.js").html;const a={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="bright blue">',c:'<span class="cyan">',C:'<span class="bright cyan">',g:'<span class="green">',G:'<span class="bright green">',k:'<span class="black">',K:'<span class="grey">',m:'<span class="magenta">',M:'<span class="bright magenta">',r:'<span class="red">',R:'<span class="bright red">',w:'<span class="white">',W:'<span class="bright white">',y:'<span class="yellow">',Y:'<span class="bright yellow">'}};i.markup=function(...e){e[0]=s(e[0]).replace(/\n/,"<br />");return r.apply(a,e)}},{"string-kit/lib/escape.js":28,"string-kit/lib/format.js":29}],4:[function(e,t,n){"use strict";var i=e("nextgen-events/lib/browser.js");var r=e("../Dom.js");var s=e("../toolkit.js");function a(e,t){console.log(Array.from(arguments));this.bus=e;this.client=t;this.user=null;this.users=null;this.roles=null;this.roleId=null;this.config=null;this.inGame=false;this.nexts=null;this.afterNext=false;this.afterNextTriggered=false;this.afterLeave=false;this.hasNewContent=false;this.dom=new r;this.ended=false;this.client.once("connecting",a.clientConnecting.bind(this));this.client.once("open",a.clientOpen.bind(this));this.client.once("close",a.clientClose.bind(this));this.client.on("error",a.clientError.bind(this));this.commandConfig({enabled:true});this.dom.preload()}t.exports=a;a.prototype=Object.create(i.prototype);a.prototype.constructor=a;function o(e){return this.find(t=>{return t.id===e})}a.prototype.initBus=function(){this.bus.on("clientConfig",a.clientConfig.bind(this));this.bus.on("user",a.user.bind(this));this.bus.on("userList",a.userList.bind(this));this.bus.on("roleList",a.roleList.bind(this));this.bus.on("extOutput",a.extOutput.bind(this));this.bus.on("extErrorOutput",a.extErrorOutput.bind(this));this.bus.on("message",a.message.bind(this),{async:true});this.bus.on("indicators",a.indicators.bind(this));this.bus.on("status",a.status.bind(this));this.bus.on("panel",a.panel.bind(this));this.bus.on("theme",a.theme.bind(this));this.bus.on("image",a.image.bind(this));this.bus.on("sound",a.sound.bind(this));this.bus.on("music",a.music.bind(this));this.bus.on("defineAnimation",a.defineAnimation.bind(this));this.bus.on("showSprite",a.showSprite.bind(this),{async:true});this.bus.on("updateSprite",a.updateSprite.bind(this),{async:true});this.bus.on("animateSprite",a.animateSprite.bind(this),{async:true});this.bus.on("clearSprite",a.clearSprite.bind(this));this.bus.on("showUi",a.showUi.bind(this));this.bus.on("updateUi",a.updateUi.bind(this));this.bus.on("animateUi",a.animateUi.bind(this));this.bus.on("clearUi",a.clearUi.bind(this));this.bus.on("showMarker",a.showMarker.bind(this));this.bus.on("updateMarker",a.updateMarker.bind(this));this.bus.on("animateMarker",a.animateMarker.bind(this));this.bus.on("clearMarker",a.clearMarker.bind(this));this.bus.on("showCard",a.showCard.bind(this));this.bus.on("updateCard",a.updateCard.bind(this));this.bus.on("animateCard",a.animateCard.bind(this));this.bus.on("clearCard",a.clearCard.bind(this));this.bus.on("enterScene",a.enterScene.bind(this));this.bus.on("leaveScene",a.leaveScene.bind(this));this.bus.on("nextList",a.nextList.bind(this));this.bus.on("nextTriggered",a.nextTriggered.bind(this));this.bus.on("textInput",a.textInput.bind(this));this.bus.on("commandConfig",a.prototype.commandConfig.bind(this));this.bus.on("rejoinRoles",a.rejoinRoles.bind(this));this.bus.on("pause",a.pause.bind(this));this.bus.on("unpause",a.unpause.bind(this));this.bus.on("wait",a.wait.bind(this));this.bus.on("end",a.end.bind(this),{async:true});this.bus.on("custom",a.custom.bind(this));this.bus.on("exit",a.exit.bind(this),{async:true});this.bus.emit("ready");this.defineStates("end")};a.clientConnecting=function(){console.log("Connecting!");this.dom.clientStatus("connecting")};a.clientOpen=function(){console.log("Connected!");this.dom.clientStatus("connected");this.initBus()};a.clientClose=function(){console.log("Closed!");this.dom.clientStatus("closed")};a.clientError=function(e){switch(e){case"unreachable":this.dom.clientStatus("unreachable");break}};a.clientConfig=function(e){console.warn("Client config received: ",e);this.config=e;if(this.config.theme){this.dom.setTheme(this.config.theme)}};a.user=function(e){console.log("User received: ",e);this.user=e};a.userList=function(e){console.log("User-list received: ",e);e.get=o;this.users=e};a.roleList=function(e,t,n){var i=[],r;if(!this.roles&&e.length>1){this.dom.setMultiplayer(true)}e.get=o;this.roles=e;if(this.inGame){return}if(n&&e.length<=1){this.roleId=e[0].id;return}e.forEach((e,t)=>{var n=e.clientId&&this.users.get(e.clientId).name;i.push({index:t,label:e.name,type:"role",selectedBy:n&&[n]})});if(t.length){r=t.map(e=>{return this.users.get(e).name})}var s=t=>{if(e[t].clientId===this.user.id){this.bus.emit("selectRole",null)}else if(e[t].clientId!==null){return}else{this.bus.emit("selectRole",e[t].id)}};this.dom.setChoices(i,r,s);if(n){e.find((e,t)=>{if(e.clientId===this.user.id){this.roleId=e.id;return true}return false});this.afterLeave=true;return}};a.message=function(e,t,n){var i=false;this.hasNewContent=true;e=s.markup(e);if(!t){t={}}this.dom.addMessage(e,t,n)};a.indicators=function(e){this.dom.addIndicators(e)};a.status=function(e){this.dom.addIndicators(e,true)};a.panel=function(e,t){this.dom.addPanel(e,t)};a.enterScene=function(e,t){var n;this.inGame=true;if(t){n=this.dom.toAltBuffer()}if(!e&&!n){this.dom.newSegmentOnContent()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};a.leaveScene=function(e,t){if(t){this.dom.toMainBuffer()}this.afterNext=this.afterNextTriggered=false;this.afterLeave=true};a.nextTriggered=function(e){var t=this.nexts.find(t=>t.id===e);this.dom.newSegmentOnContent("inter-segment");if(t&&t.label&&!t.button){this.dom.addSelectedChoice(t.label)}this.dom.clearChoices();this.afterNextTriggered=true;this.hasNewContent=false};a.nextList=function(e,t,n,i){var r=[],s,a=0;this.nexts=e;this.afterNext=true;if(i&&this.roles.length===1){return}e.forEach((e,t)=>{var n=e.roleIds.map(e=>{return this.roles.get(e).name});if(e.label){a+=e.label.length}r.push({index:t,label:e.label||"Next",style:e.style,class:e.class,image:e.image,button:e.button,groupBreak:!!e.groupBreak,type:"next",selectedBy:n})});if(!n.nextStyle||n.nextStyle==="auto"){if(this.roles.length<=1&&r.length<=3&&a<20){n.nextStyle="inline"}else if(r.length>8){n.nextStyle="smallList"}else{n.nextStyle="list"}}if(t.length&&this.roles.length){s=t.map(e=>{return this.roles.get(e).name})}var o=t=>{if(e[t].roleIds.indexOf(this.roleId)!==-1){this.bus.emit("selectNext",null)}else{this.bus.emit("selectNext",e[t].id)}};this.dom.setChoices(r,s,o,{timeout:n.timeout,nextStyle:n.nextStyle})};a.extOutput=function(e){alert("not coded ATM!")};a.extErrorOutput=function(e){alert("not coded ATM!")};a.textInput=function(e,t){var n={label:e};if(t.indexOf(this.roleId)===-1){n.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(n)}else{this.dom.textInput(n,e=>{this.bus.emit("textSubmit",e)})}};a.prototype.commandConfig=function(e){console.warn("Received command config:",e);if(e.enabled===true){this.dom.enableCommand(e=>{console.log("inGame?",this.inGame);this.bus.emit(this.inGame?"command":"chat",e)})}else if(e.enabled===false){console.warn("disabled!");this.dom.disableCommand()}};a.pause=function(e){console.log("Received a pause event for",e,"seconds")};a.unpause=function(){console.log("Received an unpause event")};a.rejoinRoles=function(){};a.wait=function(e){switch(e){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoinRoles",()=>this.dom.clearHint());break;default:this.dom.setBigHint("WAITING FOR "+e,{wait:true,"pulse-animation":true})}};a.theme=function(e){if(!e.url){if(this.config.theme){this.dom.setTheme(this.config.theme)}return}this.dom.setTheme(e)};a.image=function(e){this.dom.setSceneImage(e)};a.defineAnimation=function(e,t){this.dom.defineAnimation(e,t)};a.showSprite=function(e,t,n){if(!t.url||typeof t.url!=="string"){n();return}t.actionCallback=a.spriteActionCallback.bind(this);this.dom.showSprite(e,t).then(n)};a.spriteActionCallback=function(e){console.warn("Sprite action triggered: ",e);this.bus.emit("action",e)};a.updateSprite=function(e,t,n){this.dom.updateSprite(e,t).then(n)};a.animateSprite=function(e,t,n){this.dom.animateSprite(e,t).then(n)};a.clearSprite=function(e){this.dom.clearSprite(e)};a.showUi=function(e,t){if(!t.url||typeof t.url!=="string"){return}t.actionCallback=a.uiActionCallback.bind(this);this.dom.showUi(e,t)};a.uiActionCallback=function(e){console.warn("UI action triggered: ",e);this.bus.emit("action",e)};a.updateUi=function(e,t){this.dom.updateUi(e,t)};a.animateUi=function(e,t){this.dom.animateUi(e,t)};a.clearUi=function(e){this.dom.clearUi(e)};a.showMarker=function(e,t){if(!t.url||typeof t.url!=="string"){return}t.actionCallback=a.markerActionCallback.bind(this);this.dom.showMarker(e,t)};a.markerActionCallback=function(e){console.warn("Marker action triggered: ",e);this.bus.emit("action",e)};a.updateMarker=function(e,t){this.dom.updateMarker(e,t)};a.animateMarker=function(e,t){this.dom.animateMarker(e,t)};a.clearMarker=function(e){this.dom.clearMarker(e)};a.showCard=function(e,t){if(!t.url||typeof t.url!=="string"){return}t.actionCallback=a.cardActionCallback.bind(this);this.dom.showCard(e,t)};a.cardActionCallback=function(e){console.warn("Card action triggered: ",e);this.bus.emit("action",e)};a.updateCard=function(e,t){this.dom.updateCard(e,t)};a.animateCard=function(e,t){this.dom.animateCard(e,t)};a.clearCard=function(e){this.dom.clearCard(e)};a.sound=function(e){this.dom.sound(e)};a.music=function(e){this.dom.music(e)};a.end=function(e,t,n){var i={modal:true,big:true,fun:true,contentDelay:this.hasNewContent,slow:true};var r=()=>{if(this.ended){return}this.ended=true;console.log("finished!");this.emit("end");n()};switch(e){case"end":this.dom.setDialog("The End.",i,r);break;case"win":this.dom.setDialog("You Win!",i,r);break;case"lost":this.dom.setDialog("You Lose...",i,r);break;case"draw":this.dom.setDialog("Draw.",i,r);break}};a.custom=function(e,t){console.log("Received a custom event",e,t)};a.exit=function(e,t,n){console.log("exit cb",n);this.once("end",()=>{setTimeout(200,n)})}},{"../Dom.js":1,"../toolkit.js":3,"nextgen-events/lib/browser.js":11}],5:[function(e,t,n){"use strict";n.toClassObject=function e(t){var n={};if(!t){return n}if(typeof t==="string"){n[t]=true;return n}if(typeof t==="object"){if(Array.isArray(t)){t.forEach(e=>n[e]=true);return n}return t}return n}},{}],6:[function(e,t,n){},{}],7:[function(e,t,n){(function(n){"use strict";var i,r;if(n.browser){i=new DOMParser;r=new XMLSerializer}else{var s=e("@cronvel/xmldom");i=new s.DOMParser;r=new s.XMLSerializer}var a={};t.exports=a;a.ready=function(e){document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t,false);e()},false)};a.fromXml=function(e){return i.parseFromString(e,"application/xml")};a.toXml=function(e){return r.serializeToString(e)};a.fromHtml=function(e){var t,n,i;i=document.createDocumentFragment();n=document.createElement("div");n.insertAdjacentHTML("beforeend",e);for(t=0;t<n.children.length;t++){i.appendChild(n.children[t])}return i};a.appendJs=function(e){var t=document.createElement("script");t.setAttribute("src",e);document.body.appendChild(t)};a.batch=function(e,t,...n){var i;if(t instanceof Element){e(t,...n)}else if(Array.isArray(t)){for(i=0;i<t.length;i++){e(t[i],...n)}}else if(t instanceof NodeList||t instanceof NamedNodeMap){for(i=0;i<t.length;i++){e(t[i],...n)}}};a.css=function(e,t){var n;for(n in t){e.style[n]=t[n]}};a.attr=function(e,t,n){var i;n=n||"";for(i in t){if(t[i]===null){e.removeAttribute(n+i)}else{e.setAttribute(n+i,t[i])}}};a.class=function(e,t,n){var i;n=n||"";for(i in t){if(t[i]){e.classList.add(n+i)}else{e.classList.remove(n+i)}}};a.remove=function(e){e.parentNode.removeChild(e)};a.empty=function(e){while(e.firstChild){e.removeChild(e.firstChild)}};a.cloneInto=function(e,t){a.empty(t);t.appendChild(e.cloneNode(true))};a.insertInto=function(e,t){a.empty(t);t.appendChild(e)};a.moveChildrenInto=function(e,t){a.empty(t);while(e.firstChild){t.appendChild(e.firstChild)}};a.moveAttributes=function(e,t){Array.from(e.attributes).forEach(n=>{var i=n.name;var r=n.value;e.removeAttribute(i);if(i!=="xmlns"&&i.indexOf(":")===-1&&r){t.setAttribute(i,r)}})};a.styleToAttribute=function(e,t,n){if(e.style[t]&&(!n||n.indexOf(e.style[t])===-1)){e.setAttribute(t,e.style[t]);e.style[t]=null}};a.prefixIds=function(e,t){var n,i={};n=e.querySelectorAll("*");a.batch(a.prefixIds.idAttributePass,n,t,i);a.batch(a.prefixIds.otherAttributesPass,n,i)};a.prefixIds.idAttributePass=function(e,t,n){n[e.id]=t+"."+e.id;e.id=n[e.id]};a.prefixIds.otherAttributesPass=function(e,t){a.batch(a.prefixIds.oneAttributeSubPass,e.attributes,t)};a.prefixIds.oneAttributeSubPass=function(e,t){e.value=e.value.replace(/url\(#([^)]+)\)/g,(e,n)=>{if(!t[n]){return e}return"url(#"+t[n]+")"})};a.removeAllTags=function(e,t,n){Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!n||!e.firstChild){e.parentNode.removeChild(e)}})};a.removeAllAttributes=function(e,t){e.removeAttribute(t);Array.from(e.querySelectorAll("["+t+"]")).forEach(e=>{e.removeAttribute(t)})};a.preload=function(e){if(!Array.isArray(e)){e=[e]}e.forEach(e=>{if(a.preload.preloaded[e]){return}a.preload.preloaded[e]=new Image;a.preload.preloaded[e].src=e})};a.preload.preloaded={};a.filterByNamespace=function(e,t){var n,i,r,s,o;if(!t||typeof t!=="object"){return}a.filterAttributesByNamespace(e,t);for(n=e.childNodes.length-1;n>=0;n--){i=e.childNodes[n];if(i.nodeType===1){if(i.tagName.indexOf(":")!==-1){o=i.tagName.split(":");r=o[0];s=o[1];if(r===t.primary){i.tagName=s;a.filterByNamespace(i,t)}else if(t.whitelist){if(t.whitelist.indexOf(r)!==-1){a.filterByNamespace(i,t)}else{e.removeChild(i)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeChild(i)}else{a.filterByNamespace(i,t)}}else{a.filterByNamespace(i,t)}}else{a.filterByNamespace(i,t)}}}};a.filterAttributesByNamespace=function(e,t){var n,i,r,s,a,o;if(!t||typeof t!=="object"){return}for(n=e.attributes.length-1;n>=0;n--){i=e.attributes[n];if(i.name.indexOf(":")!==-1){o=i.name.split(":");r=o[0];s=o[1];a=i.value;if(r===t.primary){e.removeAttributeNode(i);e.setAttribute(s,a)}else if(t.whitelist){if(t.whitelist.indexOf(r)===-1){e.removeAttributeNode(i)}}else if(t.blacklist){if(t.blacklist.indexOf(r)!==-1){e.removeAttributeNode(i)}}}}};a.removeComments=function(e){var t,n;for(t=e.childNodes.length-1;t>=0;t--){n=e.childNodes[t];if(n.nodeType===8){e.removeChild(n)}else if(n.nodeType===1){a.removeComments(n)}}};a.removeWhiteSpaces=function(e,t){var n,i,r=null;for(n=e.childNodes.length-1;n>=0;n--){i=e.childNodes[n];if(i.nodeType===3){if(t){if(r){r.nodeValue=(i.nodeValue+r.nodeValue).replace(/^\s*(\n[\t ]*)$/,"$1");e.removeChild(i)}else{i.nodeValue=i.nodeValue.replace(/^\s*(\n[\t ]*)$/,"$1");r=i}}else if(!/\S/.test(i.nodeValue)){e.removeChild(i)}}else if(i.nodeType===1){r=null;a.removeWhiteSpaces(i,t)}else{r=null}}};a.parseMatrix=function(e){var t=e.match(/(matrix|matrix3d)\(([0-9., -]+)\)/);if(!t){return null}return t[2].trim().split(/ ?, ?/).map(e=>{return parseFloat(e)})};a.decomposeMatrix=function(e){if(e.length===6){return a.decomposeMatrix2d(e)}if(e.length===16){return a.decomposeMatrix3d(e)}return null};a.decomposeMatrix2d=function(e){var t=Math.atan2(e[1],e[0]),n=e[0]*e[0]+e[1]*e[1],i=Math.sqrt(n),r=(e[0]*e[3]-e[2]*e[1])/i,s=Math.atan2(e[0]*e[2]+e[1]*e[3],n);return{rotate:180*t/Math.PI,scaleX:i,scaleY:r,skewX:180*s/Math.PI,skewY:0,translateX:e[4],translateY:e[5]}};a.decomposeMatrix3d=function(e){var t=Math.PI/180;var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=Math.sqrt(e[4]*e[4]+e[5]*e[5]+e[6]*e[6]),r=Math.sqrt(e[8]*e[8]+e[9]*e[9]+e[10]*e[10]);var s=Math.atan2(-e[9]/r,e[10]/r)/t,a=Math.asin(e[8]/r)/t,o=Math.atan2(-e[4]/i,e[0]/n)/t;if(e[4]===1||e[4]===-1){s=0;a=e[4]*-Math.PI/2;o=e[4]*Math.atan2(e[6]/i,e[5]/i)/t}var l=e[12]/n,c=e[13]/n,u=e[14]/n;return{translateX:l,translateY:c,translateZ:u,rotateX:s,rotateY:a,rotateZ:o,scaleX:n,scaleY:i,scaleZ:r}};a.stringifyTransform=function(e){var t=[];if(e.translateX){t.push("translateX("+e.translateX+"px)")}if(e.translateY){t.push("translateY("+e.translateY+"px)")}if(e.translateZ){t.push("translateZ("+e.translateZ+"px)")}if(e.rotate){t.push("rotate("+e.rotate+"deg)")}else{if(e.rotateX){t.push("rotateX("+e.rotateX+"deg)")}if(e.rotateY){t.push("rotateY("+e.rotateY+"deg)")}if(e.rotateZ){t.push("rotateZ("+e.rotateZ+"deg)")}}if(e.scale){t.push("scale("+e.scale+")")}else{if(e.scaleX){t.push("scaleX("+e.scaleX+")")}if(e.scaleY){t.push("scaleY("+e.scaleY+")")}if(e.scaleZ){t.push("scaleZ("+e.scaleZ+")")}}if(e.skewX){t.push("skewX("+e.skewX+"deg)")}if(e.skewY){t.push("skewY("+e.skewY+"deg)")}return t.join(" ")};a.transform=function(e,t){e.style.transform=a.stringifyTransform(t)};a.id=function(e,t){e.id=t};a.text=function(e,t){e.textContent=t};a.html=function(e,t){e.innerHTML=t}}).call(this,e("_process"))},{"@cronvel/xmldom":6,_process:13}],8:[function(e,t,n){t.exports=function(e){return e!=null&&(i(e)||r(e)||!!e._isBuffer)};function i(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function r(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&i(e.slice(0,0))}},{}],9:[function(e,t,n){(function(n,i,r){"use strict";const s=n.browser?window.setImmediate:n.nextTick;if(!i.__NEXTGEN_EVENTS__){i.__NEXTGEN_EVENTS__={recursions:0}}var a=i.__NEXTGEN_EVENTS__;function o(){}t.exports=o;o.prototype.__prototypeUID__="nextgen-events/NextGenEvents";o.prototype.__prototypeVersion__=e("../package.json").version;o.SYNC=-Infinity;o.DESYNC=-1;o.defaultMaxListeners=Infinity;o.init=function(){Object.defineProperty(this,"__ngev",{configurable:true,value:new o.Internal})};o.Internal=function(e){this.nice=o.SYNC;this.interruptible=false;this.contexts={};this.desync=r;this.depth=0;this.states={};this.stateGroups={};this.listeners={error:[],interrupt:[],newListener:[],removeListener:[]};this.hasListenerPriority=false;this.maxListeners=o.defaultMaxListeners;if(e){this.nice=e.nice;this.interruptible=e.interruptible;Object.assign(this.states,e.states),Object.assign(this.stateGroups,e.stateGroups),Object.keys(e.listeners).forEach(t=>{this.listeners[t]=e.listeners[t].slice()});Object.keys(e.contexts).forEach(t=>{var n=e.contexts[t];this.contexts[t]={nice:n.nice,ready:true,status:n.status,serial:n.serial,scopes:{}}})}};o.initFrom=function(e){if(!e.__ngev){o.init.call(e)}Object.defineProperty(this,"__ngev",{configurable:true,value:new o.Internal(e.__ngev)})};o.mergeListeners=function(e){if(!this.__ngev){o.init.call(this)}var t=this.__ngev.listeners;this.__ngev.listeners={};Object.keys(t).forEach(e=>{this.__ngev.listeners[e]=[]});e.forEach(e=>{if(!e.__ngev){o.init.call(e)}Object.keys(e.__ngev.listeners).forEach(e=>{if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}})});Object.keys(this.__ngev.listeners).forEach(n=>{var i,r,s=[];if(t[n]){t[n].forEach(t=>{for(i=0,r=e.length;i<r;i++){if(!e[i].__ngev.listeners[n]||e[i].__ngev.listeners[n].indexOf(t)===-1){s.push(t);break}}})}e.forEach(e=>{e.__ngev.listeners[n].forEach(e=>{if(this.__ngev.listeners[n].indexOf(e)===-1&&s.indexOf(e)===-1){this.__ngev.listeners[n].push(e)}})})})};o.filterOutCallback=function(e,t){return e!==t};o.prototype.addListener=function(e,t,i){var r,s;if(!this.__ngev){o.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}if(!e||typeof e!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof t==="function"){r={};if(!i||typeof i!=="object"){i={}}}else if(i===true&&t&&typeof t==="object"){i=r=t;t=undefined}else{i=t;if(!i||typeof i!=="object"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}t=undefined;r={}}r.fn=t||i.fn;r.id=i.id!==undefined?i.id:r.fn;r.once=!!i.once;r.async=!!i.async;r.eventObject=!!i.eventObject;r.nice=i.nice!==undefined?Math.floor(i.nice):o.SYNC;r.priority=+i.priority||0;r.context=i.context&&(typeof i.context==="string"||typeof i.context==="object")?i.context:null;if(typeof r.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(typeof r.context==="string"){r.context=this.__ngev.contexts[r.context]||this.addListenerContext(r.context)}r.event=e;if(this.__ngev.listeners.newListener.length){s=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[e].push(r);o.emitEvent({emitter:this,name:"newListener",args:[[r]],listeners:s});if(this.__ngev.states[e]){o.emitToOneListener(this.__ngev.states[e],r)}return this}this.__ngev.listeners[e].push(r);if(this.__ngev.hasListenerPriority){this.__ngev.listeners[e].sort((e,t)=>t.priority-e.priority)}if(this.__ngev.listeners[e].length===this.__ngev.maxListeners+1){n.emitWarning("Possible NextGenEvents memory leak detected. "+this.__ngev.listeners[e].length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit",{type:"MaxListenersExceededWarning"})}if(this.__ngev.states[e]){o.emitToOneListener(this.__ngev.states[e],r)}return this};o.prototype.on=o.prototype.addListener;o.prototype.once=function(e,t,n){if(t&&typeof t==="object"){t.once=true}else if(n&&typeof n==="object"){n.once=true}else{n={once:true}}return this.addListener(e,t,n)};o.prototype.waitFor=function(e){return new Promise(t=>{this.addListener(e,e=>t(e),{once:true})})};o.prototype.waitForAll=function(e){return new Promise(t=>{this.addListener(e,(...e)=>t(e),{once:true})})};o.prototype.removeListener=function(e,t){var n,i,r=[],s=[];if(!e||typeof e!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){o.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}i=this.__ngev.listeners[e].length;for(n=0;n<i;n++){if(this.__ngev.listeners[e][n].id===t){s.push(this.__ngev.listeners[e][n])}else{r.push(this.__ngev.listeners[e][n])}}this.__ngev.listeners[e]=r;if(s.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",s)}return this};o.prototype.off=o.prototype.removeListener;o.prototype.removeAllListeners=function(e){var t;if(!this.__ngev){o.init.call(this)}if(e){if(!e||typeof e!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}t=this.__ngev.listeners[e];this.__ngev.listeners[e]=[];if(t.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",t)}}else{this.__ngev.listeners={error:[],interrupt:[],newListener:[],removeListener:[]}}return this};o.listenerWrapper=function(e,t,n,i,r){var s,l,c=t.master||t,u=!!t.master||t.emitter.__ngev.interruptible;if(c.interrupt){return}if(e.async){if(n){n.ready=!i}if(r<0){if(a.recursions>=-r){t.emitter.__ngev.desync(o.listenerWrapper.bind(undefined,e,t,n,i,o.SYNC));return}}else{setTimeout(o.listenerWrapper.bind(undefined,e,t,n,i,o.SYNC),r);return}l=(e=>{c.listenersDone++;if(e&&u&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=e;if(c.callback){o.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){o.emitCallback(t)}if(i){o.processScopeQueue(n,true,true)}});if(e.eventObject){e.fn(t,l)}else{s=e.fn(...t.args,l)}}else{if(r<0){if(a.recursions>=-r){t.emitter.__ngev.desync(o.listenerWrapper.bind(undefined,e,t,n,i,o.SYNC));return}}else{setTimeout(o.listenerWrapper.bind(undefined,e,t,n,i,o.SYNC),r);return}if(e.eventObject){e.fn(t)}else{s=e.fn(...t.args)}c.listenersDone++}if(s&&u&&!c.interrupt&&t.name!=="interrupt"){c.interrupt=s;if(c.callback){o.emitCallback(t)}t.emitter.emit("interrupt",c.interrupt)}else if(c.listenersDone>=c.listeners.length&&c.callback){o.emitCallback(t)}};var l=0;o.prototype.emit=function(...e){var t=o.createEvent(this,...e);return o.emitEvent(t)};o.prototype.waitForEmit=function(...e){return new Promise(t=>{this.emit(...e,e=>t(e))})};o.createEvent=function(e,...t){var n={emitter:e,interrupt:null,master:null,sync:true};if(typeof t[0]==="number"){n.nice=Math.floor(t[0]);n.name=t[1];if(!n.name||typeof n.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof t[t.length-1]==="function"){n.callback=t[t.length-1];n.args=t.slice(2,-1)}else{n.args=t.slice(2)}}else{n.name=t[0];if(!n.name||typeof n.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}if(typeof t[t.length-1]==="function"){n.callback=t[t.length-1];n.args=t.slice(1,-1)}else{n.args=t.slice(1)}}return n};o.emitEvent=function(e){var t=e.emitter,n,i,r=0,s,c;if(!t.__ngev){o.init.call(t)}s=t.__ngev.states[e.name];if(s!==undefined){if(s&&e.args.length===s.args.length&&e.args.every((e,t)=>e===s.args[t])){return}t.__ngev.stateGroups[e.name].forEach(e=>{t.__ngev.states[e]=null});t.__ngev.states[e.name]=e}if(!t.__ngev.listeners[e.name]){t.__ngev.listeners[e.name]=[]}e.id=l++;e.listenersDone=0;if(e.nice===undefined||e.nice===null){e.nice=t.__ngev.nice}if(!e.listeners){e.listeners=t.__ngev.listeners[e.name].slice()}a.recursions++;e.depth=t.__ngev.depth++;c=[];try{for(n=0,i=e.listeners.length;n<i;n++){r++;o.emitToOneListener(e,e.listeners[n],c)}}catch(e){a.recursions--;t.__ngev.depth--;throw e}a.recursions--;if(!e.callback){t.__ngev.depth--}if(c.length&&t.__ngev.listeners.removeListener.length){t.emit("removeListener",c)}if(!r){if(e.name==="error"){if(e.args[0]){throw e.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(e.callback){o.emitCallback(e)}}e.sync=false;return e};o.emitIntricatedEvents=function(e,t){var n,i,r=0,s;if(!Array.isArray(e)){throw new TypeError(".emitCorrelatedEvents() argument should be an array")}var c=[],u={nice:o.DESYNC,ready:true,status:o.CONTEXT_ENABLED,serial:true,scopes:{}},f={sync:false,nice:o.DESYNC,context:u,interrupt:null,listeners:c,listenersDone:0,depth:0,callback:t};e.forEach(e=>{var t=o.createEvent(...e);t.master=f;if(!t.emitter.__ngev){o.init.call(t.emitter)}if(!t.emitter.__ngev.listeners[t.name]){t.emitter.__ngev.listeners[t.name]=[]}t.listeners=t.emitter.__ngev.listeners[t.name].slice();t.id=l++;t.listeners.forEach(e=>c.push({event:t,listener:e}))});c.sort((e,t)=>t.listener.priority-e.listener.priority);a.recursions++;s=[];try{for(n=0,i=c.length;n<i;n++){r++;o.emitToOneListener(c[n].event,c[n].listener,s)}}catch(e){a.recursions--;throw e}a.recursions--;if(!r&&f.callback){o.emitCallback(event)}f.sync=false};o.emitToOneListener=function(e,t,n){var i=e.emitter,r=e.master||e,s=e.master?e.master.context:t.context,a,l,c,u=false;if(s){if(s.status===o.CONTEXT_DISABLED){return}c=Math.max(r.nice,t.nice,s.nice);l=s.serial;a=o.getContextScope(s,r.depth)}else{c=Math.max(r.nice,t.nice)}if(t.once){i.__ngev.listeners[e.name]=i.__ngev.listeners[e.name].filter(o.filterOutCallback.bind(undefined,t));if(n){n.push(t)}else{u=true}}if(s&&(s.status===o.CONTEXT_QUEUED||!a.ready)){a.queue.push({event:e,listener:t,nice:c})}else{o.listenerWrapper(t,e,a,l,c)}if(u&&i.__ngev.listeners.removeListener.length){i.emit("removeListener",[t])}};o.emitCallback=function(e){var t;if(e.master){t=e.master.callback;delete e.master.callback;if(e.master.sync){s(()=>t(e.master.interrupt,e))}else{t(e.master.interrupt,e)}return}t=e.callback;delete e.callback;if(e.sync&&e.emitter.__ngev.nice!==o.SYNC){e.emitter.__ngev.desync(()=>{e.emitter.__ngev.depth--;t(e.interrupt,e)})}else{e.emitter.__ngev.depth--;t(e.interrupt,e)}};o.prototype.listeners=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){o.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].slice()};o.listenerCount=function(e,t){if(!e||!(e instanceof o)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};o.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){o.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};o.prototype.setNice=function(e){if(!this.__ngev){o.init.call(this)}this.__ngev.nice=Math.floor(+e||0)};o.prototype.desyncUseNextTick=function(e){if(!this.__ngev){o.init.call(this)}this.__ngev.desync=e?s:r};o.prototype.setInterruptible=function(e){if(!this.__ngev){o.init.call(this)}this.__ngev.interruptible=!!e};o.prototype.setListenerPriority=function(e){if(!this.__ngev){o.init.call(this)}this.__ngev.hasListenerPriority=!!e};o.share=function(e,t){if(!(e instanceof o)||!(t instanceof o)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){o.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};o.reset=function(e){Object.defineProperty(e,"__ngev",{configurable:true,value:null})};o.prototype.getMaxListeners=function(){if(!this.__ngev){o.init.call(this)}return this.__ngev.maxListeners};o.prototype.setMaxListeners=function(e){if(!this.__ngev){o.init.call(this)}this.__ngev.maxListeners=typeof e==="number"&&!Number.isNaN(e)?Math.floor(e):o.defaultMaxListeners;return this};o.noop=(()=>undefined);o.prototype.defineStates=function(...e){if(!this.__ngev){o.init.call(this)}e.forEach(t=>{this.__ngev.states[t]=null;this.__ngev.stateGroups[t]=e})};o.prototype.hasState=function(e){if(!this.__ngev){o.init.call(this)}return!!this.__ngev.states[e]};o.prototype.getAllStates=function(){if(!this.__ngev){o.init.call(this)}return Object.keys(this.__ngev.states).filter(e=>this.__ngev.states[e])};o.groupAddListener=function(e,t,n,i){if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}n=n||i.fn;delete i.fn;i.id=i.id||n;e.forEach(e=>{e.addListener(t,n.bind(undefined,e),i)})};o.groupOn=o.groupAddListener;o.groupOnce=function(e,t,n,i){if(n&&typeof n==="object"){n.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.groupAddListener(e,t,n,i)};o.groupWaitFor=function(e,t){return Promise.all(e.map(e=>e.waitFor(t)))};o.groupWaitForAll=function(e,t){return Promise.all(e.map(e=>e.waitForAll(t)))};o.groupOnceFirst=function(e,t,n,i){var r,s=false;if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}n=n||i.fn;delete i.fn;i.id=i.id||n;r=((...r)=>{if(s){return}s=true;o.groupRemoveListener(e,t,i.id);n(...r)});e.forEach(e=>{e.once(t,r.bind(undefined,e),i)})};o.groupWaitForFirst=function(e,t){return new Promise(n=>{o.groupOnceFirst(e,t,e=>n(e))})};o.groupWaitForFirstAll=function(e,t){return new Promise(n=>{o.groupOnceFirst(e,t,(...e)=>n(e))})};o.groupOnceLast=function(e,t,n,i){var r,s=false,a=e.length;if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}n=n||i.fn;delete i.fn;i.id=i.id||n;r=((...e)=>{if(s){return}if(--a){return}s=true;n(...e)});e.forEach(e=>{e.once(t,r.bind(undefined,e),i)})};o.groupWaitForLast=function(e,t){return new Promise(n=>{o.groupOnceLast(e,t,e=>n(e))})};o.groupWaitForLastAll=function(e,t){return new Promise(n=>{o.groupOnceLast(e,t,(...e)=>n(e))})};o.groupRemoveListener=function(e,t,n){e.forEach(e=>{e.removeListener(t,n)})};o.groupOff=o.groupRemoveListener;o.groupRemoveAllListeners=function(e,t){e.forEach(e=>{e.removeAllListeners(t)})};o.groupEmit=function(e,...t){var n,i,r=1,s,a=e.length,l,c,u=false;if(typeof t[t.length-1]==="function"){s=-1;l=t[t.length-1];c=(e=>{if(u){return}if(e){u=true;l(e)}else if(!--a){u=true;l()}})}if(typeof t[0]==="number"){r=2;i=typeof t[0]}n=t[r-1];t=t.slice(r,s);e.forEach(e=>{o.emitEvent({emitter:e,name:n,args:t,nice:i,callback:c})})};o.groupWaitForEmit=function(e,...t){return new Promise(n=>{o.groupEmit(e,...t,e=>n(e))})};o.groupDefineStates=function(e,...t){e.forEach(e=>{e.defineStates(...t)})};o.groupGlobalOnce=o.groupOnceFirst;o.groupGlobalOnceAll=o.groupOnceLast;o.CONTEXT_ENABLED=0;o.CONTEXT_DISABLED=1;o.CONTEXT_QUEUED=2;o.prototype.addListenerContext=function(e,t){if(!this.__ngev){o.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!t||typeof t!=="object"){t={}}var n=this.__ngev.contexts[e];if(!n){n=this.__ngev.contexts[e]={nice:o.SYNC,ready:true,status:o.CONTEXT_ENABLED,serial:false,scopes:{}}}if(t.nice!==undefined){n.nice=Math.floor(t.nice)}if(t.status!==undefined){n.status=t.status}if(t.serial!==undefined){n.serial=!!t.serial}return n};o.prototype.getListenerContext=function(e){return this.__ngev.contexts[e]};o.getContextScope=function(e,t){var n=e.scopes[t];if(!n){n=e.scopes[t]={ready:true,queue:[]}}return n};o.prototype.disableListenerContext=function(e){if(!this.__ngev){o.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=o.CONTEXT_DISABLED;return this};o.prototype.enableListenerContext=function(e){if(!this.__ngev){o.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}var t=this.__ngev.contexts[e];t.status=o.CONTEXT_ENABLED;Object.values(t.scopes).forEach(e=>{if(e.queue.length>0){o.processScopeQueue(e,t.serial)}});return this};o.prototype.queueListenerContext=function(e){if(!this.__ngev){o.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].status=o.CONTEXT_QUEUED;return this};o.prototype.serializeListenerContext=function(e,t){if(!this.__ngev){o.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].serial=t===undefined?true:!!t;return this};o.prototype.setListenerContextNice=function(e,t){if(!this.__ngev){o.init.call(this)}if(!e||typeof e!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[e]){this.addListenerContext(e)}this.__ngev.contexts[e].nice=Math.floor(t);return this};o.prototype.destroyListenerContext=function(e){var t,n,i,r,s,a=[];if(!e||typeof e!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){o.init.call(this)}i=this.__ngev.contexts[e];if(!i){return}for(r in this.__ngev.listeners){s=null;n=this.__ngev.listeners[r].length;for(t=0;t<n;t++){if(this.__ngev.listeners[r][t].context===i){s=[];a.push(this.__ngev.listeners[r][t])}else if(s){s.push(this.__ngev.listeners[r][t])}}if(s){this.__ngev.listeners[r]=s}}delete this.__ngev.contexts[e];if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};o.processScopeQueue=function(e,t,n){var i,r,s,l;if(n){e.ready=true}a.recursions++;while(e.ready&&e.queue.length){i=e.queue.shift();r=i.event;s=r.master||r;l=r.emitter;if(s.interrupt){continue}o.listenerWrapper(i.listener,r,e,t,i.nice)}a.recursions--};o.on=o.prototype.on;o.once=o.prototype.once;o.off=o.prototype.off;if(i.AsyncTryCatch){o.prototype.asyncTryCatchId=i.AsyncTryCatch.NextGenEvents.length;i.AsyncTryCatch.NextGenEvents.push(o);if(i.AsyncTryCatch.substituted){i.AsyncTryCatch.substitute()}}o.Proxy=e("./Proxy.js")}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{"../package.json":12,"./Proxy.js":10,_process:13,timers:34}],10:[function(e,t,n){"use strict";function i(){this.localServices={};this.remoteServices={};this.nextAckId=1}t.exports=i;var r=e("./NextGenEvents.js");var s="NextGenEvents/message";function a(){}i.create=((...e)=>new i(...e));i.prototype.addLocalService=function(e,t,n){this.localServices[e]=o.create(this,e,t,n);return this.localServices[e]};i.prototype.addRemoteService=function(e){this.remoteServices[e]=l.create(this,e);return this.remoteServices[e]};i.prototype.destroy=function(){Object.keys(this.localServices).forEach(e=>{this.localServices[e].destroy();delete this.localServices[e]});Object.keys(this.remoteServices).forEach(e=>{this.remoteServices[e].destroy();delete this.remoteServices[e]});this.receive=this.send=a};i.prototype.push=function(e){if(e.__type!==s||!e.service||typeof e.service!=="string"||!e.event||typeof e.event!=="string"||!e.method){return}switch(e.method){case"event":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveEvent(e);case"ackEmit":return this.remoteServices[e.service]&&this.remoteServices[e.service].receiveAckEmit(e);case"emit":return this.localServices[e.service]&&this.localServices[e.service].receiveEmit(e);case"listen":return this.localServices[e.service]&&this.localServices[e.service].receiveListen(e);case"ignore":return this.localServices[e.service]&&this.localServices[e.service].receiveIgnore(e);case"ackEvent":return this.localServices[e.service]&&this.localServices[e.service].receiveAckEvent(e);default:return}};i.prototype.receive=function(e){this.push(e)};i.prototype.send=function(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function o(e,t,n,i){return o.create(e,t,n,i)}i.LocalService=o;o.create=function(e,t,n,i){var s=Object.create(o.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:n,writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!i.listen,writable:true,enumerable:true},canEmit:{value:!!i.emit,writable:true,enumerable:true},canAck:{value:!!i.ack,writable:true,enumerable:true},canRpc:{value:!!i.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return s};o.prototype.destroy=function(){Object.keys(this.events).forEach(e=>{this.emitter.off(e,this.events[e]);delete this.events[e]});this.emitter=null;this.destroyed=true};o.prototype.receiveEmit=function(e){if(this.destroyed||!this.canEmit||e.ack&&!this.canAck){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(t=>{this.proxy.send({__type:s,service:this.id,method:"ackEmit",ack:e.ack,event:e.event,interruption:t})})}r.emitEvent(t)};o.prototype.receiveListen=function(e){if(this.destroyed||!this.canListen||e.ack&&!this.canAck){return}if(e.ack){if(this.events[e.event]){if(this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=o.forwardWithAck.bind(this);this.events[e.event].ack=true;this.emitter.on(e.event,this.events[e.event],{eventObject:true,async:true})}else{if(this.events[e.event]){if(!this.events[e.event].ack){return}this.emitter.off(e.event,this.events[e.event])}this.events[e.event]=o.forward.bind(this);this.events[e.event].ack=false;this.emitter.on(e.event,this.events[e.event],{eventObject:true})}};o.prototype.receiveIgnore=function(e){if(this.destroyed||!this.canListen){return}if(!this.events[e.event]){return}this.emitter.off(e.event,this.events[e.event]);this.events[e.event]=null};o.prototype.receiveAckEvent=function(e){if(this.destroyed||!this.canListen||!this.canAck||!e.ack||!this.events[e.event]||!this.events[e.event].ack){return}this.internalEvents.emit("ack",e)};o.forward=function(e){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,args:e.args})};o.forward.ack=false;o.forwardWithAck=function(e,t){if(this.destroyed){return}if(!e.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,args:e.args});t();return}var n=false;var i=this.proxy.nextAckId++;var r=e=>{if(n||e.ack!==i){return}n=true;this.internalEvents.off("ack",r);t()};this.internalEvents.on("ack",r);this.proxy.send({__type:s,service:this.id,method:"event",event:e.name,ack:i,args:e.args})};o.forwardWithAck.ack=true;function l(e,t){return l.create(e,t)}i.RemoteService=l;var c=1;var u=2;l.create=function(e,t){var n=Object.create(l.prototype,{proxy:{value:e,enumerable:true},id:{value:t,enumerable:true},emitter:{value:Object.create(r.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(r.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return n};l.prototype.destroy=function(){this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(e=>{delete this.events[e]});this.destroyed=true};l.prototype.emit=function(e,...t){if(this.destroyed){return}var n,i,r;if(typeof e==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof t[t.length-1]!=="function"){this.proxy.send({__type:s,service:this.id,method:"emit",event:e,args:t});return}n=t.pop();i=this.proxy.nextAckId++;r=false;var a=e=>{if(r||e.ack!==i){return}r=true;this.internalEvents.off("ack",a);n(e.interruption)};this.internalEvents.on("ack",a);this.proxy.send({__type:s,service:this.id,method:"emit",ack:i,event:e,args:t})};l.prototype.addListener=function(e,t,n){if(this.destroyed){return}if(typeof t!=="function"){n=t;t=undefined}if(!n||typeof n!=="object"){n={}}n.fn=t||n.fn;this.emitter.addListener(e,n);if(!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length){return}if(n.async&&this.events[e]!==u){this.events[e]=u;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:e})}else if(!n.async&&!this.events[e]){this.events[e]=c;this.proxy.send({__type:s,service:this.id,method:"listen",event:e})}};l.prototype.on=l.prototype.addListener;l.prototype.once=r.prototype.once;l.prototype.removeListener=function(e,t){if(this.destroyed){return}this.emitter.removeListener(e,t);if((!this.emitter.__ngev.listeners[e]||!this.emitter.__ngev.listeners[e].length)&&this.events[e]){this.events[e]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:e})}};l.prototype.off=l.prototype.removeListener;l.prototype.receiveEvent=function(e){if(this.destroyed||!this.events[e.event]){return}var t={emitter:this.emitter,name:e.event,args:e.args||[]};if(e.ack){t.callback=(()=>{this.proxy.send({__type:s,service:this.id,method:"ackEvent",ack:e.ack,event:e.event})})}r.emitEvent(t);var n=t.name;if(!this.emitter.__ngev.listeners[n]||!this.emitter.__ngev.listeners[n].length){this.events[n]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:n})}};l.prototype.receiveAckEmit=function(e){if(this.destroyed||!e.ack||this.events[e.event]!==u){return}this.internalEvents.emit("ack",e)}},{"./NextGenEvents.js":9}],11:[function(e,t,n){(function(n){"use strict";if(typeof window.setImmediate!=="function"){window.setImmediate=(e=>setTimeout(e,0))}if(!n.emitWarning){n.emitWarning=(()=>undefined)}t.exports=e("./NextGenEvents.js");t.exports.isBrowser=true}).call(this,e("_process"))},{"./NextGenEvents.js":9,_process:13}],12:[function(e,t,n){t.exports={_from:"nextgen-events@^1.2.1",_id:"nextgen-events@1.3.0",_inBundle:false,_integrity:"sha512-eBz5mrO4Hw2eenPVm0AVPHuAzg/RZetAWMI547RH8O9+a0UYhCysiZ3KoNWslnWNlHetb9kzowEshsKsmFo2YQ==",_location:"/nextgen-events",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"nextgen-events@^1.2.1",name:"nextgen-events",escapedName:"nextgen-events",rawSpec:"^1.2.1",saveSpec:null,fetchSpec:"^1.2.1"},_requiredBy:["#USER","/","/server-kit","/terminal-kit"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-1.3.0.tgz",_shasum:"a32665d1ab6f026448b19d75c4603ec20292fa22",_spec:"nextgen-events@^1.2.1",_where:"/home/cedric/inside/github/spellcast",author:{name:"Cdric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},bundleDependencies:false,config:{"tea-time":{coverDir:["lib"]}},copyright:{title:"Next-Gen Events",years:[2015,2019],owner:"Cdric Ronvel"},dependencies:{},deprecated:false,description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^16.2.2","uglify-js-es6":"^2.8.9",ws:"^5.1.1"},directories:{test:"test"},engines:{node:">=6.0.0"},homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",name:"nextgen-events",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"tea-time -R dot"},version:"1.3.0"}},{}],13:[function(e,t,n){var i=t.exports={};var r;var s;function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=a}}catch(e){r=a}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=o}}catch(e){s=o}})();function l(e){if(r===setTimeout){return setTimeout(e,0)}if((r===a||!r)&&setTimeout){r=setTimeout;return setTimeout(e,0)}try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}function c(e){if(s===clearTimeout){return clearTimeout(e)}if((s===o||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var u=[];var f=false;var h;var p=-1;function d(){if(!f||!h){return}f=false;if(h.length){u=h.concat(u)}else{p=-1}if(u.length){m()}}function m(){if(f){return}var e=l(d);f=true;var t=u.length;while(t){h=u;u=[];while(++p<t){if(h){h[p].run()}}p=-1;t=u.length}h=null;f=false;c(e)}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}u.push(new g(e,t));if(u.length===1&&!f){l(m)}};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function v(){}i.on=v;i.addListener=v;i.once=v;i.off=v;i.removeListener=v;i.removeAllListeners=v;i.emit=v;i.prependListener=v;i.prependOnceListener=v;i.listeners=function(e){return[]};i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},{}],14:[function(t,n,i){(function(t){(function(r){var s=typeof i=="object"&&i&&!i.nodeType&&i;var a=typeof n=="object"&&n&&!n.nodeType&&n;var o=typeof t=="object"&&t;if(o.global===o||o.window===o||o.self===o){r=o}var l,c=2147483647,u=36,f=1,h=26,p=38,d=700,m=72,g=128,v="-",y=/^xn--/,b=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,k={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=u-f,_=Math.floor,S=String.fromCharCode,C;function E(e){throw new RangeError(k[e])}function L(e,t){var n=e.length;var i=[];while(n--){i[n]=t(e[n])}return i}function $(e,t){var n=e.split("@");var i="";if(n.length>1){i=n[0]+"@";e=n[1]}e=e.replace(w,".");var r=e.split(".");var s=L(r,t).join(".");return i+s}function T(e){var t=[],n=0,i=e.length,r,s;while(n<i){r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((r&1023)<<10)+(s&1023)+65536)}else{t.push(r);n--}}else{t.push(r)}}return t}function A(e){return L(e,function(e){var t="";if(e>65535){e-=65536;t+=S(e>>>10&1023|55296);e=56320|e&1023}t+=S(e);return t}).join("")}function j(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function I(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function M(e,t,n){var i=0;e=n?_(e/d):e>>1;e+=_(e/t);for(;e>x*h>>1;i+=u){e=_(e/x)}return _(i+(x+1)*e/(e+p))}function O(e){var t=[],n=e.length,i,r=0,s=g,a=m,o,l,p,d,y,b,w,k,x;o=e.lastIndexOf(v);if(o<0){o=0}for(l=0;l<o;++l){if(e.charCodeAt(l)>=128){E("not-basic")}t.push(e.charCodeAt(l))}for(p=o>0?o+1:0;p<n;){for(d=r,y=1,b=u;;b+=u){if(p>=n){E("invalid-input")}w=j(e.charCodeAt(p++));if(w>=u||w>_((c-r)/y)){E("overflow")}r+=w*y;k=b<=a?f:b>=a+h?h:b-a;if(w<k){break}x=u-k;if(y>_(c/x)){E("overflow")}y*=x}i=t.length+1;a=M(r-d,i,d==0);if(_(r/i)>c-s){E("overflow")}s+=_(r/i);r%=i;t.splice(r++,0,s)}return A(t)}function N(e){var t,n,i,r,s,a,o,l,p,d,y,b=[],w,k,x,C;e=T(e);w=e.length;t=g;n=0;s=m;for(a=0;a<w;++a){y=e[a];if(y<128){b.push(S(y))}}i=r=b.length;if(r){b.push(v)}while(i<w){for(o=c,a=0;a<w;++a){y=e[a];if(y>=t&&y<o){o=y}}k=i+1;if(o-t>_((c-n)/k)){E("overflow")}n+=(o-t)*k;t=o;for(a=0;a<w;++a){y=e[a];if(y<t&&++n>c){E("overflow")}if(y==t){for(l=n,p=u;;p+=u){d=p<=s?f:p>=s+h?h:p-s;if(l<d){break}C=l-d;x=u-d;b.push(S(I(d+C%x,0)));l=_(C/x)}b.push(S(I(l,0)));s=M(n,k,i==r);n=0;++i}}++n;++t}return b.join("")}function B(e){return $(e,function(e){return y.test(e)?O(e.slice(4).toLowerCase()):e})}function F(e){return $(e,function(e){return b.test(e)?"xn--"+N(e):e})}l={version:"1.4.1",ucs2:{decode:T,encode:A},decode:O,encode:N,toASCII:F,toUnicode:B};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return l})}else if(s&&a){if(n.exports==s){a.exports=l}else{for(C in l){l.hasOwnProperty(C)&&(s[C]=l[C])}}}else{r.punycode=l}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],15:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var a={};if(typeof e!=="string"||e.length===0){return a}var o=/\+/g;e=e.split(t);var l=1e3;if(s&&typeof s.maxKeys==="number"){l=s.maxKeys}var c=e.length;if(l>0&&c>l){c=l}for(var u=0;u<c;++u){var f=e[u].replace(o,"%20"),h=f.indexOf(n),p,d,m,g;if(h>=0){p=f.substr(0,h);d=f.substr(h+1)}else{p=f;d=""}m=decodeURIComponent(p);g=decodeURIComponent(d);if(!i(a,m)){a[m]=g}else if(r(a[m])){a[m].push(g)}else{a[m]=[a[m],g]}}return a};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],16:[function(e,t,n){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,o){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(a(e),function(a){var o=encodeURIComponent(i(a))+n;if(r(e[a])){return s(e[a],function(e){return o+encodeURIComponent(i(e))}).join(t)}else{return o+encodeURIComponent(i(e[a]))}}).join(t)}if(!o)return"";return encodeURIComponent(i(o))+n+encodeURIComponent(i(e))};var r=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var i=0;i<e.length;i++){n.push(t(e[i],i))}return n}var a=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],17:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":15,"./encode":16}],18:[function(e,t,n){(function(e,t){(function(t,n){"use strict";if(t.setImmediate){return}var i=1;var r={};var s=false;var a=t.document;var o;function l(e){if(typeof e!=="function"){e=new Function(""+e)}var t=new Array(arguments.length-1);for(var n=0;n<t.length;n++){t[n]=arguments[n+1]}var s={callback:e,args:t};r[i]=s;o(i);return i++}function c(e){delete r[e]}function u(e){var t=e.callback;var i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i);break}}function f(e){if(s){setTimeout(f,0,e)}else{var t=r[e];if(t){s=true;try{u(t)}finally{c(e);s=false}}}}function h(){o=function(t){e.nextTick(function(){f(t)})}}function p(){if(t.postMessage&&!t.importScripts){var e=true;var n=t.onmessage;t.onmessage=function(){e=false};t.postMessage("","*");t.onmessage=n;return e}}function d(){var e="setImmediate$"+Math.random()+"$";var n=function(n){if(n.source===t&&typeof n.data==="string"&&n.data.indexOf(e)===0){f(+n.data.slice(e.length))}};if(t.addEventListener){t.addEventListener("message",n,false)}else{t.attachEvent("onmessage",n)}o=function(n){t.postMessage(e+n,"*")}}function m(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;f(t)};o=function(t){e.port2.postMessage(t)}}function g(){var e=a.documentElement;o=function(t){var n=a.createElement("script");n.onreadystatechange=function(){f(t);n.onreadystatechange=null;e.removeChild(n);n=null};e.appendChild(n)}}function v(){o=function(e){setTimeout(f,0,e)}}var y=Object.getPrototypeOf&&Object.getPrototypeOf(t);y=y&&y.setTimeout?y:t;if({}.toString.call(t.process)==="[object process]"){h()}else if(p()){d()}else if(t.MessageChannel){m()}else if(a&&"onreadystatechange"in a.createElement("script")){g()}else{v()}y.setImmediate=l;y.clearImmediate=c})(typeof self==="undefined"?typeof t==="undefined"?this:t:self)}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:13}],19:[function(e,t,n){"use strict";var i=e("./seventh.js");i.promisifyNodeApi=((e,t,n,r,s)=>{var a;t=t||"Async";n=n||"AsyncAll";r=r||(e=>e[0]!=="_"&&!e.endsWith("Sync"));if(s){a=[];for(let t in e){if(typeof e[t]==="function"){a.push(t)}}}else{a=Object.keys(e)}a.filter(t=>{if(typeof e[t]!=="function"){return false}for(let n in e[t].prototype){return false}return r(t,e)}).forEach(r=>{const s=r+t;const a=r+n;if(!e[s]){e[s]=i.promisify(e[r],e)}if(!e[a]){e[a]=i.promisifyAll(e[r],e)}})});i.promisifyAnyNodeApi=((e,t,n,r)=>{i.promisifyNodeApi(e,t,n,r,true)})},{"./seventh.js":25}],20:[function(e,t,n){"use strict";var i=e("./seventh.js");const r={};function s(){}i.all=(e=>{var t=-1,n=false,r=0,s=Infinity,a,o=[],l=new i;for(a of e){if(n){break}t++;(()=>{const e=t;i.resolve(a).then(t=>{if(n){return}o[e]=t;r++;if(r>=s){n=true;l._resolveValue(o)}},e=>{if(n){return}n=true;l.reject(e)})})()}s=t+1;if(!s){l._resolveValue(o)}return l});i._allArray=(e=>{var t=e.length;if(!t){i._resolveValue([])}var n,r={settled:false,count:0,length:t,values:[],allPromise:new i};for(n=0;!r.settled&&n<t;n++){i._allArrayOne(e[n],n,r)}return r.allPromise});i._allArrayOne=((e,t,n)=>{i._bareThen(e,e=>{if(n.settled){return}n.values[t]=e;n.count++;if(n.count>=n.length){n.settled=true;n.allPromise._resolveValue(n.values)}},e=>{if(n.settled){return}n.settled=true;n.allPromise.reject(e)})});i.every=i.map=((e,t)=>{var n=-1,r=false,s=0,a=Infinity,o,l=[],c=new i;for(o of e){if(r){break}n++;(()=>{const e=n;i.resolve(o).then(n=>{if(r){return}return t(n,e)}).then(t=>{if(r){return}l[e]=t;s++;if(s>=a){r=true;c._resolveValue(l)}},e=>{if(r){return}r=true;c.reject(e)})})()}a=n+1;if(!a){c._resolveValue(l)}return c});i.any=(e=>{var t=-1,n=false,r=0,s=Infinity,a,o=[],l=new i;for(a of e){if(n){break}t++;(()=>{const e=t;i.resolve(a).then(e=>{if(n){return}n=true;l._resolveValue(e)},t=>{if(n){return}o[e]=t;r++;if(r>=s){n=true;l.reject(o)}})})()}s=t+1;if(!s){l.reject(new RangeError("Promise.any(): empty array"))}return l});i.some=((e,t)=>{var n=-1,r=false,s=0,a=Infinity,o,l=[],c=new i;for(o of e){if(r){break}n++;(()=>{const e=n;i.resolve(o).then(n=>{if(r){return}return t(n,e)}).then(e=>{if(r){return}r=true;c._resolveValue(e)},t=>{if(r){return}l[e]=t;s++;if(s>=a){r=true;c.reject(l)}})})()}a=n+1;if(!a){c.reject(new RangeError("Promise.any(): empty array"))}return c});i.filter=((e,t)=>{var n=-1,s=false,a=0,o=Infinity,l,c=[],u=new i;for(l of e){if(s){break}n++;(()=>{const e=n;i.resolve(l).then(n=>{if(s){return}c[e]=n;return t(n,e)}).then(t=>{if(s){return}a++;if(!t){c[e]=r}if(a>=o){s=true;c=c.filter(e=>e!==r);u._resolveValue(c)}},e=>{if(s){return}s=true;u.reject(e)})})()}o=n+1;if(!o){u._resolveValue(c)}else if(a>=o){s=true;c=c.filter(e=>e!==r);u._resolveValue(c)}return u});i.foreach=i.forEach=function(e,t,n){var r=-1,a=arguments.length>=3,o=e[Symbol.iterator](),l=new i,c=i.resolve(n);if(i.warnUnhandledRejection){i._handleAll(e)}var u=()=>{c.then(e=>{let{value:n,done:s}=o.next();r++;if(s){l.resolve(e)}else{c=i.resolve(n).then(a?n=>t(e,n,r):e=>t(e,r));u()}},e=>{l.reject(e);for(;;){let{value:e,done:t}=o.next();if(t){break}if(i.isThenable(e)){e.then(s,s)}}})};u();return l};i.reduce=((e,t,n)=>{return i.forEach(e,t,n)});i.mapObject=((e,t)=>{var n=false,r=0,s,a,o=Object.keys(e),l=o.length,c,u={},f=new i;for(s=0;!n&&s<l;s++){a=o[s];c=e[a];(()=>{const e=a;i.resolve(c).then(i=>{if(n){return}return t(i,e)}).then(t=>{if(n){return}u[e]=t;r++;if(r>=l){n=true;f._resolveValue(u)}},e=>{if(n){return}n=true;f.reject(e)})})()}if(!l){f._resolveValue(u)}return f});i.concurrent=((e,t,n)=>{var r=-1,s=false,a=0,o=0,l=Infinity,c,u=false,f=[],h=t[Symbol.iterator](),p=new i;if(i.warnUnhandledRejection){i._handleAll(t)}e=e||1;const d=()=>{while(!u&&a<e){({value:c,done:u}=h.next());if(u){l=r+1;if(o>=l){s=true;p._resolveValue(f);return}break}if(s){break}r++;(()=>{const t=r;a++;i.resolve(c).then(e=>{if(s){return}return n(e,t)}).then(n=>{if(s){return}f[t]=n;o++;a--;if(o>=l){s=true;p._resolveValue(f);return}if(a<e){d();return}},e=>{if(s){return}s=true;p.reject(e)})})()}};d();if(r<0){p._resolveValue(f)}return p});i.race=(e=>{var t=false,n,r=new i;for(n of e){if(t){break}i.resolve(n).then(e=>{if(t){return}t=true;r._resolveValue(e)},e=>{if(t){return}t=true;r.reject(e)})}return r})},{"./seventh.js":25}],21:[function(e,t,n){(function(n,i,r){"use strict";const s=i.Promise;var a;if(!n.browser){a=n.nextTick}else{e("setimmediate");a=r}function o(e){this.fn=e;this._then=o._dormantThen;this.value=null;this.thenHandlers=null;this.handledRejection=null;if(this.fn){this._exec()}}t.exports=o;o.Native=s;o.warnUnhandledRejection=true;o.prototype._exec=function(){this._then=o._pendingThen;try{this.fn(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};o.prototype.resolve=o.prototype.fulfill=function(e){if(this._then.settled){return this}if(o.isThenable(e)){this._execThenPromise(e);return this}return this._resolveValue(e)};o.prototype._resolveValue=function(e){this._then=o._fulfilledThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execFulfillHandlers()}return this};o.prototype._execThenPromise=function(e){try{e.then(e=>{this.resolve(e)},e=>{this.reject(e)})}catch(e){this.reject(e)}};o.prototype.reject=function(e){if(this._then.settled){return this}this._then=o._rejectedThen;this.value=e;if(this.thenHandlers&&this.thenHandlers.length){this._execRejectionHandlers()}else if(o.warnUnhandledRejection&&!this.handledRejection){this._unhandledRejection()}return this};o.prototype._execFulfillHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+1]){this._execOneFulfillHandler(this.thenHandlers[e],this.thenHandlers[e+1])}else{this.thenHandlers[e].resolve(this.value)}}};o.prototype._execOneFulfillHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};o.prototype._execRejectionHandlers=function(){var e,t=this.thenHandlers.length;for(e=0;e<t;e+=3){if(this.thenHandlers[e+2]){this._execOneRejectHandler(this.thenHandlers[e],this.thenHandlers[e+2])}else{this.thenHandlers[e].reject(this.value)}}};o.prototype._execOneRejectHandler=function(e,t){try{e.resolve(t(this.value))}catch(t){e.reject(t)}};o.prototype.resolveTimeout=o.prototype.fulfillTimeout=function(e,t){setTimeout(()=>this.resolve(t),e)};o.prototype.rejectTimeout=function(e,t){setTimeout(()=>this.reject(t),e)};o._dormantThen=function(e,t){if(this.fn){this._exec();return this._then(e,t)}var n=new o;if(!this.thenHandlers){this.thenHandlers=[n,e,t]}else{this.thenHandlers[this.thenHandlers.length]=n;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return n};o._dormantThen.settled=false;o._pendingThen=function(e,t){var n=new o;if(!this.thenHandlers){this.thenHandlers=[n,e,t]}else{this.thenHandlers[this.thenHandlers.length]=n;this.thenHandlers[this.thenHandlers.length]=e;this.thenHandlers[this.thenHandlers.length]=t}return n};o._pendingThen.settled=false;o._fulfilledThen=function(e){if(!e){return this}var t=new o;a(()=>{try{t.resolve(e(this.value))}catch(e){t.reject(e)}});return t};o._fulfilledThen.settled=true;o._rejectedThen=function(e,t){if(!t){return this}this.handledRejection=true;var n=new o;a(()=>{try{n.resolve(t(this.value))}catch(e){n.reject(e)}});return n};o._rejectedThen.settled=true;o.prototype.then=function(e,t){return this._then(e,t)};o.prototype.catch=function(e=(()=>undefined)){return this._then(undefined,e)};o.prototype.finally=function(e){return this._then(e,e)};o.prototype.tap=o.prototype.tapThen=function(e){this._then(e,undefined);return this};o.prototype.tapCatch=function(e){this._then(undefined,e);return this};o.prototype.tapFinally=function(e){this._then(e,e);return this};o.prototype.fatal=function(){this._then(undefined,e=>{a(()=>{throw e})})};o.prototype.done=function(e,t){this._then(e,t).fatal();return this};o.prototype.callback=function(e){this._then(t=>{e(undefined,t)},t=>{e(t)}).fatal();return this};o.prototype.callbackAll=function(e){this._then(t=>{if(Array.isArray(t)){e(undefined,...t)}else{e(undefined,t)}},t=>{e(t)}).fatal();return this};o.callback=function(e){return new o((t,n)=>{e((e,i)=>{if(e){n(e)}else{t(i)}})})};o.callbackAll=function(e){return new o((t,n)=>{e((e,...i)=>{if(e){n(e)}else{t(i)}})})};o.prototype.toPromise=o.prototype.propagate=function(e){this._then(t=>{e.resolve(t)},t=>{e.reject(t)});return this};o.propagate=function(e,t){e.then(e=>{t.resolve(e)},e=>{t.reject(e)});return e};o.finally=function(e,t){return e.then(t,t)};o.resolve=o.fulfill=function(e){if(o.isThenable(e)){return o.fromThenable(e)}return o._resolveValue(e)};o._resolveValue=function(e){var t=new o;t._then=o._fulfilledThen;t.value=e;return t};o.reject=function(e){var t=new o;t._then=o._rejectedThen;t.value=e;return t};o.resolveTimeout=o.fulfillTimeout=function(e,t){return new o(n=>setTimeout(()=>n(t),e))};o.rejectTimeout=function(e,t){return new o((n,i)=>setTimeout(()=>i(t),e))};o.resolveNextTick=o.fulfillNextTick=function(e){return new o(t=>a(()=>t(e)))};o.rejectNextTick=function(e){return new o((t,n)=>a(()=>n(e)))};o.dormant=function(e){var t=new o;t.fn=e;return t};o.try=function(e){try{return o.resolve(e())}catch(e){return o.reject(e)}};o.isThenable=function(e){return e&&typeof e==="object"&&typeof e.then==="function"};o.fromThenable=function(e){if(e instanceof o){return e}return new o((t,n)=>{e.then(e=>{t(e)},e=>{n(e)})})};o._bareThen=function(e,t,n){if(e&&typeof e==="object"){if(e instanceof o){if(e._then===o._fulfilledThen){t(e.value)}else if(e._then===o._rejectedThen){n(e.value)}else{e._then(t,n)}}else if(typeof e.then==="function"){e.then(t,n)}else{t(e)}}else{t(e)}};o._handleAll=function(e){var t;for(t of e){if(o.isThenable(t)){t.handledRejection=true}}};o.prototype._unhandledRejection=function(){this.handledRejection=false;const e=e=>setTimeout(e,0);if(this.value instanceof Error){e(()=>{if(this.handledRejection===false){this.value.message="Unhandled promise rejection: "+this.value.message;console.error(this.value)}})}else{let t=new Error("Unhandled promise rejection");e(()=>{if(this.handledRejection===false){console.error(t);console.error("Rejection reason:",this.value)}})}};o.prototype.getStatus=function(){switch(this._then){case o._dormantThen:return"dormant";case o._pendingThen:return"pending";case o._fulfilledThen:return"fulfilled";case o._rejectedThen:return"rejected"}};o.prototype.inspect=function(){switch(this._then){case o._dormantThen:return"Promise { <DORMANT> }";case o._pendingThen:return"Promise { <PENDING> }";case o._fulfilledThen:return"Promise { <FULFILLED> "+this.value+" }";case o._rejectedThen:return"Promise { <REJECTED> "+this.value+" }"}};o.resolved=o.dummy=o.resolve();if(n.browser){o.prototype.resolveAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.resolve(e))};o.prototype.rejectAtAnimationFrame=function(e){window.requestAnimationFrame(()=>this.reject(e))};o.resolveAtAnimationFrame=function(e){return new o(t=>window.requestAnimationFrame(()=>t(e)))};o.rejectAtAnimationFrame=function(e){return new o((t,n)=>window.requestAnimationFrame(()=>n(e)))}}}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},e("timers").setImmediate)},{_process:13,setimmediate:18,timers:34}],22:[function(e,t,n){"use strict";var i=e("./seventh.js");i.promisifyAll=((e,t)=>{if(t){return(...n)=>{return new i((i,r)=>{e.call(t,...n,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}r(e)}else{i(t)}})})}}return function(...t){return new i((n,i)=>{e.call(this,...t,(e,...t)=>{if(e){if(t.length&&e instanceof Error){e.args=t}i(e)}else{n(t)}})})}});i.promisify=((e,t)=>{if(t){return(...n)=>{return new i((i,r)=>{e.call(t,...n,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}r(e)}else{i(t)}})})}}return function(...t){return new i((n,i)=>{e.call(this,...t,(e,t)=>{if(e){if(t!==undefined&&e instanceof Error){e.arg=t}i(e)}else{n(t)}})})}});i.returnValueInterceptor=((e,t,n)=>{return function(...i){var r=t.call(n||this,...i);e(r);return r}});i.once=((e,t)=>{var n=false;var i;return function(...r){if(!n){n=true;i=e.call(t||this,...r)}return i}});i.serialize=((e,t)=>{var n=new i.resolve;return function(...r){var s=new i;n.finally(()=>{i.propagate(e.call(t||this,...r),s)});n=s;return s}});i.debounce=((e,t)=>{var n=null;const r=()=>{n=null};return function(...s){if(n){return n}n=e.call(t||this,...s);i.finally(n,r);return n}});i.debounceUpdate=((e,t)=>{var n=null;var r=null;var s=null;const a=()=>{var t,o;n=null;if(r){t=r;r=null;o=s;s=null;n=e.call(...t);i.propagate(n,o);i.finally(n,a);return n}};return function(...o){var l=t||this;if(n){if(!s){s=new i}r=[l,...o];return s}n=e.call(l,...o);i.finally(n,a);return n}});i.debounceSync=((e,t)=>{var n=new Map;const r=e=>{var t=n.get(e);if(!t){t={inProgress:null,inProgressIsFull:null,last:null,lastTime:null,lastFullSync:null,lastFullSyncTime:null,nextFullSyncPromise:null,nextFullSyncWith:null};n.set(e,t)}return t};const s=(e,n)=>{var r,a,o,l=new Date;e.inProgress=null;if(n>=2){e.lastFullSyncTime=e.lastTime=l}else if(n>=1){e.lastTime=l}if(e.nextFullSyncWith){if(t.delay&&e.lastFullSyncTime&&(r=l-e.lastFullSyncTime-t.delay)<0){e.inProgress=i.resolveTimeout(-r+1);e.inProgress.finally(()=>s(e,0));return e.nextFullSyncPromise}a=e.nextFullSyncWith;e.nextFullSyncWith=null;o=e.nextFullSyncPromise;e.nextFullSyncPromise=null;e.lastFullSync=e.last=e.inProgress=t.fn.call(...a);i.propagate(e.inProgress,o);i.finally(e.inProgress,()=>s(e,2));return e.inProgress}};const a=function(t,...n){var a=e.thisBinding||this,o=r(t);if(o.inProgress){return o.inProgress}if(e.delay&&o.lastTime&&new Date-o.lastTime<e.delay){return o.last}o.last=o.inProgress=e.fn.call(a,t,...n);o.inProgressIsFull=false;i.finally(o.inProgress,()=>s(o,1));return o.inProgress};const o=function(e,...n){var a,o=t.thisBinding||this,l=r(e);if(!l.inProgress&&t.delay&&l.lastFullSyncTime&&(a=new Date-l.lastFullSyncTime-t.delay)<0){l.inProgress=i.resolveTimeout(-a+1);i.finally(l.inProgress,()=>s(l,0))}if(l.inProgress){if(!l.nextFullSyncPromise){l.nextFullSyncPromise=new i}l.nextFullSyncWith=[o,e,...n];return l.nextFullSyncPromise}l.lastFullSync=l.last=l.inProgress=t.fn.call(o,e,...n);i.finally(l.inProgress,()=>s(l,2));return l.inProgress};return[a,o]});i.timeout=((e,t,n)=>{return function(...i){var r=t.call(n||this,...i);setTimeout(()=>r.reject(new Error("Timeout")),e);return r}});i.variableTimeout=((e,t)=>{return function(n,...i){var r=e.call(t||this,...i);setTimeout(()=>r.reject(new Error("Timeout")),n);return r}})},{"./seventh.js":25}],23:[function(e,t,n){(function(t){"use strict";var n=e("./seventh.js");var i=false;n.asyncExit=function(e,r){if(i){return}i=true;var s=t.listeners("asyncExit");if(!s.length){t.exit(e);return}if(r===undefined){r=1e3}const a=t=>{if(t.length<3){t(e,r);return n.dummy}return new n(n=>{t(e,r,()=>{n()})})};n.map(s,a).finally(()=>t.exit(e));setTimeout(()=>t.exit(e),r)};n.resolveSafeTimeout=function(e,t){return new n(n=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>{setTimeout(()=>n(t),0)},e/2)},e/2)},0)})}}).call(this,e("_process"))},{"./seventh.js":25,_process:13}],24:[function(e,t,n){"use strict";var i=e("./seventh.js");i.parasite=(()=>{var e=["tap","tapCatch","finally","fatal","done","callback","callbackAll"];e.forEach(e=>i.Native.prototype[e]=i.prototype[e]);i.Native.prototype._then=i.Native.prototype.then})},{"./seventh.js":25}],25:[function(e,t,n){"use strict";const i=e("./core.js");t.exports=i;e("./batch.js");e("./wrapper.js");e("./decorators.js");e("./api.js");e("./parasite.js");e("./misc.js")},{"./api.js":19,"./batch.js":20,"./core.js":21,"./decorators.js":22,"./misc.js":23,"./parasite.js":24,"./wrapper.js":26}],26:[function(e,t,n){"use strict";var i=e("./seventh.js");i.timeLimit=((e,t)=>{return new i((n,r)=>{if(typeof t==="function"){t=t()}i.resolve(t).then(n,r);setTimeout(()=>r(new Error("Timeout")),e)})});i.retry=((e,t)=>{var n=e.retries||1,r=e.coolDown||0,s=e.raiseFactor||1,a=e.maxCoolDown||Infinity,o=e.timeout||0,l=e.catch||null;const c=()=>{return(o?i.timeLimit(o,t):t()).catch(e=>{if(!n--){throw e}var t=r;r=Math.min(r*s,a);if(l){return i.resolve(l(e)).then(()=>i.resolveTimeout(t).then(c))}return i.resolveTimeout(t).then(c)})};return c()});i.onceEvent=((e,t)=>{return new i(n=>e.once(t,n))});i.onceEventAll=((e,t)=>{return new i(n=>e.once(t,(...e)=>n(e)))});i.onceEventOrError=((e,t,n)=>{return new i((i,r)=>{var s;var a=t=>{e.removeListener("error",o);if(s){for(let t in s){e.removeListener(t,s[t])}}i(t)};var o=n=>{e.removeListener(t,a);if(s){for(let t in s){e.removeListener(t,s[t])}}r(n)};e.once(t,a);e.once("error",o);if(n){if(!Array.isArray(n)){n=[n]}s={};n.forEach(n=>{var i=(...i)=>{e.removeListener("error",o);e.removeListener(t,a);var s=new Error("Received an excluded event: "+n);s.event=n;s.eventArgs=i;r(s)};e.once(n,i);s[n]=i})}})});i.onceEventAllOrError=((e,t,n)=>{return new i((i,r)=>{var s;var a=(...t)=>{e.removeListener("error",o);if(s){for(let t in s){e.removeListener(t,s[t])}}i(t)};var o=n=>{e.removeListener(t,a);if(s){for(let t in s){e.removeListener(t,s[t])}}r(n)};e.once(t,a);e.once("error",o);if(n){if(!Array.isArray(n)){n=[n]}s={};n.forEach(n=>{var i=(...i)=>{e.removeListener("error",o);e.removeListener(t,a);var s=new Error("Received an excluded event: "+n);s.event=n;s.eventArgs=i;r(s)};e.once(n,i);s[n]=i})}})})},{"./seventh.js":25}],27:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",grey:"[90m",gray:"[90m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m",defaultBgColor:"[49m",bgBlack:"[40m",bgRed:"[41m",bgGreen:"[42m",bgYellow:"[43m",bgBlue:"[44m",bgMagenta:"[45m",bgCyan:"[46m",bgWhite:"[47m",bgGrey:"[100m",bgGray:"[100m",bgBrightBlack:"[100m",bgBrightRed:"[101m",bgBrightGreen:"[102m",bgBrightYellow:"[103m",bgBrightBlue:"[104m",bgBrightMagenta:"[105m",bgBrightCyan:"[106m",bgBrightWhite:"[107m"}},{}],28:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=(e=>e.replace(/([.*+?^${}()|[\]/\\])/g,"\\$1"));n.regExpReplacement=(e=>e.replace(/\$/g,"$$$$"));n.format=(e=>e.replace(/%/g,"%%"));n.jsSingleQuote=(e=>n.control(e).replace(/'/g,"\\'"));n.jsDoubleQuote=(e=>n.control(e).replace(/"/g,'\\"'));n.shellArg=(e=>"'"+e.replace(/'/g,"'\\''")+"'");var i={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=((e,t=false)=>e.replace(/[\x00-\x1f\x7f]/g,e=>{if(t&&(e==="\n"||e==="\t")){return e}if(i[e]!==undefined){return i[e]}var n=e.charCodeAt(0).toString(16);if(n.length%2){n="0"+n}return"\\x"+n}));var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=(e=>e.replace(/[&<>]/g,e=>r[e]));n.htmlAttr=(e=>e.replace(/[&<>"]/g,e=>r[e]));n.htmlSpecialChars=(e=>e.replace(/[&<>"']/g,e=>r[e]));n.unicodePercentEncode=(e=>e.replace(/[\x00-\x1f\u0100-\uffff\x7f%]/g,e=>{try{return encodeURI(e)}catch(e){return""}}));n.httpHeaderValue=(e=>n.unicodePercentEncode(e))},{}],29:[function(e,t,n){(function(t){"use strict";var i=e("./inspect.js").inspect;var r=e("./inspect.js").inspectError;var s=e("./escape.js");var a=e("./ansi.js");n.formatMethod=function e(...t){var n=t[0];if(typeof n!=="string"){if(!n){n=""}else if(typeof n.toString==="function"){n=n.toString()}else{n=""}}var i,r=1,s=t.length,a=false,l=null,c=[];if(this.markupReset&&this.startingMarkupReset){n=(typeof this.markupReset==="function"?this.markupReset(c):this.markupReset)+n}n=n.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,(e,n,u,f,h,p,d)=>{var m,g,v,y,b,w,k=[];if(u){return"%"}if(n){if(this.noMarkup){return"^"+n}if(n==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[n]){l=this.shiftMarkup[n];return""}if(l){if(!this.shiftedMarkup||!this.shiftedMarkup[l]||!this.shiftedMarkup[l][n]){return""}a=true;if(typeof this.shiftedMarkup[l][n]==="function"){m=this.shiftedMarkup[l][n](c)}else{m=this.shiftedMarkup[l][n];c.push(m)}l=null}else{if(!this.markup||!this.markup[n]){return""}a=true;if(typeof this.markup[n]==="function"){m=this.markup[n](c)}else{m=this.markup[n];c.push(m)}}return m}if(h){h=parseInt(h,10);if(f){if(f==="+"){h=r+h}else if(f==="-"){h=r-h}}}else{h=r}r++;if(h>=s||h<1){i=undefined}else{i=t[h]}if(o[d]){m=o[d](i,p,this);if(this.argumentSanitizer&&!o[d].noSanitize){m=this.argumentSanitizer(m)}return m}if(d==="F"){r--;if(p===undefined){return""}v=p.split(":");y=v[0];b=v[1];if(!y){return""}if(b&&(w=b.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(g=0;g<w.length;g++){f=w[g][1];h=w[g][2];if(h){h=parseInt(h,10);if(f){if(f==="+"){h=r+h}else if(f==="-"){h=r-h}}}else{h=r}r++;if(h>=s||h<1){k[g]=undefined}else{k[g]=t[h]}}}if(!this||!this.fn||typeof this.fn[y]!=="function"){return""}return this.fn[y].apply(this,k)}return""});if(a&&this.markupReset&&this.endingMarkupReset){n+=typeof this.markupReset==="function"?this.markupReset(c):this.markupReset}if(this.extraArguments){for(;r<s;r++){i=t[r];if(i===null||i===undefined){continue}else if(typeof i==="string"){n+=i}else if(typeof i==="number"){n+=i}else if(typeof i.toString==="function"){n+=i.toString()}}}return n};var o={};o.s=(e=>{if(typeof e==="string"){return e}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return e.toString()}return"("+e+")"});o.r=(e=>o.s(e));o.r.noSanitize=true;o.S=((e,t,i)=>{var r=e=>n.markupMethod.call(i,i.argumentSanitizer?i.argumentSanitizer(e):e);if(typeof e==="string"){return r(e)}if(e===null||e===undefined||e===true||e===false){return"("+e+")"}if(typeof e==="number"){return""+e}if(typeof e.toString==="function"){return r(e.toString())}return r("("+e+")")});o.S.noSanitize=true;const l=/([a-zA-Z]?)(.[^a-zA-Z]*)/g;o.f=((e,t)=>{var n,i,r,s,a,o=0,c,u,f;if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}if(t){l.index=0;while(n=l.exec(t)){[,i,r]=n;if(i==="p"){f=+r}else if(r[0]==="."){s=r[r.length-1];if(s==="!"){a=parseInt(r.slice(1,-1),10);o=10**-a;c=a}else if(s==="?"){a=parseInt(r.slice(1,-1),10);o=10**-a;c=a;u=true}else{a=parseInt(r.slice(1),10);o=10**-a}}else if(r[r.length-1]==="."){a=parseInt(r.slice(0,-1),10);o=10**a}else{a=parseInt(r,10);o=10**(Math.ceil(Math.log10(e+Number.EPSILON)+Number.EPSILON)-a)}}}if(o){e=d(e,o)}if(c!==undefined&&(!u||e!==Math.trunc(e))){e=e.toFixed(c)}else{e=""+e}if(f){a=e.indexOf(".");if(a===-1){a=e.length}if(a<f){e="0".repeat(f-a)+e}}return e});o.f.noSanitize=true;o.e=((e,t)=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){e=0}if(t){return""+e.toExponential(parseInt(t,10)-1)}return""+e.toExponential()});o.e.noSanitize=true;o.d=o.i=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.floor(e)}return"0"});o.i.noSanitize=true;o.u=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0)}return"0"});o.u.noSanitize=true;o.U=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),1)}return"1"});o.U.noSanitize=true;o.k=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"0"}return y(e)});o.k.noSanitize=true;o.t=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"(NaN)"}var t=Math.floor(e/1e3);if(t<60){return t+"s"}var n=Math.floor(t/60);t=t%60;if(n<60){return n+"min"+c(t)+"s"}var i=Math.floor(n/60);n=n%60;return i+"h"+c(n)+"min"+c(t)+"s"});o.t.noSanitize=true;function c(e,t=2){e=""+e;if(e.length<t){e="0".repeat(t-e.length)+e}return e}o.h=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(16)}return"0"});o.h.noSanitize=true;o.x=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e!=="number"){return"0"}var t=""+Math.max(Math.floor(e),0).toString(16);if(t.length%2){t="0"+t}return t});o.x.noSanitize=true;o.o=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(8)}return"0"});o.o.noSanitize=true;o.b=(e=>{if(typeof e==="string"){e=parseFloat(e)}if(typeof e==="number"){return""+Math.max(Math.floor(e),0).toString(2)}return"0"});o.b.noSanitize=true;o.z=(e=>{if(typeof e==="string"){e=t.from(e)}else if(!t.isBuffer(e)){return""}return e.toString("base64")});o.Z=(e=>{if(typeof e==="string"){e=t.from(e)}else if(!t.isBuffer(e)){return""}return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]{1,2}$/g,"")});o.I=((e,t,n)=>{var r=3;if(t!==undefined){r=parseInt(t,10)}return i({depth:r,style:n&&n.color?"color":"none"},e)});o.I.noSanitize=true;o.Y=((e,t,n)=>{var r=3;if(t!==undefined){r=parseInt(t,10)}return i({depth:r,style:n&&n.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true,useInspect:true},e)});o.Y.noSanitize=true;o.E=((e,t,n)=>r({style:n&&n.color?"color":"none"},e));o.E.noSanitize=true;o.J=(e=>e===undefined?"null":JSON.stringify(e));o.D=(()=>"");o.D.noSanitize=true;var u={argumentSanitizer:e=>s.control(e,true),extraArguments:true,color:false,noMarkup:false,endingMarkupReset:true,startingMarkupReset:false,markupReset:a.reset,shiftMarkup:{"#":"background"},markup:{":":a.reset," ":a.reset+" ","-":a.dim,"+":a.bold,_:a.underline,"/":a.italic,"!":a.inverse,b:a.blue,B:a.brightBlue,c:a.cyan,C:a.brightCyan,g:a.green,G:a.brightGreen,k:a.black,K:a.brightBlack,m:a.magenta,M:a.brightMagenta,r:a.red,R:a.brightRed,w:a.white,W:a.brightWhite,y:a.yellow,Y:a.brightYellow},shiftedMarkup:{background:{":":a.reset," ":a.reset+" ",b:a.bgBlue,B:a.bgBrightBlue,c:a.bgCyan,C:a.bgBrightCyan,g:a.bgGreen,G:a.bgBrightGreen,k:a.bgBlack,K:a.bgBrightBlack,m:a.bgMagenta,M:a.bgBrightMagenta,r:a.bgRed,R:a.bgBrightRed,w:a.bgWhite,W:a.bgBrightWhite,y:a.bgYellow,Y:a.bgBrightYellow}}};n.createFormatter=(e=>n.formatMethod.bind(Object.assign({},u,e)));n.format=n.formatMethod.bind(u);n.format.default=u;n.markupMethod=function e(t){if(typeof t!=="string"){if(!t){t=""}else if(typeof t.toString==="function"){t=t.toString()}else{t=""}}var n=false,i=null,r=[];if(this.markupReset&&this.startingMarkupReset){t=(typeof this.markupReset==="function"?this.markupReset(r):this.markupReset)+t}t=t.replace(/\^(.?)/g,(e,t)=>{var s;if(t==="^"){return"^"}if(this.shiftMarkup&&this.shiftMarkup[t]){i=this.shiftMarkup[t];return""}if(i){if(!this.shiftedMarkup||!this.shiftedMarkup[i]||!this.shiftedMarkup[i][t]){return""}n=true;if(typeof this.shiftedMarkup[i][t]==="function"){s=this.shiftedMarkup[i][t](r)}else{s=this.shiftedMarkup[i][t];r.push(s)}i=null}else{if(!this.markup||!this.markup[t]){return""}n=true;if(typeof this.markup[t]==="function"){s=this.markup[t](r)}else{s=this.markup[t];r.push(s)}}return s});if(n&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(r):this.markupReset}return t};n.createMarkup=(e=>n.markupMethod.bind(Object.assign({},u,e)));n.markup=n.markupMethod.bind(u);n.format.count=function e(t){var n,i,r,s=1,a=0;if(typeof t!=="string"){return 0}var o=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=o.exec(t))!==null){r=n[1];i=n[2];if(i){i=parseInt(i,10);if(r){if(r==="+"){i=s+i}else if(r==="-"){i=s-i}}}else{i=s}s++;if(a<i){a=i}}return a};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}return false};const f=1e-10;const h=Math.round(1/f);function p(e){return Math.round(e*h)/h}function d(e,t){return p(t*Math.round(e*(1/t)))}const m=["","k","M","G","T","P","E","Z","Y"];const g=["","m","","n","p","f","a","z","y"];const v=[100,10,1];function y(e){var t,n,i,r,s;if(!e||e===1){return""+e}if(e<0){return"-"+y(-e)}if(e>1){t=Math.floor(Math.log10(e));n=Math.floor(t/3);i=t%3;r=b(e/Math.pow(1e3,n),v[i]);s=m[n]}else{t=Math.floor(Math.log10(e));n=Math.floor(t/3);i=t%3;if(i<0){i+=3}r=b(e/Math.pow(1e3,n),v[i]);s=g[-n]}return""+r+s}function b(e,t){return Math.round((e+Number.EPSILON)*t)/t}}).call(this,e("buffer").Buffer)},{"./ansi.js":27,"./escape.js":28,"./inspect.js":30,buffer:6}],30:[function(e,t,n){(function(t,i){"use strict";const r=e("./escape.js");const s=e("./ansi.js");const a={};function o(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(e.depth===undefined){e.depth=3}if(e.maxLength===undefined){e.maxLength=250}if(e.outputMaxLength===undefined){e.outputMaxLength=5e3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.noArrayProperty=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}var i=l(n,e,t);if(i.length>e.outputMaxLength){i=e.style.truncate(i,e.outputMaxLength)}return i}function l(e,n,i){var s,o,u,h,p,d,m,g,v,y,b,w,k,x="",_="",S="",C,E;g=typeof i;y=n.style.tab.repeat(e.depth);if(g==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){S=[];if(!e.descriptor.configurable){S.push("-conf")}if(!e.descriptor.enumerable){S.push("-enum")}if(!e.descriptor.writable){S.push("-w")}if(S.length){S=S.join(" ")}else{S=""}}if(e.keyIsProperty){if(c(e.key)){_='"'+n.style.key(e.key)+'": '}else{_=n.style.key(e.key)+": "}}else{_=n.style.index(e.key)}if(S){S=" "+n.style.type(S)}}v=e.noPre?"":y+_;if(i===undefined){x+=v+n.style.constant("undefined")+S+n.style.newline}else if(i===a){x+=v+n.style.constant("[empty]")+S+n.style.newline}else if(i===null){x+=v+n.style.constant("null")+S+n.style.newline}else if(i===false){x+=v+n.style.constant("false")+S+n.style.newline}else if(i===true){x+=v+n.style.constant("true")+S+n.style.newline}else if(g==="number"){x+=v+n.style.number(i.toString())+(n.noType?"":" "+n.style.type("number"))+S+n.style.newline}else if(g==="string"){if(i.length>n.maxLength){x+=v+'"'+n.style.string(r.control(i.slice(0,n.maxLength-1)))+'"'+(n.noType?"":" "+n.style.type("string")+n.style.length("("+i.length+" - TRUNCATED)"))+S+n.style.newline}else{x+=v+'"'+n.style.string(r.control(i))+'"'+(n.noType?"":" "+n.style.type("string")+n.style.length("("+i.length+")"))+S+n.style.newline}}else if(t.isBuffer(i)){x+=v+n.style.inspect(i.inspect())+(n.noType?"":" "+n.style.type("Buffer")+n.style.length("("+i.length+")"))+S+n.style.newline}else if(g==="object"||g==="function"){o=u="";w=false;if(g==="function"){w=true;o=" "+n.style.funcName(i.name?i.name:"(anonymous)");u=n.style.length("("+i.length+")")}b=false;if(Array.isArray(i)){b=true;u=n.style.length("("+i.length+")")}if(!i.constructor){d="(no constructor)"}else if(!i.constructor.name){d="(anonymous)"}else{d=i.constructor.name}d=n.style.constructorName(d);h=Object.getPrototypeOf(i);x+=v;if(!n.noType){if(e.forceType){x+=n.style.type(e.forceType)}else{x+=d+o+u+" "+n.style.type(g)+S}if(!w||n.funcDetails){x+=" "}}if(b&&n.noArrayProperty){p=[...Array(i.length).keys()]}else{p=Object.getOwnPropertyNames(i)}if(n.sort){p.sort()}k=f(i,e,n);if(n.protoBlackList&&n.protoBlackList.has(h)){x+=n.style.limit("[skip]")+n.style.newline}else if(k!==undefined){if(typeof k==="string"){x+="=> "+k+n.style.newline}else{x+="=> "+l({depth:e.depth,ancestors:e.ancestors,noPre:true},n,k)}}else if(w&&!n.funcDetails){x+=n.style.newline}else if(!p.length&&!n.proto){x+=(b?"[]":"{}")+n.style.newline}else if(e.depth>=n.depth){x+=n.style.limit("[depth limit]")+n.style.newline}else if(e.ancestors.indexOf(i)!==-1){x+=n.style.limit("[circular]")+n.style.newline}else{x+=(b&&n.noType&&n.noArrayProperty?"[":"{")+n.style.newline;E=e.ancestors.slice();E.push(i);for(s=0;s<p.length&&x.length<n.outputMaxLength;s++){if(!b&&n.propertyBlackList&&n.propertyBlackList.has(p[s])){continue}if(b&&n.noArrayProperty&&!(p[s]in i)){x+=l({depth:e.depth+1,ancestors:E,key:p[s],keyIsProperty:false},n,a)}else{try{C=Object.getOwnPropertyDescriptor(i,p[s]);if(!C.enumerable&&n.enumOnly){continue}m=!b||!C.enumerable||isNaN(p[s]);if(!n.noDescriptor&&C&&(C.get||C.set)){x+=l({depth:e.depth+1,ancestors:E,key:p[s],keyIsProperty:m,descriptor:C,forceType:"getter/setter"},n,{get:C.get,set:C.set})}else{x+=l({depth:e.depth+1,ancestors:E,key:p[s],keyIsProperty:m,descriptor:n.noDescriptor?undefined:C},n,i[p[s]])}}catch(t){x+=l({depth:e.depth+1,ancestors:E,key:p[s],keyIsProperty:m,descriptor:n.noDescriptor?undefined:C},n,t)}}if(s<p.length-1){x+=n.style.comma}}if(n.proto){x+=l({depth:e.depth+1,ancestors:E,key:"__proto__",keyIsProperty:true},n,h)}x+=y+(b&&n.noType&&n.noArrayProperty?"]":"}");x+=n.style.newline}}if(e.depth===0){if(n.style.trim){x=x.trim()}if(n.style==="html"){x=r.html(x)}}return x}n.inspect=o;function c(e){if(!e.length){return true}return false}var u=["pending","fulfilled","rejected"];function f(e,t,n){if(typeof e.constructor!=="function"){return}if(e instanceof String){return e.toString()}if(e instanceof RegExp){return e.toString()}if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}if(e instanceof Promise){if(i&&i.binding&&i.binding("util")&&i.binding("util").getPromiseDetails){let r=i.binding("util").getPromiseDetails(e);let s=u[r[0]];let a="Promise <"+s+">";if(s==="fulfilled"){a+=" "+l({depth:t.depth,ancestors:t.ancestors,noPre:true},n,r[1])}else if(s==="rejected"){if(r[1]instanceof Error){a+=" "+h({style:n.style,noErrorStack:true},r[1])}else{a+=" "+l({depth:t.depth,ancestors:t.ancestors,noPre:true},n,r[1])}}return a}}if(e._bsontype){return e.toString()}if(n.useInspect&&typeof e.inspect==="function"){return e.inspect()}return}function h(e,t){var n="",i,r,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return"inspectError: not an error -- regular variable inspection: "+o(e,t)}if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(t.stack&&!e.noErrorStack){i=p(e,t.stack)}r=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(r)+(s?" ["+e.style.errorType(s)+"]":"")+": ";n+=e.style.errorMessage(t.message)+"\n";if(i){n+=e.style.errorStack(i)+"\n"}if(t.from){n+=e.style.newline+e.style.errorFromMessage("Error created from:")+e.style.newline+h(e,t.from)}return n}n.inspectError=h;function p(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=d.none}else if(typeof e.style==="string"){e.style=d[e.style]}if(!t){return}if((e.browser||i.browser)&&t.indexOf("@")!==-1){t=t.replace(/[</]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,(t,n,i,r,s)=>{return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(i?e.style.errorStackFile(i):e.style.errorStack("unknown"))+(r?e.style.errorStack(":")+e.style.errorStackLine(r):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:((?:new +)?[^\s:()[\]\n]+(?:\([^)]+\))?)\s)?(?:\[as ([^\s:()[\]\n]+)\]\s)?(?:\(?([^:()[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,(t,n,i,r,s,a,o)=>{return e.style.errorStack("    at ")+(i?e.style.errorStackMethod(i)+" ":"")+(r?e.style.errorStack("[as ")+e.style.errorStackMethodAs(r)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(a?e.style.errorStack(":")+e.style.errorStackLine(a):"")+(o?e.style.errorStack(":")+e.style.errorStackColumn(o):"")+e.style.errorStack(")")})}return t}n.inspectStack=p;var d={};var m=e=>e;d.none={trim:false,tab:"    ",newline:"\n",comma:"",limit:m,type:e=>"<"+e+">",constant:m,funcName:m,constructorName:e=>"<"+e+">",length:m,key:m,index:e=>"["+e+"] ",number:m,inspect:m,string:m,errorType:m,errorMessage:m,errorStack:m,errorStackMethod:m,errorStackMethodAs:m,errorStackFile:m,errorStackLine:m,errorStackColumn:m,errorFromMessage:m,truncate:(e,t)=>e.slice(0,t-1)+""};d.inline=Object.assign({},d.none,{trim:true,tab:"",newline:" ",comma:", ",length:()=>"",index:()=>""});d.color=Object.assign({},d.none,{limit:e=>s.bold+s.brightRed+e+s.reset,type:e=>s.italic+s.brightBlack+e+s.reset,constant:e=>s.cyan+e+s.reset,funcName:e=>s.italic+s.magenta+e+s.reset,constructorName:e=>s.magenta+e+s.reset,length:e=>s.italic+s.brightBlack+e+s.reset,key:e=>s.green+e+s.reset,index:e=>s.blue+"["+e+"]"+s.reset+" ",number:e=>s.cyan+e+s.reset,inspect:e=>s.cyan+e+s.reset,string:e=>s.blue+e+s.reset,errorType:e=>s.red+s.bold+e+s.reset,errorMessage:e=>s.red+s.italic+e+s.reset,errorStack:e=>s.brightBlack+e+s.reset,errorStackMethod:e=>s.brightYellow+e+s.reset,errorStackMethodAs:e=>s.yellow+e+s.reset,errorStackFile:e=>s.brightCyan+e+s.reset,errorStackLine:e=>s.blue+e+s.reset,errorStackColumn:e=>s.magenta+e+s.reset,errorFromMessage:e=>s.yellow+s.underline+e+s.reset,truncate:(e,t)=>{var n=s.gray+""+s.reset;e=e.slice(0,t-n.length);var i=e.lastIndexOf("");if(i>=e.length-6){e=e.slice(0,i)}return e+n}});d.html=Object.assign({},d.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",newline:"<br />",limit:e=>'<span style="color:red">'+e+"</span>",type:e=>'<i style="color:gray">'+e+"</i>",constant:e=>'<span style="color:cyan">'+e+"</span>",funcName:e=>'<i style="color:magenta">'+e+"</i>",constructorName:e=>'<span style="color:magenta">'+e+"</span>",length:e=>'<i style="color:gray">'+e+"</i>",key:e=>'<span style="color:green">'+e+"</span>",index:e=>'<span style="color:blue">['+e+"]</span> ",number:e=>'<span style="color:cyan">'+e+"</span>",inspect:e=>'<span style="color:cyan">'+e+"</span>",string:e=>'<span style="color:blue">'+e+"</span>",errorType:e=>'<span style="color:red">'+e+"</span>",errorMessage:e=>'<span style="color:red">'+e+"</span>",errorStack:e=>'<span style="color:gray">'+e+"</span>",errorStackMethod:e=>'<span style="color:yellow">'+e+"</span>",errorStackMethodAs:e=>'<span style="color:yellow">'+e+"</span>",errorStackFile:e=>'<span style="color:cyan">'+e+"</span>",errorStackLine:e=>'<span style="color:blue">'+e+"</span>",errorStackColumn:e=>'<span style="color:gray">'+e+"</span>",errorFromMessage:e=>'<span style="color:yellow">'+e+"</span>"})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":8,"./ansi.js":27,"./escape.js":28,_process:13}],31:[function(e,t,n){"use strict";const i={};t.exports=i;i.dFromPoints=((e,t)=>{var n=t?-1:1,i="M";e.forEach(e=>{i+=" "+e.x+","+e.y*n});return i})},{}],32:[function(e,t,n){(function(n){"use strict";const i=e("fs");const r=e("dom-kit");const s=e("string-kit/lib/escape.js");function a(){}const o={};t.exports=o;o.path=e("./path.js");const l=["path","circle","ellipse","line","rect","polyline","polygone","text","textPath"];o.inject=function(e,t){o.patch(e,t);if(t.into){t.into.appendChild(e)}if(t.as){r.moveAttributes(e,t.as);r.moveChildrenInto(e,t.as)}};o.patch=function(e,t){var n,i,s;o.lightCleanup(e);if(t.id!==undefined){if(typeof t.id==="string"){e.setAttribute("id",t.id)}else if(!t.id){e.removeAttribute("id")}}if(t.class){if(typeof t.class==="string"){e.classList.add(t.class)}else if(typeof t.class==="object"){r.class(e,t.class)}}if(t.hidden){e.style.visibility="hidden"}if(t.prefixIds){r.prefixIds(e,t.prefixIds)}if(t.removeIds){r.removeAllAttributes(e,"id")}if(t.removeSvgStyle){e.removeAttribute("style")}if(t.removeDefaultStyles){o.removeDefaultStyles(e)}if(t.removeComments){r.removeComments(e)}if(t.removeExoticNamespaces){r.filterByNamespace(e,{primary:"svg",whitelist:[]})}if(t.removeSize){i=e.getAttribute("width")||e.style.width;s=e.getAttribute("height")||e.style.height;e.removeAttribute("height");e.removeAttribute("width");e.style.width=null;e.style.height=null;if(!e.getAttribute("viewBox")&&i&&s){n="0 0 "+i+" "+s;e.setAttribute("viewBox",n)}}if(t.css){r.css(e,t.css)}if(t.colorClass){o.colorClass(e)}if(t.removeWhiteSpaces){r.removeWhiteSpaces(e)}else if(t.removeWhiteLines){r.removeWhiteSpaces(e,true)}};o.patchDocument=function(e,t){var n=t.removeWhiteSpaces,i=t.removeWhiteLines,s=t.removeComments;delete t.removeWhiteSpaces;delete t.removeWhiteLines;delete t.removeComments;if(s){r.removeComments(e)}o.patch(e.documentElement,t);if(n){r.removeWhiteSpaces(e)}else if(i){r.removeWhiteSpaces(e,true)}};o.lightCleanup=function(e){r.removeAllTags(e,"metadata");r.removeAllTags(e,"script");r.removeAllTags(e,"defs",true)};o.colorClass=function(e){l.forEach(t=>{Array.from(e.getElementsByTagName(t)).forEach(e=>{if(!e.getAttribute("class")){e.classList.add("primary")}r.styleToAttribute(e,"fill",["none"]);r.styleToAttribute(e,"stroke",["none"])})})};const c=[["font-style","normal"],["font-weight","normal"],["font-variant","normal"],["font-stretch","normal"],["font-size","medium"],["line-height","normal"],["font-variant-ligatures","normal"],["font-variant-position","normal"],["font-variant-caps","normal"],["font-variant-numeric","normal"],["font-variant-alternates","normal"],["font-variant-east-asian","normal"],["font-feature-settings","normal"],["text-indent","0"],["text-align","start"],["text-decoration","none"],["text-decoration-line","none"],["text-decoration-style","solid"],["text-decoration-color","#000000"],["letter-spacing","normal"],["word-spacing","normal"],["text-transform","none"],["writing-mode","lr-tb"],["direction","ltr"],["text-orientation","mixed"],["dominant-baseline","auto"],["baseline-shift","baseline"],["text-anchor","start"],["white-space","normal"],["shape-padding","0"],["display","inline"],["visibility","visible"],["overflow","visible"],["opacity","1"],["isolation","auto"],["mix-blend-mode","normal"],["color-interpolation","sRGB"],["color-interpolation-filters","linearRGB"],["solid-color","#000000"],["solid-opacity","1"],["vector-effect","none"],["fill-rule","nonzero"],["clip-rule","nonzero"],["color-rendering","auto"],["image-rendering","auto"],["shape-rendering","auto"],["text-rendering","auto"],["enable-background","accumulate"],["stroke-dasharray","none"],["stroke-dashoffset","0"],["paint-order","normal"],["paint-order","fill stroke markers"]];o.removeDefaultStyles=function(e){l.forEach(t=>{Array.from(e.getElementsByTagName(t)).forEach(e=>{var t=e.getAttribute("style");c.forEach(e=>{var n=e[0];var i=e[1];t=t.replace(new RegExp("(^|;) *"+s.regExp(n)+" *: *"+s.regExp(i)+" *(?:;|$)"),(e,t)=>t)});e.setAttribute("style",t)})})};o.load=function(e,t,s){if(typeof t==="function"){s=t;t={}}else if(!t||typeof t!=="object"){t={}}if(typeof s!=="function"){s=a}if(!n.browser){if(e.substring(0,7)==="file://"){e=e.slice(7)}i.readFile(e,"utf8",(e,n)=>{if(e){s(e);return}var i=r.fromXml(n);if(t.removeComments){r.removeComments(i);delete t.removeComments}var a=i.documentElement;try{o.inject(a,t)}catch(e){s(e);return}s(undefined,a)})}else{o.ajax(e,(e,n)=>{if(e){s(e);return}if(t.removeComments){r.removeComments(n);delete t.removeComments}var i=n.documentElement;try{o.inject(i,t)}catch(e){s(e);return}s(undefined,i)})}};o.ajax=function(e,t){var n=new XMLHttpRequest;n.responseType="document";n.onreadystatechange=o.ajax.ajaxStatus.bind(n,t);n.open("GET",e);n.send()};o.ajax.ajaxStatus=function(e){try{if(this.readyState===4){if(this.status===200){e(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){e(undefined,this.responseXML)}else if(this.status){e(this.status)}else{e(new Error("[svg-kit] ajaxStatus(): Error with falsy status"))}}}catch(t){e(t)}};o.getViewBox=function(e){var t=e.getAttribute("viewBox");if(!t){return null}var n=t.split(/ +/);return{x:parseFloat(n[0],10),y:parseFloat(n[1],10),width:parseFloat(n[2],10),height:parseFloat(n[3],10)}};o.setViewBox=function(e,t){e.setAttribute("viewBox",t.x+" "+t.y+" "+t.width+" "+t.height)};o.toAreaArray=function(e){if(e.min&&e.max){return[e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y]}else if(e.xmin!==undefined&&e.xmax!==undefined&&e.ymin!==undefined&&e.ymax!==undefined){return[e.xmin,e.ymin,e.xmax-e.xmin,e.ymax-e.ymin]}else if(e.x!==undefined&&e.y!==undefined&&e.width!==undefined&&e.height!==undefined){return[e.x,e.y,e.width,e.height]}return[0,0,100,100]};o.standalone=function(e,t){var n='<?xml version="1.0" encoding="UTF-8"?>\n';if(!Array.isArray(t)){t=o.toAreaArray(t)}n+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="'+t.join(" ")+'">\n';n+=e;n+="\n</svg>\n";return n}}).call(this,e("_process"))},{"./path.js":31,_process:13,"dom-kit":7,fs:6,"string-kit/lib/escape.js":33}],33:[function(e,t,n){arguments[4][28][0].apply(n,arguments)},{dup:28}],34:[function(e,t,n){(function(t,i){var r=e("process/browser.js").nextTick;var s=Function.prototype.apply;var a=Array.prototype.slice;var o={};var l=0;n.setTimeout=function(){return new c(s.call(setTimeout,window,arguments),clearTimeout)};n.setInterval=function(){return new c(s.call(setInterval,window,arguments),clearInterval)};n.clearTimeout=n.clearInterval=function(e){e.close()};function c(e,t){this._id=e;this._clearFn=t}c.prototype.unref=c.prototype.ref=function(){};c.prototype.close=function(){this._clearFn.call(window,this._id)};n.enroll=function(e,t){clearTimeout(e._idleTimeoutId);e._idleTimeout=t};n.unenroll=function(e){clearTimeout(e._idleTimeoutId);e._idleTimeout=-1};n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;if(t>=0){e._idleTimeoutId=setTimeout(function t(){if(e._onTimeout)e._onTimeout()},t)}};n.setImmediate=typeof t==="function"?t:function(e){var t=l++;var i=arguments.length<2?false:a.call(arguments,1);o[t]=true;r(function r(){if(o[t]){if(i){e.apply(null,i)}else{e.call(null)}n.clearImmediate(t)}});return t};n.clearImmediate=typeof i==="function"?i:function(e){delete o[e]}}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":13,timers:34}],35:[function(e,t,n){"use strict";var i=e("punycode");var r=e("./util");n.parse=k;n.resolve=_;n.resolveObject=S;n.format=x;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var a=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(c),f=["'"].concat(u),h=["%","/","?",";","#"].concat(f),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:true,"javascript:":true},y={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},w=e("querystring");function k(e,t,n){if(e&&r.isObject(e)&&e instanceof s)return e;var i=new s;i.parse(e,t,n);return i}s.prototype.parse=function(e,t,n){if(!r.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),o=s!==-1&&s<e.indexOf("#")?"?":"#",c=e.split(o),u=/\\/g;c[0]=c[0].replace(u,"/");e=c.join(o);var k=e;k=k.trim();if(!n&&e.split("#").length===1){var x=l.exec(k);if(x){this.path=k;this.href=k;this.pathname=x[1];if(x[2]){this.search=x[2];if(t){this.query=w.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var _=a.exec(k);if(_){_=_[0];var S=_.toLowerCase();this.protocol=S;k=k.substr(_.length)}if(n||_||k.match(/^\/\/[^@\/]+@[^@\/]+/)){var C=k.substr(0,2)==="//";if(C&&!(_&&y[_])){k=k.substr(2);this.slashes=true}}if(!y[_]&&(C||_&&!b[_])){var E=-1;for(var L=0;L<p.length;L++){var $=k.indexOf(p[L]);if($!==-1&&(E===-1||$<E))E=$}var T,A;if(E===-1){A=k.lastIndexOf("@")}else{A=k.lastIndexOf("@",E)}if(A!==-1){T=k.slice(0,A);k=k.slice(A+1);this.auth=decodeURIComponent(T)}E=-1;for(var L=0;L<h.length;L++){var $=k.indexOf(h[L]);if($!==-1&&(E===-1||$<E))E=$}if(E===-1)E=k.length;this.host=k.slice(0,E);k=k.slice(E);this.parseHost();this.hostname=this.hostname||"";var j=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!j){var I=this.hostname.split(/\./);for(var L=0,M=I.length;L<M;L++){var O=I[L];if(!O)continue;if(!O.match(m)){var N="";for(var B=0,F=O.length;B<F;B++){if(O.charCodeAt(B)>127){N+="x"}else{N+=O[B]}}if(!N.match(m)){var P=I.slice(0,L);var U=I.slice(L+1);var R=O.match(g);if(R){P.push(R[1]);U.unshift(R[2])}if(U.length){k="/"+U.join(".")+k}this.hostname=P.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!j){this.hostname=i.toASCII(this.hostname)}var G=this.port?":"+this.port:"";var D=this.hostname||"";this.host=D+G;this.href+=this.host;if(j){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(k[0]!=="/"){k="/"+k}}}if(!v[S]){for(var L=0,M=f.length;L<M;L++){var W=f[L];if(k.indexOf(W)===-1)continue;var H=encodeURIComponent(W);if(H===W){H=escape(W)}k=k.split(W).join(H)}}var q=k.indexOf("#");if(q!==-1){this.hash=k.substr(q);k=k.slice(0,q)}var Y=k.indexOf("?");if(Y!==-1){this.search=k.substr(Y);this.query=k.substr(Y+1);if(t){this.query=w.parse(this.query)}k=k.slice(0,Y)}else if(t){this.search="";this.query={}}if(k)this.pathname=k;if(b[S]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var G=this.pathname||"";var z=this.search||"";this.path=G+z}this.href=this.format();return this};function x(e){if(r.isString(e))e=k(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",s=false,a="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&r.isObject(this.query)&&Object.keys(this.query).length){a=w.stringify(this.query)}var o=this.search||a&&"?"+a||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(i&&i.charAt(0)!=="#")i="#"+i;if(o&&o.charAt(0)!=="?")o="?"+o;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});o=o.replace("#","%23");return t+s+n+o+i};function _(e,t){return k(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(k(e,false,true)).format()};function S(e,t){if(!e)return t;return k(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(r.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var i=Object.keys(this);for(var a=0;a<i.length;a++){var o=i[a];n[o]=this[o]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var l=Object.keys(e);for(var c=0;c<l.length;c++){var u=l[c];if(u!=="protocol")n[u]=e[u]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var f=Object.keys(e);for(var h=0;h<f.length;h++){var p=f[h];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!y[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");n.pathname=d.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var g=n.search||"";n.path=m+g}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var v=n.pathname&&n.pathname.charAt(0)==="/",w=e.host||e.pathname&&e.pathname.charAt(0)==="/",k=w||v||n.host&&e.pathname,x=k,_=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],S=n.protocol&&!b[n.protocol];if(S){n.hostname="";n.port=null;if(n.host){if(_[0]==="")_[0]=n.host;else _.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}k=k&&(d[0]===""||_[0]==="")}if(w){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;_=d}else if(d.length){if(!_)_=[];_.pop();_=_.concat(d);n.search=e.search;n.query=e.query}else if(!r.isNullOrUndefined(e.search)){if(S){n.hostname=n.host=_.shift();var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}n.search=e.search;n.query=e.query;if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!_.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var E=_.slice(-1)[0];var L=(n.host||e.host||_.length>1)&&(E==="."||E==="..")||E==="";var $=0;for(var T=_.length;T>=0;T--){E=_[T];if(E==="."){_.splice(T,1)}else if(E===".."){_.splice(T,1);$++}else if($){_.splice(T,1);$--}}if(!k&&!x){for(;$--;$){_.unshift("..")}}if(k&&_[0]!==""&&(!_[0]||_[0].charAt(0)!=="/")){_.unshift("")}if(L&&_.join("/").substr(-1)!=="/"){_.push("")}var A=_[0]===""||_[0]&&_[0].charAt(0)==="/";if(S){n.hostname=n.host=A?"":_.length?_.shift():"";var C=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(C){n.auth=C.shift();n.host=n.hostname=C.shift()}}k=k||n.host&&_.length;if(k&&!A){_.unshift("")}if(!_.length){n.pathname=null;n.path=null}else{n.pathname=_.join("/")}if(!r.isNull(n.pathname)||!r.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=o.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":36,punycode:14,querystring:17}],36:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}]},{},[2])(2)});