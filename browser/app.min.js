(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var c=typeof require=="function"&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return i(n?n:e)},u,u.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";var r=e("dom-kit");var i=e("tree-kit/lib/extend.js");function s(){}function o(){return o.create()}t.exports=o;o.create=function e(){var t=Object.create(o.prototype);t.$theme=document.querySelector("#theme");t.$gfx=document.querySelector("#gfx");t.$sceneImage=document.querySelector(".scene-image");t.$content=document.querySelector("#content");t.$text=document.querySelector("#text");t.$chat=document.querySelector("#chat");t.$chatForm=document.querySelector("#chat-form");t.$chatInput=document.querySelector("#chat-input");t.$next=document.querySelector("#next");t.$hint=document.querySelector("#hint");t.$connection=document.querySelector("#connection");t.$music=document.querySelector("#music");t.$sound0=document.querySelector("#sound0");t.$sound1=document.querySelector("#sound1");t.$sound2=document.querySelector("#sound2");t.$sound3=document.querySelector("#sound3");t.nextSoundChannel=0;t.sprites={};t.animations={};t.hideContentTimer=null;t.onChatSubmit=null;t.initEvents();window.dom=t;return t};o.prototype.setTheme=function e(t){this.$theme.setAttribute("href",t.url)};o.prototype.initEvents=function e(){this.$gfx.addEventListener("click",this.toggleContent.bind(this),false)};o.prototype.toggleContent=function e(){if(this.$content.classList.contains("hidden")){this.showContent()}else{this.hideContent()}};o.prototype.hideContent=function e(){if(this.hideContentTimer!==null){clearTimeout(this.hideContentTimer);this.hideContentTimer=null}this.$content.classList.add("hidden");this.hideContentTimer=setTimeout(this.showContent.bind(this),8e3)};o.prototype.showContent=function e(){if(this.hideContentTimer!==null){clearTimeout(this.hideContentTimer);this.hideContentTimer=null}this.$content.classList.remove("hidden")};o.prototype.clientStatus=function e(t,n){var i=document.createElement("span");i.classList.add(n.color);i.textContent=t;r.empty(this.$connection);this.$connection.appendChild(i);this.$connection.classList.toggle("alert",n.alert)};o.prototype.clear=function e(t){t=t||s;r.empty(this.$hint);r.empty(this.$text);r.empty(this.$next);t()};o.prototype.clearHints=function e(t){t=t||s;r.empty(this.$hint);t()};o.prototype.clearMessages=function e(t){t=t||s;r.empty(this.$text);t()};o.prototype.addMessage=function e(t,n,r){r=r||s;var i=document.createElement("p");i.classList.add("text");i.innerHTML=t;this.$text.appendChild(i);r()};o.prototype.messageNext=function e(t){t()};o.prototype.clearChoices=function e(t){t=t||s;r.empty(this.$next);t()};o.prototype.addChoices=function e(t,n,r){var i=document.createDocumentFragment();r=r||s;t.forEach(function(e){console.warn("choice.selectedBy:",e.selectedBy);var t=document.createElement("button");t.classList.add("choice",e.type);t.setAttribute("data-isOrdered",e.orderedList);t.textContent=e.label;if(e.selectedBy&&e.selectedBy.length){var r=document.createElement("span");r.classList.add("italic","brightBlack");r.textContent=" "+e.selectedBy.join(", ");t.appendChild(r)}t.addEventListener("click",function(){n(e.index)});i.appendChild(t)});this.$next.appendChild(i);r()};o.prototype.setChoices=function e(t,n,r,i,o){var a=this;o=o||s;this.clearChoices(function(){a.addChoices(t,i,o);if(n&&n.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=n.join(", ");a.$next.appendChild(e)}if(typeof r==="number"){a.choiceTimeout(r)}})};o.prototype.updateChoices=function e(t,n,r,i,o){var a=this;o=o||s;this.clearChoices(function(){a.addChoices(t,i,o);if(n&&n.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=n.join(", ");a.$next.appendChild(e)}if(typeof r==="number"){a.choiceTimeout(r)}})};o.prototype.choiceTimeout=function e(t){var n=Date.now(),r,i;r=document.createElement("p");r.classList.add("timer");r.textContent=Math.round(t/1e3);this.$next.appendChild(r);i=setInterval(function(){if(!r.parentNode){clearInterval(i);return}r.textContent=Math.round((t+n-Date.now())/1e3)},1e3)};o.prototype.textInputDisabled=function e(t){var n=document.createElement("form"),r=document.createElement("label"),i=document.createElement("input");r.textContent=t.label;i.setAttribute("placeholder",t.placeholder);i.setAttribute("disabled",true);i.setAttribute("type","text");i.classList.add("text-input");n.appendChild(r);n.appendChild(i);this.$text.appendChild(n)};o.prototype.textInput=function e(t,n){var r=document.createElement("form"),i=document.createElement("label"),s=document.createElement("input");i.classList.add("text");i.textContent=t.label;s.setAttribute("type","text");s.classList.add("text-input");r.appendChild(i);r.appendChild(s);this.$text.appendChild(r);s.focus();var o=function e(t){t.preventDefault();r.removeEventListener("submit",e);s.setAttribute("disabled",true);n(s.value)};r.addEventListener("submit",o)};o.prototype.enableChat=function e(t){var n=this;if(!this.onChatSubmit){this.onChatSubmit=function(e){e.preventDefault();t(n.$chatInput.value);n.$chatInput.value=""};this.$chatForm.addEventListener("submit",this.onChatSubmit);this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")}};o.prototype.disableChat=function e(){this.$chatForm.removeEventListener("submit",this.onChatSubmit);this.onChatSubmit=null;this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)};o.prototype.clearHint=function e(){r.empty(this.$hint)};o.prototype.setBigHint=function e(t,n){var i=document.createElement("h2");i.textContent=t;if(n){r.class(i,n)}r.empty(this.$hint);this.$hint.appendChild(i)};o.prototype.setSceneImage=function e(t){var n=false;var r=this.$sceneImage;console.warn("setSceneImage: ",t);this.$sceneImage=document.createElement("div");this.$sceneImage.classList.add("scene-image");if(t.url){this.$sceneImage.style.backgroundImage='url("'+t.url+'")'}if(t.origin&&typeof t.origin==="string"){this.$sceneImage.style.backgroundPosition=t.origin}var i=function e(){if(n){return}n=true;r.remove()};if(r){r.addEventListener("transitionend",i,false);this.$gfx.insertBefore(this.$sceneImage,r);r.classList.add("hidden");setTimeout(i,2e3)}else{this.$gfx.insertBefore(this.$sceneImage,this.$gfx.firstChild||null)}switch(t.position){case"left":this.$content.setAttribute("data-position","right");break;case"right":default:this.$content.setAttribute("data-position","left");break}};o.prototype.showSprite=function e(t,n){var i=this,s,o;if(!n.url||typeof n.url!=="string"){return}o=this.sprites[t];s=this.sprites[t]={actionCallback:n.actionCallback,action:null,style:{},animation:null};s.$img=document.createElement("img");s.$img.classList.add("sprite");if(n.maskUrl){console.warn("has mask!");r.svg.load(null,n.maskUrl,{class:{spriteMask:true,clickable:true},css:n.style,noWidthHeightAttr:true},function(e,t){if(e){console.warn(e);return}s.$mask=t;i.updateSprite(null,n,s);if(o){o.$img.remove()}i.$gfx.append(s.$img);i.$gfx.append(s.$mask)});return}this.updateSprite(null,n,s);if(o){o.$img.remove()}this.$gfx.append(s.$img)};o.prototype.updateSprite=function e(t,n,s){var o,a;if(!n.style||typeof n.style!=="object"){n.style={}}if(s){o=s}else{if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}o=this.sprites[t]}delete n.style.position;if(n.url){o.$img.setAttribute("src",n.url)}if(n.action!==undefined){a=o.$mask||o.$img;if(n.action&&!o.action){o.onClick=function(e){o.actionCallback(o.action);e.stopPropagation()};a.classList.add("clickable");a.addEventListener("click",o.onClick)}else if(!n.action&&o.action){a.classList.remove("clickable");a.removeEventListener("click",o.onClick)}o.action=n.action||null}i(null,o.style,n.style);r.css(o.$img,n.style);if(o.$mask){console.warn("update mask!");r.css(o.$mask,n.style)}};o.prototype.animateSprite=function e(t,n){var r=this,i,s,o,a=0;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}i=this.sprites[t];s=this.animations[n];i.animation=n;if(!Array.isArray(s.frames)||!s.frames.length){return}var c=function(){o=s.frames[a];r.updateSprite(null,o,i);if(++a<s.frames.length){setTimeout(c,o.duration*1e3)}else{i.animation=null}};c()};o.prototype.defineAnimation=function e(t,n){this.animations[t]=n};o.prototype.clearSprite=function e(t){var n;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}n=this.sprites[t];n.$img.remove();if(n.$mask){n.$mask.remove()}delete this.sprites[t]};o.prototype.sound=function e(t){var n=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,t,n);this.nextSoundChannel=(this.nextSoundChannel+1)%4;n.setAttribute("src",t.url);n.play()};o.prototype.music=function e(t){var n=this,r=this.$music.getAttribute("src");if(t.url){if(r){if(r!==t.url){u(this.$music,function(){n.$music.setAttribute("src",t.url);n.$music.play();l(n.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",t.url);this.$music.play();l(this.$music)}}else{if(r){u(this.$music,function(){n.$music.removeAttribute("src")})}}};var a=10;var c=.01;function l(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+c);e.__fadeTimer=setTimeout(l.bind(undefined,e,t),a)}function u(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-c);e.__fadeTimer=setTimeout(u.bind(undefined,e,t),a)}},{"dom-kit":6,"tree-kit/lib/extend.js":21}],2:[function(e,t,n){"use strict";var r=e("nextgen-events");var i=e("dom-kit");var s=e("url");function o(e){return o.create(e)}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.create=function e(t){var n=Object.create(o.prototype,{token:{value:t.token||"null",writable:true,enumerable:true},port:{value:t.port||80,writable:true,enumerable:true},userName:{value:t.name||"unknown_"+Math.floor(Math.random()*1e4),writable:true,enumerable:true},ws:{value:null,writable:true,enumerable:true},proxy:{value:null,writable:true,enumerable:true}});return n};var a={classic:e("./ui/classic.js")};o.autoCreate=function e(){var t=s.parse(window.location.href,true).query;window.spellcastClient=o.create(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};o.prototype.run=function e(t){var n=this,i=false;this.proxy=new r.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(function(e){if(a[e]){a[e](n.proxy.remoteServices.bus,n)}});this.ws=new WebSocket("ws://127.0.0.1:"+this.port+"/"+this.token);this.emit("connecting");this.ws.onerror=function e(){if(!i){console.log("Can't open Websocket (error)...");n.emit("error","unreachable");return}};this.ws.onopen=function e(){i=true;console.log("Websocket opened!");n.emit("open");n.proxy.remoteServices.bus.emit("authenticate",{name:n.userName});if(typeof t==="function"){t()}};this.ws.onclose=function e(){if(!i){console.log("Can't open Websocket (close)...");n.emit("error","unreachable");return}i=false;n.proxy.destroy();console.log("Websocket closed!");n.emit("close")};this.ws.onmessage=function e(t){var r;try{r=JSON.parse(t.data)}catch(e){return}console.log("Message received: ",r);n.proxy.receive(r)};n.proxy.send=function e(t){n.ws.send(JSON.stringify(t))}};o.autoCreate();i.ready(function(){window.spellcastClient.run()})},{"./ui/classic.js":4,"dom-kit":6,"nextgen-events":9,url:22}],3:[function(e,t,n){"use strict";var r={};t.exports=r;var i=e("string-kit/lib/format.js").markupMethod;var s=e("string-kit/lib/escape.js").html;var o={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="brightBlue">',c:'<span class="cyan">',C:'<span class="brightCyan">',g:'<span class="green">',G:'<span class="brightGreen">',k:'<span class="black">',K:'<span class="brightBlack">',m:'<span class="magenta">',M:'<span class="brightMagenta">',r:'<span class="red">',R:'<span class="brightRed">',w:'<span class="white">',W:'<span class="brightWhite">',y:'<span class="yellow">',Y:'<span class="brightYellow">'}};r.markup=function(){var e=Array.from(arguments);e[0]=s(e[0]).replace(/\n/,"<br />");return i.apply(o,e)}},{"string-kit/lib/escape.js":18,"string-kit/lib/format.js":19}],4:[function(e,t,n){"use strict";var r=e("../Dom.js");var i=e("../toolkit.js");function s(e,t,n){console.log(Array.from(arguments));if(!n){n=Object.create(s.prototype,{bus:{value:e,enumerable:true},client:{value:t,enumerable:true},user:{value:null,writable:true,enumerable:true},users:{value:null,writable:true,enumerable:true},roles:{value:null,writable:true,enumerable:true},roleId:{value:null,writable:true,enumerable:true},config:{value:null,writable:true,enumerable:true},chatConfig:{value:null,writable:true,enumerable:true},inGame:{value:false,writable:true,enumerable:true},nexts:{value:null,writable:true,enumerable:true},afterNext:{value:false,writable:true,enumerable:true},afterLeave:{value:false,writable:true,enumerable:true},dom:{value:r.create()}})}n.client.once("connecting",s.clientConnecting.bind(n));n.client.once("open",s.clientOpen.bind(n));n.client.once("close",s.clientClose.bind(n));n.client.on("error",s.clientError.bind(n));n.dom.enableChat(function(e){n.bus.emit("chat",e)});return n}t.exports=s;function o(e){return this.find(function(t){return t.id===e})}s.prototype.initBus=function e(){this.bus.on("clientConfig",s.clientConfig.bind(this));this.bus.on("user",s.user.bind(this));this.bus.on("userList",s.userList.bind(this));this.bus.on("roleList",s.roleList.bind(this));this.bus.on("extOutput",s.extOutput.bind(this));this.bus.on("extErrorOutput",s.extErrorOutput.bind(this));this.bus.on("message",s.message.bind(this),{async:true});this.bus.on("chatConfig",s.chatConfig.bind(this));this.bus.on("image",s.image.bind(this));this.bus.on("sound",s.sound.bind(this));this.bus.on("music",s.music.bind(this));this.bus.on("defineAnimation",s.defineAnimation.bind(this));this.bus.on("showSprite",s.showSprite.bind(this));this.bus.on("updateSprite",s.prototype.updateSprite.bind(this));this.bus.on("animateSprite",s.animateSprite.bind(this));this.bus.on("clearSprite",s.clearSprite.bind(this));this.bus.on("enterScene",s.enterScene.bind(this));this.bus.on("leaveScene",s.leaveScene.bind(this),{async:true});this.bus.on("nextList",s.nextList.bind(this));this.bus.on("nextTriggered",s.nextTriggered.bind(this));this.bus.on("textInput",s.textInput.bind(this));this.bus.on("rejoin",s.rejoin.bind(this));this.bus.on("wait",s.wait.bind(this));this.bus.on("end",s.end.bind(this));this.bus.on("exit",s.exit.bind(this));this.bus.emit("ready")};s.prototype.cleanUrl=function e(t){return"/script/"+t};s.clientConnecting=function e(){console.log("Connecting!");this.dom.clientStatus("connecting...",{color:"blue"})};s.clientOpen=function e(){console.log("Connected!");this.dom.clientStatus("connected",{color:"green"});this.initBus()};s.clientClose=function e(){console.log("Closed!");this.dom.clientStatus("connection closed",{color:"red",alert:true})};s.clientError=function e(t){switch(t){case"unreachable":this.dom.clientStatus("server unreachable",{color:"red",alert:true});break}};s.clientConfig=function e(t){console.warn("Client config received: ",t);this.config=t;if(this.config.theme){this.config.theme.url=this.cleanUrl(this.config.theme.url);this.dom.setTheme(this.config.theme)}};s.user=function e(t){console.log("User received: ",t);this.user=t};s.userList=function e(t){console.log("User-list received: ",t);t.get=o;this.users=t};s.roleList=function e(t,n,r){var i=this,s=[],a;t.get=o;this.roles=t;if(this.inGame){return}if(r&&t.length<=1){this.roleId=t[0].id;return}t.forEach(function(e,t){var n=e.clientId&&i.users.get(e.clientId).name;s.push({index:t,label:e.label,type:"role",selectedBy:n&&[n]})});if(n.length){a=n.map(function(e){return i.users.get(e).name})}var c=function(e){if(t[e].clientId===i.user.id){i.bus.emit("selectRole",null)}else if(t[e].clientId!==null){return}else{i.bus.emit("selectRole",e)}};this.dom.setChoices(s,a,null,c);if(r){t.find(function(e,t){if(e.clientId===i.user.id){i.roleId=e.id;return true}return false});this.afterLeave=true;return}};s.message=function e(t,n,r){var s=this,o=false;t=i.markup(t);if(!n){n={}}var a=function e(){if(o){return}o=true;if(n.next){s.messageNext(r);return}r()};this.dom.addMessage(t,n,a)};s.prototype.messageNext=function e(t){this.dom.messageNext(t)};s.chatConfig=function e(t){var n=this;this.chatConfig=t;console.warn("chatConfig:",this.chatConfig);if(this.roleId&&this.chatConfig[this.roleId].write){this.dom.enableChat(function(e){n.bus.emit("chat",e)})}else{this.dom.disableChat()}};s.enterScene=function e(){this.inGame=true;if(this.afterLeave&&!this.afterNextTriggered){this.dom.clear()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};s.leaveScene=function e(t){this.afterLeave=true;if(this.afterNext){t();return}setTimeout(t,500)};s.nextTriggered=function e(){this.afterNextTriggered=true;this.dom.clearMessages();this.dom.clearChoices()};s.nextList=function e(t,n,r,i,s){var o=this,a=[],c;this.nexts=t;this.afterNext=true;if(s&&this.roles.length===1){return}t.forEach(function(e,n){var r=e.roleIds.map(function(e){return o.roles.get(e).label});a.push({index:n,label:e.label||"Next",orderedList:t.length>1,type:"next",selectedBy:r})});if(r.length&&this.roles.length){c=r.map(function(e){return o.roles.get(e).label})}var l=function(e){if(t[e].roleIds.indexOf(o.roleId)!==-1){o.bus.emit("selectNext",null)}else{o.bus.emit("selectNext",e)}};this.dom.setChoices(a,c,i,l)};s.extOutput=function e(t){alert("not coded ATM!")};s.extErrorOutput=function e(t){alert("not coded ATM!")};s.textInput=function e(t,n){var r=this,i={label:t};if(n.indexOf(this.roleId)===-1){i.placeholder="YOU CAN'T RESPOND - WAIT...";this.dom.textInputDisabled(i)}else{this.dom.textInput(i,function(e){r.bus.emit("textSubmit",e)})}};s.rejoin=function e(){};s.wait=function e(t){var n=this;switch(t){case"otherBranches":this.dom.setBigHint("WAITING FOR OTHER BRANCHES TO FINISH...",{wait:true,"pulse-animation":true});this.bus.once("rejoin",function(){n.dom.clearHint()});break;default:this.dom.setBigHint("WAITING FOR "+t,{wait:true,"pulse-animation":true})}};s.image=function e(t){if(t.url){t.url=this.cleanUrl(t.url)}this.dom.setSceneImage(t)};s.defineAnimation=function e(t,n){this.dom.defineAnimation(t,n)};s.showSprite=function e(t,n){if(!n.url||typeof n.url!=="string"){return}n.url=this.cleanUrl(n.url);if(n.maskUrl){n.maskUrl=this.cleanUrl(n.maskUrl)}n.actionCallback=s.spriteActionCallback.bind(this);this.dom.showSprite(t,n)};s.spriteActionCallback=function e(t){console.warn("action triggered: ",t);this.bus.emit("action",t)};s.prototype.updateSprite=function e(t,n){if(n.url){n.url=this.cleanUrl(n.url)}if(n.maskUrl){n.maskUrl=this.cleanUrl(n.maskUrl)}this.dom.updateSprite(t,n)};s.animateSprite=function e(t,n){this.dom.animateSprite(t,n)};s.clearSprite=function e(t){this.dom.clearSprite(t)};s.sound=function e(t){if(t.url){t.url=this.cleanUrl(t.url)}this.dom.sound(t)};s.music=function e(t){if(t.url){t.url=this.cleanUrl(t.url)}this.dom.music(t)};s.end=function e(t,n){switch(t){case"end":this.dom.setBigHint("The End.",{end:true});break;case"win":this.dom.setBigHint("You Win!",{end:true,win:true});break;case"lost":this.dom.setBigHint("You Lose...",{end:true,lost:true});break;case"draw":this.dom.setBigHint("Draw.",{end:true,draw:true});break}};s.exit=function e(){}},{"../Dom.js":1,"../toolkit.js":3}],5:[function(e,t,n){},{}],6:[function(e,t,n){var r={};t.exports=r;r.svg=e("./svg.js");r.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};r.fromHtml=function e(t){var n,r,i;i=document.createDocumentFragment();r=document.createElement("div");r.insertAdjacentHTML("beforeend",t);for(n=0;n<r.children.length;n++){i.appendChild(r.children[n])}return i};r.batch=function e(t,n){var r,i=Array.prototype.slice.call(arguments,1);if(n instanceof Element){i[0]=n;t.apply(this,i)}else if(Array.isArray(n)){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}else if(n instanceof NodeList||n instanceof NamedNodeMap){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}};r.css=function e(t,n){var r;for(r in n){t.style[r]=n[r]}};r.attr=function e(t,n){var r;for(r in n){if(n[r]===null){t.removeAttribute(r)}else{t.setAttribute(r,n[r])}}};r.class=function e(t,n){var r;for(r in n){if(n[r]){t.classList.add(r)}else{t.classList.remove(r)}}};r.remove=function e(t){t.parentNode.removeChild(t)};r.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};r.cloneInto=function e(t,n){r.empty(t);t.appendChild(n.cloneNode(true))};r.insertInto=function e(t,n){r.empty(t);t.appendChild(n)};r.idNamespace=function e(t,n){var i,s={};i=t.querySelectorAll("*");r.batch(r.idNamespace.idAttributePass,i,n,s);r.batch(r.idNamespace.otherAttributesPass,i,s)};r.idNamespace.idAttributePass=function e(t,n,r){r[t.id]=n+"."+t.id;t.id=r[t.id]};r.idNamespace.otherAttributesPass=function e(t,n){r.batch(r.idNamespace.oneAttributeSubPass,t.attributes,n)};r.idNamespace.oneAttributeSubPass=function e(t,n){t.value=t.value.replace(/url\(#([^)]+)\)/g,function(e,t){if(!n[t]){return e}return"url(#"+n[t]+")"})};r.id=function e(t,e){t.id=e};r.text=function e(t,e){t.textContent=e};r.html=function e(t,e){t.innerHTML=e}},{"./svg.js":7}],7:[function(e,t,n){(function(n){var r=e("fs");var i=e("./dom.js");var s={};t.exports=s;s.load=function e(t,i,o,a){if(typeof o==="function"){a=o}if(!o||typeof o!=="object"){o={}}if(i.substring(0,7)==="file://"&&!n.browser){r.readFile(i.slice(7),function(e,n){if(e){a(e);return}var r=new DOMParser;var i=r.parseFromString(n.toString(),"application/xml").documentElement;try{s.attachXmlTo(t,i,o)}catch(e){a(e);return}a(undefined,i)})}else{s.ajax(i,function(e,n){if(e){a(e);return}var r=n.documentElement;try{s.attachXmlTo(t,r,o)}catch(e){a(e);return}a(undefined,r)})}};s.attachXmlTo=function e(t,n,r){var o,a,c;s.lightCleanup(n);if(r.id!==undefined){if(typeof r.id==="string"){n.setAttribute("id",r.id)}else if(!r.id){n.removeAttribute("id")}}if(r.class&&typeof r.class==="object"){i.class(n,r.class)}if(r.idNamespace){i.idNamespace(n,r.idNamespace)}if(r.hidden){n.style.visibility="hidden"}if(r.noWidthHeightAttr){a=n.getAttribute("width");c=n.getAttribute("height");n.removeAttribute("height");n.removeAttribute("width");if(!n.getAttribute("viewBox")&&a&&c){o="0 0 "+a+" "+c;n.setAttribute("viewBox",o)}}if(r.css){i.css(n,r.css)}if(t){t.appendChild(n)}};s.lightCleanup=function e(t){o(t,"metadata");o(t,"script")};function o(e,t){var n,r,i;r=e.getElementsByTagName(t);for(n=0;n<r.length;n++){i=r.item(n);i.parentNode.removeChild(i)}}s.ajax=function e(t,n){var r=new XMLHttpRequest;r.responseType="document";r.onreadystatechange=s.ajax.ajaxStatus.bind(r,n);r.open("GET",t);r.send()};s.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[dom-kit.svg] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}}}).call(this,e("_process"))},{"./dom.js":6,_process:12,fs:5}],8:[function(e,t,n){t.exports=function(e){return e!=null&&(r(e)||i(e)||!!e._isBuffer)};function r(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function i(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&r(e.slice(0,0))}},{}],9:[function(e,t,n){(function(n){"use strict";function r(){return Object.create(r.prototype)}t.exports=r;r.prototype.__prototypeUID__="nextgen-events/NextGenEvents";r.prototype.__prototypeVersion__=e("../package.json").version;r.SYNC=-Infinity;r.init=function e(){Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:r.SYNC,interruptible:false,recursion:0,contexts:{},states:{},stateGroups:{},listeners:{error:[],interrupt:[],newListener:[],removeListener:[]}}})};r.filterOutCallback=function(e,t){return e!==t};r.prototype.addListener=function e(t,n,i){var s={},o;if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}s.fn=n||i.fn;s.id=i.id!==undefined?i.id:s.fn;s.once=!!i.once;s.async=!!i.async;s.eventObject=!!i.eventObject;s.nice=i.nice!==undefined?Math.floor(i.nice):r.SYNC;s.context=typeof i.context==="string"?i.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(s.context&&typeof s.context==="string"&&!this.__ngev.contexts[s.context]){this.addListenerContext(s.context)}s.event=t;if(this.__ngev.listeners.newListener.length){o=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[t].push(s);r.emitEvent({emitter:this,name:"newListener",args:[[s]],listeners:o});if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this}this.__ngev.listeners[t].push(s);if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function e(t,n,r){if(n&&typeof n==="object"){n.once=true}else if(r&&typeof r==="object"){r.once=true}else{r={once:true}}return this.addListener(t,n,r)};r.prototype.removeListener=function e(t,n){var i,s,o=[],a=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}s=this.__ngev.listeners[t].length;for(i=0;i<s;i++){if(this.__ngev.listeners[t][i].id===n){a.push(this.__ngev.listeners[t][i])}else{o.push(this.__ngev.listeners[t][i])}}this.__ngev.listeners[t]=o;if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.prototype.off=r.prototype.removeListener;r.prototype.removeAllListeners=function e(t){var n;if(!this.__ngev){r.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}n=this.__ngev.listeners[t];this.__ngev.listeners[t]=[];if(n.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",n)}}else{this.__ngev.listeners={}}return this};r.listenerWrapper=function e(t,n,i){var s,o,a;if(n.interrupt){return}if(t.async){if(i){o=i.serial;i.ready=!o}a=function(e){n.listenersDone++;if(e&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=e;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}if(o){r.processQueue.call(n.emitter,t.context,true)}};if(t.eventObject){t.fn(n,a)}else{s=t.fn.apply(undefined,n.args.concat(a))}}else{if(t.eventObject){t.fn(n)}else{s=t.fn.apply(undefined,n.args)}n.listenersDone++}if(s&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=s;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}};var i=0;r.prototype.emit=function e(){var t;t={emitter:this};if(typeof arguments[0]==="number"){t.nice=Math.floor(arguments[0]);t.name=arguments[1];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,2,-1)}else{t.args=Array.prototype.slice.call(arguments,2)}}else{t.name=arguments[0];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}t.args=Array.prototype.slice.call(arguments,1);if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,1,-1)}else{t.args=Array.prototype.slice.call(arguments,1)}}return r.emitEvent(t)};r.emitEvent=function e(t){var n=t.emitter,s,o,a=0,c,l;if(!n.__ngev){r.init.call(n)}c=n.__ngev.states[t.name];if(c!==undefined){if(c&&t.args.length===c.args.length&&t.args.every(function(e,t){return e===c.args[t]})){return}n.__ngev.stateGroups[t.name].forEach(function(e){n.__ngev.states[e]=null});n.__ngev.states[t.name]=t}if(!n.__ngev.listeners[t.name]){n.__ngev.listeners[t.name]=[]}t.id=i++;t.listenersDone=0;t.once=!!t.once;if(t.nice===undefined||t.nice===null){t.nice=n.__ngev.nice}if(!t.listeners){t.listeners=n.__ngev.listeners[t.name].slice()}n.__ngev.recursion++;l=[];for(s=0,o=t.listeners.length;s<o;s++){a++;r.emitToOneListener(t,t.listeners[s],l)}n.__ngev.recursion--;if(l.length&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",l)}if(!a){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){t.callback(undefined,t);delete t.callback}}return t};r.emitToOneListener=function e(t,n,i){var s=t.emitter,o,a,c=false;o=n.context&&s.__ngev.contexts[n.context];if(o&&o.status===r.CONTEXT_DISABLED){return}if(o){a=Math.max(t.nice,n.nice,o.nice)}else{a=Math.max(t.nice,n.nice)}if(n.once){s.__ngev.listeners[t.name]=s.__ngev.listeners[t.name].filter(r.filterOutCallback.bind(undefined,n));if(i){i.push(n)}else{c=true}}if(o&&(o.status===r.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:t,listener:n,nice:a})}else{try{if(a<0){if(s.__ngev.recursion>=-a){setImmediate(r.listenerWrapper.bind(s,n,t,o))}else{r.listenerWrapper.call(s,n,t,o)}}else{setTimeout(r.listenerWrapper.bind(s,n,t,o),a)}}catch(e){s.__ngev.recursion--;throw e}}if(c&&s.__ngev.listeners.removeListener.length){s.emit("removeListener",[n])}};r.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}return this.__ngev.listeners[t].slice()};r.listenerCount=function(e,t){if(!e||!(e instanceof r)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};r.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};r.prototype.setNice=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};r.prototype.setInterruptible=function e(t){
if(!this.__ngev){r.init.call(this)}this.__ngev.interruptible=!!t};r.share=function(e,t){if(!(e instanceof r)||!(t instanceof r)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){r.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};r.reset=function e(t){Object.defineProperty(t,"__ngev",{configurable:true,value:null})};r.prototype.setMaxListeners=function(){};r.noop=function(){};r.prototype.defineStates=function e(){var t=this,n=Array.prototype.slice.call(arguments);if(!this.__ngev){r.init.call(this)}n.forEach(function(e){t.__ngev.states[e]=null;t.__ngev.stateGroups[e]=n})};r.prototype.hasState=function e(t){if(!this.__ngev){r.init.call(this)}return!!this.__ngev.states[t]};r.prototype.getAllStates=function e(){var t=this;if(!this.__ngev){r.init.call(this)}return Object.keys(this.__ngev.states).filter(function(e){return t.__ngev.states[e]})};r.groupAddListener=function e(t,n,r,i){if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;t.forEach(function(e){e.addListener(n,r.bind(undefined,e),i)})};r.groupOn=r.groupAddListener;r.groupOnce=function e(t,n,r,i){if(r&&typeof r==="object"){r.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.groupAddListener(t,n,r,i)};r.groupGlobalOnce=function e(t,n,i,s){var o,a=false;if(typeof i!=="function"){s=i;i=undefined}if(!s||typeof s!=="object"){s={}}i=i||s.fn;delete s.fn;s.id=s.id||i;o=function(){if(a){return}a=true;r.groupRemoveListener(t,n,s.id);i.apply(undefined,arguments)};t.forEach(function(e){e.once(n,o.bind(undefined,e),s)})};r.groupGlobalOnceAll=function e(t,n,r,i){var s,o=false,a=t.length;if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;s=function(){if(o){return}if(--a){return}o=true;r.apply(undefined,arguments)};t.forEach(function(e){e.once(n,s.bind(undefined,e),i)})};r.groupRemoveListener=function e(t,n,r){t.forEach(function(e){e.removeListener(n,r)})};r.groupOff=r.groupRemoveListener;r.groupRemoveAllListeners=function e(t,n){t.forEach(function(e){e.removeAllListeners(n)})};r.groupEmit=function e(t){var n,i,s=2,o,a,c=t.length,l,u,f=false;if(typeof arguments[arguments.length-1]==="function"){o=-1;l=arguments[arguments.length-1];u=function(e){if(f){return}if(e){f=true;l(e)}else if(!--c){f=true;l()}}}if(typeof arguments[1]==="number"){s=3;i=typeof arguments[1]}n=arguments[s-1];a=Array.prototype.slice.call(arguments,s,o);t.forEach(function(e){r.emitEvent({emitter:e,name:n,args:a,nice:i,callback:u})})};r.groupDefineStates=function e(t){var n=Array.prototype.slice.call(arguments,1);t.forEach(function(e){e.defineStates.apply(e,n)})};r.CONTEXT_ENABLED=0;r.CONTEXT_DISABLED=1;r.CONTEXT_QUEUED=2;r.prototype.addListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!n||typeof n!=="object"){n={}}if(!this.__ngev.contexts[t]){this.__ngev.contexts[t]=Object.create(r.prototype);this.__ngev.contexts[t].nice=r.SYNC;this.__ngev.contexts[t].ready=true;this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;this.__ngev.contexts[t].serial=false;this.__ngev.contexts[t].queue=[]}if(n.nice!==undefined){this.__ngev.contexts[t].nice=Math.floor(n.nice)}if(n.status!==undefined){this.__ngev.contexts[t].status=n.status}if(n.serial!==undefined){this.__ngev.contexts[t].serial=!!n.serial}return this};r.prototype.disableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_DISABLED;return this};r.prototype.enableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;if(this.__ngev.contexts[t].queue.length>0){r.processQueue.call(this,t)}return this};r.prototype.queueListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_QUEUED;return this};r.prototype.serializeListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=n===undefined?true:!!n;return this};r.prototype.setListenerContextNice=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(n);return this};r.prototype.destroyListenerContext=function e(t){var n,i,s,o,a=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}for(s in this.__ngev.listeners){o=null;i=this.__ngev.listeners[s].length;for(n=0;n<i;n++){if(this.__ngev.listeners[s][n].context===t){o=[];a.push(this.__ngev.listeners[s][n])}else if(o){o.push(this.__ngev.listeners[s][n])}}if(o){this.__ngev.listeners[s]=o}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.processQueue=function e(t,n){var i,s;if(!this.__ngev.contexts[t]){return}i=this.__ngev.contexts[t];if(n){i.ready=true}this.__ngev.recursion++;while(i.ready&&i.queue.length){s=i.queue.shift();if(s.event.interrupt){continue}try{if(s.nice<0){if(this.__ngev.recursion>=-s.nice){setImmediate(r.listenerWrapper.bind(this,s.listener,s.event,i))}else{r.listenerWrapper.call(this,s.listener,s.event,i)}}else{setTimeout(r.listenerWrapper.bind(this,s.listener,s.event,i),s.nice)}}catch(e){this.__ngev.recursion--;throw e}}this.__ngev.recursion--};r.on=r.prototype.on;r.once=r.prototype.once;r.off=r.prototype.off;if(n.AsyncTryCatch){r.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(r);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}r.Proxy=e("./Proxy.js")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":11,"./Proxy.js":10}],10:[function(e,t,n){"use strict";function r(){return r.create()}t.exports=r;var i=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}r.create=function e(){var t=Object.create(r.prototype,{localServices:{value:{},enumerable:true},remoteServices:{value:{},enumerable:true},nextAckId:{value:1,writable:true,enumerable:true}});return t};r.prototype.addLocalService=function e(t,n,r){this.localServices[t]=a.create(this,t,n,r);return this.localServices[t]};r.prototype.addRemoteService=function e(t){this.remoteServices[t]=c.create(this,t);return this.remoteServices[t]};r.prototype.destroy=function e(){var t=this;Object.keys(this.localServices).forEach(function(e){t.localServices[e].destroy();delete t.localServices[e]});Object.keys(this.remoteServices).forEach(function(e){t.remoteServices[e].destroy();delete t.remoteServices[e]});this.receive=this.send=o};r.prototype.push=function e(t){if(t.__type!==s||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};r.prototype.receive=function e(t){this.push(t)};r.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,n,r){return a.create(e,t,n,r)}r.LocalService=a;a.create=function e(t,n,r,s){var o=Object.create(a.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:r,writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!s.listen,writable:true,enumerable:true},canEmit:{value:!!s.emit,writable:true,enumerable:true},canAck:{value:!!s.ack,writable:true,enumerable:true},canRpc:{value:!!s.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return o};a.prototype.destroy=function e(){var t=this;Object.keys(this.events).forEach(function(e){t.emitter.off(e,t.events[e]);delete t.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var n=this;var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(r){n.proxy.send({__type:s,service:n.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:r})}}i.emitEvent(r)};a.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};a.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};a.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t)};a.forward=function e(t){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args})};a.forward.ack=false;a.forwardWithAck=function e(t,n){if(this.destroyed){return}var r=this;if(!t.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args});n();return}var i=false;var o=this.proxy.nextAckId++;var a=function e(t){if(i||t.ack!==o){return}i=true;r.internalEvents.off("ack",e);n()};this.internalEvents.on("ack",a);this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,ack:o,args:t.args})};a.forwardWithAck.ack=true;function c(e,t){return c.create(e,t)}r.RemoteService=c;var l=1;var u=2;c.create=function e(t,n){var r=Object.create(c.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:Object.create(i.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return r};c.prototype.destroy=function e(){var t=this;this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(function(e){delete t.events[e]});this.destroyed=true};c.prototype.emit=function e(t){if(this.destroyed){return}var n=this,r,i,o,a;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof arguments[arguments.length-1]!=="function"){r=Array.prototype.slice.call(arguments,1);this.proxy.send({__type:s,service:this.id,method:"emit",event:t,args:r});return}r=Array.prototype.slice.call(arguments,1,-1);i=arguments[arguments.length-1];o=this.proxy.nextAckId++;a=false;var c=function e(t){if(a||t.ack!==o){return}a=true;n.internalEvents.off("ack",e);i(t.interruption)};this.internalEvents.on("ack",c);this.proxy.send({__type:s,service:this.id,method:"emit",ack:o,event:t,args:r})};c.prototype.addListener=function e(t,n,r){if(this.destroyed){return}if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}r.fn=n||r.fn;this.emitter.addListener(t,r);if(!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length){return}if(r.async&&this.events[t]!==u){this.events[t]=u;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:t})}else if(!r.async&&!this.events[t]){this.events[t]=l;this.proxy.send({__type:s,service:this.id,method:"listen",event:t})}};c.prototype.on=c.prototype.addListener;c.prototype.once=i.prototype.once;c.prototype.removeListener=function e(t,n){if(this.destroyed){return}this.emitter.removeListener(t,n);if((!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:t})}};c.prototype.off=c.prototype.removeListener;c.prototype.receiveEvent=function e(t){var n=this;if(this.destroyed||!this.events[t.event]){return}var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(){n.proxy.send({__type:s,service:n.id,method:"ackEvent",ack:t.ack,event:t.event})}}i.emitEvent(r);var o=r.name;if(!this.emitter.__ngev.listeners[o]||!this.emitter.__ngev.listeners[o].length){this.events[o]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:o})}};c.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==u){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":9}],11:[function(e,t,n){t.exports={_args:[[{raw:"nextgen-events@^0.9.8",scope:null,escapedName:"nextgen-events",name:"nextgen-events",rawSpec:"^0.9.8",spec:">=0.9.8 <0.10.0",type:"range"},"/srv/soulserv/spellcast"]],_from:"nextgen-events@>=0.9.8 <0.10.0",_id:"nextgen-events@0.9.8",_inCache:true,_location:"/nextgen-events",_nodeVersion:"4.5.0",_npmOperationalInternal:{host:"packages-16-east.internal.npmjs.com",tmp:"tmp/nextgen-events-0.9.8.tgz_1473951316005_0.2686476525850594"},_npmUser:{name:"cronvel",email:"cedric.ronvel@gmail.com"},_npmVersion:"2.15.9",_phantomChildren:{},_requested:{raw:"nextgen-events@^0.9.8",scope:null,escapedName:"nextgen-events",name:"nextgen-events",rawSpec:"^0.9.8",spec:">=0.9.8 <0.10.0",type:"range"},_requiredBy:["/","/async-kit","/terminal-kit"],_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-0.9.8.tgz",_shasum:"ed1712c2b37dad55407b3e941672d1568c3a4630",_shrinkwrap:null,_spec:"nextgen-events@^0.9.8",_where:"/srv/soulserv/spellcast",author:{name:"Cédric Ronvel"},bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},copyright:{title:"Next-Gen Events",years:[2015,2016],owner:"Cédric Ronvel"},dependencies:{},description:"The next generation of events handling for javascript! New: abstract away the network!",devDependencies:{browserify:"^13.0.1","expect.js":"^0.3.1",jshint:"^2.9.2",mocha:"^2.5.3","uglify-js":"^2.6.2",ws:"^1.1.1"},directories:{test:"test"},dist:{shasum:"ed1712c2b37dad55407b3e941672d1568c3a4630",tarball:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-0.9.8.tgz"},gitHead:"e91559128a1653ed3b58dcadefcac62aa7056207",homepage:"https://github.com/cronvel/nextgen-events#readme",keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],license:"MIT",main:"lib/NextGenEvents.js",maintainers:[{name:"cronvel",email:"cedric.ronvel@gmail.com"}],name:"nextgen-events",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},scripts:{test:"mocha -R dot"},version:"0.9.8"}},{}],12:[function(e,t,n){var r=t.exports={};var i;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){i=setTimeout}else{i=o}}catch(e){i=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(e){s=a}})();function c(e){if(i===setTimeout){return setTimeout(e,0)}if((i===o||!i)&&setTimeout){i=setTimeout;return setTimeout(e,0)}try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function l(e){if(s===clearTimeout){return clearTimeout(e)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var u=[];var f=false;var h;var p=-1;function d(){if(!f||!h){return}f=false;if(h.length){u=h.concat(u)}else{p=-1}if(u.length){m()}}function m(){if(f){return}var e=c(d);f=true;var t=u.length;while(t){h=u;u=[];while(++p<t){if(h){h[p].run()}}p=-1;t=u.length}h=null;f=false;l(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}u.push(new y(e,t));if(u.length===1&&!f){c(m)}};function y(e,t){this.fun=e;this.array=t}y.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function v(){}r.on=v;r.addListener=v;r.once=v;r.off=v;r.removeListener=v;r.removeAllListeners=v;r.emit=v;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],13:[function(t,n,r){(function(t){(function(i){var s=typeof r=="object"&&r&&!r.nodeType&&r;var o=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){i=a}var c,l=2147483647,u=36,f=1,h=26,p=38,d=700,m=72,y=128,v="-",g=/^xn--/,b=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=u-f,w=Math.floor,C=String.fromCharCode,S;function j(e){throw new RangeError(x[e])}function E(e,t){var n=e.length;var r=[];while(n--){r[n]=t(e[n])}return r}function A(e,t){var n=e.split("@");var r="";if(n.length>1){r=n[0]+"@";e=n[1]}e=e.replace(_,".");var i=e.split(".");var s=E(i,t).join(".");return r+s}function L(e){var t=[],n=0,r=e.length,i,s;while(n<r){i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((i&1023)<<10)+(s&1023)+65536)}else{t.push(i);n--}}else{t.push(i)}}return t}function O(e){return E(e,function(e){var t="";if(e>65535){e-=65536;t+=C(e>>>10&1023|55296);e=56320|e&1023}t+=C(e);return t}).join("")}function T(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return u}function $(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function I(e,t,n){var r=0;e=n?w(e/d):e>>1;e+=w(e/t);for(;e>k*h>>1;r+=u){e=w(e/k)}return w(r+(k+1)*e/(e+p))}function N(e){var t=[],n=e.length,r,i=0,s=y,o=m,a,c,p,d,g,b,_,x,k;a=e.lastIndexOf(v);if(a<0){a=0}for(c=0;c<a;++c){if(e.charCodeAt(c)>=128){j("not-basic")}t.push(e.charCodeAt(c))}for(p=a>0?a+1:0;p<n;){for(d=i,g=1,b=u;;b+=u){if(p>=n){j("invalid-input")}_=T(e.charCodeAt(p++));if(_>=u||_>w((l-i)/g)){j("overflow")}i+=_*g;x=b<=o?f:b>=o+h?h:b-o;if(_<x){break}k=u-x;if(g>w(l/k)){j("overflow")}g*=k}r=t.length+1;o=I(i-d,r,d==0);if(w(i/r)>l-s){j("overflow")}s+=w(i/r);i%=r;t.splice(i++,0,s)}return O(t)}function M(e){var t,n,r,i,s,o,a,c,p,d,g,b=[],_,x,k,S;e=L(e);_=e.length;t=y;n=0;s=m;for(o=0;o<_;++o){g=e[o];if(g<128){b.push(C(g))}}r=i=b.length;if(i){b.push(v)}while(r<_){for(a=l,o=0;o<_;++o){g=e[o];if(g>=t&&g<a){a=g}}x=r+1;if(a-t>w((l-n)/x)){j("overflow")}n+=(a-t)*x;t=a;for(o=0;o<_;++o){g=e[o];if(g<t&&++n>l){j("overflow")}if(g==t){for(c=n,p=u;;p+=u){d=p<=s?f:p>=s+h?h:p-s;if(c<d){break}S=c-d;k=u-d;b.push(C($(d+S%k,0)));c=w(S/k)}b.push(C($(c,0)));s=I(n,x,r==i);n=0;++r}}++n;++t}return b.join("")}function D(e){return A(e,function(e){return g.test(e)?N(e.slice(4).toLowerCase()):e})}function R(e){return A(e,function(e){return b.test(e)?"xn--"+M(e):e})}c={version:"1.4.1",ucs2:{decode:L,encode:O},decode:N,encode:M,toASCII:R,toUnicode:D};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return c})}else if(s&&o){if(n.exports==s){o.exports=c}else{for(S in c){c.hasOwnProperty(S)&&(s[S]=c[S])}}}else{i.punycode=c}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],14:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var c=1e3;if(s&&typeof s.maxKeys==="number"){c=s.maxKeys}var l=e.length;if(c>0&&l>c){l=c}for(var u=0;u<l;++u){var f=e[u].replace(a,"%20"),h=f.indexOf(n),p,d,m,y;if(h>=0){p=f.substr(0,h);d=f.substr(h+1)}else{p=f;d=""}m=decodeURIComponent(p);y=decodeURIComponent(d);if(!r(o,m)){o[m]=y}else if(i(o[m])){o[m].push(y)}else{o[m]=[o[m],y]}}return o};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],15:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(r(o))+n;if(i(e[o])){return s(e[o],function(e){return a+encodeURIComponent(r(e))}).join(t)}else{return a+encodeURIComponent(r(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(r(a))+n+encodeURIComponent(r(e))};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var r=0;r<e.length;r++){n.push(t(e[r],r))}return n}var o=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],16:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":14,"./encode":15}],17:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m"}},{}],18:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=function e(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")};n.regExpReplacement=function e(t){return t.replace(/\$/g,"$$$$")};n.format=function e(t){return t.replace(/%/g,"%%")};n.shellArg=function e(t){return"'"+t.replace(/\'/g,"'\\''")+"'"};var r={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=function e(t){return t.replace(/[\x00-\x1f\x7f]/g,function(e){if(r[e]!==undefined){return r[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t})};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=function e(t){return t.replace(/[&<>]/g,function(e){return i[e]})};n.htmlAttr=function e(t){return t.replace(/[&<>"]/g,function(e){return i[e]})};n.htmlSpecialChars=function e(t){return t.replace(/[&<>"']/g,function(e){return i[e]})}},{}],19:[function(e,t,n){"use strict";var r=e("./inspect.js").inspect;var i=e("./inspect.js").inspectError;var s=e("./ansi.js");n.formatMethod=function e(t){if(typeof t!=="string"){if(t===null||t===undefined){return""}else if(typeof t.toString==="function"){t=t.toString()}else{return""}}var n=this,s,o,a=1,c=arguments,l=arguments.length,u=false,f=[];t=t.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,function(e,t,h,p,d,m,y){var v,g,b,_,x,k,w,C=[];if(h){return"%"}if(t){if(t==="^"){return"^"}if(!n.markup||!n.markup[t]){return""}u=true;if(typeof n.markup[t]==="function"){v=n.markup[t](f)}else{v=n.markup[t];f.push(v)}return v}if(d){d=parseInt(d);if(p){if(p==="+"){d=a+d}else if(p==="-"){d=a-d}}}else{d=a}a++;if(d>=l||d<1){s=undefined}else{s=c[d]}switch(y){case"s":if(s===null||s===undefined){return""}if(typeof s==="string"){return s}if(typeof s==="number"){return""+s}if(typeof s.toString==="function"){return s.toString()}return"";case"f":if(typeof s==="string"){s=parseFloat(s)}if(typeof s!=="number"){return"0"}if(m!==undefined){switch(m[0]){case"p":b=parseInt(m.slice(1),10);if(b>=1){s=s.toPrecision(b)}break;case"f":b=parseInt(m.slice(1),10);s=s.toFixed(b);break}}return""+s;case"d":case"i":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.floor(s)}return"0";case"u":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0)}return"0";case"U":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),1)}return"1";case"x":if(typeof s==="string"){s=parseInt(s)}if(typeof s!=="number"){return"0"}o=""+Math.max(Math.floor(s),0).toString(16);if(o.length%2){o="0"+o}return o;case"h":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(16)}return"0";case"o":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(8)}return"0";case"b":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(2)}return"0";case"I":return r({style:n&&n.color?"color":"none"},s);case"Y":return r({style:n&&n.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true},s);case"E":return i({style:n&&n.color?"color":"none"},s);case"J":return JSON.stringify(s);case"D":return"";case"F":a--;if(m===undefined){return""}_=m.split(":");x=_[0];k=_[1];if(!x){return""}if(k&&(w=k.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(g=0;g<w.length;g++){p=w[g][1];d=w[g][2];if(d){d=parseInt(d,10);if(p){if(p==="+"){d=a+d}else if(p==="-"){d=a-d}}}else{d=a}a++;if(d>=l||d<1){C[g]=undefined}else{C[g]=c[d]}}}if(!n||!n.fn||typeof n.fn[x]!=="function"){return""}return n.fn[x].apply(n,C);default:return""}});if(u&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(f):this.markupReset}if(this.extraArguments){for(;a<l;a++){s=c[a];if(s===null||s===undefined){continue}else if(typeof s==="string"){t+=s}else if(typeof s==="number"){t+=s}else if(typeof s.toString==="function"){t+=s.toString()}}}return t};var o={extraArguments:true,endingMarkupReset:true,markupReset:s.reset,markup:{":":s.reset," ":s.reset+" ","-":s.dim,"+":s.bold,_:s.underline,"/":s.italic,"!":s.inverse,b:s.blue,B:s.brightBlue,c:s.cyan,C:s.brightCyan,g:s.green,G:s.brightGreen,k:s.black,K:s.brightBlack,m:s.magenta,M:s.brightMagenta,r:s.red,R:s.brightRed,w:s.white,W:s.brightWhite,y:s.yellow,Y:s.brightYellow}};n.format=n.formatMethod.bind(o);n.format.default=o;n.markupMethod=function e(t){if(typeof t!=="string"){if(t===null||t===undefined){return""}else if(typeof t.toString==="function"){t=t.toString()}else{return""}}var n=this,r=false,i=[];t=t.replace(/\^(.?)/g,function(e,t){var s;if(t==="^"){return"^"}if(!n.markup||!n.markup[t]){return""}r=true;if(typeof n.markup[t]==="function"){s=n.markup[t](i)}else{s=n.markup[t];i.push(s)}return s});if(r&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(i):this.markupReset}return t};n.markup=n.markupMethod.bind(o);n.format.count=function e(t){var n,r,i,s=1,o=0;if(typeof t!=="string"){return 0}var a=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=a.exec(t))!==null){i=n[1];r=n[2];if(r){r=parseInt(r,10);if(i){if(i==="+"){r=s+r}else if(i==="-"){r=s-r}}}else{r=s}s++;if(o<r){o=r}}return o};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}else{return false}}},{"./ansi.js":17,"./inspect.js":20}],20:[function(e,t,n){(function(t,r){"use strict";var i=e("tree-kit/lib/extend.js");var s=e("./escape.js");var o=e("./ansi.js");function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(e.depth===undefined){e.depth=3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}return c(n,e,t)}function c(e,n,r){var i,o,a,f,h,p,d,m,y,v,g,b,_="",x="",k="",w,C;d=typeof r;y=n.style.tab.repeat(e.depth);if(d==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){k=[];if(!e.descriptor.configurable){k.push("-conf")}if(!e.descriptor.enumerable){k.push("-enum")}if(!e.descriptor.writable){k.push("-w")}if(k.length){k=k.join(" ")}else{k=""}}if(e.keyIsProperty){if(l(e.key)){x='"'+n.style.key(e.key)+'": '}else{x=n.style.key(e.key)+": "}}else{x="["+n.style.index(e.key)+"] "}if(k){k=" "+n.style.type(k)}}m=e.noPre?"":y+x;if(r===undefined){_+=m+n.style.constant("undefined")+k+n.style.nl}else if(r===null){_+=m+n.style.constant("null")+k+n.style.nl}else if(r===false){_+=m+n.style.constant("false")+k+n.style.nl}else if(r===true){_+=m+n.style.constant("true")+k+n.style.nl}else if(d==="number"){_+=m+n.style.number(r.toString())+(n.noType?"":" "+n.style.type("number"))+k+n.style.nl}else if(d==="string"){_+=m+'"'+n.style.string(s.control(r))+'" '+(n.noType?"":n.style.type("string")+n.style.length("("+r.length+")"))+k+n.style.nl}else if(t.isBuffer(r)){_+=m+n.style.inspect(r.inspect())+" "+(n.noType?"":n.style.type("Buffer")+n.style.length("("+r.length+")"))+k+n.style.nl}else if(d==="object"||d==="function"){o=a="";g=false;if(d==="function"){g=true;o=" "+n.style.funcName(r.name?r.name:"(anonymous)");a=n.style.length("("+r.length+")")}v=false;if(Array.isArray(r)){v=true;a=n.style.length("("+r.length+")")}if(!r.constructor){h="(no constructor)"}else if(!r.constructor.name){h="(anonymous)"}else{h=r.constructor.name}h=n.style.constructorName(h);_+=m;if(!n.noType){if(e.forceType){_+=n.style.type(e.forceType)}else{_+=h+o+a+" "+n.style.type(d)+k}if(!g||n.funcDetails){_+=" "}}f=Object.getOwnPropertyNames(r);if(n.sort){f.sort()}b=u(r);if(b!==undefined){_+="=> "+c({depth:e.depth,ancestors:e.ancestors,noPre:true},n,b)}else if(g&&!n.funcDetails){_+=n.style.nl}else if(!f.length&&!n.proto){_+="{}"+n.style.nl}else if(e.depth>=n.depth){_+=n.style.limit("[depth limit]")+n.style.nl}else if(e.ancestors.indexOf(r)!==-1){_+=n.style.limit("[circular]")+n.style.nl}else{_+=(v&&n.noType?"[":"{")+n.style.nl;C=e.ancestors.slice();C.push(r);for(i=0;i<f.length;i++){try{w=Object.getOwnPropertyDescriptor(r,f[i]);if(!w.enumerable&&n.enumOnly){continue}p=!v||!w.enumerable||isNaN(f[i]);if(!n.noDescriptor&&(w.get||w.set)){_+=c({depth:e.depth+1,ancestors:C,key:f[i],keyIsProperty:p,descriptor:w,forceType:"getter/setter"},n,{get:w.get,set:w.set})}else{_+=c({depth:e.depth+1,ancestors:C,key:f[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,r[f[i]])}}catch(t){_+=c({depth:e.depth+1,ancestors:C,key:f[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,t)}}if(n.proto){_+=c({depth:e.depth+1,ancestors:C,key:"__proto__",keyIsProperty:true},n,r.__proto__)}_+=y+(v&&n.noType?"]":"}")+n.style.nl}}if(e.depth===0){if(n.style==="html"){_=s.html(_)}}return _}n.inspect=a;function l(e){if(!e.length){return true}return false}function u(e){switch(e.constructor.name){case"Date":if(e instanceof Date){
return e.toString()+" ["+e.getTime()+"]"}break;case"Set":if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}break;case"Map":if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}break;case"ObjectID":if(e._bsontype){return e.toString()}break}return}function f(e,t){var n="",r,i,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(t.stack){r=h(e,t.stack)}i=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(i)+(s?" ["+e.style.errorType(s)+"]":"")+": ";n+=e.style.errorMessage(t.message)+"\n";if(r){n+=e.style.errorStack(r)+"\n"}return n}n.inspectError=f;function h(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(!t){return}if((e.browser||r.browser)&&t.indexOf("@")!==-1){t=t.replace(/[<\/]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,function(t,n,r,i,s){return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(r?e.style.errorStackFile(r):e.style.errorStack("unknown"))+(i?e.style.errorStack(":")+e.style.errorStackLine(i):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:([^\s:\(\)\[\]\n]+(?:\([^\)]+\))?)\s)?(?:\[as ([^\s:\(\)\[\]\n]+)\]\s)?(?:\(?([^:\(\)\[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,function(t,n,r,i,s,o,a){return e.style.errorStack("    at ")+(r?e.style.errorStackMethod(r)+" ":"")+(i?e.style.errorStack("[as ")+e.style.errorStackMethodAs(i)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(o?e.style.errorStack(":")+e.style.errorStackLine(o):"")+(a?e.style.errorStack(":")+e.style.errorStackColumn(a):"")+e.style.errorStack(")")})}return t}n.inspectStack=h;var p={};var d=function(e){return e};p.none={tab:"    ",nl:"\n",limit:d,type:function(e){return"<"+e+">"},constant:d,funcName:d,constructorName:function(e){return"<"+e+">"},length:d,key:d,index:d,number:d,inspect:d,string:d,errorType:d,errorMessage:d,errorStack:d,errorStackMethod:d,errorStackMethodAs:d,errorStackFile:d,errorStackLine:d,errorStackColumn:d};p.color=i(null,{},p.none,{limit:function(e){return o.bold+o.brightRed+e+o.reset},type:function(e){return o.italic+o.brightBlack+e+o.reset},constant:function(e){return o.cyan+e+o.reset},funcName:function(e){return o.italic+o.magenta+e+o.reset},constructorName:function(e){return o.magenta+e+o.reset},length:function(e){return o.italic+o.brightBlack+e+o.reset},key:function(e){return o.green+e+o.reset},index:function(e){return o.blue+e+o.reset},number:function(e){return o.cyan+e+o.reset},inspect:function(e){return o.cyan+e+o.reset},string:function(e){return o.blue+e+o.reset},errorType:function(e){return o.red+o.bold+e+o.reset},errorMessage:function(e){return o.red+o.italic+e+o.reset},errorStack:function(e){return o.brightBlack+e+o.reset},errorStackMethod:function(e){return o.brightYellow+e+o.reset},errorStackMethodAs:function(e){return o.yellow+e+o.reset},errorStackFile:function(e){return o.brightCyan+e+o.reset},errorStackLine:function(e){return o.blue+e+o.reset},errorStackColumn:function(e){return o.magenta+e+o.reset}});p.html=i(null,{},p.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",nl:"<br />",limit:function(e){return'<span style="color:red">'+e+"</span>"},type:function(e){return'<i style="color:gray">'+e+"</i>"},constant:function(e){return'<span style="color:cyan">'+e+"</span>"},funcName:function(e){return'<i style="color:magenta">'+e+"</i>"},constructorName:function(e){return'<span style="color:magenta">'+e+"</span>"},length:function(e){return'<i style="color:gray">'+e+"</i>"},key:function(e){return'<span style="color:green">'+e+"</span>"},index:function(e){return'<span style="color:blue">'+e+"</span>"},number:function(e){return'<span style="color:cyan">'+e+"</span>"},inspect:function(e){return'<span style="color:cyan">'+e+"</span>"},string:function(e){return'<span style="color:blue">'+e+"</span>"},errorType:function(e){return'<span style="color:red">'+e+"</span>"},errorMessage:function(e){return'<span style="color:red">'+e+"</span>"},errorStack:function(e){return'<span style="color:gray">'+e+"</span>"},errorStackMethod:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackMethodAs:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackFile:function(e){return'<span style="color:cyan">'+e+"</span>"},errorStackLine:function(e){return'<span style="color:blue">'+e+"</span>"},errorStackColumn:function(e){return'<span style="color:gray">'+e+"</span>"}})}).call(this,{isBuffer:e("../../is-buffer/index.js")},e("_process"))},{"../../is-buffer/index.js":8,"./ansi.js":17,"./escape.js":18,_process:12,"tree-kit/lib/extend.js":21}],21:[function(e,t,n){"use strict";function r(e,t){var n,r,s=false,o=arguments.length;if(o<3){return t}var a=Array.prototype.slice.call(arguments,2);o=a.length;if(!e||typeof e!=="object"){e={}}var c={depth:0,prefix:""};if(!e.maxDepth&&e.deep&&!e.circular){e.maxDepth=100}if(e.deepFunc){e.deep=true}if(e.deepFilter&&typeof e.deepFilter==="object"){if(e.deepFilter.whitelist&&(!Array.isArray(e.deepFilter.whitelist)||!e.deepFilter.whitelist.length)){delete e.deepFilter.whitelist}if(e.deepFilter.blacklist&&(!Array.isArray(e.deepFilter.blacklist)||!e.deepFilter.blacklist.length)){delete e.deepFilter.blacklist}if(!e.deepFilter.whitelist&&!e.deepFilter.blacklist){delete e.deepFilter}}if(e.flat){e.deep=true;e.proto=false;e.inherit=false;e.unflat=false;if(typeof e.flat!=="string"){e.flat="."}}if(e.unflat){e.deep=false;e.proto=false;e.inherit=false;e.flat=false;if(typeof e.unflat!=="string"){e.unflat="."}}if(e.inherit){e.own=true;e.proto=false}else if(e.proto){e.own=true}if(!t||typeof t!=="object"&&typeof t!=="function"){s=true}if(!e.skipRoot&&(e.inherit||e.proto)){for(n=o-1;n>=0;n--){r=a[n];if(r&&(typeof r==="object"||typeof r==="function")){if(e.inherit){if(s){t=Object.create(r)}else{Object.setPrototypeOf(t,r)}}else if(e.proto){if(s){t=Object.create(Object.getPrototypeOf(r))}else{Object.setPrototypeOf(t,Object.getPrototypeOf(r))}}break}}}else if(s){t={}}c.references={sources:[],targets:[]};for(n=0;n<o;n++){r=a[n];if(!r||typeof r!=="object"&&typeof r!=="function"){continue}i(c,e,t,r)}return t}t.exports=r;function i(e,t,n,r){var s,o,a,c,l,u,f,h,p,d,m,y=-1;if(t.maxDepth&&e.depth>t.maxDepth){throw new Error("[tree] extend(): max depth reached("+t.maxDepth+")")}if(t.circular){e.references.sources.push(r);e.references.targets.push(n)}if(t.own){if(t.nonEnum){a=Object.getOwnPropertyNames(r)}else{a=Object.keys(r)}}else{a=r}for(c in a){if(t.own){c=a[c]}if(t.descriptor){h=Object.getOwnPropertyDescriptor(r,c);l=h.value}else{l=r[c]}d=n;p=e.prefix+c;if(t.nofunc&&typeof l==="function"){continue}if(t.unflat&&e.depth===0){m=c.split(t.unflat);o=m.length-1;if(o){for(s=0;s<o;s++){if(!d[m[s]]||typeof d[m[s]]!=="object"&&typeof d[m[s]]!=="function"){d[m[s]]={}}d=d[m[s]]}p=e.prefix+m[o]}}if(t.deep&&l&&(typeof l==="object"||t.deepFunc&&typeof l==="function")&&(!t.descriptor||!h.get)&&((u=Object.getPrototypeOf(l))||true)&&(!t.deepFilter||(!t.deepFilter.whitelist||t.deepFilter.whitelist.indexOf(u)!==-1)&&(!t.deepFilter.blacklist||t.deepFilter.blacklist.indexOf(u)===-1))){if(t.circular){y=e.references.sources.indexOf(l)}if(t.flat){if(y>=0){continue}i({depth:e.depth+1,prefix:e.prefix+c+t.flat,references:e.references},t,d,l)}else{if(y>=0){if(t.descriptor){Object.defineProperty(d,p,{value:e.references.targets[y],enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=e.references.targets[y]}continue}if(!d[p]||!d.hasOwnProperty(p)||typeof d[p]!=="object"&&typeof d[p]!=="function"){if(Array.isArray(l)){f=[]}else if(t.proto){f=Object.create(u)}else if(t.inherit){f=Object.create(l)}else{f={}}if(t.descriptor){Object.defineProperty(d,p,{value:f,enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=f}}else if(t.proto&&Object.getPrototypeOf(d[p])!==u){Object.setPrototypeOf(d[p],u)}else if(t.inherit&&Object.getPrototypeOf(d[p])!==l){Object.setPrototypeOf(d[p],l)}if(t.circular){e.references.sources.push(l);e.references.targets.push(d[p])}i({depth:e.depth+1,prefix:"",references:e.references},t,d[p],l)}}else if(t.preserve&&d[p]!==undefined){continue}else if(!t.inherit){if(t.descriptor){Object.defineProperty(d,p,h)}else{d[p]=l}}if(t.move){delete r[c]}}}},{}],22:[function(e,t,n){"use strict";var r=e("punycode");var i=e("./util");n.parse=x;n.resolve=w;n.resolveObject=C;n.format=k;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["<",">",'"',"`"," ","\r","\n","\t"],u=["{","}","|","\\","^","`"].concat(l),f=["'"].concat(u),h=["%","/","?",";","#"].concat(f),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,y=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:true,"javascript:":true},g={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},_=e("querystring");function x(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;r.parse(e,t,n);return r}s.prototype.parse=function(e,t,n){if(!i.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",l=e.split(a),u=/\\/g;l[0]=l[0].replace(u,"/");e=l.join(a);var x=e;x=x.trim();if(!n&&e.split("#").length===1){var k=c.exec(x);if(k){this.path=x;this.href=x;this.pathname=k[1];if(k[2]){this.search=k[2];if(t){this.query=_.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var w=o.exec(x);if(w){w=w[0];var C=w.toLowerCase();this.protocol=C;x=x.substr(w.length)}if(n||w||x.match(/^\/\/[^@\/]+@[^@\/]+/)){var S=x.substr(0,2)==="//";if(S&&!(w&&g[w])){x=x.substr(2);this.slashes=true}}if(!g[w]&&(S||w&&!b[w])){var j=-1;for(var E=0;E<p.length;E++){var A=x.indexOf(p[E]);if(A!==-1&&(j===-1||A<j))j=A}var L,O;if(j===-1){O=x.lastIndexOf("@")}else{O=x.lastIndexOf("@",j)}if(O!==-1){L=x.slice(0,O);x=x.slice(O+1);this.auth=decodeURIComponent(L)}j=-1;for(var E=0;E<h.length;E++){var A=x.indexOf(h[E]);if(A!==-1&&(j===-1||A<j))j=A}if(j===-1)j=x.length;this.host=x.slice(0,j);x=x.slice(j);this.parseHost();this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T){var $=this.hostname.split(/\./);for(var E=0,I=$.length;E<I;E++){var N=$[E];if(!N)continue;if(!N.match(m)){var M="";for(var D=0,R=N.length;D<R;D++){if(N.charCodeAt(D)>127){M+="x"}else{M+=N[D]}}if(!M.match(m)){var q=$.slice(0,E);var U=$.slice(E+1);var F=N.match(y);if(F){q.push(F[1]);U.unshift(F[2])}if(U.length){x="/"+U.join(".")+x}this.hostname=q.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!T){this.hostname=r.toASCII(this.hostname)}var B=this.port?":"+this.port:"";var P=this.hostname||"";this.host=P+B;this.href+=this.host;if(T){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(x[0]!=="/"){x="/"+x}}}if(!v[C]){for(var E=0,I=f.length;E<I;E++){var G=f[E];if(x.indexOf(G)===-1)continue;var W=encodeURIComponent(G);if(W===G){W=escape(G)}x=x.split(G).join(W)}}var H=x.indexOf("#");if(H!==-1){this.hash=x.substr(H);x=x.slice(0,H)}var X=x.indexOf("?");if(X!==-1){this.search=x.substr(X);this.query=x.substr(X+1);if(t){this.query=_.parse(this.query)}x=x.slice(0,X)}else if(t){this.search="";this.query={}}if(x)this.pathname=x;if(b[C]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var B=this.pathname||"";var Y=this.search||"";this.path=B+Y}this.href=this.format();return this};function k(e){if(i.isString(e))e=x(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=false,o="";if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&i.isObject(this.query)&&Object.keys(this.query).length){o=_.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(r&&r.charAt(0)!=="#")r="#"+r;if(a&&a.charAt(0)!=="?")a="?"+a;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+n+a+r};function w(e,t){return x(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(x(e,false,true)).format()};function C(e,t){if(!e)return t;return x(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var r=Object.keys(this);for(var o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var c=Object.keys(e);for(var l=0;l<c.length;l++){var u=c[l];if(u!=="protocol")n[u]=e[u]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var f=Object.keys(e);for(var h=0;h<f.length;h++){var p=f[h];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!g[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");n.pathname=d.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var y=n.search||"";n.path=m+y}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var v=n.pathname&&n.pathname.charAt(0)==="/",_=e.host||e.pathname&&e.pathname.charAt(0)==="/",x=_||v||n.host&&e.pathname,k=x,w=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],C=n.protocol&&!b[n.protocol];if(C){n.hostname="";n.port=null;if(n.host){if(w[0]==="")w[0]=n.host;else w.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}x=x&&(d[0]===""||w[0]==="")}if(_){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;w=d}else if(d.length){if(!w)w=[];w.pop();w=w.concat(d);n.search=e.search;n.query=e.query}else if(!i.isNullOrUndefined(e.search)){if(C){n.hostname=n.host=w.shift();var S=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(S){n.auth=S.shift();n.host=n.hostname=S.shift()}}n.search=e.search;n.query=e.query;if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!w.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var j=w.slice(-1)[0];var E=(n.host||e.host||w.length>1)&&(j==="."||j==="..")||j==="";var A=0;for(var L=w.length;L>=0;L--){j=w[L];if(j==="."){w.splice(L,1)}else if(j===".."){w.splice(L,1);A++}else if(A){w.splice(L,1);A--}}if(!x&&!k){for(;A--;A){w.unshift("..")}}if(x&&w[0]!==""&&(!w[0]||w[0].charAt(0)!=="/")){w.unshift("")}if(E&&w.join("/").substr(-1)!=="/"){w.push("")}var O=w[0]===""||w[0]&&w[0].charAt(0)==="/";if(C){n.hostname=n.host=O?"":w.length?w.shift():"";var S=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(S){n.auth=S.shift();n.host=n.hostname=S.shift()}}x=x||n.host&&w.length;if(x&&!O){w.unshift("")}if(!w.length){n.pathname=null;n.path=null}else{n.pathname=w.join("/")}if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":23,punycode:13,querystring:16}],23:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}]},{},[2])(2)});