(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.SpellcastClient=e()}})(function(){var e,t,n;return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var c=typeof require=="function"&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";var r=e("dom-kit");function i(){}var s={empty:function(e){while(e.firstChild){e.removeChild(e.firstChild)}}};function o(){return o.create()}t.exports=o;o.create=function e(){var t=Object.create(o.prototype);t.$gfx=document.querySelector("#gfx");t.$content=document.querySelector("#content");t.$text=document.querySelector("#text");t.$chat=document.querySelector("#chat");t.$chatForm=document.querySelector("#chat-form");t.$chatInput=document.querySelector("#chat-input");t.$next=document.querySelector("#next");t.$hint=document.querySelector("#hint");t.$connection=document.querySelector("#connection");t.$music=document.querySelector("#music");t.$sound0=document.querySelector("#sound0");t.$sound1=document.querySelector("#sound1");t.$sound2=document.querySelector("#sound2");t.$sound3=document.querySelector("#sound3");return t};o.prototype.clientStatus=function e(t,n){var r=document.createElement("span");r.classList.add(n.color);r.textContent=t;s.empty(this.$connection);this.$connection.appendChild(r);this.$connection.classList.toggle("alert",n.alert)};o.prototype.clear=function e(t){t=t||i;s.empty(this.$hint);s.empty(this.$text);s.empty(this.$next);t()};o.prototype.clearHints=function e(t){t=t||i;s.empty(this.$hint);t()};o.prototype.clearMessages=function e(t){t=t||i;s.empty(this.$text);t()};o.prototype.addMessage=function e(t,n,r){r=r||i;var s=document.createElement("p");s.classList.add("text");s.textContent=t;this.$text.appendChild(s);r()};o.prototype.clearChoices=function e(t){t=t||i;s.empty(this.$next);t()};o.prototype.addChoices=function e(t,n,r){var s=document.createDocumentFragment();r=r||i;t.forEach(function(e){console.warn("choice.selectedBy:",e.selectedBy);var t=document.createElement("button");t.classList.add("choice",e.type);t.setAttribute("data-isOrdered",e.orderedList);t.textContent=e.label;if(e.selectedBy&&e.selectedBy.length){var r=document.createElement("span");r.classList.add("italic","brightBlack");r.textContent=e.selectedBy.join(", ");t.appendChild(r)}t.addEventListener("click",function(){n(e.index)});s.appendChild(t)});this.$next.appendChild(s);r()};o.prototype.setChoices=function e(t,n,r,s){var o=this;s=s||i;this.clearChoices(function(){o.addChoices(t,s);if(n&&n.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=n.join(", ");o.$next.appendChild(e)}if(typeof r==="number"){o.choiceTimeout(r)}})};o.prototype.updateChoices=function e(t,n,r,s){var o=this;s=s||i;this.clearChoices(function(){o.addChoices(t,s);if(n&&n.length){var e=document.createElement("p");e.classList.add("unassigned-users");e.textContent=n.join(", ");o.$next.appendChild(e)}if(typeof r==="number"){o.choiceTimeout(r)}})};o.prototype.choiceTimeout=function e(t){var n=Date.now(),r,i;r=document.createElement("p");r.classList.add("timer");r.textContent=Math.round(t/1e3);this.$next.appendChild(r);i=setInterval(function(){if(!r.parentNode){clearInterval(i);return}r.textContent=Math.round((t+n-Date.now())/1e3)},1e3)};o.prototype.enableChat=function e(){this.$chat.classList.remove("hidden");this.$chatInput.removeAttribute("disabled")};o.prototype.disableChat=function e(){this.$chat.classList.add("hidden");this.$chatInput.setAttribute("disabled",true)}},{"dom-kit":15}],2:[function(e,t,n){"use strict";var r=e("nextgen-events");var i=e("dom-kit");var s=e("url");function o(e){return o.create(e)}t.exports=o;o.prototype=Object.create(r.prototype);o.prototype.constructor=o;o.create=function e(t){var n=Object.create(o.prototype,{token:{value:t.token||"null",writable:true,enumerable:true},port:{value:t.port||57311,writable:true,enumerable:true},userName:{value:t.name||"unknown_"+Math.floor(Math.random()*1e4),writable:true,enumerable:true},ws:{value:null,writable:true,enumerable:true},proxy:{value:null,writable:true,enumerable:true}});return n};var a={classic:e("./ui/classic.js")};o.autoCreate=function e(){var t=s.parse(window.location.href,true).query;window.spellcastClient=o.create(t);if(!t.ui){t.ui=["classic"]}else if(!Array.isArray(t.ui)){t.ui=[t.ui]}window.spellcastClient.ui=t.ui;return window.spellcastClient};o.prototype.run=function e(t){var n=this,i=false;this.proxy=new r.Proxy;this.proxy.addRemoteService("bus");this.ui.forEach(function(e){if(a[e]){a[e](n.proxy.remoteServices.bus,n)}});this.ws=new WebSocket("ws://127.0.0.1:"+this.port+"/"+this.token);this.emit("connecting");this.ws.onerror=function e(){if(!i){console.log("Can't open Websocket (error)...");n.emit("error","unreachable");return}};this.ws.onopen=function e(){i=true;console.log("Websocket opened!");n.emit("open");n.proxy.remoteServices.bus.emit("authenticate",{name:n.userName});if(typeof t==="function"){t()}};this.ws.onclose=function e(){if(!i){console.log("Can't open Websocket (close)...");n.emit("error","unreachable");return}i=false;n.proxy.destroy();console.log("Websocket closed!");n.emit("close")};this.ws.onmessage=function e(t){var r;try{r=JSON.parse(t.data)}catch(e){return}console.log("Message received: ",r);n.proxy.receive(r)};n.proxy.send=function e(t){n.ws.send(JSON.stringify(t))}};o.autoCreate();i.ready(function(){window.spellcastClient.run()})},{"./ui/classic.js":4,"dom-kit":15,"nextgen-events":18,url:13}],3:[function(e,t,n){"use strict";var r={};t.exports=r;var i=e("string-kit/lib/format.js").markupMethod;var s={endingMarkupReset:true,markupReset:function(e){var t="</span>".repeat(e.length);e.length=0;return t},markup:{":":function(e){var t="</span>".repeat(e.length);e.length=0;return t}," ":function(e){var t="</span>".repeat(e.length);e.length=0;return t+" "},"-":'<span class="dim">',"+":'<span class="bold">',_:'<span class="underline">',"/":'<span class="italic">',"!":'<span class="inverse">',b:'<span class="blue">',B:'<span class="brightBlue">',c:'<span class="cyan">',C:'<span class="brightCyan">',g:'<span class="green">',G:'<span class="brightGreen">',k:'<span class="black">',K:'<span class="brightBlack">',m:'<span class="magenta">',M:'<span class="brightMagenta">',r:'<span class="red">',R:'<span class="brightRed">',w:'<span class="white">',W:'<span class="brightWhite">',y:'<span class="yellow">',Y:'<span class="brightYellow">'}};r.markup=i.bind(s)},{"string-kit/lib/format.js":23}],4:[function(e,t,n){"use strict";var r=e("path");var i=e("../Dom.js");var s=e("dom-kit");var o=e("tree-kit/lib/extend.js");var a=e("kung-fig/lib/treeOps.js");var c=e("../toolkit.js");function u(e,t,n){console.log(Array.from(arguments));if(!n){n=Object.create(u.prototype,{bus:{value:e,enumerable:true},client:{value:t,enumerable:true},user:{value:null,writable:true,enumerable:true},users:{value:null,writable:true,enumerable:true},roles:{value:null,writable:true,enumerable:true},roleId:{value:null,writable:true,enumerable:true},config:{value:null,writable:true,enumerable:true},chatConfig:{value:null,writable:true,enumerable:true},inGame:{value:false,writable:true,enumerable:true},redirectChat:{value:null,writable:true,enumerable:true},nexts:{value:null,writable:true,enumerable:true},afterNext:{value:false,writable:true,enumerable:true},afterLeave:{value:false,writable:true,enumerable:true},nextSoundChannel:{value:0,writable:true,enumerable:true},sprites:{value:{},enumerable:true},animations:{value:{},enumerable:true},dom:{value:i.create()}})}n.$gfx=document.querySelector("#gfx");n.$content=document.querySelector("#content");n.$text=document.querySelector("#text");n.$chat=document.querySelector("#chat");n.$chatForm=document.querySelector("#chat-form");n.$chatInput=document.querySelector("#chat-input");n.$next=document.querySelector("#next");n.$hint=document.querySelector("#hint");n.$connection=document.querySelector("#connection");n.$music=document.querySelector("#music");n.$sound0=document.querySelector("#sound0");n.$sound1=document.querySelector("#sound1");n.$sound2=document.querySelector("#sound2");n.$sound3=document.querySelector("#sound3");n.initInteractions();n.client.once("connecting",u.clientConnecting.bind(n));n.client.once("open",u.clientOpen.bind(n));n.client.once("close",u.clientClose.bind(n));n.client.on("error",u.clientError.bind(n));return n}t.exports=u;function l(e){return this.find(function(t){return t.id===e})}u.prototype.initInteractions=function e(){var t=this,n=null;this.$chatForm.onsubmit=u.onChatSubmit.bind(this);var r=function e(r){if(n!==null){clearTimeout(n);n=null}t.$content.classList.remove("hidden")};var i=function e(i){if(n!==null){clearTimeout(n);n=null}t.$content.classList.toggle("hidden");if(t.$content.classList.contains("hidden")){n=setTimeout(r,8e3)}};this.$content.addEventListener("click",r,false);this.$gfx.addEventListener("click",i,false)};u.prototype.initBus=function e(){this.bus.on("clientConfig",u.clientConfig.bind(this));this.bus.on("user",u.user.bind(this));this.bus.on("userList",u.userList.bind(this));this.bus.on("roleList",u.roleList.bind(this));this.bus.on("extOutput",u.extOutput.bind(this));this.bus.on("extErrorOutput",u.extErrorOutput.bind(this));this.bus.on("message",u.message.bind(this),{async:true});this.bus.on("chatConfig",u.chatConfig.bind(this));this.bus.on("image",u.image.bind(this));this.bus.on("sound",u.sound.bind(this));this.bus.on("music",u.music.bind(this));this.bus.on("defineAnimation",u.defineAnimation.bind(this));this.bus.on("showSprite",u.showSprite.bind(this));this.bus.on("updateSprite",u.prototype.updateSprite.bind(this));this.bus.on("animateSprite",u.animateSprite.bind(this));this.bus.on("clearSprite",u.clearSprite.bind(this));this.bus.on("enterScene",u.enterScene.bind(this));this.bus.on("leaveScene",u.leaveScene.bind(this),{async:true});this.bus.on("nextList",u.nextList.bind(this));this.bus.on("nextTriggered",u.nextTriggered.bind(this));this.bus.on("textInput",u.textInput.bind(this));this.bus.on("rejoin",u.rejoin.bind(this));this.bus.on("wait",u.wait.bind(this));this.bus.on("end",u.end.bind(this));this.bus.on("exit",u.exit.bind(this));this.bus.emit("ready")};u.prototype.cleanUrl=function e(t){if(r.isAbsolute(t)){return t}return this.config.assetBaseUrl+"/"+t};u.clientConnecting=function e(){console.log("Connecting!");this.dom.clientStatus("connecting...",{color:"blue"})};u.clientOpen=function e(){console.log("Connected!");this.dom.clientStatus("connected",{color:"green"});this.initBus()};u.clientClose=function e(){console.log("Closed!");this.dom.clientStatus("connection closed",{color:"red",alert:true})};u.clientError=function e(t){switch(t){case"unreachable":this.dom.clientStatus("server unreachable",{color:"red",alert:true});break}};u.clientConfig=function e(t){console.warn("Client config received: ",t);this.config=t};u.user=function e(t){console.log("User received: ",t);this.user=t};u.userList=function e(t){console.log("User-list received: ",t);t.get=l;this.users=t};u.roleList=function e(t,n,r){var i=this,s,o,a=[],c,u=97+t.length-1;t.get=l;this.roles=t;if(this.inGame){return}if(r&&t.length<=1){this.roleId=t[0].id;return}t.forEach(function(e,t){var n=e.clientId&&i.users.get(e.clientId).name;a.push({index:t,label:e.label,type:"role",selectedBy:n&&[n]})});if(n.length){c=n.map(function(e){return i.users.get(e).name})}this.dom.setChoices(a,c);if(r){t.find(function(e,t){if(e.clientId===i.user.id){i.roleId=e.id;return true}return false});this.afterLeave=true;return}s=document.querySelectorAll(".role");s=Array.prototype.slice.call(s);s.forEach(function(e,n){e.onclick=function(){if(t[n].clientId===i.user.id){i.bus.emit("selectRole",null)}else if(t[n].clientId!==null){return}else{i.bus.emit("selectRole",n)}s.forEach(function(e,t){e.onclick=null})}})};u.message=function e(t,n,r){var i=this,s=false;t=c.markup(t);if(!n){n={}}var o=function e(){if(s){return}s=true;if(n.next){i.messageNext(r);return}r()};this.dom.addMessage(t,n,o)};u.prototype.messageNext=function e(t){t()};u.chatConfig=function e(t){this.chatConfig=t;console.warn("chatConfig:",this.chatConfig);if(this.roleId&&this.chatConfig[this.roleId].write){this.dom.enableChat()}else{this.dom.disableChat()}};u.onChatSubmit=function e(t){t.preventDefault();if(this.$chatInput.getAttribute("disabled")){return}if(this.redirectChat){this.redirectChat(this.$chatInput.value)}else{this.bus.emit("chat",this.$chatInput.value)}this.$chatInput.value=""};u.enterScene=function e(){this.inGame=true;if(this.afterLeave&&!this.afterNextTriggered){this.dom.clear()}this.afterNext=this.afterLeave=this.afterNextTriggered=false};u.leaveScene=function e(t){this.afterLeave=true;if(this.afterNext){t();return}setTimeout(t,500)};u.nextTriggered=function e(){this.afterNextTriggered=true;this.dom.clearMessages();this.dom.clearChoices()};u.nextList=function e(t,n,r,i,s){var o=this,a,c=[],u,l,f,h,p=97+t.length-1;this.nexts=t;this.afterNext=true;if(s&&this.roles.length===1){return}t.forEach(function(e,n){var r=e.roleIds.map(function(e){return o.roles.get(e).label});c.push({index:n,label:e.label||"NEXT",orderedList:t.length>1,type:"next",selectedBy:r})});if(r.length&&this.roles.length){u=r.map(function(e){return o.roles.get(e).label})}this.dom.setChoices(c,u,i);a=document.querySelectorAll(".next");a=Array.prototype.slice.call(a);a.forEach(function(e,n){e.onclick=function(){if(t[n].roleIds.indexOf(o.roleId)!==-1){o.bus.emit("selectNext",null)}else{o.bus.emit("selectNext",n)}a.forEach(function(e,t){e.onclick=null})}})};u.extOutput=function e(t){alert("not coded ATM!")};u.extErrorOutput=function e(t){alert("not coded ATM!")};u.textInput=function e(t,n){var r=this,i,s,o=false;if(n.indexOf(this.roleId)===-1){this.$text.insertAdjacentHTML("beforeend",'<p class="text">'+t+'<input type="text" id="textInput" class="text-input" placeholder="YOU CAN\'T RESPOND - WAIT..." disabled /></p>');return}this.$text.insertAdjacentHTML("beforeend",'<form class="form-text-input"><p class="text">'+t+'<input type="text" class="text-input" /></p></form>');i=document.querySelector(".form-text-input");s=i.querySelector(".text-input");s.value=this.$chatInput.value;s.focus();var a=function e(t){if(o){return}o=true;r.redirectChat=null;i.onsubmit=function(){};s.oninput=null;r.$chatInput.oninput=null;s.setAttribute("disabled",true);r.bus.emit("textSubmit",t)};this.redirectChat=function e(t){a(t)};i.onsubmit=function e(t){t.preventDefault();a(s.value)};s.oninput=function e(){r.$chatInput.value=s.value};this.$chatInput.oninput=function e(){s.value=r.$chatInput.value}};u.rejoin=function e(){};u.wait=function e(t){var n=this;switch(t){case"otherBranches":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="wait pulse-animation">WAITING FOR OTHER BRANCHES TO FINISH...</h2>');this.bus.once("rejoin",function(){n.$hint.innerHTML=""});break;default:this.$hint.insertAdjacentHTML("beforeend",'<h2 class="wait pulse-animation">WAITING FOR '+t+"</h2>")}};u.image=function e(t){var n=this,r=false;var i=document.createElement("div");i.classList.add("scene-image");if(t.url){i.style.backgroundImage='url("'+this.cleanUrl(t.url)+'")'}if(t.origin&&typeof t.origin==="string"){i.style.backgroundPosition=t.origin}var s=this.$gfx.firstElementChild||null;var o=function e(){if(r){return}r=true;s.remove()};if(s){s.addEventListener("transitionend",o,false);this.$gfx.insertBefore(i,s);s.classList.add("hidden");setTimeout(o,2e3)}else{this.$gfx.append(i)}switch(t.position){case"left":this.$content.setAttribute("data-position","right");break;case"right":default:this.$content.setAttribute("data-position","left");break}};u.defineAnimation=function e(t,n){this.animations[t]=n};u.showSprite=function e(t,n){var r=this,i,s;if(!n.url||typeof n.url!=="string"){return}s=this.sprites[t];i=this.sprites[t]={animation:null,action:null,style:{}};i.$img=document.createElement("img");i.$img.classList.add("sprite");this.updateSprite(null,n,i);if(s){s.$img.remove()}this.$gfx.append(i.$img)};u.prototype.updateSprite=function e(t,n,r){var i=this,a;if(!n.style||typeof n.style!=="object"){n.style={}}if(r){a=r}else{if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}a=this.sprites[t]}delete n.style.position;if(n.url){a.$img.setAttribute("src",this.cleanUrl(n.url))}if(n.action!==undefined){if(n.action&&!a.action){a.$img.classList.add("clickable");a.onClick=function(e){console.warn("action triggered: ",a.action);i.bus.emit("action",a.action);e.stopPropagation()};a.$img.addEventListener("click",a.onClick)}else if(!n.action&&a.action){a.$img.classList.remove("clickable");a.$img.removeEventListener("click",a.onClick)}a.action=n.action||null}o(null,a.style,n.style);s.css(a.$img,n.style)};u.animateSprite=function e(t,n){var r=this,i,s,o,a=0;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}if(!this.animations[n]){console.warn("Unknown animation id: ",n);return}i=this.sprites[t];s=this.animations[n];i.animation=n;if(!Array.isArray(s.frames)||!s.frames.length){return}var c=function(){o=s.frames[a];r.updateSprite(null,o,i);if(++a<s.frames.length){setTimeout(c,o.duration*1e3)}else{i.animation=null}};c()};u.clearSprite=function e(t,n){var r;if(!this.sprites[t]){console.warn("Unknown sprite id: ",t);return}r=this.sprites[t];r.$img.remove();delete this.sprites[t]};u.sound=function e(t){var n=this["$sound"+this.nextSoundChannel];console.warn("$sound"+this.nextSoundChannel,t,n);this.nextSoundChannel=(this.nextSoundChannel+1)%4;n.setAttribute("src",this.cleanUrl(t.url));n.play()};u.music=function e(t){var n=this,r=this.$music.getAttribute("src");if(t.url){if(r){if(r!==t.url){d(this.$music,function(){n.$music.setAttribute("src",n.cleanUrl(t.url));n.$music.play();p(n.$music)})}else if(this.$music.ended){this.$music.play()}}else{this.$music.volume=0;this.$music.setAttribute("src",this.cleanUrl(t.url));this.$music.play();p(this.$music)}}else{if(r){d(this.$music,function(){n.$music.removeAttribute("src")})}}};var f=10;var h=.01;function p(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume>=1){if(t){t()}return}e.volume=Math.min(1,e.volume+h);e.__fadeTimer=setTimeout(p.bind(undefined,e,t),f)}function d(e,t){if(e.__fadeTimer){clearTimeout(e.__fadeTimer);e.__fadeTimer=null}if(e.volume<=0){if(t){t()}return}e.volume=Math.max(0,e.volume-h);e.__fadeTimer=setTimeout(d.bind(undefined,e,t),f)}u.end=function e(t,n){switch(t){case"end":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end">The End.</h2>');break;case"win":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end win">You win!</h2>');break;case"lost":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end lost">You lose...</h2>');break;case"draw":this.$hint.insertAdjacentHTML("beforeend",'<h2 class="end draw">Draw.</h2>');break}};u.exit=function e(){}},{"../Dom.js":1,"../toolkit.js":3,"dom-kit":15,"kung-fig/lib/treeOps.js":17,path:7,"tree-kit/lib/extend.js":25}],5:[function(e,t,n){},{}],6:[function(e,t,n){t.exports=function(e){return e!=null&&(r(e)||i(e)||!!e._isBuffer)};function r(e){return!!e.constructor&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function i(e){return typeof e.readFloatLE==="function"&&typeof e.slice==="function"&&r(e.slice(0,0))}},{}],7:[function(e,t,n){(function(e){function t(e,t){var n=0;for(var r=e.length-1;r>=0;r--){var i=e[r];if(i==="."){e.splice(r,1)}else if(i===".."){e.splice(r,1);n++}else if(n){e.splice(r,1);n--}}if(t){for(;n--;n){e.unshift("..")}}return e}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var i=function(e){return r.exec(e).slice(1)};n.resolve=function(){var n="",r=false;for(var i=arguments.length-1;i>=-1&&!r;i--){var o=i>=0?arguments[i]:e.cwd();if(typeof o!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!o){continue}n=o+"/"+n;r=o.charAt(0)==="/"}n=t(s(n.split("/"),function(e){return!!e}),!r).join("/");return(r?"/":"")+n||"."};n.normalize=function(e){var r=n.isAbsolute(e),i=o(e,-1)==="/";e=t(s(e.split("/"),function(e){return!!e}),!r).join("/");if(!e&&!r){e="."}if(e&&i){e+="/"}return(r?"/":"")+e};n.isAbsolute=function(e){return e.charAt(0)==="/"};n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(s(e,function(e,t){if(typeof e!=="string"){throw new TypeError("Arguments to path.join must be strings")}return e}).join("/"))};n.relative=function(e,t){e=n.resolve(e).substr(1);t=n.resolve(t).substr(1);function r(e){var t=0;for(;t<e.length;t++){if(e[t]!=="")break}var n=e.length-1;for(;n>=0;n--){if(e[n]!=="")break}if(t>n)return[];return e.slice(t,n-t+1)}var i=r(e.split("/"));var s=r(t.split("/"));var o=Math.min(i.length,s.length);var a=o;for(var c=0;c<o;c++){if(i[c]!==s[c]){a=c;break}}var u=[];for(var c=a;c<i.length;c++){u.push("..")}u=u.concat(s.slice(a));return u.join("/")};n.sep="/";n.delimiter=":";n.dirname=function(e){var t=i(e),n=t[0],r=t[1];if(!n&&!r){return"."}if(r){r=r.substr(0,r.length-1)}return n+r};n.basename=function(e,t){var n=i(e)[2];if(t&&n.substr(-1*t.length)===t){n=n.substr(0,n.length-t.length)}return n};n.extname=function(e){return i(e)[3]};function s(e,t){if(e.filter)return e.filter(t);var n=[];for(var r=0;r<e.length;r++){if(t(e[r],r,e))n.push(e[r])}return n}var o="ab".substr(-1)==="b"?function(e,t,n){return e.substr(t,n)}:function(e,t,n){if(t<0)t=e.length+t;return e.substr(t,n)}}).call(this,e("_process"))},{_process:8}],8:[function(e,t,n){var r=t.exports={};var i;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){i=setTimeout}else{i=o}}catch(e){i=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(e){s=a}})();function c(e){if(i===setTimeout){return setTimeout(e,0)}if((i===o||!i)&&setTimeout){i=setTimeout;return setTimeout(e,0)}try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function u(e){if(s===clearTimeout){return clearTimeout(e)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(e)}try{return s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}var l=[];var f=false;var h;var p=-1;function d(){if(!f||!h){return}f=false;if(h.length){l=h.concat(l)}else{p=-1}if(l.length){m()}}function m(){if(f){return}var e=c(d);f=true;var t=l.length;while(t){h=l;l=[];while(++p<t){if(h){h[p].run()}}p=-1;t=l.length}h=null;f=false;u(e)}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}}l.push(new y(e,t));if(l.length===1&&!f){c(m)}};function y(e,t){this.fun=e;this.array=t}y.prototype.run=function(){this.fun.apply(null,this.array)};r.title="browser";r.browser=true;r.env={};r.argv=[];r.version="";r.versions={};function v(){}r.on=v;r.addListener=v;r.once=v;r.off=v;r.removeListener=v;r.removeAllListeners=v;r.emit=v;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")};r.umask=function(){return 0}},{}],9:[function(t,n,r){(function(t){(function(i){var s=typeof r=="object"&&r&&!r.nodeType&&r;var o=typeof n=="object"&&n&&!n.nodeType&&n;var a=typeof t=="object"&&t;if(a.global===a||a.window===a||a.self===a){i=a}var c,u=2147483647,l=36,f=1,h=26,p=38,d=700,m=72,y=128,v="-",g=/^xn--/,b=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,k={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=l-f,w=Math.floor,j=String.fromCharCode,S;function O(e){throw new RangeError(k[e])}function C(e,t){var n=e.length;var r=[];while(n--){r[n]=t(e[n])}return r}function A(e,t){var n=e.split("@");var r="";if(n.length>1){r=n[0]+"@";e=n[1]}e=e.replace(_,".");var i=e.split(".");var s=C(i,t).join(".");return r+s}function E(e){var t=[],n=0,r=e.length,i,s;while(n<r){i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){s=e.charCodeAt(n++);if((s&64512)==56320){t.push(((i&1023)<<10)+(s&1023)+65536)}else{t.push(i);n--}}else{t.push(i)}}return t}function L(e){return C(e,function(e){var t="";if(e>65535){e-=65536;t+=j(e>>>10&1023|55296);e=56320|e&1023}t+=j(e);return t}).join("")}function T(e){if(e-48<10){return e-22}if(e-65<26){return e-65}if(e-97<26){return e-97}return l}function $(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function N(e,t,n){var r=0;e=n?w(e/d):e>>1;e+=w(e/t);for(;e>x*h>>1;r+=l){e=w(e/x)}return w(r+(x+1)*e/(e+p))}function I(e){var t=[],n=e.length,r,i=0,s=y,o=m,a,c,p,d,g,b,_,k,x;a=e.lastIndexOf(v);if(a<0){a=0}for(c=0;c<a;++c){if(e.charCodeAt(c)>=128){O("not-basic")}t.push(e.charCodeAt(c))}for(p=a>0?a+1:0;p<n;){for(d=i,g=1,b=l;;b+=l){if(p>=n){O("invalid-input")}_=T(e.charCodeAt(p++));if(_>=l||_>w((u-i)/g)){O("overflow")}i+=_*g;k=b<=o?f:b>=o+h?h:b-o;if(_<k){break}x=l-k;if(g>w(u/x)){O("overflow")}g*=x}r=t.length+1;o=N(i-d,r,d==0);if(w(i/r)>u-s){O("overflow")}s+=w(i/r);i%=r;t.splice(i++,0,s)}return L(t)}function M(e){var t,n,r,i,s,o,a,c,p,d,g,b=[],_,k,x,S;e=E(e);_=e.length;t=y;n=0;s=m;for(o=0;o<_;++o){g=e[o];if(g<128){b.push(j(g))}}r=i=b.length;if(i){b.push(v)}while(r<_){for(a=u,o=0;o<_;++o){g=e[o];if(g>=t&&g<a){a=g}}k=r+1;if(a-t>w((u-n)/k)){O("overflow")}n+=(a-t)*k;t=a;for(o=0;o<_;++o){g=e[o];if(g<t&&++n>u){O("overflow")}if(g==t){for(c=n,p=l;;p+=l){d=p<=s?f:p>=s+h?h:p-s;if(c<d){break}S=c-d;x=l-d;b.push(j($(d+S%x,0)));c=w(S/x)}b.push(j($(c,0)));s=N(n,k,r==i);n=0;++r}}++n;++t}return b.join("")}function q(e){return A(e,function(e){return g.test(e)?I(e.slice(4).toLowerCase()):e})}function R(e){return A(e,function(e){return b.test(e)?"xn--"+M(e):e})}c={version:"1.4.1",ucs2:{decode:E,encode:L},decode:I,encode:M,toASCII:R,toUnicode:q};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd){e("punycode",function(){return c})}else if(s&&o){if(n.exports==s){o.exports=c}else{for(S in c){c.hasOwnProperty(S)&&(s[S]=c[S])}}}else{i.punycode=c}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],10:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,s){t=t||"&";n=n||"=";var o={};if(typeof e!=="string"||e.length===0){return o}var a=/\+/g;e=e.split(t);var c=1e3;if(s&&typeof s.maxKeys==="number"){c=s.maxKeys}var u=e.length;if(c>0&&u>c){u=c}for(var l=0;l<u;++l){var f=e[l].replace(a,"%20"),h=f.indexOf(n),p,d,m,y;if(h>=0){p=f.substr(0,h);d=f.substr(h+1)}else{p=f;d=""}m=decodeURIComponent(p);y=decodeURIComponent(d);if(!r(o,m)){o[m]=y}else if(i(o[m])){o[m].push(y)}else{o[m]=[o[m],y]}}return o};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],11:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return s(o(e),function(o){var a=encodeURIComponent(r(o))+n;if(i(e[o])){return s(e[o],function(e){return a+encodeURIComponent(r(e))}).join(t)}else{return a+encodeURIComponent(r(e[o]))}}).join(t)}if(!a)return"";return encodeURIComponent(r(a))+n+encodeURIComponent(r(e))};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function s(e,t){if(e.map)return e.map(t);var n=[];for(var r=0;r<e.length;r++){n.push(t(e[r],r))}return n}var o=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],12:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":10,"./encode":11}],13:[function(e,t,n){"use strict";var r=e("punycode");var i=e("./util");n.parse=k;n.resolve=w;n.resolveObject=j;n.format=x;n.Url=s;function s(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["<",">",'"',"`"," ","\r","\n","\t"],l=["{","}","|","\\","^","`"].concat(u),f=["'"].concat(l),h=["%","/","?",";","#"].concat(f),p=["/","?","#"],d=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,y=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:true,"javascript:":true},g={javascript:true,"javascript:":true},b={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},_=e("querystring");function k(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;r.parse(e,t,n);return r}s.prototype.parse=function(e,t,n){if(!i.isString(e)){throw new TypeError("Parameter 'url' must be a string, not "+typeof e)}var s=e.indexOf("?"),a=s!==-1&&s<e.indexOf("#")?"?":"#",u=e.split(a),l=/\\/g;u[0]=u[0].replace(l,"/");e=u.join(a);var k=e;k=k.trim();if(!n&&e.split("#").length===1){var x=c.exec(k);if(x){this.path=k;this.href=k;this.pathname=x[1];if(x[2]){this.search=x[2];if(t){this.query=_.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(t){this.search="";this.query={}}return this}}var w=o.exec(k);if(w){w=w[0];var j=w.toLowerCase();this.protocol=j;k=k.substr(w.length)}if(n||w||k.match(/^\/\/[^@\/]+@[^@\/]+/)){var S=k.substr(0,2)==="//";if(S&&!(w&&g[w])){k=k.substr(2);this.slashes=true}}if(!g[w]&&(S||w&&!b[w])){var O=-1;for(var C=0;C<p.length;C++){var A=k.indexOf(p[C]);if(A!==-1&&(O===-1||A<O))O=A}var E,L;if(O===-1){L=k.lastIndexOf("@")}else{L=k.lastIndexOf("@",O)}if(L!==-1){E=k.slice(0,L);k=k.slice(L+1);this.auth=decodeURIComponent(E)}O=-1;for(var C=0;C<h.length;C++){var A=k.indexOf(h[C]);if(A!==-1&&(O===-1||A<O))O=A}if(O===-1)O=k.length;this.host=k.slice(0,O);k=k.slice(O);this.parseHost();this.hostname=this.hostname||"";var T=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!T){var $=this.hostname.split(/\./);for(var C=0,N=$.length;C<N;C++){var I=$[C];if(!I)continue;if(!I.match(m)){var M="";for(var q=0,R=I.length;q<R;q++){if(I.charCodeAt(q)>127){M+="x"}else{M+=I[q]}}if(!M.match(m)){var D=$.slice(0,C);var F=$.slice(C+1);var P=I.match(y);if(P){D.push(P[1]);F.unshift(P[2])}if(F.length){k="/"+F.join(".")+k}this.hostname=D.join(".");break}}}}if(this.hostname.length>d){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!T){this.hostname=r.toASCII(this.hostname)}var U=this.port?":"+this.port:"";var B=this.hostname||"";this.host=B+U;this.href+=this.host;if(T){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(k[0]!=="/"){k="/"+k}}}if(!v[j]){for(var C=0,N=f.length;C<N;C++){var K=f[C];if(k.indexOf(K)===-1)continue;var G=encodeURIComponent(K);if(G===K){G=escape(K)}k=k.split(K).join(G)}}var W=k.indexOf("#");if(W!==-1){this.hash=k.substr(W);k=k.slice(0,W)}var H=k.indexOf("?");if(H!==-1){this.search=k.substr(H);this.query=k.substr(H+1);if(t){this.query=_.parse(this.query)}k=k.slice(0,H)}else if(t){this.search="";this.query={}}if(k)this.pathname=k;if(b[j]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var U=this.pathname||"";var X=this.search||"";this.path=U+X}this.href=this.format();return this};function x(e){if(i.isString(e))e=k(e);if(!(e instanceof s))return s.prototype.format.call(e);return e.format()}s.prototype.format=function(){var e=this.auth||"";if(e){e=encodeURIComponent(e);e=e.replace(/%3A/i,":");e+="@"}var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=false,o="";
if(this.host){s=e+this.host}else if(this.hostname){s=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){s+=":"+this.port}}if(this.query&&i.isObject(this.query)&&Object.keys(this.query).length){o=_.stringify(this.query)}var a=this.search||o&&"?"+o||"";if(t&&t.substr(-1)!==":")t+=":";if(this.slashes||(!t||b[t])&&s!==false){s="//"+(s||"");if(n&&n.charAt(0)!=="/")n="/"+n}else if(!s){s=""}if(r&&r.charAt(0)!=="#")r="#"+r;if(a&&a.charAt(0)!=="?")a="?"+a;n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)});a=a.replace("#","%23");return t+s+n+a+r};function w(e,t){return k(e,false,true).resolve(t)}s.prototype.resolve=function(e){return this.resolveObject(k(e,false,true)).format()};function j(e,t){if(!e)return t;return k(e,false,true).resolveObject(t)}s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,false,true);e=t}var n=new s;var r=Object.keys(this);for(var o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}n.hash=e.hash;if(e.href===""){n.href=n.format();return n}if(e.slashes&&!e.protocol){var c=Object.keys(e);for(var u=0;u<c.length;u++){var l=c[u];if(l!=="protocol")n[l]=e[l]}if(b[n.protocol]&&n.hostname&&!n.pathname){n.path=n.pathname="/"}n.href=n.format();return n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){var f=Object.keys(e);for(var h=0;h<f.length;h++){var p=f[h];n[p]=e[p]}n.href=n.format();return n}n.protocol=e.protocol;if(!e.host&&!g[e.protocol]){var d=(e.pathname||"").split("/");while(d.length&&!(e.host=d.shift()));if(!e.host)e.host="";if(!e.hostname)e.hostname="";if(d[0]!=="")d.unshift("");if(d.length<2)d.unshift("");n.pathname=d.join("/")}else{n.pathname=e.pathname}n.search=e.search;n.query=e.query;n.host=e.host||"";n.auth=e.auth;n.hostname=e.hostname||e.host;n.port=e.port;if(n.pathname||n.search){var m=n.pathname||"";var y=n.search||"";n.path=m+y}n.slashes=n.slashes||e.slashes;n.href=n.format();return n}var v=n.pathname&&n.pathname.charAt(0)==="/",_=e.host||e.pathname&&e.pathname.charAt(0)==="/",k=_||v||n.host&&e.pathname,x=k,w=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],j=n.protocol&&!b[n.protocol];if(j){n.hostname="";n.port=null;if(n.host){if(w[0]==="")w[0]=n.host;else w.unshift(n.host)}n.host="";if(e.protocol){e.hostname=null;e.port=null;if(e.host){if(d[0]==="")d[0]=e.host;else d.unshift(e.host)}e.host=null}k=k&&(d[0]===""||w[0]==="")}if(_){n.host=e.host||e.host===""?e.host:n.host;n.hostname=e.hostname||e.hostname===""?e.hostname:n.hostname;n.search=e.search;n.query=e.query;w=d}else if(d.length){if(!w)w=[];w.pop();w=w.concat(d);n.search=e.search;n.query=e.query}else if(!i.isNullOrUndefined(e.search)){if(j){n.hostname=n.host=w.shift();var S=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(S){n.auth=S.shift();n.host=n.hostname=S.shift()}}n.search=e.search;n.query=e.query;if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.href=n.format();return n}if(!w.length){n.pathname=null;if(n.search){n.path="/"+n.search}else{n.path=null}n.href=n.format();return n}var O=w.slice(-1)[0];var C=(n.host||e.host||w.length>1)&&(O==="."||O==="..")||O==="";var A=0;for(var E=w.length;E>=0;E--){O=w[E];if(O==="."){w.splice(E,1)}else if(O===".."){w.splice(E,1);A++}else if(A){w.splice(E,1);A--}}if(!k&&!x){for(;A--;A){w.unshift("..")}}if(k&&w[0]!==""&&(!w[0]||w[0].charAt(0)!=="/")){w.unshift("")}if(C&&w.join("/").substr(-1)!=="/"){w.push("")}var L=w[0]===""||w[0]&&w[0].charAt(0)==="/";if(j){n.hostname=n.host=L?"":w.length?w.shift():"";var S=n.host&&n.host.indexOf("@")>0?n.host.split("@"):false;if(S){n.auth=S.shift();n.host=n.hostname=S.shift()}}k=k||n.host&&w.length;if(k&&!L){w.unshift("")}if(!w.length){n.pathname=null;n.path=null}else{n.pathname=w.join("/")}if(!i.isNull(n.pathname)||!i.isNull(n.search)){n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")}n.auth=e.auth||n.auth;n.slashes=n.slashes||e.slashes;n.href=n.format();return n};s.prototype.parseHost=function(){var e=this.host;var t=a.exec(e);if(t){t=t[0];if(t!==":"){this.port=t.substr(1)}e=e.substr(0,e.length-t.length)}if(e)this.hostname=e}},{"./util":14,punycode:9,querystring:12}],14:[function(e,t,n){"use strict";t.exports={isString:function(e){return typeof e==="string"},isObject:function(e){return typeof e==="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}}},{}],15:[function(e,t,n){var r={};t.exports=r;r.svg=e("./svg.js");r.ready=function e(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,false);t()},false)};r.fromHtml=function e(t){var n,r,i;i=document.createDocumentFragment();r=document.createElement("div");r.insertAdjacentHTML("beforeend",t);for(n=0;n<r.children.length;n++){i.appendChild(r.children[n])}return i};r.batch=function e(t,n){var r,i=Array.prototype.slice.call(arguments,1);if(n instanceof Element){i[0]=n;t.apply(this,i)}else if(Array.isArray(n)){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}else if(n instanceof NodeList||n instanceof NamedNodeMap){for(r=0;r<n.length;r++){i[0]=n[r];t.apply(this,i)}}};r.css=function e(t,n){var r;for(r in n){t.style[r]=n[r]}};r.attr=function e(t,n){var r;for(r in n){if(n[r]===null){t.removeAttribute(r)}else{t.setAttribute(r,n[r])}}};r.remove=function e(t){t.parentNode.removeChild(t)};r.empty=function e(t){while(t.firstChild){t.removeChild(t.firstChild)}};r.cloneInto=function e(t,n){r.empty(t);t.appendChild(n.cloneNode(true))};r.insertInto=function e(t,n){r.empty(t);t.appendChild(n)};r.idNamespace=function e(t,n){var i,s={};i=t.querySelectorAll("*");r.batch(r.idNamespace.idAttributePass,i,n,s);r.batch(r.idNamespace.otherAttributesPass,i,s)};r.idNamespace.idAttributePass=function e(t,n,r){r[t.id]=n+"."+t.id;t.id=r[t.id]};r.idNamespace.otherAttributesPass=function e(t,n){r.batch(r.idNamespace.oneAttributeSubPass,t.attributes,n)};r.idNamespace.oneAttributeSubPass=function e(t,n){t.value=t.value.replace(/url\(#([^)]+)\)/g,function(e,t){if(!n[t]){return e}return"url(#"+n[t]+")"})};r.id=function e(t,e){t.id=e};r.text=function e(t,e){t.textContent=e};r.html=function e(t,e){t.innerHTML=e}},{"./svg.js":16}],16:[function(e,t,n){var r=e("fs");var i=e("./dom.js");var s={};t.exports=s;s.load=function e(t,n,i,o){if(typeof i==="function"){o=i}if(!i||typeof i!=="object"){i={}}if(n.substring(0,7)==="file://"){r.readFile(n.slice(7),function(e,n){if(e){o(e);return}var r=new DOMParser;var a=r.parseFromString(n.toString(),"application/xml").documentElement;try{s.attachXmlTo(t,a,i)}catch(e){o(e);return}o(undefined,a)})}else{s.ajax(n,function(e,n){var r=n.documentElement;if(e){o(e);return}try{s.attachXmlTo(t,r,i)}catch(e){o(e);return}o(undefined,r)})}};s.attachXmlTo=function e(t,n,r){s.lightCleanup(n);if(r.id!==undefined){if(typeof r.id==="string"){n.setAttribute("id",r.id)}else if(!r.id){n.removeAttribute("id")}}if(typeof r.class==="string"){n.setAttribute("class",r.class)}if(r.idNamespace){i.idNamespace(n,r.idNamespace)}if(r.hidden){n.style.visibility="hidden"}t.appendChild(n)};s.lightCleanup=function e(t){o(t,"metadata");o(t,"script")};function o(e,t){var n,r,i;r=e.getElementsByTagName(t);for(n=0;n<r.length;n++){i=r.item(n);i.parentNode.removeChild(i)}}s.ajax=function e(t,n){var r=new XMLHttpRequest;r.responseType="document";r.onreadystatechange=s.ajax.ajaxStatus.bind(r,n);r.open("GET",t);r.send()};s.ajax.ajaxStatus=function e(t){try{if(this.readyState===4){if(this.status===200){t(undefined,this.responseXML)}else if(this.status===0&&this.responseXML){t(undefined,this.responseXML)}else{if(this.status){t(this.status)}else{t(new Error("[dom-kit.svg] ajaxStatus(): Error with falsy status"))}}}}catch(e){t(e)}}},{"./dom.js":15,fs:5}],17:[function(e,t,n){"use strict";var r={};t.exports=r;r.reduceToObject=function e(t){return r.toObject(r.reduce.apply(this,arguments))};r.toObject=function e(t){if(!s(t)){return t}var n,i,o,a,c={},u=Object.keys(t);for(n=0,i=u.length;n<i;n++){o=this.splitOpKey(u[n]);if(o.operator){continue}a=t[u[n]];if(s(a)){a=r.toObject(a)}c[o.baseKey]=a}return c};r.stack=function e(){var t,n=arguments.length,r={};for(t=0;t<n;t++){if(!s(arguments[t])){continue}this.stackInto(arguments[t],r)}return r};r.autoStack=function e(t){if(!s(t)){return t}var n,r=arguments.length;for(n=1;n<r;n++){if(!s(arguments[n])){continue}this.stackInto(arguments[n],t)}return t};r.stackInto=function e(t,n){var r,i,s,o,a,c,u=Object.keys(t);i=u.length;for(r=0;r<i;r++){c=u[r];if(!c){continue}s=this.splitOpKey(c);if(s.foreach){if(Array.isArray(t[c])){a=c[0]==="("?"("+c.slice(2):c.slice(1);if(n[a]!==undefined){if(Array.isArray(n[c])){n[c].push(n[a])}else{n[c]=[n[a]]}delete n[a]}if(Array.isArray(n[c])){n[c]=n[c].concat(t[c])}else{n[c]=t[c]}}continue}o=c[0]==="("?"(#"+c.slice(1):"#"+c;if(Array.isArray(n[o])){if(n[c]===undefined){n[o].push(t[c])}else{n[o]=n[o].concat([n[c],t[c]])}delete n[c]}else if(n[c]===undefined){n[c]=t[c]}else{n[o]=[n[c],t[c]];delete n[c]}}};r.reduce=function e(t){if(!s(t)){return t}t=this.stack.apply(this,arguments);return this.reduceObject(t,[t])};r.autoReduce=function e(t){if(!s(t)){return t}if(arguments.length>1){this.autoStack.apply(this,arguments)}return this.reduceObject(t,[t])};r.reduceObject=function e(t,n){var r,o,a,c=[],u,l,f,h=Object.keys(t);o=h.length;for(r=0;r<o;r++){if(!h[r]||t[h[r]]===undefined){delete t[h[r]];continue}a=this.splitOpKey(h[r]);a.rank=this.operators[a.operator].rank;c.push(a)}c.sort(i);for(r=0,o=c.length;r<o;r++){l=c[r].baseKey;f=c[r].key;if(!l){t[""]={};this.assignObject(t[""],t);delete t[""][f];delete t[""][""]}if(c[r].foreach){if(!Array.isArray(t[f])){delete t[f];continue}t[l]=this.operators[c[r].operator].reduce.call(this,t[l],t[f]);if(t[l]===undefined){delete t[l]}if(t[f].length===0){delete t[f]}else if(t[f].length===1){t[f.slice(1)]=t[f][0];delete t[f]}}else if(c[r].operator){u=[t[f]];t[l]=this.operators[c[r].operator].reduce.call(this,t[l],u);if(t[l]===undefined){delete t[l]}if(u.length===0){delete t[f]}}if(s(t[l])&&n.indexOf(t[l])===-1){n.push(t[l]);this.reduceObject(t[l],n)}if(!l){if(s(t[""])){this.assignObject(t,t[""])}delete t[""];return this.reduceObject(t,n)}}return t};function i(e,t){return e.rank-t.rank||(e.baseKey?0:1)-(t.baseKey?0:1)||(e.foreach?0:1)-(t.foreach?0:1)}function s(e){var t;return e&&typeof e==="object"&&((t=Object.getPrototypeOf(e))===Object.prototype||t===null)}r.reservedOperators={"+":true,"-":true,"*":true,"/":true,"*>":true,"<*":true,"*>>":true,"<<*":true,"+>":true,"<+":true};Object.keys(r.reservedOperators).forEach(function(e){r.reservedOperators["#"+e]=true});r.reservedKeyStart={"#":true,"(":true,"+":true,"-":true,"*":true,"/":true,"<":true,"?":true,"!":true,"^":true};r.splitOpKey=function e(t){var n,r,i=t,s,o=false;if(i[0]==="("){i=t.slice(1);if(i[0]==="#"){o=true;i=i.slice(1)}for(n=0,r=i.length;n<r&&i[n]!==")";n++){}s={operator:i.slice(0,n),baseKey:i.slice(n+1),key:t}}else{if(i[0]==="#"){o=true;i=i.slice(1)}switch(i[0]){case"+":switch(i[1]){case">":s={operator:"+>",baseKey:i.slice(2),key:t};break;default:s={operator:"+",baseKey:i.slice(1),key:t}}break;case"-":s={operator:"-",baseKey:i.slice(1),key:t};break;case"*":switch(i[1]){case">":switch(i[2]){case">":s={operator:"*>>",baseKey:i.slice(3),key:t};break;default:s={operator:"*>",baseKey:i.slice(2),key:t}}break;default:s={operator:"*",baseKey:i.slice(1),key:t}}break;case"/":s={operator:"/",baseKey:i.slice(1),key:t};break;case"<":switch(i[1]){case"<":switch(i[2]){case"*":s={operator:"<<*",baseKey:i.slice(3),key:t};break;default:s={operator:"",baseKey:i,key:t}}break;case"*":s={operator:"<*",baseKey:i.slice(2),key:t};break;case"+":s={operator:"<+",baseKey:i.slice(2),key:t};break;case"^":s={operator:"<^",baseKey:i.slice(2),key:t};break;default:s={operator:"",baseKey:i,key:t}}break;case"^":s={operator:"^",baseKey:i.slice(1),key:t};break;default:s={operator:"",baseKey:i,key:t}}}s.foreach=o;s.fullOperator=o?"#"+s.operator:s.operator;return s};r.assignObject=function e(t,n){var r;for(r in t){delete t[r]}for(r in n){t[r]=n[r]}};r.operators={};var o=0;r.operators[""]={rank:o++,reduce:function(e,t){var n,r=t.length;for(n=0;n<r;n++){if(s(e)&&s(t[n])){this.autoReduce(e,t[n])}else{e=t[n]}}t.length=0;return e}};r.operators["<*"]={rank:o++,reduce:function(e,t){if(!s(e)){return e}var n={};var r=[e].concat(t).concat(n).reverse();this.autoReduce.apply(this,r);t.length=0;return n}};r.operators["*>"]={rank:o++,reduce:function(e,t){if(!s(e)){return e}this.autoReduce.apply(this,[e].concat(t));t.length=0;return e}};r.operators["<<*"]={rank:o++,reduce:r.operators["<*"].reduce};r.operators["*>>"]={rank:o++,reduce:r.operators["*>"].reduce};r.operators["<+"]={rank:o++,reduce:function(e,t){var n,r=t.length,i=[];for(n=0;n<r;n++){if(Array.isArray(t[n])){i=t[n].concat(i)}}if(Array.isArray(e)){e=i.concat(e);t.length=0;return e}else{t[0]=i;t.length=1;return e}}};r.operators["+>"]={rank:o++,reduce:function(e,t){var n,r=t.length,i=[];for(n=0;n<r;n++){if(Array.isArray(t[n])){i=i.concat(t[n])}}if(Array.isArray(e)){e=e.concat(i);t.length=0;return e}else{t[0]=i;t.length=1;return e}}};r.operators["/"]={rank:o++,reduce:function(e,t){var n,r=t.length,i=1;for(n=0;n<r;n++){if(!isNaN(t[n])){i*=+t[n]}}if(!isNaN(e)){e=+e/i;t.length=0;return e}else{t[0]=i;t.length=1;return e}}};r.operators["*"]={rank:o++,reduce:function(e,t){var n,r=t.length,i=1;for(n=0;n<r;n++){if(!isNaN(t[n])){i*=+t[n]}}if(!isNaN(e)){e=+e*i;t.length=0;return e}else{t[0]=i;t.length=1;return e}}};r.operators["-"]={rank:o++,reduce:function(e,t){var n,r=t.length,i=0;for(n=0;n<r;n++){if(!isNaN(t[n])){i+=+t[n]}}if(!isNaN(e)){e=+e-i;t.length=0;return e}else{t[0]=i;t.length=1;return e}}};r.operators["+"]={rank:o++,reduce:function(e,t){var n,r=t.length,i=0;for(n=0;n<r;n++){if(!isNaN(t[n])){i+=+t[n]}}if(!isNaN(e)){e=+e+i;t.length=0;return e}else{t[0]=i;t.length=1;return e}}}},{}],18:[function(e,t,n){(function(n){"use strict";function r(){return Object.create(r.prototype)}t.exports=r;r.prototype.__prototypeUID__="nextgen-events/NextGenEvents";r.prototype.__prototypeVersion__=e("../package.json").version;r.SYNC=-Infinity;r.init=function e(){Object.defineProperty(this,"__ngev",{configurable:true,value:{nice:r.SYNC,interruptible:false,recursion:0,contexts:{},states:{},stateGroups:{},listeners:{error:[],interrupt:[],newListener:[],removeListener:[]}}})};r.filterOutCallback=function(e,t){return e!==t};r.prototype.addListener=function e(t,n,i){var s={},o;if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}if(!t||typeof t!=="string"){throw new TypeError(".addListener(): argument #0 should be a non-empty string")}if(typeof n!=="function"){i=n;n=undefined}if(!i||typeof i!=="object"){i={}}s.fn=n||i.fn;s.id=i.id!==undefined?i.id:s.fn;s.once=!!i.once;s.async=!!i.async;s.eventObject=!!i.eventObject;s.nice=i.nice!==undefined?Math.floor(i.nice):r.SYNC;s.context=typeof i.context==="string"?i.context:null;if(typeof s.fn!=="function"){throw new TypeError(".addListener(): a function or an object with a 'fn' property which value is a function should be provided")}if(s.context&&typeof s.context==="string"&&!this.__ngev.contexts[s.context]){this.addListenerContext(s.context)}s.event=t;if(this.__ngev.listeners.newListener.length){o=this.__ngev.listeners.newListener.slice();this.__ngev.listeners[t].push(s);r.emitEvent({emitter:this,name:"newListener",args:[[s]],listeners:o});if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this}this.__ngev.listeners[t].push(s);if(this.__ngev.states[t]){r.emitToOneListener(this.__ngev.states[t],s)}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function e(t,n,r){if(n&&typeof n==="object"){n.once=true}else if(r&&typeof r==="object"){r.once=true}else{r={once:true}}return this.addListener(t,n,r)};r.prototype.removeListener=function e(t,n){var i,s,o=[],a=[];if(!t||typeof t!=="string"){throw new TypeError(".removeListener(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}s=this.__ngev.listeners[t].length;for(i=0;i<s;i++){if(this.__ngev.listeners[t][i].id===n){a.push(this.__ngev.listeners[t][i])}else{o.push(this.__ngev.listeners[t][i])}}this.__ngev.listeners[t]=o;if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.prototype.off=r.prototype.removeListener;r.prototype.removeAllListeners=function e(t){var n;if(!this.__ngev){r.init.call(this)}if(t){if(!t||typeof t!=="string"){throw new TypeError(".removeAllListeners(): argument #0 should be undefined or a non-empty string")}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}n=this.__ngev.listeners[t];this.__ngev.listeners[t]=[];if(n.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",n)}}else{this.__ngev.listeners={}}return this};r.listenerWrapper=function e(t,n,i){var s,o,a;if(n.interrupt){return}if(t.async){if(i){o=i.serial;i.ready=!o}a=function(e){n.listenersDone++;if(e&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=e;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}if(o){r.processQueue.call(n.emitter,t.context,true)}};if(t.eventObject){t.fn(n,a)}else{s=t.fn.apply(undefined,n.args.concat(a))}}else{if(t.eventObject){t.fn(n)}else{s=t.fn.apply(undefined,n.args)}n.listenersDone++}if(s&&n.emitter.__ngev.interruptible&&!n.interrupt&&n.name!=="interrupt"){n.interrupt=s;if(n.callback){n.callback(n.interrupt,n);delete n.callback}n.emitter.emit("interrupt",n.interrupt)}else if(n.listenersDone>=n.listeners.length&&n.callback){n.callback(undefined,n);delete n.callback}};var i=0;r.prototype.emit=function e(){var t;t={emitter:this};if(typeof arguments[0]==="number"){t.nice=Math.floor(arguments[0]);t.name=arguments[1];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): when argument #0 is a number, argument #1 should be a non-empty string")}if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,2,-1)}else{t.args=Array.prototype.slice.call(arguments,2)}}else{t.name=arguments[0];if(!t.name||typeof t.name!=="string"){throw new TypeError(".emit(): argument #0 should be an number or a non-empty string")}t.args=Array.prototype.slice.call(arguments,1);if(typeof arguments[arguments.length-1]==="function"){t.callback=arguments[arguments.length-1];t.args=Array.prototype.slice.call(arguments,1,-1)}else{t.args=Array.prototype.slice.call(arguments,1)}}return r.emitEvent(t)};r.emitEvent=function e(t){var n=t.emitter,s,o,a=0,c,u;if(!n.__ngev){r.init.call(n)}c=n.__ngev.states[t.name];if(c!==undefined){if(c&&t.args.length===c.args.length&&t.args.every(function(e,t){return e===c.args[t]})){return}n.__ngev.stateGroups[t.name].forEach(function(e){n.__ngev.states[e]=null});n.__ngev.states[t.name]=t}if(!n.__ngev.listeners[t.name]){n.__ngev.listeners[t.name]=[]}t.id=i++;t.listenersDone=0;t.once=!!t.once;if(t.nice===undefined||t.nice===null){t.nice=n.__ngev.nice}if(!t.listeners){t.listeners=n.__ngev.listeners[t.name].slice()}n.__ngev.recursion++;u=[];for(s=0,o=t.listeners.length;s<o;s++){a++;r.emitToOneListener(t,t.listeners[s],u)}n.__ngev.recursion--;if(u.length&&n.__ngev.listeners.removeListener.length){n.emit("removeListener",u)}if(!a){if(t.name==="error"){if(t.args[0]){throw t.args[0]}else{throw Error("Uncaught, unspecified 'error' event.")}}if(t.callback){t.callback(undefined,t);delete t.callback}}return t};r.emitToOneListener=function e(t,n,i){var s=t.emitter,o,a,c=false;o=n.context&&s.__ngev.contexts[n.context];if(o&&o.status===r.CONTEXT_DISABLED){return}if(o){a=Math.max(t.nice,n.nice,o.nice)}else{a=Math.max(t.nice,n.nice)}if(n.once){s.__ngev.listeners[t.name]=s.__ngev.listeners[t.name].filter(r.filterOutCallback.bind(undefined,n));if(i){i.push(n)}else{c=true}}if(o&&(o.status===r.CONTEXT_QUEUED||!o.ready)){o.queue.push({event:t,listener:n,nice:a})}else{try{if(a<0){if(s.__ngev.recursion>=-a){setImmediate(r.listenerWrapper.bind(s,n,t,o))}else{r.listenerWrapper.call(s,n,t,o)}}else{setTimeout(r.listenerWrapper.bind(s,n,t,o),a)}}catch(e){s.__ngev.recursion--;throw e}}if(c&&s.__ngev.listeners.removeListener.length){s.emit("removeListener",[n])}};r.prototype.listeners=function e(t){if(!t||typeof t!=="string"){throw new TypeError(".listeners(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[t]){this.__ngev.listeners[t]=[]}return this.__ngev.listeners[t].slice()};r.listenerCount=function(e,t){if(!e||!(e instanceof r)){throw new TypeError(".listenerCount(): argument #0 should be an instance of NextGenEvents")}return e.listenerCount(t)};r.prototype.listenerCount=function(e){if(!e||typeof e!=="string"){throw new TypeError(".listenerCount(): argument #1 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}if(!this.__ngev.listeners[e]){this.__ngev.listeners[e]=[]}return this.__ngev.listeners[e].length};r.prototype.setNice=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.nice=Math.floor(+t||0)};r.prototype.setInterruptible=function e(t){if(!this.__ngev){r.init.call(this)}this.__ngev.interruptible=!!t};r.share=function(e,t){if(!(e instanceof r)||!(t instanceof r)){throw new TypeError("NextGenEvents.share() arguments should be instances of NextGenEvents")}if(!e.__ngev){r.init.call(e)}Object.defineProperty(t,"__ngev",{configurable:true,value:e.__ngev})};r.reset=function e(t){Object.defineProperty(t,"__ngev",{configurable:true,value:null})};r.prototype.setMaxListeners=function(){};r.noop=function(){};r.prototype.defineStates=function e(){var t=this,n=Array.prototype.slice.call(arguments);if(!this.__ngev){r.init.call(this)}n.forEach(function(e){t.__ngev.states[e]=null;t.__ngev.stateGroups[e]=n})};r.prototype.hasState=function e(t){if(!this.__ngev){r.init.call(this)}return!!this.__ngev.states[t]};r.prototype.getAllStates=function e(){var t=this;if(!this.__ngev){r.init.call(this)}return Object.keys(this.__ngev.states).filter(function(e){return t.__ngev.states[e]})};r.groupAddListener=function e(t,n,r,i){if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;t.forEach(function(e){e.addListener(n,r.bind(undefined,e),i)})};r.groupOn=r.groupAddListener;r.groupOnce=function e(t,n,r,i){if(r&&typeof r==="object"){r.once=true}else if(i&&typeof i==="object"){i.once=true}else{i={once:true}}return this.groupAddListener(t,n,r,i)};r.groupGlobalOnce=function e(t,n,i,s){var o,a=false;if(typeof i!=="function"){s=i;i=undefined}if(!s||typeof s!=="object"){s={}}i=i||s.fn;delete s.fn;s.id=s.id||i;o=function(){if(a){return}a=true;r.groupRemoveListener(t,n,s.id);i.apply(undefined,arguments)};t.forEach(function(e){e.once(n,o.bind(undefined,e),s)})};r.groupGlobalOnceAll=function e(t,n,r,i){var s,o=false,a=t.length;if(typeof r!=="function"){i=r;r=undefined}if(!i||typeof i!=="object"){i={}}r=r||i.fn;delete i.fn;i.id=i.id||r;s=function(){if(o){return}if(--a){return}o=true;r.apply(undefined,arguments)};t.forEach(function(e){e.once(n,s.bind(undefined,e),i)})};r.groupRemoveListener=function e(t,n,r){t.forEach(function(e){e.removeListener(n,r)})};r.groupOff=r.groupRemoveListener;r.groupRemoveAllListeners=function e(t,n){t.forEach(function(e){e.removeAllListeners(n)})};r.groupEmit=function e(t){var n,i,s=2,o,a,c=t.length,u,l,f=false;if(typeof arguments[arguments.length-1]==="function"){o=-1;u=arguments[arguments.length-1];l=function(e){if(f){return}if(e){f=true;u(e)}else if(!--c){f=true;u()}}}if(typeof arguments[1]==="number"){s=3;i=typeof arguments[1]}n=arguments[s-1];a=Array.prototype.slice.call(arguments,s,o);t.forEach(function(e){r.emitEvent({emitter:e,name:n,args:a,nice:i,callback:l})})};r.groupDefineStates=function e(t){var n=Array.prototype.slice.call(arguments,1);t.forEach(function(e){e.defineStates.apply(e,n)})};r.CONTEXT_ENABLED=0;r.CONTEXT_DISABLED=1;r.CONTEXT_QUEUED=2;r.prototype.addListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".addListenerContext(): argument #0 should be a non-empty string")}if(!n||typeof n!=="object"){n={}}if(!this.__ngev.contexts[t]){this.__ngev.contexts[t]=Object.create(r.prototype);this.__ngev.contexts[t].nice=r.SYNC;this.__ngev.contexts[t].ready=true;this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;this.__ngev.contexts[t].serial=false;this.__ngev.contexts[t].queue=[]}if(n.nice!==undefined){this.__ngev.contexts[t].nice=Math.floor(n.nice)}if(n.status!==undefined){this.__ngev.contexts[t].status=n.status}if(n.serial!==undefined){this.__ngev.contexts[t].serial=!!n.serial}return this};r.prototype.disableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_DISABLED;return this};r.prototype.enableListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".enableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_ENABLED;if(this.__ngev.contexts[t].queue.length>0){r.processQueue.call(this,t)}return this};r.prototype.queueListenerContext=function e(t){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".queueListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].status=r.CONTEXT_QUEUED;return this};r.prototype.serializeListenerContext=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".serializeListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].serial=n===undefined?true:!!n;return this};r.prototype.setListenerContextNice=function e(t,n){if(!this.__ngev){r.init.call(this)}if(!t||typeof t!=="string"){throw new TypeError(".setListenerContextNice(): argument #0 should be a non-empty string")}if(!this.__ngev.contexts[t]){this.addListenerContext(t)}this.__ngev.contexts[t].nice=Math.floor(n);return this};r.prototype.destroyListenerContext=function e(t){var n,i,s,o,a=[];if(!t||typeof t!=="string"){throw new TypeError(".disableListenerContext(): argument #0 should be a non-empty string")}if(!this.__ngev){r.init.call(this)}for(s in this.__ngev.listeners){o=null;i=this.__ngev.listeners[s].length;for(n=0;n<i;n++){if(this.__ngev.listeners[s][n].context===t){o=[];a.push(this.__ngev.listeners[s][n])}else if(o){o.push(this.__ngev.listeners[s][n])}}if(o){this.__ngev.listeners[s]=o}}if(this.__ngev.contexts[t]){delete this.__ngev.contexts[t]}if(a.length&&this.__ngev.listeners.removeListener.length){this.emit("removeListener",a)}return this};r.processQueue=function e(t,n){var i,s;if(!this.__ngev.contexts[t]){return}i=this.__ngev.contexts[t];if(n){i.ready=true}this.__ngev.recursion++;while(i.ready&&i.queue.length){s=i.queue.shift();if(s.event.interrupt){continue}try{if(s.nice<0){if(this.__ngev.recursion>=-s.nice){setImmediate(r.listenerWrapper.bind(this,s.listener,s.event,i))}else{r.listenerWrapper.call(this,s.listener,s.event,i)}}else{setTimeout(r.listenerWrapper.bind(this,s.listener,s.event,i),s.nice)}}catch(e){this.__ngev.recursion--;throw e}}this.__ngev.recursion--};r.on=r.prototype.on;r.once=r.prototype.once;r.off=r.prototype.off;if(n.AsyncTryCatch){r.prototype.asyncTryCatchId=n.AsyncTryCatch.NextGenEvents.length;n.AsyncTryCatch.NextGenEvents.push(r);if(n.AsyncTryCatch.substituted){n.AsyncTryCatch.substitute()}}r.Proxy=e("./Proxy.js")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":20,"./Proxy.js":19}],19:[function(e,t,n){"use strict";function r(){return r.create()}t.exports=r;var i=e("./NextGenEvents.js");var s="NextGenEvents/message";function o(){}r.create=function e(){var t=Object.create(r.prototype,{localServices:{value:{},enumerable:true},remoteServices:{value:{},enumerable:true},nextAckId:{value:1,writable:true,enumerable:true}});return t};r.prototype.addLocalService=function e(t,n,r){this.localServices[t]=a.create(this,t,n,r);return this.localServices[t]};r.prototype.addRemoteService=function e(t){this.remoteServices[t]=c.create(this,t);return this.remoteServices[t]};r.prototype.destroy=function e(){var t=this;Object.keys(this.localServices).forEach(function(e){t.localServices[e].destroy();delete t.localServices[e]});Object.keys(this.remoteServices).forEach(function(e){t.remoteServices[e].destroy();delete t.remoteServices[e]});this.receive=this.send=o};r.prototype.push=function e(t){if(t.__type!==s||!t.service||typeof t.service!=="string"||!t.event||typeof t.event!=="string"||!t.method){return}switch(t.method){case"event":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveEvent(t);case"ackEmit":return this.remoteServices[t.service]&&this.remoteServices[t.service].receiveAckEmit(t);case"emit":return this.localServices[t.service]&&this.localServices[t.service].receiveEmit(t);case"listen":return this.localServices[t.service]&&this.localServices[t.service].receiveListen(t);case"ignore":return this.localServices[t.service]&&this.localServices[t.service].receiveIgnore(t);case"ackEvent":return this.localServices[t.service]&&this.localServices[t.service].receiveAckEvent(t);default:return}};r.prototype.receive=function e(t){this.push(t)};r.prototype.send=function e(){throw new Error("The send() method of the Proxy MUST be extended/overwritten")};function a(e,t,n,r){return a.create(e,t,n,r)}r.LocalService=a;a.create=function e(t,n,r,s){var o=Object.create(a.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:r,writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},canListen:{value:!!s.listen,writable:true,enumerable:true},canEmit:{value:!!s.emit,writable:true,enumerable:true},canAck:{value:!!s.ack,writable:true,enumerable:true},canRpc:{value:!!s.rpc,writable:true,enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return o};a.prototype.destroy=function e(){var t=this;Object.keys(this.events).forEach(function(e){t.emitter.off(e,t.events[e]);delete t.events[e]});this.emitter=null;this.destroyed=true};a.prototype.receiveEmit=function e(t){if(this.destroyed||!this.canEmit||t.ack&&!this.canAck){return}var n=this;var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(r){n.proxy.send({__type:s,service:n.id,method:"ackEmit",ack:t.ack,event:t.event,interruption:r})}}i.emitEvent(r)};a.prototype.receiveListen=function e(t){if(this.destroyed||!this.canListen||t.ack&&!this.canAck){return}if(t.ack){if(this.events[t.event]){if(this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forwardWithAck.bind(this);this.events[t.event].ack=true;this.emitter.on(t.event,this.events[t.event],{eventObject:true,async:true})}else{if(this.events[t.event]){if(!this.events[t.event].ack){return}this.emitter.off(t.event,this.events[t.event])}this.events[t.event]=a.forward.bind(this);this.events[t.event].ack=false;this.emitter.on(t.event,this.events[t.event],{eventObject:true})}};a.prototype.receiveIgnore=function e(t){if(this.destroyed||!this.canListen){return}if(!this.events[t.event]){return}this.emitter.off(t.event,this.events[t.event]);this.events[t.event]=null};a.prototype.receiveAckEvent=function e(t){if(this.destroyed||!this.canListen||!this.canAck||!t.ack||!this.events[t.event]||!this.events[t.event].ack){return}this.internalEvents.emit("ack",t);
};a.forward=function e(t){if(this.destroyed){return}this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args})};a.forward.ack=false;a.forwardWithAck=function e(t,n){if(this.destroyed){return}var r=this;if(!t.callback){this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,args:t.args});n();return}var i=false;var o=this.proxy.nextAckId++;var a=function e(t){if(i||t.ack!==o){return}i=true;r.internalEvents.off("ack",e);n()};this.internalEvents.on("ack",a);this.proxy.send({__type:s,service:this.id,method:"event",event:t.name,ack:o,args:t.args})};a.forwardWithAck.ack=true;function c(e,t){return c.create(e,t)}r.RemoteService=c;var u=1;var l=2;c.create=function e(t,n){var r=Object.create(c.prototype,{proxy:{value:t,enumerable:true},id:{value:n,enumerable:true},emitter:{value:Object.create(i.prototype),writable:true,enumerable:true},internalEvents:{value:Object.create(i.prototype),writable:true,enumerable:true},events:{value:{},enumerable:true},destroyed:{value:false,writable:true,enumerable:true}});return r};c.prototype.destroy=function e(){var t=this;this.emitter.removeAllListeners();this.emitter=null;Object.keys(this.events).forEach(function(e){delete t.events[e]});this.destroyed=true};c.prototype.emit=function e(t){if(this.destroyed){return}var n=this,r,i,o,a;if(typeof t==="number"){throw new TypeError("Cannot emit with a nice value on a remote service")}if(typeof arguments[arguments.length-1]!=="function"){r=Array.prototype.slice.call(arguments,1);this.proxy.send({__type:s,service:this.id,method:"emit",event:t,args:r});return}r=Array.prototype.slice.call(arguments,1,-1);i=arguments[arguments.length-1];o=this.proxy.nextAckId++;a=false;var c=function e(t){if(a||t.ack!==o){return}a=true;n.internalEvents.off("ack",e);i(t.interruption)};this.internalEvents.on("ack",c);this.proxy.send({__type:s,service:this.id,method:"emit",ack:o,event:t,args:r})};c.prototype.addListener=function e(t,n,r){if(this.destroyed){return}if(typeof n!=="function"){r=n;n=undefined}if(!r||typeof r!=="object"){r={}}r.fn=n||r.fn;this.emitter.addListener(t,r);if(!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length){return}if(r.async&&this.events[t]!==l){this.events[t]=l;this.proxy.send({__type:s,service:this.id,method:"listen",ack:true,event:t})}else if(!r.async&&!this.events[t]){this.events[t]=u;this.proxy.send({__type:s,service:this.id,method:"listen",event:t})}};c.prototype.on=c.prototype.addListener;c.prototype.once=i.prototype.once;c.prototype.removeListener=function e(t,n){if(this.destroyed){return}this.emitter.removeListener(t,n);if((!this.emitter.__ngev.listeners[t]||!this.emitter.__ngev.listeners[t].length)&&this.events[t]){this.events[t]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:t})}};c.prototype.off=c.prototype.removeListener;c.prototype.receiveEvent=function e(t){var n=this;if(this.destroyed||!this.events[t.event]){return}var r={emitter:this.emitter,name:t.event,args:t.args||[]};if(t.ack){r.callback=function e(){n.proxy.send({__type:s,service:n.id,method:"ackEvent",ack:t.ack,event:t.event})}}i.emitEvent(r);var o=r.name;if(!this.emitter.__ngev.listeners[o]||!this.emitter.__ngev.listeners[o].length){this.events[o]=0;this.proxy.send({__type:s,service:this.id,method:"ignore",event:o})}};c.prototype.receiveAckEmit=function e(t){if(this.destroyed||!t.ack||this.events[t.event]!==l){return}this.internalEvents.emit("ack",t)}},{"./NextGenEvents.js":18}],20:[function(e,t,n){t.exports={name:"nextgen-events",version:"0.9.8",description:"The next generation of events handling for javascript! New: abstract away the network!",main:"lib/NextGenEvents.js",directories:{test:"test"},dependencies:{},devDependencies:{browserify:"^13.0.1","expect.js":"^0.3.1",jshint:"^2.9.2",mocha:"^2.5.3","uglify-js":"^2.6.2",ws:"^1.1.1"},scripts:{test:"mocha -R dot"},repository:{type:"git",url:"git+https://github.com/cronvel/nextgen-events.git"},keywords:["events","async","emit","listener","context","series","serialize","namespace","proxy","network"],author:{name:"Cédric Ronvel"},license:"MIT",bugs:{url:"https://github.com/cronvel/nextgen-events/issues"},copyright:{title:"Next-Gen Events",years:[2015,2016],owner:"Cédric Ronvel"},gitHead:"e91559128a1653ed3b58dcadefcac62aa7056207",homepage:"https://github.com/cronvel/nextgen-events#readme",_id:"nextgen-events@0.9.8",_shasum:"ed1712c2b37dad55407b3e941672d1568c3a4630",_from:"nextgen-events@>=0.9.8 <0.10.0",_npmVersion:"2.15.9",_nodeVersion:"4.5.0",_npmUser:{name:"cronvel",email:"cedric.ronvel@gmail.com"},maintainers:[{name:"cronvel",email:"cedric.ronvel@gmail.com"}],dist:{shasum:"ed1712c2b37dad55407b3e941672d1568c3a4630",tarball:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-0.9.8.tgz"},_npmOperationalInternal:{host:"packages-16-east.internal.npmjs.com",tmp:"tmp/nextgen-events-0.9.8.tgz_1473951316005_0.2686476525850594"},_resolved:"https://registry.npmjs.org/nextgen-events/-/nextgen-events-0.9.8.tgz",readme:"ERROR: No README data found!"}},{}],21:[function(e,t,n){"use strict";t.exports={reset:"[0m",bold:"[1m",dim:"[2m",italic:"[3m",underline:"[4m",inverse:"[7m",defaultColor:"[39m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",brightBlack:"[90m",brightRed:"[91m",brightGreen:"[92m",brightYellow:"[93m",brightBlue:"[94m",brightMagenta:"[95m",brightCyan:"[96m",brightWhite:"[97m"}},{}],22:[function(e,t,n){"use strict";n.regExp=n.regExpPattern=function e(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")};n.regExpReplacement=function e(t){return t.replace(/\$/g,"$$$$")};n.format=function e(t){return t.replace(/%/g,"%%")};n.shellArg=function e(t){return"'"+t.replace(/\'/g,"'\\''")+"'"};var r={"\r":"\\r","\n":"\\n","\t":"\\t","":"\\x7f"};n.control=function e(t){return t.replace(/[\x00-\x1f\x7f]/g,function(e){if(r[e]!==undefined){return r[e]}var t=e.charCodeAt(0).toString(16);if(t.length%2){t="0"+t}return"\\x"+t})};var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};n.html=function e(t){return t.replace(/[&<>]/g,function(e){return i[e]})};n.htmlAttr=function e(t){return t.replace(/[&<>"]/g,function(e){return i[e]})};n.htmlSpecialChars=function e(t){return t.replace(/[&<>"']/g,function(e){return i[e]})}},{}],23:[function(e,t,n){"use strict";var r=e("./inspect.js").inspect;var i=e("./inspect.js").inspectError;var s=e("./ansi.js");n.formatMethod=function e(t){if(typeof t!=="string"){if(t===null||t===undefined){return""}else if(typeof t.toString==="function"){t=t.toString()}else{return""}}var n=this,s,o,a=1,c=arguments,u=arguments.length,l=false,f=[];t=t.replace(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/g,function(e,t,h,p,d,m,y){var v,g,b,_,k,x,w,j=[];if(h){return"%"}if(t){if(t==="^"){return"^"}if(!n.markup||!n.markup[t]){return""}l=true;if(typeof n.markup[t]==="function"){v=n.markup[t](f)}else{v=n.markup[t];f.push(v)}return v}if(d){d=parseInt(d);if(p){if(p==="+"){d=a+d}else if(p==="-"){d=a-d}}}else{d=a}a++;if(d>=u||d<1){s=undefined}else{s=c[d]}switch(y){case"s":if(s===null||s===undefined){return""}if(typeof s==="string"){return s}if(typeof s==="number"){return""+s}if(typeof s.toString==="function"){return s.toString()}return"";case"f":if(typeof s==="string"){s=parseFloat(s)}if(typeof s!=="number"){return"0"}if(m!==undefined){switch(m[0]){case"p":b=parseInt(m.slice(1),10);if(b>=1){s=s.toPrecision(b)}break;case"f":b=parseInt(m.slice(1),10);s=s.toFixed(b);break}}return""+s;case"d":case"i":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.floor(s)}return"0";case"u":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0)}return"0";case"U":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),1)}return"1";case"x":if(typeof s==="string"){s=parseInt(s)}if(typeof s!=="number"){return"0"}o=""+Math.max(Math.floor(s),0).toString(16);if(o.length%2){o="0"+o}return o;case"h":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(16)}return"0";case"o":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(8)}return"0";case"b":if(typeof s==="string"){s=parseInt(s)}if(typeof s==="number"){return""+Math.max(Math.floor(s),0).toString(2)}return"0";case"I":return r({style:n&&n.color?"color":"none"},s);case"Y":return r({style:n&&n.color?"color":"none",noFunc:true,enumOnly:true,noDescriptor:true},s);case"E":return i({style:n&&n.color?"color":"none"},s);case"J":return JSON.stringify(s);case"D":return"";case"F":a--;if(m===undefined){return""}_=m.split(":");k=_[0];x=_[1];if(!k){return""}if(x&&(w=x.match(/%([+-]?)([0-9]*)[a-zA-Z]/g))){for(g=0;g<w.length;g++){p=w[g][1];d=w[g][2];if(d){d=parseInt(d,10);if(p){if(p==="+"){d=a+d}else if(p==="-"){d=a-d}}}else{d=a}a++;if(d>=u||d<1){j[g]=undefined}else{j[g]=c[d]}}}if(!n||!n.fn||typeof n.fn[k]!=="function"){return""}return n.fn[k].apply(n,j);default:return""}});if(l&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(f):this.markupReset}if(this.extraArguments){for(;a<u;a++){s=c[a];if(s===null||s===undefined){continue}else if(typeof s==="string"){t+=s}else if(typeof s==="number"){t+=s}else if(typeof s.toString==="function"){t+=s.toString()}}}return t};var o={extraArguments:true,endingMarkupReset:true,markupReset:s.reset,markup:{":":s.reset," ":s.reset+" ","-":s.dim,"+":s.bold,_:s.underline,"/":s.italic,"!":s.inverse,b:s.blue,B:s.brightBlue,c:s.cyan,C:s.brightCyan,g:s.green,G:s.brightGreen,k:s.black,K:s.brightBlack,m:s.magenta,M:s.brightMagenta,r:s.red,R:s.brightRed,w:s.white,W:s.brightWhite,y:s.yellow,Y:s.brightYellow}};n.format=n.formatMethod.bind(o);n.format.default=o;n.markupMethod=function e(t){if(typeof t!=="string"){if(t===null||t===undefined){return""}else if(typeof t.toString==="function"){t=t.toString()}else{return""}}var n=this,r=false,i=[];t=t.replace(/\^(.?)/g,function(e,t){var s;if(t==="^"){return"^"}if(!n.markup||!n.markup[t]){return""}r=true;if(typeof n.markup[t]==="function"){s=n.markup[t](i)}else{s=n.markup[t];i.push(s)}return s});if(r&&this.markupReset&&this.endingMarkupReset){t+=typeof this.markupReset==="function"?this.markupReset(i):this.markupReset}return t};n.markup=n.markupMethod.bind(o);n.format.count=function e(t){var n,r,i,s=1,o=0;if(typeof t!=="string"){return 0}var a=/%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-EG-Z])/g;while((n=a.exec(t))!==null){i=n[1];r=n[2];if(r){r=parseInt(r,10);if(i){if(i==="+"){r=s+r}else if(i==="-"){r=s-r}}}else{r=s}s++;if(o<r){o=r}}return o};n.format.hasFormatting=function e(t){if(t.search(/\^(.?)|(%%)|%([+-]?)([0-9]*)(?:\[([^\]]*)\])?([a-zA-Z])/)!==-1){return true}else{return false}}},{"./ansi.js":21,"./inspect.js":24}],24:[function(e,t,n){(function(t,r){"use strict";var i=e("tree-kit/lib/extend.js");var s=e("./escape.js");var o=e("./ansi.js");function a(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}var n={depth:0,ancestors:[]};if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(e.depth===undefined){e.depth=3}if(e.nofunc){e.noFunc=true}if(e.minimal){e.noFunc=true;e.noDescriptor=true;e.noType=true;e.enumOnly=true;e.funcDetails=false;e.proto=false}return c(n,e,t)}function c(e,n,r){var i,o,a,f,h,p,d,m,y,v,g,b,_="",k="",x="",w,j;d=typeof r;y=n.style.tab.repeat(e.depth);if(d==="function"&&n.noFunc){return""}if(e.key!==undefined){if(e.descriptor){x=[];if(!e.descriptor.configurable){x.push("-conf")}if(!e.descriptor.enumerable){x.push("-enum")}if(!e.descriptor.writable){x.push("-w")}if(x.length){x=x.join(" ")}else{x=""}}if(e.keyIsProperty){if(u(e.key)){k='"'+n.style.key(e.key)+'": '}else{k=n.style.key(e.key)+": "}}else{k="["+n.style.index(e.key)+"] "}if(x){x=" "+n.style.type(x)}}m=e.noPre?"":y+k;if(r===undefined){_+=m+n.style.constant("undefined")+x+n.style.nl}else if(r===null){_+=m+n.style.constant("null")+x+n.style.nl}else if(r===false){_+=m+n.style.constant("false")+x+n.style.nl}else if(r===true){_+=m+n.style.constant("true")+x+n.style.nl}else if(d==="number"){_+=m+n.style.number(r.toString())+(n.noType?"":" "+n.style.type("number"))+x+n.style.nl}else if(d==="string"){_+=m+'"'+n.style.string(s.control(r))+'" '+(n.noType?"":n.style.type("string")+n.style.length("("+r.length+")"))+x+n.style.nl}else if(t.isBuffer(r)){_+=m+n.style.inspect(r.inspect())+" "+(n.noType?"":n.style.type("Buffer")+n.style.length("("+r.length+")"))+x+n.style.nl}else if(d==="object"||d==="function"){o=a="";g=false;if(d==="function"){g=true;o=" "+n.style.funcName(r.name?r.name:"(anonymous)");a=n.style.length("("+r.length+")")}v=false;if(Array.isArray(r)){v=true;a=n.style.length("("+r.length+")")}if(!r.constructor){h="(no constructor)"}else if(!r.constructor.name){h="(anonymous)"}else{h=r.constructor.name}h=n.style.constructorName(h);_+=m;if(!n.noType){if(e.forceType){_+=n.style.type(e.forceType)}else{_+=h+o+a+" "+n.style.type(d)+x}if(!g||n.funcDetails){_+=" "}}f=Object.getOwnPropertyNames(r);if(n.sort){f.sort()}b=l(r);if(b!==undefined){_+="=> "+c({depth:e.depth,ancestors:e.ancestors,noPre:true},n,b)}else if(g&&!n.funcDetails){_+=n.style.nl}else if(!f.length&&!n.proto){_+="{}"+n.style.nl}else if(e.depth>=n.depth){_+=n.style.limit("[depth limit]")+n.style.nl}else if(e.ancestors.indexOf(r)!==-1){_+=n.style.limit("[circular]")+n.style.nl}else{_+=(v&&n.noType?"[":"{")+n.style.nl;j=e.ancestors.slice();j.push(r);for(i=0;i<f.length;i++){try{w=Object.getOwnPropertyDescriptor(r,f[i]);if(!w.enumerable&&n.enumOnly){continue}p=!v||!w.enumerable||isNaN(f[i]);if(!n.noDescriptor&&(w.get||w.set)){_+=c({depth:e.depth+1,ancestors:j,key:f[i],keyIsProperty:p,descriptor:w,forceType:"getter/setter"},n,{get:w.get,set:w.set})}else{_+=c({depth:e.depth+1,ancestors:j,key:f[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,r[f[i]])}}catch(t){_+=c({depth:e.depth+1,ancestors:j,key:f[i],keyIsProperty:p,descriptor:n.noDescriptor?undefined:w},n,t)}}if(n.proto){_+=c({depth:e.depth+1,ancestors:j,key:"__proto__",keyIsProperty:true},n,r.__proto__)}_+=y+(v&&n.noType?"]":"}")+n.style.nl}}if(e.depth===0){if(n.style==="html"){_=s.html(_)}}return _}n.inspect=a;function u(e){if(!e.length){return true}return false}function l(e){switch(e.constructor.name){case"Date":if(e instanceof Date){return e.toString()+" ["+e.getTime()+"]"}break;case"Set":if(typeof Set==="function"&&e instanceof Set){return Array.from(e)}break;case"Map":if(typeof Map==="function"&&e instanceof Map){return Array.from(e)}break;case"ObjectID":if(e._bsontype){return e.toString()}break}return}function f(e,t){var n="",r,i,s;if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!(t instanceof Error)){return}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(t.stack){r=h(e,t.stack)}i=t.type||t.constructor.name;s=t.code||t.name||t.errno||t.number;n+=e.style.errorType(i)+(s?" ["+e.style.errorType(s)+"]":"")+": ";n+=e.style.errorMessage(t.message)+"\n";if(r){n+=e.style.errorStack(r)+"\n"}return n}n.inspectError=f;function h(e,t){if(arguments.length<2){t=e;e={}}else if(!e||typeof e!=="object"){e={}}if(!e.style){e.style=p.none}else if(typeof e.style==="string"){e.style=p[e.style]}if(!t){return}if((e.browser||r.browser)&&t.indexOf("@")!==-1){t=t.replace(/[<\/]*(?=@)/g,"").replace(/^\s*([^@]*)\s*@\s*([^\n]*)(?::([0-9]+):([0-9]+))?$/gm,function(t,n,r,i,s){return e.style.errorStack("    at ")+(n?e.style.errorStackMethod(n)+" ":"")+e.style.errorStack("(")+(r?e.style.errorStackFile(r):e.style.errorStack("unknown"))+(i?e.style.errorStack(":")+e.style.errorStackLine(i):"")+(s?e.style.errorStack(":")+e.style.errorStackColumn(s):"")+e.style.errorStack(")")})}else{t=t.replace(/^[^\n]*\n/,"");t=t.replace(/^\s*(at)\s+(?:([^\s:\(\)\[\]\n]+(?:\([^\)]+\))?)\s)?(?:\[as ([^\s:\(\)\[\]\n]+)\]\s)?(?:\(?([^:\(\)\[\]\n]+):([0-9]+):([0-9]+)\)?)?$/gm,function(t,n,r,i,s,o,a){return e.style.errorStack("    at ")+(r?e.style.errorStackMethod(r)+" ":"")+(i?e.style.errorStack("[as ")+e.style.errorStackMethodAs(i)+e.style.errorStack("] "):"")+e.style.errorStack("(")+(s?e.style.errorStackFile(s):e.style.errorStack("unknown"))+(o?e.style.errorStack(":")+e.style.errorStackLine(o):"")+(a?e.style.errorStack(":")+e.style.errorStackColumn(a):"")+e.style.errorStack(")")})}return t}n.inspectStack=h;var p={};var d=function(e){return e};p.none={tab:"    ",nl:"\n",limit:d,type:function(e){return"<"+e+">"},constant:d,funcName:d,constructorName:function(e){return"<"+e+">"},length:d,key:d,index:d,number:d,inspect:d,string:d,errorType:d,errorMessage:d,errorStack:d,errorStackMethod:d,errorStackMethodAs:d,errorStackFile:d,errorStackLine:d,errorStackColumn:d};p.color=i(null,{},p.none,{limit:function(e){return o.bold+o.brightRed+e+o.reset},type:function(e){return o.italic+o.brightBlack+e+o.reset},constant:function(e){return o.cyan+e+o.reset},funcName:function(e){return o.italic+o.magenta+e+o.reset},constructorName:function(e){return o.magenta+e+o.reset},length:function(e){return o.italic+o.brightBlack+e+o.reset},key:function(e){return o.green+e+o.reset},index:function(e){return o.blue+e+o.reset},number:function(e){return o.cyan+e+o.reset},inspect:function(e){return o.cyan+e+o.reset},string:function(e){return o.blue+e+o.reset},errorType:function(e){return o.red+o.bold+e+o.reset},errorMessage:function(e){return o.red+o.italic+e+o.reset},errorStack:function(e){return o.brightBlack+e+o.reset},errorStackMethod:function(e){return o.brightYellow+e+o.reset},errorStackMethodAs:function(e){return o.yellow+e+o.reset},errorStackFile:function(e){return o.brightCyan+e+o.reset},errorStackLine:function(e){return o.blue+e+o.reset},errorStackColumn:function(e){return o.magenta+e+o.reset}});p.html=i(null,{},p.none,{tab:"&nbsp;&nbsp;&nbsp;&nbsp;",nl:"<br />",limit:function(e){return'<span style="color:red">'+e+"</span>"},type:function(e){return'<i style="color:gray">'+e+"</i>"},constant:function(e){return'<span style="color:cyan">'+e+"</span>"},funcName:function(e){return'<i style="color:magenta">'+e+"</i>"},constructorName:function(e){return'<span style="color:magenta">'+e+"</span>"},length:function(e){return'<i style="color:gray">'+e+"</i>"},key:function(e){return'<span style="color:green">'+e+"</span>"},index:function(e){return'<span style="color:blue">'+e+"</span>"},number:function(e){return'<span style="color:cyan">'+e+"</span>"},inspect:function(e){return'<span style="color:cyan">'+e+"</span>"},string:function(e){return'<span style="color:blue">'+e+"</span>"},errorType:function(e){return'<span style="color:red">'+e+"</span>"},errorMessage:function(e){return'<span style="color:red">'+e+"</span>"},errorStack:function(e){return'<span style="color:gray">'+e+"</span>"},errorStackMethod:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackMethodAs:function(e){return'<span style="color:yellow">'+e+"</span>"},errorStackFile:function(e){return'<span style="color:cyan">'+e+"</span>"},errorStackLine:function(e){return'<span style="color:blue">'+e+"</span>"},errorStackColumn:function(e){return'<span style="color:gray">'+e+"</span>"}})}).call(this,{isBuffer:e("../../browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js")},e("_process"))},{"../../browserify/node_modules/insert-module-globals/node_modules/is-buffer/index.js":6,"./ansi.js":21,"./escape.js":22,_process:8,"tree-kit/lib/extend.js":25}],25:[function(e,t,n){"use strict";function r(e,t){var n,r,s=false,o=arguments.length;if(o<3){return t}var a=Array.prototype.slice.call(arguments,2);o=a.length;if(!e||typeof e!=="object"){e={}}var c={depth:0,prefix:""};if(!e.maxDepth&&e.deep&&!e.circular){e.maxDepth=100}if(e.deepFunc){e.deep=true}if(e.deepFilter&&typeof e.deepFilter==="object"){if(e.deepFilter.whitelist&&(!Array.isArray(e.deepFilter.whitelist)||!e.deepFilter.whitelist.length)){delete e.deepFilter.whitelist}if(e.deepFilter.blacklist&&(!Array.isArray(e.deepFilter.blacklist)||!e.deepFilter.blacklist.length)){delete e.deepFilter.blacklist}if(!e.deepFilter.whitelist&&!e.deepFilter.blacklist){delete e.deepFilter}}if(e.flat){e.deep=true;e.proto=false;e.inherit=false;e.unflat=false;if(typeof e.flat!=="string"){e.flat="."}}if(e.unflat){e.deep=false;e.proto=false;e.inherit=false;e.flat=false;if(typeof e.unflat!=="string"){e.unflat="."}}if(e.inherit){e.own=true;e.proto=false}else if(e.proto){e.own=true}if(!t||typeof t!=="object"&&typeof t!=="function"){s=true}if(!e.skipRoot&&(e.inherit||e.proto)){for(n=o-1;n>=0;n--){r=a[n];if(r&&(typeof r==="object"||typeof r==="function")){if(e.inherit){if(s){t=Object.create(r)}else{Object.setPrototypeOf(t,r)}}else if(e.proto){if(s){t=Object.create(Object.getPrototypeOf(r))}else{Object.setPrototypeOf(t,Object.getPrototypeOf(r))}}break}}}else if(s){t={}}c.references={sources:[],targets:[]};for(n=0;n<o;n++){r=a[n];if(!r||typeof r!=="object"&&typeof r!=="function"){continue}i(c,e,t,r)}return t}t.exports=r;function i(e,t,n,r){var s,o,a,c,u,l,f,h,p,d,m,y=-1;if(t.maxDepth&&e.depth>t.maxDepth){throw new Error("[tree] extend(): max depth reached("+t.maxDepth+")")}if(t.circular){e.references.sources.push(r);e.references.targets.push(n)}if(t.own){if(t.nonEnum){a=Object.getOwnPropertyNames(r)}else{a=Object.keys(r)}}else{a=r}for(c in a){if(t.own){c=a[c]}if(t.descriptor){h=Object.getOwnPropertyDescriptor(r,c);u=h.value}else{u=r[c]}d=n;p=e.prefix+c;if(t.nofunc&&typeof u==="function"){continue}if(t.unflat&&e.depth===0){m=c.split(t.unflat);o=m.length-1;if(o){for(s=0;s<o;s++){if(!d[m[s]]||typeof d[m[s]]!=="object"&&typeof d[m[s]]!=="function"){d[m[s]]={}}d=d[m[s]]}p=e.prefix+m[o]}}if(t.deep&&u&&(typeof u==="object"||t.deepFunc&&typeof u==="function")&&(!t.descriptor||!h.get)&&((l=Object.getPrototypeOf(u))||true)&&(!t.deepFilter||(!t.deepFilter.whitelist||t.deepFilter.whitelist.indexOf(l)!==-1)&&(!t.deepFilter.blacklist||t.deepFilter.blacklist.indexOf(l)===-1))){if(t.circular){y=e.references.sources.indexOf(u)}if(t.flat){if(y>=0){continue}i({depth:e.depth+1,prefix:e.prefix+c+t.flat,references:e.references},t,d,u)}else{if(y>=0){if(t.descriptor){Object.defineProperty(d,p,{value:e.references.targets[y],enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=e.references.targets[y]}continue}if(!d[p]||!d.hasOwnProperty(p)||typeof d[p]!=="object"&&typeof d[p]!=="function"){if(Array.isArray(u)){f=[]}else if(t.proto){f=Object.create(l)}else if(t.inherit){f=Object.create(u)}else{f={}}if(t.descriptor){Object.defineProperty(d,p,{value:f,enumerable:h.enumerable,writable:h.writable,configurable:h.configurable})}else{d[p]=f}}else if(t.proto&&Object.getPrototypeOf(d[p])!==l){Object.setPrototypeOf(d[p],l)}else if(t.inherit&&Object.getPrototypeOf(d[p])!==u){Object.setPrototypeOf(d[p],u)}if(t.circular){e.references.sources.push(u);e.references.targets.push(d[p])}i({depth:e.depth+1,prefix:"",references:e.references},t,d[p],u)}}else if(t.preserve&&d[p]!==undefined){continue}else if(!t.inherit){if(t.descriptor){Object.defineProperty(d,p,h)}else{d[p]=u}}if(t.move){delete r[c]}}}},{}]},{},[2])(2)});